<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Light Curve Classifier - The Fornax Initiative</title><meta property="og:title" content="Light Curve Classifier - The Fornax Initiative"/><meta name="generator" content="mystmd"/><meta name="description" content="Tutorial notebooks for example Fornax use cases"/><meta property="og:description" content="Tutorial notebooks for example Fornax use cases"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/app-5WKS5EPQ.css"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/fornax-demo-notebooks/favicon.ico"/><link rel="stylesheet" href="/fornax-demo-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/fornax-demo-notebooks/"><div class="p-1 mr-3 dark:bg-white dark:rounded"><img src="/fornax-demo-notebooks/build/fornax_logo-1cc32f198ea654577faa7d552bdccccc.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="The Fornax Initiative" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/fornax-demo-notebooks/">The Fornax Initiative</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time Domain" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme">Time Domain</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Spectroscopy" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-1">Spectroscopy</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rup8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rup8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Multi-band forced photometry" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-2">Multi-band forced photometry</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Cross Matching" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-3">Cross Matching</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-none pr-2 smallcaps">Fornax Demo Notebooks</div><div class="flex-grow"></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks" title="GitHub Repository: nasa-fornax/fornax-demo-notebooks" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/light_curves/light_curve_classifier.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Light Curve Classifier</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78top:" data-state="closed">Fornax developers and scientists</button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this tutorial, you will be able to:</p><ul><li>prepare data for ML algorithms by cleaning and filtering the dataset</li><li>work with Pandas dataframes as a way of storing and manipulating time domain datasets</li><li>use <a target="_blank" rel="noreferrer" href="https://www.sktime.net/en/stable/index.html" class="">sktime</a> algorithms to train a classifier and calculate metrics of accuracy</li><li>use the trained classifier to predict labels on an unlabelled dataset</li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The science goal of this notebook is to find a classifier that can accurately discern changing look active galactic nuclei (CLAGN) from a broad sample of all Sloan Digital Sky Survey (SDSS) identified Quasars (QSOs) based solely on archival photometry in the form of multiwavelength light curves.</p><p>CLAGN are astrophysically interesting objects because they appear to change state.  CLAGN are characterized by the appearance or disappearance of broad emission lines on timescales of order months.  Astronomers would like to understand the physical mechanism behind this apparent change of state.  However, only a few hundered CLAGN are known, and finding CLAGN is observationally expensive, traditionally requiring multiple epochs of spectroscopy.  Being able to identify CLAGN in existing, archival, large, photometric samples would allow us to identify a statisitcally significant sample from which we could better understand the underlying physics.</p><p>This notebook walks through an exercise in using multiwavelength photometry(no spectroscopy) to learn if we can identify CLAGN based on their light curves alone.  If we are able to find a classifier that can differentiate CLAGN from SDSS QSOs, we would then be able to run the entire sample of SDSS QSOs (~500,000) to find additional CLAGN candidates for follow-up verification.</p><p>Input to this notebook is output of a previous demo notebook which generates multiwavelength light curves from archival data.  This notebook starts with light curves, does data prep, and runs the light curves through multiple ML classification algorithms.  There are many ML algorthms to choose from; We choose to use sktime algorithms for time domain classification beacuse it is a library of many algorithms specifically tailored to time series datasets.  It is based on the <a target="_blank" rel="noreferrer" href="https://scikit-learn.org/stable/index.html" class="">scikit-learn</a> library so syntax is familiar to many users.</p><p>The challenges of this time-domain dataset for ML work are:</p><ol start="1"><li>Multi-variate = There are multiple bands of observations per target (13+)</li><li>Unequal length = Each band has a light curve with different sampling than other bands</li><li>Missing data = Not each object has all observations in all bands</li></ol><h3 id="input" class="relative group"><span class="heading-text">Input</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#input" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Light curve parquet file of multiwavelength light curves from the light_curve_collector.md demo notebook in this same repo.  The format of the light curves is a Pandas multiindex data frame.</p><p>We choose to use a Pandas multiindex dataframe to store and work with the data because it fulfills these requirements:</p><ol start="1"><li>It can handle the above challenges of a dataset = multi-variate, unqueal length with missing data.</li><li>Multiple targets (multiple rows)</li><li>Pandas has some built in understanding of time units</li><li>Can be scaled up to big data numbers of rows (altough we don’t push to out of memory structures in this use case)</li><li>Pandas is user friendly with a lot of existing functionality</li></ol><p>A useful reference for what sktime expects as input to its ML algorithms: <a href="https://github.com/sktime/sktime/blob/main/examples/AA_datatypes_and_datasets.ipynb" class="italic" target="_blank" rel="noreferrer" data-state="closed">examples<wbr/>/AA<wbr/>_datatypes<wbr/>_and<wbr/>_datasets<wbr/>.ipynb</a></p><h3 id="output" class="relative group"><span class="heading-text">Output</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#output" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Trained classifiers as well as estimates of their accuracy and plots of confusion matrices</p><h3 id="runtime" class="relative group"><span class="heading-text">Runtime</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#runtime" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As of 2024 August, this notebook takes ~170s to run to completion on Fornax using the ‘Astrophysics Default Image’ and the ‘Large’ server with 16GB RAM/ 4CPU.</p><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><code>pandas</code> to work with light curve data structure</li><li><code>numpy</code> for numerical calculations</li><li><code>matplotlib</code> for plotting</li><li><code>sys</code> for paths</li><li><code>astropy</code> to work with coordinates/units and data structures</li><li><code>tqdm</code> for showing progress meter</li><li><code>sktime</code> ML algorithms specifically for time-domain data</li><li><code>sklearn</code> general use ML algorthims with easy to use interface</li><li><code>scipy</code> for statistical analysis</li><li><code>json</code> for storing intermediate files</li><li><code>google_drive_downloader</code> to access files stored in google drive</li></ul><p>This cell will install them if needed:</p><div id="XVaWzGgAXj" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# %pip install -r requirements_light_curve_classifier.txt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="USy9YzghBrW84QiwqVagM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hURpOLWUAI" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import sys

import matplotlib.pyplot as plt
from matplotlib.lines import Line2D
import pandas as pd
from astropy.table import Table
import googledrivedownloader as gdd
from tqdm.auto import tqdm
import json

from sklearn.metrics import ConfusionMatrixDisplay, accuracy_score, confusion_matrix
from sklearn.model_selection import train_test_split
from sklearn.gaussian_process import GaussianProcessRegressor
from sklearn.gaussian_process.kernels import RBF

from sktime.classification.deep_learning import CNNClassifier
from sktime.classification.dictionary_based import IndividualTDE
from sktime.classification.distance_based import KNeighborsTimeSeriesClassifier
from sktime.classification.dummy import DummyClassifier
from sktime.classification.ensemble import WeightedEnsembleClassifier
from sktime.classification.feature_based import Catch22Classifier, RandomIntervalClassifier
from sktime.classification.hybrid import HIVECOTEV2
from sktime.classification.interval_based import CanonicalIntervalForest
from sktime.classification.kernel_based import Arsenal, RocketClassifier
from sktime.classification.shapelet_based import ShapeletTransformClassifier
from sktime.registry import all_estimators, all_tags
from sktime.datatypes import check_is_mtype

# local code imports
sys.path.append(&#x27;code_src/&#x27;)
from classifier_functions import sigmaclip_lightcurves, remove_objects_without_band, \
remove_incomplete_data, missingdata_to_zeros, missingdata_drop_bands, \
uniform_length_spacing, reformat_df, local_normalization_max, mjd_to_datetime

#improves memory usage and avoids problems that trigger warnings
pd.options.mode.copy_on_write = True</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="laDwOVMZ-GzU4AEfuUj6S" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-1-read-in-a-dataset-of-archival-light-curves" class="relative group"><span class="heading-text">1. Read in a dataset of archival light curves</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-read-in-a-dataset-of-archival-light-curves" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We use here a sample of AGN including known CLAGN &amp; random SDSS AGN</p><p>If you want to use your own sample, you can use the code <a target="_blank" rel="noreferrer" href="https://nasa-fornax.github.io/fornax-demo-notebooks/light_curves/light_curve_collector.html" class="">light<wbr/>_curve<wbr/>_collector<wbr/>.md</a> in this same repo to make the required pandas dataframe which you will need to run this notebook.</p><div id="J4siX4mjvn" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># First we want to load light curves made in the light_curve_collector notebook

# The data is on google drive, this will download it for you and read it into
# a pandas dataframe
savename_df_lc = &#x27;./data/small_CLAGN_SDSS_df_lc.parquet&#x27;
gdd.download_file_from_google_drive(file_id=&#x27;1DrB-CWdBBBYuO0WzNnMl5uQnnckL7MWH&#x27;,
                                    dest_path=savename_df_lc,
                                    unzip=True)

#load the data into a pandas dataframe
df_lc = pd.read_parquet(savename_df_lc)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SSrdXW9kVTxCX1rfTuETq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Downloading 1DrB-CWdBBBYuO0WzNnMl5uQnnckL7MWH into ./data/small_CLAGN_SDSS_df_lc.parquet... </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Done.
Unzipping...</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/googledrivedownloader/download.py:88: UserWarning: Ignoring `unzip` since &quot;1DrB-CWdBBBYuO0WzNnMl5uQnnckL7MWH&quot; does not look like a valid zip file
  warnings.warn(&#x27;Ignoring `unzip` since &quot;{}&quot; does not look like a valid zip file&#x27;.format(file_id))
</span></code></pre></div></div></div><div id="td5frMJ3on" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#get rid of indices set in the light curve code and reset them as needed
#before sktime algorithms
df_lc = df_lc.reset_index()

#what does the dataset look like at the start?
df_lc</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="03v9MYUX8upKJEHsIwuCv" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><h2 id="id-2-data-prep" class="relative group"><span class="heading-text">2. Data Prep</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-data-prep" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The majority of work in all ML projects is preparing and cleaning the data.  As most do, this dataset needs significant work before it can be fed into a ML algorithm.  Data preparation includes everything from removing statistical outliers to putting it in the correct data format for the algorithms.</p><h3 id="id-2-1-remove-bands-with-not-enough-data" class="relative group"><span class="heading-text">2.1 Remove bands with not enough data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-1-remove-bands-with-not-enough-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>For this use case of CLAGN classification, we don’t need to include some of the bands
that are known to be sparse.  Most ML algorithms cannot handle sparse data so one way to accomodate that
is to remove the sparsest datasets.</p><div id="H1Mdumtj91" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">##what are the unique set of bands included in our light curves
df_lc.band.unique()

#get rid of some of the bands that don&#x27;t have enough data for all the sources
#CLAGN are generall fainter targets, and therefore mostly not found
#in datasets like TESS &amp; K2

bands_to_drop = [&quot;IceCube&quot;, &quot;TESS&quot;, &quot;FERMIGTRIG&quot;, &quot;K2&quot;]
df_lc = df_lc[~df_lc[&quot;band&quot;].isin(bands_to_drop)]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Q4Jy-uSHROhxAnC1HRtTZ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-2-2-combine-labels-for-a-simpler-classification" class="relative group"><span class="heading-text">2.2 Combine Labels for a Simpler Classification</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-2-combine-labels-for-a-simpler-classification" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>All CLAGN start in the dataset as having labels based on their discovery paper.  Because we want one sample with all known CLAGN, we change those discovery names to be simply “CLAGN” for all CLAGN, regardless of origin.</p><div id="OBx7fcXHvj" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;MacLeod 16&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;LaMassa 15&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;Yang 18&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;Lyu 22&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;Hon 22&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;Sheng 20&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;MacLeod 19&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;Green 22&#x27;, &#x27;CLAGN&#x27;)
df_lc[&#x27;label&#x27;] = df_lc.label.str.replace(&#x27;Lopez-Navas 22&#x27;, &#x27;CLAGN&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WP9hpbCjgq9M6CQFGHFoG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kB7Hxfl7LV" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(df_lc.groupby([&quot;objectid&quot;]).ngroups, &quot;n objects before removing missing band data&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VLsnccpDBohNwwoGvx65j" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>451 n objects before removing missing band data
</span></code></pre></div></div></div><h3 id="id-2-3-data-visualization" class="relative group"><span class="heading-text">2.3 Data Visualization</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-3-data-visualization" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li>can we see any trends by examining plots of a subset of the data?</li></ul><div id="uj6VH2tIjC" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#chhose your own adventure, the bands from which you can choose are:
df_lc.band.unique()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3JeEjsXoDUwTz3T9DnBaE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="font-mono text-sm whitespace-pre-wrap"><code><span>array([&#x27;SAXGRBMGRB&#x27;, &#x27;G&#x27;, &#x27;BP&#x27;, &#x27;RP&#x27;, &#x27;panstarrs i&#x27;, &#x27;panstarrs y&#x27;,
       &#x27;panstarrs z&#x27;, &#x27;panstarrs g&#x27;, &#x27;panstarrs r&#x27;, &#x27;zg&#x27;, &#x27;zi&#x27;, &#x27;zr&#x27;,
       &#x27;W1&#x27;, &#x27;W2&#x27;, &#x27;k2&#x27;], dtype=object)</span></code></div></div></div><div id="e2dhZMFI2y" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#plot a single band for all objects
band_of_interest = &#x27;zr&#x27;
band_lc = df_lc[df_lc[&#x27;band&#x27;] == band_of_interest]
#reset zero time to be start of that mission
band_lc[&quot;time&quot;] = band_lc[&quot;time&quot;] - band_lc[&quot;time&quot;].min()
band_lc.time.min()

band_lc.set_index(&#x27;time&#x27;, inplace = True)  #helps with the plotting

#drop some objects to try to clear up plot
querystring1 = &#x27;objectid &lt; 162&#x27;
querystring2 = &#x27;objectid &gt; 200&#x27;
band_lc = band_lc.drop(band_lc.query(querystring1 ).index)
band_lc = band_lc.drop(band_lc.query(querystring2 ).index)

#quick normalization for plotting
#we normalize for real after cleaning the data
# make a new column with max_r_flux for each objectid
band_lc[&#x27;mean_band&#x27;] = band_lc.groupby(&#x27;objectid&#x27;, sort=False)[&quot;flux&quot;].transform(&#x27;mean&#x27;)
band_lc[&#x27;sigma_band&#x27;] = band_lc.groupby(&#x27;objectid&#x27;, sort=False)[&quot;flux&quot;].transform(&#x27;std&#x27;)

#choose to normalize (flux - mean) / sigma
band_lc[&#x27;flux&#x27;] = (band_lc[&#x27;flux&#x27;] - band_lc[&#x27;mean_band&#x27;]).div(band_lc[&#x27;sigma_band&#x27;], axis=0)

#want to have two different sets so I can color code
clagn_df = band_lc[band_lc[&#x27;label&#x27;] == &#x27;CLAGN&#x27;]
sdss_df = band_lc[band_lc[&#x27;label&#x27;] == &#x27;SDSS&#x27;]
print(clagn_df.groupby([&quot;objectid&quot;]).ngroups, &quot;n objects CLAGN &quot;)
print(sdss_df.groupby([&quot;objectid&quot;]).ngroups, &quot;n objects SDSS &quot;)

#groupy objectid &amp; plot flux vs. time
fig, ax = plt.subplots(figsize=(10,6))
lc_sdss = sdss_df.groupby([&#x27;objectid&#x27;])[&#x27;flux&#x27;].plot(kind=&#x27;line&#x27;, ax=ax, color = &#x27;gray&#x27;, label = &#x27;SDSS&#x27;, linewidth = 0.3)
lc_clagn = clagn_df.groupby([&#x27;objectid&#x27;])[&#x27;flux&#x27;].plot(kind=&#x27;line&#x27;, ax=ax, color = &#x27;orange&#x27;, label = &#x27;CLAGN&#x27;, linewidth = 1)

#add legend and labels/titles
legend_elements = [Line2D([0], [0], color=&#x27;orange&#x27;, lw=4, label=&#x27;CLAGN&#x27;),
                   Line2D([0], [0], color=&#x27;gray&#x27;, lw=4, label=&#x27;SDSS&#x27;)]
ax.legend(handles=legend_elements, loc=&#x27;best&#x27;)

ax.set_ylabel(&#x27;Normalized Flux&#x27;)
ax.set_xlabel(&#x27;Time in days since start of mission&#x27;)
plt.title(f&quot;{band_of_interest} light curves&quot;)

#tailored to ZTF r band with lots of data
ax.set_ylim([-2, 4])
ax.set_xlim([1000, 1250])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="YNxrVfp7LkbPXSC05dAo_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>2 n objects CLAGN 
34 n objects SDSS 
</span></code></pre></div><div class="font-mono text-sm whitespace-pre-wrap"><code><span>(1000.0, 1250.0)</span></code></div><img src="/fornax-demo-notebooks/build/1fb474e56caea4846ccce727de3833bd.png" alt="&lt;Figure size 1000x600 with 1 Axes&gt;"/></div></div><h3 id="id-2-4-clean-the-dataset-of-unwanted-data" class="relative group"><span class="heading-text">2.4 Clean the dataset of unwanted data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-4-clean-the-dataset-of-unwanted-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>“unwanted” includes:</p><ul><li>NaNs<ul><li>SKtime does not work with NaNs</li></ul></li><li>zero flux<ul><li>there are a few flux measurements that come into our dataframe with zeros.  It is not clear what these are, and zero will be used to mean lack of observation in the rest of this notebook, so want to drop these rows at the outset.</li></ul></li><li>outliers in uncertainty<ul><li>This is a tricky job because we want to keep astrophysical sources that are variable objects, but remove instrumental noise and CR (ground based).  The user will need to choose a sigma clipping threshold, and there is some plotting functionality available to help users make that decision</li></ul></li><li>objects with no measurements in WISE W1 band<ul><li>Below we want to normalize all light curves by W1, so we neeed to remove those objects without W1 fluxes because there will be nothing to normalize those light curves with.  We don’t want to have un-normalized data.</li></ul></li><li>objects with incomplete data<ul><li>Incomplete is defined here as not enough flux measurements to make a good light curve.  Some bands in some objects have only a few datapoints. Three data points is not large enough for KNN interpolation, so we will consider any array with fewer than 4 photometry points to be incomplete data.  Another way of saying this is that we choose to remove those light curves with 3 or
fewer data points.</li></ul></li></ul><div id="tOv7ksw2JZ" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#drop rows which have Nans
df_lc.dropna(inplace = True, axis = 0)

#drop rows with zero flux
querystring = &#x27;flux &lt; 0.000001&#x27;
df_lc = df_lc.drop(df_lc.query(querystring).index)

#remove outliers
sigmaclip_value = 10.0
df_lc = sigmaclip_lightcurves(df_lc, sigmaclip_value, include_plot = False)
print(df_lc.groupby([&quot;objectid&quot;]).ngroups, &quot;n objects after sigma clipping&quot;)

#remove incomplete data
threshold_too_few = 3
df_lc = remove_incomplete_data(df_lc, threshold_too_few, verbose = False)

#remove objects without W1 fluxes
df_lc = remove_objects_without_band(df_lc, &#x27;W1&#x27;, verbose=True)

print(df_lc.groupby([&quot;objectid&quot;]).ngroups, &quot;n objects after cleaning the data&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WCsJqr1dul_glOlUcuMAP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>451 n objects after sigma clipping
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>18 objects without W1  were removed
431 n objects after cleaning the data
</span></code></pre></div></div></div><h3 id="id-2-5-missing-data" class="relative group"><span class="heading-text">2.5 Missing Data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-5-missing-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Some objects do not have light curves in all bands.  Some ML algorithms can handle mising data, but not all, so we try to do something intentional and sensible to handle this missing data up front.</p><p>There are two options here:</p><ol start="1"><li>We will add light curves with zero flux and err values for the missing data.  SKtime does not like NaNs, so we choose zeros.  This option has the benefit of including more bands and therefore more information, but the drawback of having some objects have bands with entire arrays of zeros.</li><li>Remove bands which have less data from all objects so that there are no objects with missing data.  This has the benefit of less zeros, but the disadvantage of throwing away some information for the few objects which do have light curves in the bands which will be removed.</li></ol><p>Functions are inlcuded for both options.</p><div id="iziiy0DvQz" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#choose what to do with missing data...
#df_lc = missingdata_to_zeros(df_lc)
#or
bands_to_keep = [&#x27;W1&#x27;,&#x27;W2&#x27;,&#x27;panstarrs g&#x27;,&#x27;panstarrs i&#x27;, &#x27;panstarrs r&#x27;,&#x27;panstarrs y&#x27;,&#x27;panstarrs z&#x27;,&#x27;zg&#x27;,&#x27;zr&#x27;]
df_lc = missingdata_drop_bands(df_lc, bands_to_keep, verbose = True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="2jMrgx0tPzAvDOQ1FweYg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>431 n objects before removing missing band data
357 n objects after removing missing band data
</span></code></pre></div></div></div><h3 id="id-2-6-make-all-objects-and-bands-have-identical-time-arrays-uniform-length-and-spacing" class="relative group"><span class="heading-text">2.6  Make all objects and bands have identical time arrays (uniform length and spacing)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-6-make-all-objects-and-bands-have-identical-time-arrays-uniform-length-and-spacing" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>It is very hard to find time-domain ML algorithms which can work with non uniform length datasets. Therefore we make the light curves uniform by interpolating using KNN from scikit-learn which fills in the uniform length arrays with a final frequency chosen by the user.  We choose KNN as very straightforward method. This function also shows the framework in case the user wants to choose a different scikit-learn function to do the interpolation.  Another natural choice would be to use gaussian processes (GP) to do the interpolation, but this is not a good solution for our task because the flux values go to zero at times before and after the observations.  Because we include the entire time array from beginning of the first mission to end of the last mission, most individual bands require interpolation before and after their particular observations.  In other words, our light curves span the entire range from 2010 with the start of panstarrs and WISE to the most recent ZTF data release (at least 2023), even though most individual missions do not cover that full range of time.</p><p>It is important to choose the frequency over which the data is interpolated wisely.  Experimentation with treating this variable like a hyperparam and testing sktime algorithms shows slightly higher accuracy values for a suite of algorithms for a frequency of one interpolated observation per 60 days.</p><div id="gPybO5XjNy" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#what does the dataframe look like at this point in the code?
df_lc</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ZsQWicuYUwr4-mH-zQ3OK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="oQpmIzumZs" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#this cell takes 13seconds to run on the sample of 458 sources
#change this to change the frequency of the time array
final_freq_interpol = 60  #this is the timescale of interpolation in units of days

#make all light curves have the same time array
df_interpol = uniform_length_spacing(df_lc, final_freq_interpol, include_plot = True )

# df_lc_interpol has one row per dict in lc_interpol. time and flux columns store arrays.
# &quot;explode&quot; the dataframe to get one row per light curve point. time and flux columns will now store floats.
df_lc = df_interpol.explode([&quot;time&quot;, &quot;flux&quot;,&quot;err&quot;], ignore_index=True)
df_lc = df_lc.astype({col: &quot;float&quot; for col in [&quot;time&quot;, &quot;flux&quot;, &quot;err&quot;]})</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="F3HyQM7xwf7qUaCXR5wus" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/fornax-demo-notebooks/build/43d1d57207619d42cbfbb49431cc3c2b.png" alt="&lt;Figure size 640x480 with 1 Axes&gt;"/></div></div><h3 id="id-2-7-restructure-dataframe" class="relative group"><span class="heading-text">2.7  Restructure dataframe</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-7-restructure-dataframe" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li>Make columns have band names in them and then remove band from the index</li><li>pivot the dataframe so that SKTIME understands its format</li><li>this will put it in the format expected by sktime</li></ul><div id="dTO2Diw8I8" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#reformat the data to have columns be the different flux bands
df_lc = reformat_df(df_lc)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ZAfsVWUPVWWKwMnDknANG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iQjHKlaNk1" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#look at a single object to see what this array looks like
ob_of_interest = 12
singleob = df_lc[df_lc[&#x27;objectid&#x27;] == ob_of_interest]
singleob</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="p-aU9ibj0LQA0ehNH8Ke_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><h3 id="id-2-8-normalize" class="relative group"><span class="heading-text">2.8 Normalize</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-8-normalize" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Normalizing is required so that the CLAGN and it’s comparison SDSS sample don’t have different flux levels.  ML algorithms will easily choose to classify based on overall flux levels, so we want to prevent that by normalizing the fluxes. Normalization with a multiband dataset requires extra thought.  The idea here is that we normalize across each object.  We want the algorithms to know, for example, that within one object W1 will be brighter than ZTF bands but from one object to the next, it will not know that one is brighter than the other.</p><p>We do the normalization at this point in the code, rather than before interpolating over time, so that the final light curves are normalized since that is the chunk of information which goes into the ML algorithms.</p><p>We chose to normalize by the maximum flux in one band, and not median or mean because there are some objects where the median flux = 0.0 if we did a replacement by zeros for missing data.</p><div id="wfkO6DCF5O" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#normalize by W1 band
df_lc = local_normalization_max(df_lc, norm_column = &quot;flux_W1&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="f9ceQ6hnfrLLt2QHM4R9J" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-2-9-cleanup" class="relative group"><span class="heading-text">2.9 Cleanup</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-9-cleanup" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li>Make <a target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/datetime.html#module-datetime" class="">datetime</a> column<ul><li>SKTime wants a datetime column</li></ul></li><li>Save dataframe</li></ul><div id="eyMfVfdVxJ" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># need to make a datetime column
df_lc[&#x27;datetime&#x27;] = mjd_to_datetime(df_lc)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="A0ZHH66nXo5TVTs0BxczW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="NwdX1BWPT9" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#save this dataframe to use for the ML below so we don&#x27;t have to make it every time
parquet_savename = &#x27;output/df_lc_ML.parquet&#x27;
#df_lc.to_parquet(parquet_savename)
#print(&quot;file saved!&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="c00GSEncebOhzl0kV91S3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-3-prep-for-ml-algorithms" class="relative group"><span class="heading-text">3. Prep for ML algorithms</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-prep-for-ml-algorithms" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="zZb5qW2j3I" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># could load a previously saved file in order to plot
#parquet_loadname = &#x27;output/df_lc_ML.parquet&#x27;
#df_lc = MultiIndexDFObject()
#df_lc.data = pd.read_parquet(parquet_loadname)
#print(&quot;file loaded!&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="LZScg-KSxzDoMc1mnX0Uz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UV5ndzmM56" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#try dropping the uncertainty columns as variables for sktime
df_lc.drop(columns = [&#x27;err_panstarrs_g&#x27;,	&#x27;err_panstarrs_i&#x27;,	&#x27;err_panstarrs_r&#x27;,	&#x27;err_panstarrs_y&#x27;,
                      &#x27;err_panstarrs_z&#x27;,	&#x27;err_W1&#x27;,	&#x27;err_W2&#x27;,	&#x27;err_zg&#x27;,	&#x27;err_zr&#x27;], inplace = True)

#drop also the time column because time shouldn&#x27;t be a feature
df_lc.drop(columns = [&#x27;time&#x27;],inplace = True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="cj7fGE-_W16zVLBiCxiM3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-3-1-train-test-split" class="relative group"><span class="heading-text">3.1 Train test split</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-train-test-split" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We use sklearn’s train test split to randomly split the data into training and testing datasets.  Because thre are uneven numbers of each type (many more SDSS than CLAGN), we want to make sure to stratify evenly by type.</p><div id="urwzxBOfYg" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#divide the dataframe into features and labels for ML algorithms
labels = df_lc[[&quot;objectid&quot;, &quot;label&quot;]].drop_duplicates().set_index(&quot;objectid&quot;).label
df_lc = df_lc.drop(columns=[&quot;label&quot;]).set_index([&quot;objectid&quot;, &quot;datetime&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="mpWRgK3t6s3xnKQJxVPL9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="cMzywDGZqS" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">test_size = 0.25

#want a stratified split based on label
train_ix, test_ix = train_test_split(df_lc.index.levels[0], stratify = labels, shuffle = True, random_state = 43, test_size = test_size)

#X is defined to be the features
#y is defined to be the labels
X_train = df_lc.loc[train_ix]
y_train = labels.loc[train_ix]
X_test = df_lc.loc[test_ix]
y_test = labels.loc[test_ix]

#plot to show how many of each type of object in the test dataset
plt.figure(figsize=(6,4))
plt.title(&quot;Objects in the Test dataset&quot;)
h = plt.hist(y_test, histtype=&#x27;stepfilled&#x27;, orientation=&#x27;horizontal&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ygbX9WmHMS9nX8saFF-IJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/fornax-demo-notebooks/build/da75ccd2332d33d9e6e55119e5b182e8.png" alt="&lt;Figure size 600x400 with 1 Axes&gt;"/></div></div><h2 id="id-4-run-sktime-algorithms-on-the-light-curves" class="relative group"><span class="heading-text">4. Run sktime algorithms on the light curves</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-run-sktime-algorithms-on-the-light-curves" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We choose to use <a target="_blank" rel="noreferrer" href="https://www.sktime.net/en/stable/index.html" class="">sktime</a> algorithms beacuse it is a library of many algorithms specifically tailored to time series datasets.  It is based on the sklearn library so syntax is familiar to many users.</p><p>Types of classifiers are listed <a target="_blank" rel="noreferrer" href="https://www.sktime.net/en/stable/api_reference/classification.html" class="">here</a>.</p><p>This notebook will first show you an example of a single algorithm classifier. Then it will show how to write a for loop over a bunch of classifiers while outputting some metrics of accuracy.</p><h3 id="id-4-1-check-that-the-data-types-are-ok-for-sktime" class="relative group"><span class="heading-text">4.1 Check that the data types are ok for sktime</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-1-check-that-the-data-types-are-ok-for-sktime" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>This test needs to pass in order for sktime to run</p><div id="hTJw64pSAW" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#ask sktime if it likes the data type of X_train
#if you change any of the functions or cells above this one, it is a good idea to
# look at the below output to make sure you haven&#x27;t introduced any NaNs or unequal length series
check_is_mtype(X_train, mtype=&quot;pd-multiindex&quot;, scitype=&quot;Panel&quot;, return_metadata=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FRH6FplKn6i5037nkdDf0" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="font-mono text-sm whitespace-pre-wrap"><code><span>(True,
 &#x27;&#x27;,
 {&#x27;is_univariate&#x27;: False,
  &#x27;is_empty&#x27;: False,
  &#x27;has_nans&#x27;: np.False_,
  &#x27;n_features&#x27;: 9,
  &#x27;feature_names&#x27;: [&#x27;flux_W1&#x27;,
   &#x27;flux_W2&#x27;,
   &#x27;flux_panstarrs_g&#x27;,
   &#x27;flux_panstarrs_i&#x27;,
   &#x27;flux_panstarrs_r&#x27;,
   &#x27;flux_panstarrs_y&#x27;,
   &#x27;flux_panstarrs_z&#x27;,
   &#x27;flux_zg&#x27;,
   &#x27;flux_zr&#x27;],
  &#x27;dtypekind_dfip&#x27;: [&lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;],
  &#x27;feature_kind&#x27;: [&lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;,
   &lt;DtypeKind.FLOAT: 2&gt;],
  &#x27;n_instances&#x27;: 267,
  &#x27;is_one_series&#x27;: False,
  &#x27;is_equal_length&#x27;: np.True_,
  &#x27;is_equally_spaced&#x27;: True,
  &#x27;n_panels&#x27;: 1,
  &#x27;is_one_panel&#x27;: True,
  &#x27;mtype&#x27;: &#x27;pd-multiindex&#x27;,
  &#x27;scitype&#x27;: &#x27;Panel&#x27;})</span></code></div></div></div><div id="zRz5obbtAL" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#show the list of all possible classifiers that work with multivariate data
#all_tags(estimator_types = &#x27;classifier&#x27;)
#classifiers = all_estimators(&quot;classifier&quot;, filter_tags={&#x27;capability:multivariate&#x27;:True})
#classifiers</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7XbJeCaSkaMQxI0iOSlWV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-4-2-a-single-classifier" class="relative group"><span class="heading-text">4.2 A single Classifier</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-2-a-single-classifier" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="EmgqfjtJY6" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
#this cell takes 35s to run on a sample of 267 light curves

#setup the classifier
#n_jobs is the number of jobs to run in parallel. some environments have trouble with this.
#if you encounter an error such as &#x27;BrokenProcessPool&#x27; while training or predicting, you may
#want to either set n_jobs = 1 or use a different compute environment.
clf = Arsenal(time_limit_in_minutes=1, n_jobs = -1)  # &#x27;-1&#x27; n_jobs means use all processors

#fit the classifier on the training dataset
clf.fit(X_train, y_train)

#make predictions on the test dataset using the trained model
y_pred = clf.predict(X_test)

print(f&quot;Accuracy of Random Interval Classifier: {accuracy_score(y_test, y_pred)}\n&quot;, flush=True)

#plot a confusion matrix
cm = confusion_matrix(y_test, y_pred, labels=clf.classes_)
disp = ConfusionMatrixDisplay(confusion_matrix=cm,display_labels=clf.classes_)
disp.plot()

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="J4wVpOmz1B5KPXIh3MXtm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Accuracy of Random Interval Classifier: 0.7333333333333333

</span></code></pre></div><img src="/fornax-demo-notebooks/build/4e8b512861dd52edec2826aa198db7f3.png" alt="&lt;Figure size 640x480 with 2 Axes&gt;"/><div><pre class="text-sm font-thin font-system"><code><span>CPU times: user 629 ms, sys: 291 ms, total: 920 ms
Wall time: 1min 8s
</span></code></pre></div></div></div><h3 id="id-4-3-loop-over-a-bunch-of-classifiers" class="relative group"><span class="heading-text">4.3 Loop over a bunch of classifiers</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-3-loop-over-a-bunch-of-classifiers" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Our method is to do a cursory check of a bunch of classifiers and then later drill down deeper on anything with good initial results.  We choose to run a loop over ~10 classifiers that seem promising and check the accuracy scores for each one.  Any classifier with a promising accuracy score could then be followed up with detailed hyperparameter tuning, or potentially with considering other classifiers in that same type.</p><details class="myst-exercise my-5 shadow dark:bg-stone-800 overflow-hidden dark:border-l-4 border-slate-400 dark:border-red-500/60"><summary class="myst-exercise-header m-0 font-medium py-2 flex min-w-0 text-md border-y dark:border-y-0 bg-red-50/80 dark:bg-slate-900 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03]"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-exercise-header-icon inline-block pl-2 mr-2 self-center flex-none text-red-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg><div class="myst-exercise-title text-neutral-900 dark:text-white grow self-center overflow-hidden break-words group"><code>raw-cell</code> - Unknown Directive</div><div class="self-center flex-none text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="inline-block pl-2 mr-2 self-center flex-none transition-transform details-toggle"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></div></summary><div class="myst-exercise-body px-4 details-body"><pre>%%time
#This cell is currently not being run because it takes a long time

#which classifiers are we interestd in
#roughly one from each type of classifier

names = [&quot;Arsenal&quot;,                     #kernel based
        &quot;RocektClassifier&quot;,             #kernel based
        &quot;CanonicalIntervalForest&quot;,      #interval based
        &quot;HIVECOTEV2&quot;,                   #hybrid
#        &quot;CNNClassifier&quot;,               #Deep Learning  - **requires tensorflow which is giving import errors
#        &quot;WeightedEnsembleClassifier&quot;,   #Ensemble - **maybe use in the future if we find good options
        &quot;IndividualTDE&quot;,               #Dictionary-based
        &quot;KNeighborsTimeSeriesClassifier&quot;, #Distance Based
        &quot;RandomIntervalClassifier&quot;,     #Feature based
        &quot;Catch22Classifier&quot;,            #Feature based
        &quot;ShapeletTransformClassifier&quot;   #Shapelet based
        &quot;DummyClassifier&quot;]             #Dummy - ignores input

#for those with an impossible time limit, how long to let them run for before cutting off
nmins = 3

#these could certainly be more tailored
classifier_call = [Arsenal(time_limit_in_minutes=nmins, n_jobs = -1),
                  RocketClassifier(num_kernels=2000),
                  CanonicalIntervalForest(n_jobs = -1),
                  HIVECOTEV2(time_limit_in_minutes=nmins, n_jobs = -1),
#                  CNNClassifier(),
#                  WeightedEnsembleClassifier(),
                  IndividualTDE(n_jobs=-1),
                  KNeighborsTimeSeriesClassifier(n_jobs = -1),
                  RandomIntervalClassifier(n_intervals = 20, n_jobs = -1, random_state = 43),
                  Catch22Classifier(outlier_norm = True, n_jobs = -1, random_state = 43),
                  ShapeletTransformClassifier(time_limit_in_minutes=nmins,n_jobs = -1),
                  DummyClassifier()]

#setup to store the accuracy scores
accscore_dict = {}

# iterate over classifiers
for name, clf in tqdm(zip(names, classifier_call)):
    #fit the classifier
    clf.fit(X_train, y_train)

    #make predictions on the test dataset
    y_pred = clf.predict(X_test)

    #calculate and track accuracy score
    accscore = accuracy_score(y_test, y_pred)
    print(f&quot;Accuracy of {name} classifier: {accscore}\n&quot;, flush=True)
    accscore_dict[name] = accscore

    #plot confusion matrix
    cm = confusion_matrix(y_test, y_pred, labels=clf.classes_)
    disp = ConfusionMatrixDisplay(confusion_matrix=cm,display_labels=clf.classes_)
    disp.plot()
    plt.show()</pre></div></details><div id="tTsFK11lsx" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#show the summary of the algorithms used and their accuracy score
#accscore_dict</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="fT1NtS9pgGq0VSuFsH9uV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MJQ19kNZfO" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#save statistics from these runs

# Serialize data into file:
#json.dump( accscore_dict, open( &quot;output/accscore.json&quot;, &#x27;w&#x27; ) )
#json.dump( completeness_dict, open( &quot;output/completeness.json&quot;, &#x27;w&#x27; ) )
#json.dump( homogeneity_dict, open( &quot;output/homogeneity.json&quot;, &#x27;w&#x27; ) )

# Read data from file:
#accscore_dict = json.load( open( &quot;output/accscore.json&quot;) )</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="pcy2rvh50auXpucAJuD9z" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-5-create-a-candidate-list" class="relative group"><span class="heading-text">5. Create a candidate list</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-create-a-candidate-list" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Lets assume we now have a classifier which can accurately differentiate CLAGN from SDSS QSOs based on their archival light curves.  Next, we would like to use that classifier on our favorite unlabeled sample to identify CLAGN candidates.  To do this, we need to:</p><ul><li>read in a dataframe of our new sample</li><li>get that dataset in the same format as what was fed into the classifiers</li><li>use your trained classifier to predict labels for the new sample</li><li>retrace those objectids to an ra &amp; dec</li><li>write an observing proposal (ok, you have to do that one yourself)</li></ul><div id="WG2Fb5nVt0" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#read in a dataframe of our new sample:
# we are going to cheat here and use the same file as we used for input to the above, but you should
# replace this with your favorite sample run through the light_curve_collector in this same repo.
path_to_sample = &#x27;./data/small_CLAGN_SDSS_df_lc.parquet&#x27;
my_sample = pd.read_parquet(path_to_sample)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GfvqWWmi7O775D-QtEix8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="X6eZDSj4zR" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#get dataset in same format as what was run through sktime
#This is not exactly the same as re-running the whole notebook on a different sample,
#but it is pretty close.  We don&#x27;t need to do all of the same cleaning because some of that
#was to appease sktime in training the algorithms.


#get rid of indices set in the light curve code and reset them as needed before sktime algorithms
my_sample = my_sample.reset_index()

# get rid of some of the bands that don&#x27;t have enough data for all the sources
#CLAGN are generall fainter targets, and therefore mostly not found in datasets like TESS &amp; K2
#make sure your sample has the same bands as were run to train the classifier
my_sample = my_sample[~my_sample[&quot;band&quot;].isin(bands_to_drop)]

#drop rows which have Nans
my_sample.dropna(inplace = True, axis = 0)

#remove outliers
#make sure your sample has the same sigmaclip_value as was run to train the classifier
my_sample = sigmaclip_lightcurves(my_sample, sigmaclip_value, include_plot = False, verbose= False)

#remove objects without W1 fluxes
my_sample = remove_objects_without_band(my_sample, &#x27;W1&#x27;, verbose=False)

#remove incomplete data
#make sure your sample has the same threshold_too_few as were run to train the classifier
my_sample = remove_incomplete_data(my_sample, threshold_too_few, verbose = False)

#drop missing bands
my_sample = missingdata_drop_bands(my_sample, bands_to_keep, verbose = False)

#make arrays have uniform length and spacing
#make sure your sample has the same final_feq_interpol as was run to train the classifier
df_interpol = uniform_length_spacing(my_sample, final_freq_interpol, include_plot = False )
my_sample = df_interpol.explode([&quot;time&quot;, &quot;flux&quot;,&quot;err&quot;], ignore_index=True)
my_sample = my_sample.astype({col: &quot;float&quot; for col in [&quot;time&quot;, &quot;flux&quot;, &quot;err&quot;]})

#reformat the data to have columns be the different flux bands
my_sample = reformat_df(my_sample)

#normalize
my_sample = local_normalization_max(my_sample, norm_column = &quot;flux_W1&quot;)

#make datetime column
my_sample[&#x27;datetime&#x27;] = mjd_to_datetime(my_sample)

#set index expected by sktime
my_sample = my_sample.set_index([&quot;objectid&quot;, &quot;label&quot;, &quot;datetime&quot;])

#drop the uncertainty and time columns
my_sample.drop(columns = [&#x27;err_panstarrs_g&#x27;,	&#x27;err_panstarrs_i&#x27;,	&#x27;err_panstarrs_r&#x27;,	&#x27;err_panstarrs_y&#x27;,
                          &#x27;err_panstarrs_z&#x27;,	&#x27;err_W1&#x27;,	&#x27;err_W2&#x27;,	&#x27;err_zg&#x27;,	&#x27;err_zr&#x27;,&#x27;time&#x27;], inplace = True)

 #make X
X_mysample  = my_sample.droplevel(&#x27;label&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Gfk6N-zqELVbvBxkkbHzJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FGq5hSz7XV" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#what does this look like to make sure we are on track
X_mysample</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8irxgvZ0P449IsooDUu2w" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="GOCzm0i1Wy" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#use the trained sktime algorithm to make predictions on the test dataset
y_mysample = clf.predict(X_mysample)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="DwTNAZOv9MYwPlAjODr7w" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="geMpOGWJ7s" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#access the sample_table made in the light_curve_collector notebook
#has information about the sample including ra &amp; dec
savename_sample = &#x27;./data/small_CLAGN_SDSS_sample.ecsv&#x27;
gdd.download_file_from_google_drive(file_id=&#x27;1pSEKVP4LbrdWQK9ws3CaI90m3Z_2fazL&#x27;,
                                    dest_path=savename_sample,
                                    unzip=True)
sample_table = Table.read(savename_sample, format=&#x27;ascii.ecsv&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qhOIdwAFxwhga30iHEt0-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Downloading 1pSEKVP4LbrdWQK9ws3CaI90m3Z_2fazL into ./data/small_CLAGN_SDSS_sample.ecsv... </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Done.
Unzipping...</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/googledrivedownloader/download.py:88: UserWarning: Ignoring `unzip` since &quot;1pSEKVP4LbrdWQK9ws3CaI90m3Z_2fazL&quot; does not look like a valid zip file
  warnings.warn(&#x27;Ignoring `unzip` since &quot;{}&quot; does not look like a valid zip file&#x27;.format(file_id))
</span></code></pre></div></div></div><div id="wXHPqdsGIg" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#associate these predicted CLAGN with RA &amp; Dec

#need to first associate objectid with each of y_mysample
#make a new df with a column = objectid which
#includes all the unique objectids.
test = X_mysample.reset_index()
mysample_CLAGN = pd.DataFrame(test.objectid.unique(), columns = [&#x27;objectid&#x27;])
mysample_CLAGN[&quot;predicted_label&quot;] = pd.Series(y_mysample)

#if I am only interested in the CLAGN, could drop anything with label = SDSS
querystring = &#x27;predicted_label == &quot;SDSS&quot;&#x27;
mysample_CLAGN = mysample_CLAGN.drop(mysample_CLAGN.query(querystring ).index)

#then will need to merge candidate_CLAGN with sample_table along objectid
sample_table_df = sample_table.to_pandas()
candidate_CLAGN = pd.merge(mysample_CLAGN, sample_table_df, on = &quot;objectid&quot;, how = &quot;inner&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rzFzapeP2Ajc6-MyEd7_o" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Aiv3yc14qW" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#show the CLAGN candidates ra &amp; dec
candidate_CLAGN</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="iaSIiYlz0GdUYa_My6XfY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><h2 id="conclusions" class="relative group"><span class="heading-text">Conclusions</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#conclusions" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Depending on your comfort level with the accuracy of the classifier you have trained, you could now write an observing proposal to confirm those targets prediced to be CLAGN based on their multiwavelength light curves.</p><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><strong>Authors:</strong> Jessica Krick, Shoubaneh Hemmati, Troy Raen, Brigitta Sipőcz, Andreas Faisst, Vandana Desai, David Shupe, and the Fornax team</li><li><strong>Contact:</strong> For help with this notebook, please open a topic in the <a target="_blank" rel="noreferrer" href="https://discourse.fornax.sciencecloud.nasa.gov/" class="">Fornax Community Forum</a> “Support” category.</li></ul><h3 id="acknowledgements" class="relative group"><span class="heading-text">Acknowledgements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acknowledgements" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li>Stephanie La Massa</li></ul><h3 id="references" class="relative group"><span class="heading-text">References</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li>“sktime: A Unified Interface for Machine Learning with Time Series”
Markus Löning, Tony Bagnall, Sajaysurya Ganesh, George Oastler, Jason Lines, ViktorKaz, …, Aadesh Deshmukh (2020). sktime/sktime. Zenodo. <cite class="" data-state="closed"><a href="https://doi.org/10.5281/ZENODO.3749000" target="_blank" rel="noreferrer" class="hover-link">Franz Király <em>et al.</em> (2025)</a></cite></li><li>“Scikit-learn: Machine Learning in Python”, Pedregosa et al., JMLR 12, pp. 2825-2830, 2011.</li><li>“pandas-dev/pandas: Pandas” The pandas development team, 2020. Zenodo. <cite class="" data-state="closed"><a href="https://doi.org/10.5281/ZENODO.3509134" target="_blank" rel="noreferrer" class="hover-link">team (2025)</a></cite></li><li>This work made use of <a target="_blank" rel="noreferrer" href="http://www.astropy.org" class="">Astropy</a> a community-developed core Python package and an ecosystem of tools and resources for astronomy (astropy:2013, astropy:2018, astropy:2022).</li></ul><div></div><section id="references" class="article-grid subgrid-gap col-screen"><div><header class="text-lg font-semibold text-stone-900 dark:text-white group">References<a class="no-underline text-inherit hover:text-inherit ml-2 select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to References" aria-label="Link to References">¶</a></header></div><div class="pl-3 mb-8 text-xs text-stone-500 dark:text-stone-300"><ol><li class="break-words" id="cite-https://doi.org/10.5281/zenodo.3749000">Franz Király, Markus Löning, Tony Bagnall, Matthew Middlehurst, Anirban Ray, Sajaysurya Ganesh, Martin Walter, George Oastler, Jason Lines, ViktorKaz, Benedikt Heidrich, Lukasz Mentel, Sagar Mishra, Jigyasu Krishnan, chrisholder, Daniel Bartling, Armaghan Shakir, Leonidas Tsaprounis, RNKuhns, … ericjb. (2025). <i>sktime/sktime: v0.39.0</i>. Zenodo. <a target="_blank" rel="noreferrer" href="https://doi.org/10.5281/ZENODO.3749000">10.5281/ZENODO.3749000</a></li><li class="break-words" id="cite-https://doi.org/10.5281/zenodo.3509134">The pandas development team. (2025). <i>pandas-dev/pandas: Pandas</i>. Zenodo. <a target="_blank" rel="noreferrer" href="https://doi.org/10.5281/ZENODO.3509134">10.5281/ZENODO.3509134</a></li></ol></div></section><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/fornax-demo-notebooks/scale-up"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Make Multi-Wavelength Light Curves for Large Samples</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/fornax-demo-notebooks/ml-agnzoo"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>AGN Zoo: Comparison of AGN selected with different metrics</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/fornax-demo-notebooks/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-XWET6RJ7.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-C7FW3E47.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-ND43KHSX.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/root-ZJOPFBMV.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-NFM2H3KQ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/routes/$-CQPS5IOR.js"/><script>window.__remixContext = {"url":"/light-curve-classifier","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-130ae939cafcaad1dea0a100082c930b.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-1cc32f198ea654577faa7d552bdccccc.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/fornax-demo-notebooks"},"routes/$":{"config":{"version":2,"myst":"1.6.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-130ae939cafcaad1dea0a100082c930b.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-1cc32f198ea654577faa7d552bdccccc.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Notebook","sha256":"a15aef6a3e3c2f37fdd1d6115d539fc0908b75e75c6d2cbc6d960f00aeb01ea7","slug":"light-curve-classifier","location":"/light_curves/light_curve_classifier.md","dependencies":[],"frontmatter":{"title":"Light Curve Classifier","kernelspec":{"name":"python3","display_name":"py-light_curve_classifier","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.0"}},"content_includes_title":false,"authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","subject":"Fornax Demo Notebooks","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/light_curves/light_curve_classifier.md","exports":[{"format":"md","filename":"light_curve_classifier.md","url":"/fornax-demo-notebooks/build/light_curve_classifi-2648d07fb6f97315f8d2525b83a71df7.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"I6kb3Ew451"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"Rg1jcHpeCy"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will be able to:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"lgI4pSy17U"}],"key":"GhdQ4gWpOT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":19,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"prepare data for ML algorithms by cleaning and filtering the dataset","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ndZjaDCU4f"}],"key":"EFHHNRyWTn"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"work with Pandas dataframes as a way of storing and manipulating time domain datasets","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"eOfY2HWtTK"}],"key":"ARDniMvikZ"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"use ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"WZBQ5P0XY8"},{"type":"link","url":"https://www.sktime.net/en/stable/index.html","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"sktime","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"L1pzXymAAX"}],"urlSource":"https://www.sktime.net/en/stable/index.html","key":"WN1cWZmRVI"},{"type":"text","value":" algorithms to train a classifier and calculate metrics of accuracy","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"JuCqZeQrCS"}],"key":"KnIEoISxjD"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"use the trained classifier to predict labels on an unlabelled dataset","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"WFF1WzVto2"}],"key":"eoDM9gaSoZ"}],"key":"ATGIM9terM"},{"type":"heading","depth":2,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"fvfwyXpjJS"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"DlFJmP7jz0"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"The science goal of this notebook is to find a classifier that can accurately discern changing look active galactic nuclei (CLAGN) from a broad sample of all Sloan Digital Sky Survey (SDSS) identified Quasars (QSOs) based solely on archival photometry in the form of multiwavelength light curves.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"tGYiucmIEr"}],"key":"T5mJ3Qwse7"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"CLAGN are astrophysically interesting objects because they appear to change state.  CLAGN are characterized by the appearance or disappearance of broad emission lines on timescales of order months.  Astronomers would like to understand the physical mechanism behind this apparent change of state.  However, only a few hundered CLAGN are known, and finding CLAGN is observationally expensive, traditionally requiring multiple epochs of spectroscopy.  Being able to identify CLAGN in existing, archival, large, photometric samples would allow us to identify a statisitcally significant sample from which we could better understand the underlying physics.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Y8ocTpUEZv"}],"key":"mucplD8slc"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"This notebook walks through an exercise in using multiwavelength photometry(no spectroscopy) to learn if we can identify CLAGN based on their light curves alone.  If we are able to find a classifier that can differentiate CLAGN from SDSS QSOs, we would then be able to run the entire sample of SDSS QSOs (~500,000) to find additional CLAGN candidates for follow-up verification.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"WFxfa3k1hf"}],"key":"IUmaMD0OMN"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Input to this notebook is output of a previous demo notebook which generates multiwavelength light curves from archival data.  This notebook starts with light curves, does data prep, and runs the light curves through multiple ML classification algorithms.  There are many ML algorthms to choose from; We choose to use sktime algorithms for time domain classification beacuse it is a library of many algorithms specifically tailored to time series datasets.  It is based on the ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"gDn8g3YDBE"},{"type":"link","url":"https://scikit-learn.org/stable/index.html","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"scikit-learn","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"ZzNnrS02Yp"}],"urlSource":"https://scikit-learn.org/stable/index.html","key":"BpckVPMQnP"},{"type":"text","value":" library so syntax is familiar to many users.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"PNj6rIe0Wl"}],"key":"InheNvFYxs"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"The challenges of this time-domain dataset for ML work are:","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"HR53rraoC8"}],"key":"klxZxgzNaH"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Multi-variate = There are multiple bands of observations per target (13+)","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"vjluS3yW9L"}],"key":"iBn2S1HyPQ"},{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Unequal length = Each band has a light curve with different sampling than other bands","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"hPlaNzMjgd"}],"key":"lrOpLjEudu"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Missing data = Not each object has all observations in all bands","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"OvDVNCpVsF"}],"key":"uISdzv2rQS"}],"key":"G96PXK4Sph"},{"type":"heading","depth":3,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Input","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"XLldOEu6Wf"}],"identifier":"input","label":"Input","html_id":"input","implicit":true,"key":"mUlshvh7Z2"},{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Light curve parquet file of multiwavelength light curves from the light_curve_collector.md demo notebook in this same repo.  The format of the light curves is a Pandas multiindex data frame.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"goxHQDiIlz"}],"key":"YAlvHh3jeK"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"We choose to use a Pandas multiindex dataframe to store and work with the data because it fulfills these requirements:","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"uWbvpxGeBx"}],"key":"FXu17FDSSt"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":44,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"It can handle the above challenges of a dataset = multi-variate, unqueal length with missing data.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"dqCsWZ5V1C"}],"key":"fF4V8vaLaO"},{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Multiple targets (multiple rows)","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"AZDcSsEVTc"}],"key":"xNlYYEA5Ei"},{"type":"listItem","spread":true,"position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"Pandas has some built in understanding of time units","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"wwAGkhJfAq"}],"key":"YUaSsVb98E"},{"type":"listItem","spread":true,"position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"Can be scaled up to big data numbers of rows (altough we don’t push to out of memory structures in this use case)","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"ymcGlhbStR"}],"key":"cmE7UUMdw4"},{"type":"listItem","spread":true,"position":{"start":{"line":48,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"Pandas is user friendly with a lot of existing functionality","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"zRdxnQr44a"}],"key":"xnIIKaRw80"}],"key":"iKJ56R8csa"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"A useful reference for what sktime expects as input to its ML algorithms: ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"M1GKnUP3aV"},{"type":"link","url":"https://github.com/sktime/sktime/blob/main/examples/AA_datatypes_and_datasets.ipynb","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"examples​/AA​_datatypes​_and​_datasets​.ipynb","key":"O3LsFIG5ZX"}],"urlSource":"https://github.com/sktime/sktime/blob/main/examples/AA_datatypes_and_datasets.ipynb","data":{"kind":"file","org":"sktime","repo":"sktime","reference":"main","file":"examples/AA_datatypes_and_datasets.ipynb","raw":"https://raw.githubusercontent.com/sktime/sktime/main/examples/AA_datatypes_and_datasets.ipynb"},"internal":false,"protocol":"github","key":"QDu2rKYAPH"}],"key":"MA1LzbVk7i"},{"type":"heading","depth":3,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"e2jf8mGobw"}],"identifier":"output","label":"Output","html_id":"output","implicit":true,"key":"ovWI1EFscp"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Trained classifiers as well as estimates of their accuracy and plots of confusion matrices","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"RlJUApNocA"}],"key":"rZ4WzH7P9i"},{"type":"heading","depth":3,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"Runtime","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"tu2PlEJ9AX"}],"identifier":"runtime","label":"Runtime","html_id":"runtime","implicit":true,"key":"pglc6d2Mad"},{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"As of 2024 August, this notebook takes ~170s to run to completion on Fornax using the ‘Astrophysics Default Image’ and the ‘Large’ server with 16GB RAM/ 4CPU.","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"JtB9A133sz"}],"key":"usJtiO3YBW"},{"type":"heading","depth":2,"position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"B4H0kiLERU"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"Bl3b5c4Fdq"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":62,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"inlineCode","value":"pandas","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"K9VtAYnniz"},{"type":"text","value":" to work with light curve data structure","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"HRJv33wlSD"}],"key":"Bv3wUDREM6"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"inlineCode","value":"numpy","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"ncgKtQtNPU"},{"type":"text","value":" for numerical calculations","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"pLKI6VivJ5"}],"key":"vs6ybzpIRf"},{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"inlineCode","value":"matplotlib","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"TvJrvqw6rW"},{"type":"text","value":" for plotting","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"yq3bHofyXt"}],"key":"uFCkkr6e44"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"inlineCode","value":"sys","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"cYTsx2ifom"},{"type":"text","value":" for paths","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"tPASY5b4YF"}],"key":"zb3muKOlCD"},{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"inlineCode","value":"astropy","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"xwuRURLKzH"},{"type":"text","value":" to work with coordinates/units and data structures","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"FlZG7ZcRvu"}],"key":"mmvFOMtyLx"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"inlineCode","value":"tqdm","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"AHBFOdYjHN"},{"type":"text","value":" for showing progress meter","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"QzAfLyeJjf"}],"key":"nX8050qecL"},{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"inlineCode","value":"sktime","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"vV056e1soB"},{"type":"text","value":" ML algorithms specifically for time-domain data","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"HmeGwWJKxA"}],"key":"EP83kUjHVM"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"inlineCode","value":"sklearn","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"Snr4ptaU4m"},{"type":"text","value":" general use ML algorthims with easy to use interface","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"btwkgtne99"}],"key":"OiVe7bfjBU"},{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"inlineCode","value":"scipy","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"A02HGO6BJr"},{"type":"text","value":" for statistical analysis","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"h55SHsxNEY"}],"key":"sYHCDjN6VY"},{"type":"listItem","spread":true,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"inlineCode","value":"json","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"wFLyo6tCJL"},{"type":"text","value":" for storing intermediate files","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"zvTwyiNChl"}],"key":"O800ZqIkqI"},{"type":"listItem","spread":true,"position":{"start":{"line":72,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"inlineCode","value":"google_drive_downloader","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"mM0ggPKTb5"},{"type":"text","value":" to access files stored in google drive","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"dbKJkMmUkK"}],"key":"rwgmHUdwpZ"}],"key":"o4goJZId8j"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"This cell will install them if needed:","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"xUbJgcG2WB"}],"key":"JR0sE8WBBP"}],"key":"XummlI4iC3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# %pip install -r requirements_light_curve_classifier.txt","key":"zE8YmTw0L0"},{"type":"output","id":"USy9YzghBrW84QiwqVagM","data":[],"key":"eup52j3uvq"}],"key":"XVaWzGgAXj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import sys\n\nimport matplotlib.pyplot as plt\nfrom matplotlib.lines import Line2D\nimport pandas as pd\nfrom astropy.table import Table\nimport googledrivedownloader as gdd\nfrom tqdm.auto import tqdm\nimport json\n\nfrom sklearn.metrics import ConfusionMatrixDisplay, accuracy_score, confusion_matrix\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.gaussian_process import GaussianProcessRegressor\nfrom sklearn.gaussian_process.kernels import RBF\n\nfrom sktime.classification.deep_learning import CNNClassifier\nfrom sktime.classification.dictionary_based import IndividualTDE\nfrom sktime.classification.distance_based import KNeighborsTimeSeriesClassifier\nfrom sktime.classification.dummy import DummyClassifier\nfrom sktime.classification.ensemble import WeightedEnsembleClassifier\nfrom sktime.classification.feature_based import Catch22Classifier, RandomIntervalClassifier\nfrom sktime.classification.hybrid import HIVECOTEV2\nfrom sktime.classification.interval_based import CanonicalIntervalForest\nfrom sktime.classification.kernel_based import Arsenal, RocketClassifier\nfrom sktime.classification.shapelet_based import ShapeletTransformClassifier\nfrom sktime.registry import all_estimators, all_tags\nfrom sktime.datatypes import check_is_mtype\n\n# local code imports\nsys.path.append('code_src/')\nfrom classifier_functions import sigmaclip_lightcurves, remove_objects_without_band, \\\nremove_incomplete_data, missingdata_to_zeros, missingdata_drop_bands, \\\nuniform_length_spacing, reformat_df, local_normalization_max, mjd_to_datetime\n\n#improves memory usage and avoids problems that trigger warnings\npd.options.mode.copy_on_write = True","key":"rTPWGhBAay"},{"type":"output","id":"laDwOVMZ-GzU4AEfuUj6S","data":[],"key":"gX1ZzKIva6"}],"key":"hURpOLWUAI"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"children":[{"type":"text","value":"1. Read in a dataset of archival light curves","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"dDA1ZHOtQo"}],"identifier":"id-1-read-in-a-dataset-of-archival-light-curves","label":"1. Read in a dataset of archival light curves","html_id":"id-1-read-in-a-dataset-of-archival-light-curves","implicit":true,"key":"EYMnpWmQfD"},{"type":"paragraph","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"We use here a sample of AGN including known CLAGN \u0026 random SDSS AGN","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"NT9iBYKzTV"}],"key":"HrrK9GWYtV"},{"type":"paragraph","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"If you want to use your own sample, you can use the code ","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"u5rY4erRB8"},{"type":"link","url":"https://nasa-fornax.github.io/fornax-demo-notebooks/light_curves/light_curve_collector.html","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"light​_curve​_collector​.md","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"KG4qstOn2O"}],"urlSource":"https://nasa-fornax.github.io/fornax-demo-notebooks/light_curves/light_curve_collector.html","key":"u1IiJYYOT5"},{"type":"text","value":" in this same repo to make the required pandas dataframe which you will need to run this notebook.","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"Ij0GOTdUfi"}],"key":"Aqph6ccoue"}],"key":"ccvBYU8l36"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# First we want to load light curves made in the light_curve_collector notebook\n\n# The data is on google drive, this will download it for you and read it into\n# a pandas dataframe\nsavename_df_lc = './data/small_CLAGN_SDSS_df_lc.parquet'\ngdd.download_file_from_google_drive(file_id='1DrB-CWdBBBYuO0WzNnMl5uQnnckL7MWH',\n                                    dest_path=savename_df_lc,\n                                    unzip=True)\n\n#load the data into a pandas dataframe\ndf_lc = pd.read_parquet(savename_df_lc)","key":"uKF7QBH9rk"},{"type":"output","id":"SSrdXW9kVTxCX1rfTuETq","data":[{"output_type":"stream","name":"stdout","text":"Downloading 1DrB-CWdBBBYuO0WzNnMl5uQnnckL7MWH into ./data/small_CLAGN_SDSS_df_lc.parquet... "},{"output_type":"stream","name":"stdout","text":"Done.\nUnzipping..."},{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/googledrivedownloader/download.py:88: UserWarning: Ignoring `unzip` since \"1DrB-CWdBBBYuO0WzNnMl5uQnnckL7MWH\" does not look like a valid zip file\n  warnings.warn('Ignoring `unzip` since \"{}\" does not look like a valid zip file'.format(file_id))\n"}],"key":"bFQRXR1VSC"}],"key":"J4siX4mjvn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#get rid of indices set in the light curve code and reset them as needed\n#before sktime algorithms\ndf_lc = df_lc.reset_index()\n\n#what does the dataset look like at the start?\ndf_lc","key":"BHbYkqm5NC"},{"type":"output","id":"03v9MYUX8upKJEHsIwuCv","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"        objectid       label        band          time      flux  err\n0             15  MacLeod 19  SAXGRBMGRB  50335.861597  0.100000  0.1\n1            240        SDSS  SAXGRBMGRB  51601.900023  0.100000  0.1\n2            364        SDSS  SAXGRBMGRB  50594.078796  0.100000  0.1\n3            169        SDSS  SAXGRBMGRB  51373.759595  0.100000  0.1\n4            446        SDSS  SAXGRBMGRB  50991.525394  0.100000  0.1\n...          ...         ...         ...           ...       ...  ...\n458312       453        SDSS          K2  60148.521180  1.020081  NaN\n458313       453        SDSS          K2  60149.195427  1.014221  NaN\n458314       453        SDSS          K2  60149.930970  1.009093  NaN\n458315       453        SDSS          K2  60150.584787  1.003534  NaN\n458316       453        SDSS          K2  60151.238603  1.000992  NaN\n\n[458317 rows x 6 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eband\u003c/th\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003eflux\u003c/th\u003e\n      \u003cth\u003eerr\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e15\u003c/td\u003e\n      \u003ctd\u003eMacLeod 19\u003c/td\u003e\n      \u003ctd\u003eSAXGRBMGRB\u003c/td\u003e\n      \u003ctd\u003e50335.861597\u003c/td\u003e\n      \u003ctd\u003e0.100000\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e240\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eSAXGRBMGRB\u003c/td\u003e\n      \u003ctd\u003e51601.900023\u003c/td\u003e\n      \u003ctd\u003e0.100000\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e364\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eSAXGRBMGRB\u003c/td\u003e\n      \u003ctd\u003e50594.078796\u003c/td\u003e\n      \u003ctd\u003e0.100000\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e169\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eSAXGRBMGRB\u003c/td\u003e\n      \u003ctd\u003e51373.759595\u003c/td\u003e\n      \u003ctd\u003e0.100000\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e446\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eSAXGRBMGRB\u003c/td\u003e\n      \u003ctd\u003e50991.525394\u003c/td\u003e\n      \u003ctd\u003e0.100000\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e458312\u003c/th\u003e\n      \u003ctd\u003e453\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eK2\u003c/td\u003e\n      \u003ctd\u003e60148.521180\u003c/td\u003e\n      \u003ctd\u003e1.020081\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e458313\u003c/th\u003e\n      \u003ctd\u003e453\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eK2\u003c/td\u003e\n      \u003ctd\u003e60149.195427\u003c/td\u003e\n      \u003ctd\u003e1.014221\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e458314\u003c/th\u003e\n      \u003ctd\u003e453\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eK2\u003c/td\u003e\n      \u003ctd\u003e60149.930970\u003c/td\u003e\n      \u003ctd\u003e1.009093\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e458315\u003c/th\u003e\n      \u003ctd\u003e453\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eK2\u003c/td\u003e\n      \u003ctd\u003e60150.584787\u003c/td\u003e\n      \u003ctd\u003e1.003534\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e458316\u003c/th\u003e\n      \u003ctd\u003e453\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eK2\u003c/td\u003e\n      \u003ctd\u003e60151.238603\u003c/td\u003e\n      \u003ctd\u003e1.000992\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e458317 rows × 6 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"P5u4rKniHb"}],"key":"td5frMJ3on"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"2. Data Prep","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"H0Wy6JxYXF"}],"identifier":"id-2-data-prep","label":"2. Data Prep","html_id":"id-2-data-prep","implicit":true,"key":"GOfhJ3mjjJ"},{"type":"paragraph","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"The majority of work in all ML projects is preparing and cleaning the data.  As most do, this dataset needs significant work before it can be fed into a ML algorithm.  Data preparation includes everything from removing statistical outliers to putting it in the correct data format for the algorithms.","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"r5txRjBxMr"}],"key":"Jby8kDM0vj"}],"key":"NaGEiOJMfS"},{"type":"block","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"2.1 Remove bands with not enough data","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"RM3QrPKW1v"}],"identifier":"id-2-1-remove-bands-with-not-enough-data","label":"2.1 Remove bands with not enough data","html_id":"id-2-1-remove-bands-with-not-enough-data","implicit":true,"key":"dXPHn54twA"},{"type":"paragraph","position":{"start":{"line":158,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"For this use case of CLAGN classification, we don’t need to include some of the bands\nthat are known to be sparse.  Most ML algorithms cannot handle sparse data so one way to accomodate that\nis to remove the sparsest datasets.","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"V6yHI6FTSj"}],"key":"aFrTqqhffX"}],"key":"I8pfGLBElG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"##what are the unique set of bands included in our light curves\ndf_lc.band.unique()\n\n#get rid of some of the bands that don't have enough data for all the sources\n#CLAGN are generall fainter targets, and therefore mostly not found\n#in datasets like TESS \u0026 K2\n\nbands_to_drop = [\"IceCube\", \"TESS\", \"FERMIGTRIG\", \"K2\"]\ndf_lc = df_lc[~df_lc[\"band\"].isin(bands_to_drop)]","key":"NmRDNIGwoh"},{"type":"output","id":"Q4Jy-uSHROhxAnC1HRtTZ","data":[],"key":"F97ePaBnqH"}],"key":"H1Mdumtj91"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"2.2 Combine Labels for a Simpler Classification","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"fWmCW7a5rf"}],"identifier":"id-2-2-combine-labels-for-a-simpler-classification","label":"2.2 Combine Labels for a Simpler Classification","html_id":"id-2-2-combine-labels-for-a-simpler-classification","implicit":true,"key":"zBHBBj1m4l"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"All CLAGN start in the dataset as having labels based on their discovery paper.  Because we want one sample with all known CLAGN, we change those discovery names to be simply “CLAGN” for all CLAGN, regardless of origin.","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"RNbT3TUf6r"}],"key":"YXAgQuFyHZ"}],"key":"CyynEJiV36"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_lc['label'] = df_lc.label.str.replace('MacLeod 16', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('LaMassa 15', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('Yang 18', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('Lyu 22', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('Hon 22', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('Sheng 20', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('MacLeod 19', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('Green 22', 'CLAGN')\ndf_lc['label'] = df_lc.label.str.replace('Lopez-Navas 22', 'CLAGN')","key":"LBaFCIni5J"},{"type":"output","id":"WP9hpbCjgq9M6CQFGHFoG","data":[],"key":"FuyoJshNwN"}],"key":"OBx7fcXHvj"},{"type":"block","children":[],"key":"wWPrMjxNSy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(df_lc.groupby([\"objectid\"]).ngroups, \"n objects before removing missing band data\")","key":"KuKIL6o0T4"},{"type":"output","id":"VLsnccpDBohNwwoGvx65j","data":[{"output_type":"stream","name":"stdout","text":"451 n objects before removing missing band data\n"}],"key":"jjH7RtDPC5"}],"key":"kB7Hxfl7LV"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"2.3 Data Visualization","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"gHRsdPTY26"}],"identifier":"id-2-3-data-visualization","label":"2.3 Data Visualization","html_id":"id-2-3-data-visualization","implicit":true,"key":"dOdTsu3Rk9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":196,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":196,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"can we see any trends by examining plots of a subset of the data?","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"ldF6Xie7YV"}],"key":"JIZYJGIYFj"}],"key":"vpXmYFN5cF"}],"key":"kMI3YsBK6w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#chhose your own adventure, the bands from which you can choose are:\ndf_lc.band.unique()","key":"K4Fwkiqs8m"},{"type":"output","id":"3JeEjsXoDUwTz3T9DnBaE","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"array(['SAXGRBMGRB', 'G', 'BP', 'RP', 'panstarrs i', 'panstarrs y',\n       'panstarrs z', 'panstarrs g', 'panstarrs r', 'zg', 'zi', 'zr',\n       'W1', 'W2', 'k2'], dtype=object)","content_type":"text/plain"}}}],"key":"Sr018prIVV"}],"key":"uj6VH2tIjC"},{"type":"block","children":[],"key":"B8xwSR7Q6g"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#plot a single band for all objects\nband_of_interest = 'zr'\nband_lc = df_lc[df_lc['band'] == band_of_interest]\n#reset zero time to be start of that mission\nband_lc[\"time\"] = band_lc[\"time\"] - band_lc[\"time\"].min()\nband_lc.time.min()\n\nband_lc.set_index('time', inplace = True)  #helps with the plotting\n\n#drop some objects to try to clear up plot\nquerystring1 = 'objectid \u003c 162'\nquerystring2 = 'objectid \u003e 200'\nband_lc = band_lc.drop(band_lc.query(querystring1 ).index)\nband_lc = band_lc.drop(band_lc.query(querystring2 ).index)\n\n#quick normalization for plotting\n#we normalize for real after cleaning the data\n# make a new column with max_r_flux for each objectid\nband_lc['mean_band'] = band_lc.groupby('objectid', sort=False)[\"flux\"].transform('mean')\nband_lc['sigma_band'] = band_lc.groupby('objectid', sort=False)[\"flux\"].transform('std')\n\n#choose to normalize (flux - mean) / sigma\nband_lc['flux'] = (band_lc['flux'] - band_lc['mean_band']).div(band_lc['sigma_band'], axis=0)\n\n#want to have two different sets so I can color code\nclagn_df = band_lc[band_lc['label'] == 'CLAGN']\nsdss_df = band_lc[band_lc['label'] == 'SDSS']\nprint(clagn_df.groupby([\"objectid\"]).ngroups, \"n objects CLAGN \")\nprint(sdss_df.groupby([\"objectid\"]).ngroups, \"n objects SDSS \")\n\n#groupy objectid \u0026 plot flux vs. time\nfig, ax = plt.subplots(figsize=(10,6))\nlc_sdss = sdss_df.groupby(['objectid'])['flux'].plot(kind='line', ax=ax, color = 'gray', label = 'SDSS', linewidth = 0.3)\nlc_clagn = clagn_df.groupby(['objectid'])['flux'].plot(kind='line', ax=ax, color = 'orange', label = 'CLAGN', linewidth = 1)\n\n#add legend and labels/titles\nlegend_elements = [Line2D([0], [0], color='orange', lw=4, label='CLAGN'),\n                   Line2D([0], [0], color='gray', lw=4, label='SDSS')]\nax.legend(handles=legend_elements, loc='best')\n\nax.set_ylabel('Normalized Flux')\nax.set_xlabel('Time in days since start of mission')\nplt.title(f\"{band_of_interest} light curves\")\n\n#tailored to ZTF r band with lots of data\nax.set_ylim([-2, 4])\nax.set_xlim([1000, 1250])","key":"n0MHpucpAB"},{"type":"output","id":"YNxrVfp7LkbPXSC05dAo_","data":[{"output_type":"stream","name":"stdout","text":"2 n objects CLAGN \n34 n objects SDSS \n"},{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"(1000.0, 1250.0)","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1000x600 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1fb474e56caea4846ccce727de3833bd","path":"/fornax-demo-notebooks/build/1fb474e56caea4846ccce727de3833bd.png"}}}],"key":"nqINFtHcFA"}],"key":"e2dhZMFI2y"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"2.4 Clean the dataset of unwanted data","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"ll7CVKqeTO"}],"identifier":"id-2-4-clean-the-dataset-of-unwanted-data","label":"2.4 Clean the dataset of unwanted data","html_id":"id-2-4-clean-the-dataset-of-unwanted-data","implicit":true,"key":"zeNzeIcQIu"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"“unwanted” includes:","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"hvmhEkm7sP"}],"key":"lsIqlrNiAB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":256,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":256,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"NaNs","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"Hju34Lcr8V"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"SKtime does not work with NaNs","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"wCn0BPon2l"}],"key":"WF2C3LW2dD"}],"key":"qa1Uh69mVx"}],"key":"CmO1Lz5QpB"},{"type":"listItem","spread":true,"position":{"start":{"line":258,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"zero flux","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"key":"HjdliXqabV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"there are a few flux measurements that come into our dataframe with zeros.  It is not clear what these are, and zero will be used to mean lack of observation in the rest of this notebook, so want to drop these rows at the outset.","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"t4cv51rMyd"}],"key":"vEjBVeoFWG"}],"key":"lcl0rfRN2R"}],"key":"AlA9nPySYC"},{"type":"listItem","spread":true,"position":{"start":{"line":260,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"outliers in uncertainty","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"OkJUpEqcHE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"This is a tricky job because we want to keep astrophysical sources that are variable objects, but remove instrumental noise and CR (ground based).  The user will need to choose a sigma clipping threshold, and there is some plotting functionality available to help users make that decision","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"eufe0zRR3l"}],"key":"RxeT8qQxJ3"}],"key":"hB13jVEicS"}],"key":"FoBCdryiFH"},{"type":"listItem","spread":true,"position":{"start":{"line":262,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"objects with no measurements in WISE W1 band","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"mFTZPpnHXQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"Below we want to normalize all light curves by W1, so we neeed to remove those objects without W1 fluxes because there will be nothing to normalize those light curves with.  We don’t want to have un-normalized data.","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"C6DMt2tB2Q"}],"key":"v1lCKXqG0c"}],"key":"CKIgXox0GI"}],"key":"tJop2Z9pI9"},{"type":"listItem","spread":true,"position":{"start":{"line":264,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"objects with incomplete data","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"Z5SE1XKy0k"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":265,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":265,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"Incomplete is defined here as not enough flux measurements to make a good light curve.  Some bands in some objects have only a few datapoints. Three data points is not large enough for KNN interpolation, so we will consider any array with fewer than 4 photometry points to be incomplete data.  Another way of saying this is that we choose to remove those light curves with 3 or\nfewer data points.","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"dxoFjbmQZG"}],"key":"Rwe2ZAng7J"}],"key":"Z3iXHwnYxB"}],"key":"k3M6EcRcgS"}],"key":"bjmFNu7qhj"}],"key":"HNxNUB5RYB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#drop rows which have Nans\ndf_lc.dropna(inplace = True, axis = 0)\n\n#drop rows with zero flux\nquerystring = 'flux \u003c 0.000001'\ndf_lc = df_lc.drop(df_lc.query(querystring).index)\n\n#remove outliers\nsigmaclip_value = 10.0\ndf_lc = sigmaclip_lightcurves(df_lc, sigmaclip_value, include_plot = False)\nprint(df_lc.groupby([\"objectid\"]).ngroups, \"n objects after sigma clipping\")\n\n#remove incomplete data\nthreshold_too_few = 3\ndf_lc = remove_incomplete_data(df_lc, threshold_too_few, verbose = False)\n\n#remove objects without W1 fluxes\ndf_lc = remove_objects_without_band(df_lc, 'W1', verbose=True)\n\nprint(df_lc.groupby([\"objectid\"]).ngroups, \"n objects after cleaning the data\")","key":"l0Mdlakgy3"},{"type":"output","id":"WCsJqr1dul_glOlUcuMAP","data":[{"output_type":"stream","name":"stdout","text":"451 n objects after sigma clipping\n"},{"output_type":"stream","name":"stdout","text":"18 objects without W1  were removed\n431 n objects after cleaning the data\n"}],"key":"AeOUn0f1u9"}],"key":"tOv7ksw2JZ"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"children":[{"type":"text","value":"2.5 Missing Data","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"sL4fuXgUDg"}],"identifier":"id-2-5-missing-data","label":"2.5 Missing Data","html_id":"id-2-5-missing-data","implicit":true,"key":"qEojbIRp1a"},{"type":"paragraph","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"children":[{"type":"text","value":"Some objects do not have light curves in all bands.  Some ML algorithms can handle mising data, but not all, so we try to do something intentional and sensible to handle this missing data up front.","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"zMYLXIvk8T"}],"key":"SebDXDfbdI"},{"type":"paragraph","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"children":[{"type":"text","value":"There are two options here:","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"I2nikzBNeG"}],"key":"g7fAJKB2wB"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":296,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"text","value":"We will add light curves with zero flux and err values for the missing data.  SKtime does not like NaNs, so we choose zeros.  This option has the benefit of including more bands and therefore more information, but the drawback of having some objects have bands with entire arrays of zeros.","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"pyH7Ne1GRH"}],"key":"goX4D0ikfA"},{"type":"listItem","spread":true,"position":{"start":{"line":297,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"Remove bands which have less data from all objects so that there are no objects with missing data.  This has the benefit of less zeros, but the disadvantage of throwing away some information for the few objects which do have light curves in the bands which will be removed.","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"jiwNsNr5em"}],"key":"MnCRYMs7IC"}],"key":"kZjTASFoav"},{"type":"paragraph","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"Functions are inlcuded for both options.","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"Le99ztT40N"}],"key":"E839KU4xZ9"}],"key":"ERaQlxdck1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#choose what to do with missing data...\n#df_lc = missingdata_to_zeros(df_lc)\n#or\nbands_to_keep = ['W1','W2','panstarrs g','panstarrs i', 'panstarrs r','panstarrs y','panstarrs z','zg','zr']\ndf_lc = missingdata_drop_bands(df_lc, bands_to_keep, verbose = True)","key":"eP46FJHiUz"},{"type":"output","id":"2jMrgx0tPzAvDOQ1FweYg","data":[{"output_type":"stream","name":"stdout","text":"431 n objects before removing missing band data\n357 n objects after removing missing band data\n"}],"key":"fRcijVCy1u"}],"key":"iziiy0DvQz"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"text","value":"2.6  Make all objects and bands have identical time arrays (uniform length and spacing)","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"FPzZ6XYbGz"}],"identifier":"id-2-6-make-all-objects-and-bands-have-identical-time-arrays-uniform-length-and-spacing","label":"2.6  Make all objects and bands have identical time arrays (uniform length and spacing)","html_id":"id-2-6-make-all-objects-and-bands-have-identical-time-arrays-uniform-length-and-spacing","implicit":true,"key":"XKrYO9QnFg"},{"type":"paragraph","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"text","value":"It is very hard to find time-domain ML algorithms which can work with non uniform length datasets. Therefore we make the light curves uniform by interpolating using KNN from scikit-learn which fills in the uniform length arrays with a final frequency chosen by the user.  We choose KNN as very straightforward method. This function also shows the framework in case the user wants to choose a different scikit-learn function to do the interpolation.  Another natural choice would be to use gaussian processes (GP) to do the interpolation, but this is not a good solution for our task because the flux values go to zero at times before and after the observations.  Because we include the entire time array from beginning of the first mission to end of the last mission, most individual bands require interpolation before and after their particular observations.  In other words, our light curves span the entire range from 2010 with the start of panstarrs and WISE to the most recent ZTF data release (at least 2023), even though most individual missions do not cover that full range of time.","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"H4b7j0tnDC"}],"key":"Zj4JVNfba2"},{"type":"paragraph","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"It is important to choose the frequency over which the data is interpolated wisely.  Experimentation with treating this variable like a hyperparam and testing sktime algorithms shows slightly higher accuracy values for a suite of algorithms for a frequency of one interpolated observation per 60 days.","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"tb1gvkkVrU"}],"key":"ytRppqUau4"}],"key":"XHQpkb2lNl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#what does the dataframe look like at this point in the code?\ndf_lc","key":"YTxs29tMvl"},{"type":"output","id":"ZsQWicuYUwr4-mH-zQ3OK","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"        objectid  label         band          time      flux       err\n12489          1  CLAGN  panstarrs i  55174.305492  0.100490  0.001102\n12490          1  CLAGN  panstarrs i  55174.308519  0.090206  0.000985\n12491          1  CLAGN  panstarrs y  55416.614225  0.130497  0.007047\n12492          1  CLAGN  panstarrs y  55416.625133  0.133000  0.006277\n12493          1  CLAGN  panstarrs z  55427.627576  0.118545  0.002673\n...          ...    ...          ...           ...       ...       ...\n412825       458   SDSS           W2  58283.310746  1.793368  0.015925\n412826       458   SDSS           W2  58490.115697  1.630802  0.017747\n412827       458   SDSS           W2  58650.370860  1.674718  0.017944\n412828       458   SDSS           W2  58854.359409  1.475255  0.017491\n412829       458   SDSS           W2  59014.562406  1.400782  0.017341\n\n[346191 rows x 6 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eband\u003c/th\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003eflux\u003c/th\u003e\n      \u003cth\u003eerr\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12489\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003epanstarrs i\u003c/td\u003e\n      \u003ctd\u003e55174.305492\u003c/td\u003e\n      \u003ctd\u003e0.100490\u003c/td\u003e\n      \u003ctd\u003e0.001102\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12490\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003epanstarrs i\u003c/td\u003e\n      \u003ctd\u003e55174.308519\u003c/td\u003e\n      \u003ctd\u003e0.090206\u003c/td\u003e\n      \u003ctd\u003e0.000985\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12491\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003epanstarrs y\u003c/td\u003e\n      \u003ctd\u003e55416.614225\u003c/td\u003e\n      \u003ctd\u003e0.130497\u003c/td\u003e\n      \u003ctd\u003e0.007047\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12492\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003epanstarrs y\u003c/td\u003e\n      \u003ctd\u003e55416.625133\u003c/td\u003e\n      \u003ctd\u003e0.133000\u003c/td\u003e\n      \u003ctd\u003e0.006277\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12493\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003epanstarrs z\u003c/td\u003e\n      \u003ctd\u003e55427.627576\u003c/td\u003e\n      \u003ctd\u003e0.118545\u003c/td\u003e\n      \u003ctd\u003e0.002673\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e412825\u003c/th\u003e\n      \u003ctd\u003e458\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eW2\u003c/td\u003e\n      \u003ctd\u003e58283.310746\u003c/td\u003e\n      \u003ctd\u003e1.793368\u003c/td\u003e\n      \u003ctd\u003e0.015925\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e412826\u003c/th\u003e\n      \u003ctd\u003e458\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eW2\u003c/td\u003e\n      \u003ctd\u003e58490.115697\u003c/td\u003e\n      \u003ctd\u003e1.630802\u003c/td\u003e\n      \u003ctd\u003e0.017747\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e412827\u003c/th\u003e\n      \u003ctd\u003e458\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eW2\u003c/td\u003e\n      \u003ctd\u003e58650.370860\u003c/td\u003e\n      \u003ctd\u003e1.674718\u003c/td\u003e\n      \u003ctd\u003e0.017944\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e412828\u003c/th\u003e\n      \u003ctd\u003e458\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eW2\u003c/td\u003e\n      \u003ctd\u003e58854.359409\u003c/td\u003e\n      \u003ctd\u003e1.475255\u003c/td\u003e\n      \u003ctd\u003e0.017491\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e412829\u003c/th\u003e\n      \u003ctd\u003e458\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n      \u003ctd\u003eW2\u003c/td\u003e\n      \u003ctd\u003e59014.562406\u003c/td\u003e\n      \u003ctd\u003e1.400782\u003c/td\u003e\n      \u003ctd\u003e0.017341\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e346191 rows × 6 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"EWORtnAHVs"}],"key":"gPybO5XjNy"},{"type":"block","children":[],"key":"zyGfYZOWAo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#this cell takes 13seconds to run on the sample of 458 sources\n#change this to change the frequency of the time array\nfinal_freq_interpol = 60  #this is the timescale of interpolation in units of days\n\n#make all light curves have the same time array\ndf_interpol = uniform_length_spacing(df_lc, final_freq_interpol, include_plot = True )\n\n# df_lc_interpol has one row per dict in lc_interpol. time and flux columns store arrays.\n# \"explode\" the dataframe to get one row per light curve point. time and flux columns will now store floats.\ndf_lc = df_interpol.explode([\"time\", \"flux\",\"err\"], ignore_index=True)\ndf_lc = df_lc.astype({col: \"float\" for col in [\"time\", \"flux\", \"err\"]})","key":"a9JacwfuTK"},{"type":"output","id":"F3HyQM7xwf7qUaCXR5wus","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 640x480 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"43d1d57207619d42cbfbb49431cc3c2b","path":"/fornax-demo-notebooks/build/43d1d57207619d42cbfbb49431cc3c2b.png"}}}],"key":"o8xJ90ATv4"}],"key":"oQpmIzumZs"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"children":[{"type":"text","value":"2.7  Restructure dataframe","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"key":"iG5LgoC8CN"}],"identifier":"id-2-7-restructure-dataframe","label":"2.7  Restructure dataframe","html_id":"id-2-7-restructure-dataframe","implicit":true,"key":"VZjZhnmlp6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":336,"column":1},"end":{"line":339,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"children":[{"type":"text","value":"Make columns have band names in them and then remove band from the index","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"pntwdz1Il9"}],"key":"YH0XuYjRVo"},{"type":"listItem","spread":true,"position":{"start":{"line":337,"column":1},"end":{"line":337,"column":1}},"children":[{"type":"text","value":"pivot the dataframe so that SKTIME understands its format","position":{"start":{"line":337,"column":1},"end":{"line":337,"column":1}},"key":"X8mKYy6GaQ"}],"key":"sWvJGKc7yZ"},{"type":"listItem","spread":true,"position":{"start":{"line":338,"column":1},"end":{"line":339,"column":1}},"children":[{"type":"text","value":"this will put it in the format expected by sktime","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"Ekg7Hoe1Zu"}],"key":"BrSworIQYI"}],"key":"eBKP7LSPOs"}],"key":"Bc7aYVBOum"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#reformat the data to have columns be the different flux bands\ndf_lc = reformat_df(df_lc)","key":"msck6jZCFZ"},{"type":"output","id":"ZAfsVWUPVWWKwMnDknANG","data":[],"key":"UI9OFcojBd"}],"key":"dTO2Diw8I8"},{"type":"block","children":[],"key":"YDu0YM3pL5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#look at a single object to see what this array looks like\nob_of_interest = 12\nsingleob = df_lc[df_lc['objectid'] == ob_of_interest]\nsingleob","key":"DnSygKRTzg"},{"type":"output","id":"p-aU9ibj0LQA0ehNH8Ke_","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"     objectid  label          time   flux_W1   flux_W2  flux_panstarrs_g  \\\n850        12  CLAGN  54985.275796  0.171426  0.183990          0.014124   \n851        12  CLAGN  55045.275796  0.171426  0.183990          0.014124   \n852        12  CLAGN  55105.275796  0.171426  0.183990          0.014124   \n853        12  CLAGN  55165.275796  0.171426  0.183990          0.014124   \n854        12  CLAGN  55225.275796  0.171426  0.183990          0.014124   \n..        ...    ...           ...       ...       ...               ...   \n930        12  CLAGN  59785.275796  0.193756  0.167459          0.024364   \n931        12  CLAGN  59845.275796  0.193756  0.167459          0.024364   \n932        12  CLAGN  59905.275796  0.193756  0.167459          0.024364   \n933        12  CLAGN  59965.275796  0.193756  0.167459          0.024364   \n934        12  CLAGN  60025.275796  0.193756  0.167459          0.024364   \n\n     flux_panstarrs_i  flux_panstarrs_r  flux_panstarrs_y  flux_panstarrs_z  \\\n850          0.083940          0.043920          0.068864          0.085598   \n851          0.083940          0.043920          0.068864          0.085598   \n852          0.083940          0.043920          0.068864          0.085598   \n853          0.083940          0.043920          0.068864          0.085598   \n854          0.083940          0.043920          0.068864          0.085598   \n..                ...               ...               ...               ...   \n930          0.059121          0.042884          0.097297          0.087929   \n931          0.059121          0.042884          0.097297          0.087929   \n932          0.059121          0.042884          0.097297          0.087929   \n933          0.059121          0.042884          0.097297          0.087929   \n934          0.059121          0.042884          0.097297          0.087929   \n\n     ...   flux_zr    err_W1    err_W2  err_panstarrs_g  err_panstarrs_i  \\\n850  ...  0.065361  0.007365  0.018009          0.00128         0.002069   \n851  ...  0.065361  0.007365  0.018009          0.00128         0.002069   \n852  ...  0.065361  0.007365  0.018009          0.00128         0.002069   \n853  ...  0.065361  0.007365  0.018009          0.00128         0.002069   \n854  ...  0.065361  0.007365  0.018009          0.00128         0.002069   \n..   ...       ...       ...       ...              ...              ...   \n930  ...  0.057135  0.007365  0.018009          0.00128         0.002069   \n931  ...  0.061469  0.007365  0.018009          0.00128         0.002069   \n932  ...  0.064667  0.007365  0.018009          0.00128         0.002069   \n933  ...  0.063702  0.007365  0.018009          0.00128         0.002069   \n934  ...  0.063702  0.007365  0.018009          0.00128         0.002069   \n\n     err_panstarrs_r  err_panstarrs_y  err_panstarrs_z    err_zg   err_zr  \n850         0.002013         0.007337            0.004  0.003695  0.00521  \n851         0.002013         0.007337            0.004  0.003695  0.00521  \n852         0.002013         0.007337            0.004  0.003695  0.00521  \n853         0.002013         0.007337            0.004  0.003695  0.00521  \n854         0.002013         0.007337            0.004  0.003695  0.00521  \n..               ...              ...              ...       ...      ...  \n930         0.002013         0.007337            0.004  0.003695  0.00521  \n931         0.002013         0.007337            0.004  0.003695  0.00521  \n932         0.002013         0.007337            0.004  0.003695  0.00521  \n933         0.002013         0.007337            0.004  0.003695  0.00521  \n934         0.002013         0.007337            0.004  0.003695  0.00521  \n\n[85 rows x 21 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003eflux_W1\u003c/th\u003e\n      \u003cth\u003eflux_W2\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_g\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_i\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_r\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_y\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_z\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003eflux_zr\u003c/th\u003e\n      \u003cth\u003eerr_W1\u003c/th\u003e\n      \u003cth\u003eerr_W2\u003c/th\u003e\n      \u003cth\u003eerr_panstarrs_g\u003c/th\u003e\n      \u003cth\u003eerr_panstarrs_i\u003c/th\u003e\n      \u003cth\u003eerr_panstarrs_r\u003c/th\u003e\n      \u003cth\u003eerr_panstarrs_y\u003c/th\u003e\n      \u003cth\u003eerr_panstarrs_z\u003c/th\u003e\n      \u003cth\u003eerr_zg\u003c/th\u003e\n      \u003cth\u003eerr_zr\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e850\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e54985.275796\u003c/td\u003e\n      \u003ctd\u003e0.171426\u003c/td\u003e\n      \u003ctd\u003e0.183990\u003c/td\u003e\n      \u003ctd\u003e0.014124\u003c/td\u003e\n      \u003ctd\u003e0.083940\u003c/td\u003e\n      \u003ctd\u003e0.043920\u003c/td\u003e\n      \u003ctd\u003e0.068864\u003c/td\u003e\n      \u003ctd\u003e0.085598\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.065361\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e851\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e55045.275796\u003c/td\u003e\n      \u003ctd\u003e0.171426\u003c/td\u003e\n      \u003ctd\u003e0.183990\u003c/td\u003e\n      \u003ctd\u003e0.014124\u003c/td\u003e\n      \u003ctd\u003e0.083940\u003c/td\u003e\n      \u003ctd\u003e0.043920\u003c/td\u003e\n      \u003ctd\u003e0.068864\u003c/td\u003e\n      \u003ctd\u003e0.085598\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.065361\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e852\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e55105.275796\u003c/td\u003e\n      \u003ctd\u003e0.171426\u003c/td\u003e\n      \u003ctd\u003e0.183990\u003c/td\u003e\n      \u003ctd\u003e0.014124\u003c/td\u003e\n      \u003ctd\u003e0.083940\u003c/td\u003e\n      \u003ctd\u003e0.043920\u003c/td\u003e\n      \u003ctd\u003e0.068864\u003c/td\u003e\n      \u003ctd\u003e0.085598\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.065361\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e853\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e55165.275796\u003c/td\u003e\n      \u003ctd\u003e0.171426\u003c/td\u003e\n      \u003ctd\u003e0.183990\u003c/td\u003e\n      \u003ctd\u003e0.014124\u003c/td\u003e\n      \u003ctd\u003e0.083940\u003c/td\u003e\n      \u003ctd\u003e0.043920\u003c/td\u003e\n      \u003ctd\u003e0.068864\u003c/td\u003e\n      \u003ctd\u003e0.085598\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.065361\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e854\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e55225.275796\u003c/td\u003e\n      \u003ctd\u003e0.171426\u003c/td\u003e\n      \u003ctd\u003e0.183990\u003c/td\u003e\n      \u003ctd\u003e0.014124\u003c/td\u003e\n      \u003ctd\u003e0.083940\u003c/td\u003e\n      \u003ctd\u003e0.043920\u003c/td\u003e\n      \u003ctd\u003e0.068864\u003c/td\u003e\n      \u003ctd\u003e0.085598\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.065361\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e930\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e59785.275796\u003c/td\u003e\n      \u003ctd\u003e0.193756\u003c/td\u003e\n      \u003ctd\u003e0.167459\u003c/td\u003e\n      \u003ctd\u003e0.024364\u003c/td\u003e\n      \u003ctd\u003e0.059121\u003c/td\u003e\n      \u003ctd\u003e0.042884\u003c/td\u003e\n      \u003ctd\u003e0.097297\u003c/td\u003e\n      \u003ctd\u003e0.087929\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.057135\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e931\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e59845.275796\u003c/td\u003e\n      \u003ctd\u003e0.193756\u003c/td\u003e\n      \u003ctd\u003e0.167459\u003c/td\u003e\n      \u003ctd\u003e0.024364\u003c/td\u003e\n      \u003ctd\u003e0.059121\u003c/td\u003e\n      \u003ctd\u003e0.042884\u003c/td\u003e\n      \u003ctd\u003e0.097297\u003c/td\u003e\n      \u003ctd\u003e0.087929\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.061469\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e932\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e59905.275796\u003c/td\u003e\n      \u003ctd\u003e0.193756\u003c/td\u003e\n      \u003ctd\u003e0.167459\u003c/td\u003e\n      \u003ctd\u003e0.024364\u003c/td\u003e\n      \u003ctd\u003e0.059121\u003c/td\u003e\n      \u003ctd\u003e0.042884\u003c/td\u003e\n      \u003ctd\u003e0.097297\u003c/td\u003e\n      \u003ctd\u003e0.087929\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.064667\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e933\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e59965.275796\u003c/td\u003e\n      \u003ctd\u003e0.193756\u003c/td\u003e\n      \u003ctd\u003e0.167459\u003c/td\u003e\n      \u003ctd\u003e0.024364\u003c/td\u003e\n      \u003ctd\u003e0.059121\u003c/td\u003e\n      \u003ctd\u003e0.042884\u003c/td\u003e\n      \u003ctd\u003e0.097297\u003c/td\u003e\n      \u003ctd\u003e0.087929\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.063702\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e934\u003c/th\u003e\n      \u003ctd\u003e12\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e60025.275796\u003c/td\u003e\n      \u003ctd\u003e0.193756\u003c/td\u003e\n      \u003ctd\u003e0.167459\u003c/td\u003e\n      \u003ctd\u003e0.024364\u003c/td\u003e\n      \u003ctd\u003e0.059121\u003c/td\u003e\n      \u003ctd\u003e0.042884\u003c/td\u003e\n      \u003ctd\u003e0.097297\u003c/td\u003e\n      \u003ctd\u003e0.087929\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e0.063702\u003c/td\u003e\n      \u003ctd\u003e0.007365\u003c/td\u003e\n      \u003ctd\u003e0.018009\u003c/td\u003e\n      \u003ctd\u003e0.00128\u003c/td\u003e\n      \u003ctd\u003e0.002069\u003c/td\u003e\n      \u003ctd\u003e0.002013\u003c/td\u003e\n      \u003ctd\u003e0.007337\u003c/td\u003e\n      \u003ctd\u003e0.004\u003c/td\u003e\n      \u003ctd\u003e0.003695\u003c/td\u003e\n      \u003ctd\u003e0.00521\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e85 rows × 21 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"xJ5ngIz1gj"}],"key":"iQjHKlaNk1"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},"children":[{"type":"text","value":"2.8 Normalize","position":{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},"key":"q3yyDXVKd5"}],"identifier":"id-2-8-normalize","label":"2.8 Normalize","html_id":"id-2-8-normalize","implicit":true,"key":"dCyG3du9vb"},{"type":"paragraph","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"children":[{"type":"text","value":"Normalizing is required so that the CLAGN and it’s comparison SDSS sample don’t have different flux levels.  ML algorithms will easily choose to classify based on overall flux levels, so we want to prevent that by normalizing the fluxes. Normalization with a multiband dataset requires extra thought.  The idea here is that we normalize across each object.  We want the algorithms to know, for example, that within one object W1 will be brighter than ZTF bands but from one object to the next, it will not know that one is brighter than the other.","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"key":"ypgtmX4K26"}],"key":"HE0lwXlKyk"},{"type":"paragraph","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"children":[{"type":"text","value":"We do the normalization at this point in the code, rather than before interpolating over time, so that the final light curves are normalized since that is the chunk of information which goes into the ML algorithms.","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"IcIaioqGxd"}],"key":"RDvqwoQ36T"},{"type":"paragraph","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"We chose to normalize by the maximum flux in one band, and not median or mean because there are some objects where the median flux = 0.0 if we did a replacement by zeros for missing data.","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"IfbXMe6eHC"}],"key":"W53b3chgIK"}],"key":"tb5IMEnF0K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#normalize by W1 band\ndf_lc = local_normalization_max(df_lc, norm_column = \"flux_W1\")","key":"PaQ1mSYObF"},{"type":"output","id":"f9ceQ6hnfrLLt2QHM4R9J","data":[],"key":"oujj85RmzK"}],"key":"wfkO6DCF5O"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"2.9 Cleanup","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"TnzOrUv4Vb"}],"identifier":"id-2-9-cleanup","label":"2.9 Cleanup","html_id":"id-2-9-cleanup","implicit":true,"key":"zRvuUXwMLd"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":367,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":367,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"Make ","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"cTa877t2kx"},{"type":"link","url":"https://docs.python.org/3/library/datetime.html#module-datetime","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"datetime","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"LgesPw9v14"}],"urlSource":"https://docs.python.org/3/library/datetime.html#module-datetime","key":"FMQFSqJjWh"},{"type":"text","value":" column","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"KVNTt9BhNF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"SKTime wants a datetime column","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Z9Gb54OP6Z"}],"key":"atEC98bMDR"}],"key":"ZCjPHKcwvk"}],"key":"ntiSOyQIav"},{"type":"listItem","spread":true,"position":{"start":{"line":369,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"Save dataframe","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"L3keBMhOUi"}],"key":"DpwSDBn3xX"}],"key":"jH55TD5paU"}],"key":"ypmVb49R5p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# need to make a datetime column\ndf_lc['datetime'] = mjd_to_datetime(df_lc)","key":"DcF7DqDbzo"},{"type":"output","id":"A0ZHH66nXo5TVTs0BxczW","data":[],"key":"yCk9QbJSsS"}],"key":"eyMfVfdVxJ"},{"type":"block","children":[],"key":"rkOVPVX5Qk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#save this dataframe to use for the ML below so we don't have to make it every time\nparquet_savename = 'output/df_lc_ML.parquet'\n#df_lc.to_parquet(parquet_savename)\n#print(\"file saved!\")","key":"uaKzbkkhKh"},{"type":"output","id":"c00GSEncebOhzl0kV91S3","data":[],"key":"iMXxid1jAv"}],"key":"NwdX1BWPT9"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"3. Prep for ML algorithms","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"FFF4cHxim5"}],"identifier":"id-3-prep-for-ml-algorithms","label":"3. Prep for ML algorithms","html_id":"id-3-prep-for-ml-algorithms","implicit":true,"key":"swdxBJNdEw"}],"key":"mhJoI5kSII"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# could load a previously saved file in order to plot\n#parquet_loadname = 'output/df_lc_ML.parquet'\n#df_lc = MultiIndexDFObject()\n#df_lc.data = pd.read_parquet(parquet_loadname)\n#print(\"file loaded!\")","key":"OQkydLep2n"},{"type":"output","id":"LZScg-KSxzDoMc1mnX0Uz","data":[],"key":"TQjIkB0j2O"}],"key":"zZb5qW2j3I"},{"type":"block","children":[],"key":"cUgdfnL3Ne"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#try dropping the uncertainty columns as variables for sktime\ndf_lc.drop(columns = ['err_panstarrs_g',\t'err_panstarrs_i',\t'err_panstarrs_r',\t'err_panstarrs_y',\n                      'err_panstarrs_z',\t'err_W1',\t'err_W2',\t'err_zg',\t'err_zr'], inplace = True)\n\n#drop also the time column because time shouldn't be a feature\ndf_lc.drop(columns = ['time'],inplace = True)","key":"YSxZYitIqF"},{"type":"output","id":"cj7fGE-_W16zVLBiCxiM3","data":[],"key":"FrKIrf7Ht6"}],"key":"UV5ndzmM56"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"3.1 Train test split","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"bV2gGUJXcl"}],"identifier":"id-3-1-train-test-split","label":"3.1 Train test split","html_id":"id-3-1-train-test-split","implicit":true,"key":"hqz0P6y9ur"},{"type":"paragraph","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"children":[{"type":"text","value":"We use sklearn’s train test split to randomly split the data into training and testing datasets.  Because thre are uneven numbers of each type (many more SDSS than CLAGN), we want to make sure to stratify evenly by type.","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"JrkZpdyuJ7"}],"key":"y2nWK2TyUG"}],"key":"n2K0ynksoq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#divide the dataframe into features and labels for ML algorithms\nlabels = df_lc[[\"objectid\", \"label\"]].drop_duplicates().set_index(\"objectid\").label\ndf_lc = df_lc.drop(columns=[\"label\"]).set_index([\"objectid\", \"datetime\"])","key":"aI6r6R0m6K"},{"type":"output","id":"mpWRgK3t6s3xnKQJxVPL9","data":[],"key":"WoMTDvLhTS"}],"key":"urwzxBOfYg"},{"type":"block","children":[],"key":"Pmqfvzy8zZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"test_size = 0.25\n\n#want a stratified split based on label\ntrain_ix, test_ix = train_test_split(df_lc.index.levels[0], stratify = labels, shuffle = True, random_state = 43, test_size = test_size)\n\n#X is defined to be the features\n#y is defined to be the labels\nX_train = df_lc.loc[train_ix]\ny_train = labels.loc[train_ix]\nX_test = df_lc.loc[test_ix]\ny_test = labels.loc[test_ix]\n\n#plot to show how many of each type of object in the test dataset\nplt.figure(figsize=(6,4))\nplt.title(\"Objects in the Test dataset\")\nh = plt.hist(y_test, histtype='stepfilled', orientation='horizontal')","key":"GxgRCzrF8f"},{"type":"output","id":"ygbX9WmHMS9nX8saFF-IJ","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 600x400 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"da75ccd2332d33d9e6e55119e5b182e8","path":"/fornax-demo-notebooks/build/da75ccd2332d33d9e6e55119e5b182e8.png"}}}],"key":"HzETG9dPbz"}],"key":"cMzywDGZqS"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"text","value":"4. Run sktime algorithms on the light curves","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"TyCxaYXCql"}],"identifier":"id-4-run-sktime-algorithms-on-the-light-curves","label":"4. Run sktime algorithms on the light curves","html_id":"id-4-run-sktime-algorithms-on-the-light-curves","implicit":true,"key":"cp9upYaUoS"},{"type":"paragraph","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"children":[{"type":"text","value":"We choose to use ","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"key":"ba8MVRRjoW"},{"type":"link","url":"https://www.sktime.net/en/stable/index.html","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"children":[{"type":"text","value":"sktime","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"key":"BIEsRX083P"}],"urlSource":"https://www.sktime.net/en/stable/index.html","key":"Mu1XiNw06B"},{"type":"text","value":" algorithms beacuse it is a library of many algorithms specifically tailored to time series datasets.  It is based on the sklearn library so syntax is familiar to many users.","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"key":"BOB5NnZGY0"}],"key":"EQ7FsBckGY"},{"type":"paragraph","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"text","value":"Types of classifiers are listed ","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"key":"nKdcWEIS9Z"},{"type":"link","url":"https://www.sktime.net/en/stable/api_reference/classification.html","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"key":"TLyNaEj7Od"}],"urlSource":"https://www.sktime.net/en/stable/api_reference/classification.html","key":"T7MguZ0qI5"},{"type":"text","value":".","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"key":"rr6SesS59J"}],"key":"t79FkPqSKe"},{"type":"paragraph","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"children":[{"type":"text","value":"This notebook will first show you an example of a single algorithm classifier. Then it will show how to write a for loop over a bunch of classifiers while outputting some metrics of accuracy.","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"cxq0YI7mnY"}],"key":"sndyM260x3"}],"key":"wrMoNpGtgf"},{"type":"block","position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"text","value":"4.1 Check that the data types are ok for sktime","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"key":"kEx2rgfxxt"}],"identifier":"id-4-1-check-that-the-data-types-are-ok-for-sktime","label":"4.1 Check that the data types are ok for sktime","html_id":"id-4-1-check-that-the-data-types-are-ok-for-sktime","implicit":true,"key":"P3mDWjlLYP"},{"type":"paragraph","position":{"start":{"line":443,"column":1},"end":{"line":443,"column":1}},"children":[{"type":"text","value":"This test needs to pass in order for sktime to run","position":{"start":{"line":443,"column":1},"end":{"line":443,"column":1}},"key":"IiJK9DlABw"}],"key":"k49EFNXXdG"}],"key":"jUT9oJ0r7u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#ask sktime if it likes the data type of X_train\n#if you change any of the functions or cells above this one, it is a good idea to\n# look at the below output to make sure you haven't introduced any NaNs or unequal length series\ncheck_is_mtype(X_train, mtype=\"pd-multiindex\", scitype=\"Panel\", return_metadata=True)","key":"gvMvWiDHXU"},{"type":"output","id":"FRH6FplKn6i5037nkdDf0","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"(True,\n '',\n {'is_univariate': False,\n  'is_empty': False,\n  'has_nans': np.False_,\n  'n_features': 9,\n  'feature_names': ['flux_W1',\n   'flux_W2',\n   'flux_panstarrs_g',\n   'flux_panstarrs_i',\n   'flux_panstarrs_r',\n   'flux_panstarrs_y',\n   'flux_panstarrs_z',\n   'flux_zg',\n   'flux_zr'],\n  'dtypekind_dfip': [\u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e],\n  'feature_kind': [\u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e,\n   \u003cDtypeKind.FLOAT: 2\u003e],\n  'n_instances': 267,\n  'is_one_series': False,\n  'is_equal_length': np.True_,\n  'is_equally_spaced': True,\n  'n_panels': 1,\n  'is_one_panel': True,\n  'mtype': 'pd-multiindex',\n  'scitype': 'Panel'})","content_type":"text/plain"}}}],"key":"bqNB8KlegC"}],"key":"hTJw64pSAW"},{"type":"block","children":[],"key":"Ou4SM7Ek8D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#show the list of all possible classifiers that work with multivariate data\n#all_tags(estimator_types = 'classifier')\n#classifiers = all_estimators(\"classifier\", filter_tags={'capability:multivariate':True})\n#classifiers","key":"dkCxy5WF66"},{"type":"output","id":"7XbJeCaSkaMQxI0iOSlWV","data":[],"key":"OMmkkvtxAm"}],"key":"zRz5obbtAL"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"4.2 A single Classifier","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"aYzPynBTvf"}],"identifier":"id-4-2-a-single-classifier","label":"4.2 A single Classifier","html_id":"id-4-2-a-single-classifier","implicit":true,"key":"BU7BGI2Fye"}],"key":"eaKQJwQsk8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n#this cell takes 35s to run on a sample of 267 light curves\n\n#setup the classifier\n#n_jobs is the number of jobs to run in parallel. some environments have trouble with this.\n#if you encounter an error such as 'BrokenProcessPool' while training or predicting, you may\n#want to either set n_jobs = 1 or use a different compute environment.\nclf = Arsenal(time_limit_in_minutes=1, n_jobs = -1)  # '-1' n_jobs means use all processors\n\n#fit the classifier on the training dataset\nclf.fit(X_train, y_train)\n\n#make predictions on the test dataset using the trained model\ny_pred = clf.predict(X_test)\n\nprint(f\"Accuracy of Random Interval Classifier: {accuracy_score(y_test, y_pred)}\\n\", flush=True)\n\n#plot a confusion matrix\ncm = confusion_matrix(y_test, y_pred, labels=clf.classes_)\ndisp = ConfusionMatrixDisplay(confusion_matrix=cm,display_labels=clf.classes_)\ndisp.plot()\n\nplt.show()","key":"uwJjSKWBBE"},{"type":"output","id":"J4wVpOmz1B5KPXIh3MXtm","data":[{"output_type":"stream","name":"stdout","text":"Accuracy of Random Interval Classifier: 0.7333333333333333\n\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 640x480 with 2 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4e8b512861dd52edec2826aa198db7f3","path":"/fornax-demo-notebooks/build/4e8b512861dd52edec2826aa198db7f3.png"}}},{"output_type":"stream","name":"stdout","text":"CPU times: user 629 ms, sys: 291 ms, total: 920 ms\nWall time: 1min 8s\n"}],"key":"bZG1MmBLta"}],"key":"EmgqfjtJY6"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"4.3 Loop over a bunch of classifiers","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"fmAiWwMhNo"}],"identifier":"id-4-3-loop-over-a-bunch-of-classifiers","label":"4.3 Loop over a bunch of classifiers","html_id":"id-4-3-loop-over-a-bunch-of-classifiers","implicit":true,"key":"bGl1dMTS8U"},{"type":"paragraph","position":{"start":{"line":489,"column":1},"end":{"line":489,"column":1}},"children":[{"type":"text","value":"Our method is to do a cursory check of a bunch of classifiers and then later drill down deeper on anything with good initial results.  We choose to run a loop over ~10 classifiers that seem promising and check the accuracy scores for each one.  Any classifier with a promising accuracy score could then be followed up with detailed hyperparameter tuning, or potentially with considering other classifiers in that same type.","position":{"start":{"line":489,"column":1},"end":{"line":489,"column":1}},"key":"aiLZ4YM5dy"}],"key":"bHpsoeBxjh"},{"type":"mystDirective","name":"raw-cell","value":"%%time\n#This cell is currently not being run because it takes a long time\n\n#which classifiers are we interestd in\n#roughly one from each type of classifier\n\nnames = [\"Arsenal\",                     #kernel based\n        \"RocektClassifier\",             #kernel based\n        \"CanonicalIntervalForest\",      #interval based\n        \"HIVECOTEV2\",                   #hybrid\n#        \"CNNClassifier\",               #Deep Learning  - **requires tensorflow which is giving import errors\n#        \"WeightedEnsembleClassifier\",   #Ensemble - **maybe use in the future if we find good options\n        \"IndividualTDE\",               #Dictionary-based\n        \"KNeighborsTimeSeriesClassifier\", #Distance Based\n        \"RandomIntervalClassifier\",     #Feature based\n        \"Catch22Classifier\",            #Feature based\n        \"ShapeletTransformClassifier\"   #Shapelet based\n        \"DummyClassifier\"]             #Dummy - ignores input\n\n#for those with an impossible time limit, how long to let them run for before cutting off\nnmins = 3\n\n#these could certainly be more tailored\nclassifier_call = [Arsenal(time_limit_in_minutes=nmins, n_jobs = -1),\n                  RocketClassifier(num_kernels=2000),\n                  CanonicalIntervalForest(n_jobs = -1),\n                  HIVECOTEV2(time_limit_in_minutes=nmins, n_jobs = -1),\n#                  CNNClassifier(),\n#                  WeightedEnsembleClassifier(),\n                  IndividualTDE(n_jobs=-1),\n                  KNeighborsTimeSeriesClassifier(n_jobs = -1),\n                  RandomIntervalClassifier(n_intervals = 20, n_jobs = -1, random_state = 43),\n                  Catch22Classifier(outlier_norm = True, n_jobs = -1, random_state = 43),\n                  ShapeletTransformClassifier(time_limit_in_minutes=nmins,n_jobs = -1),\n                  DummyClassifier()]\n\n#setup to store the accuracy scores\naccscore_dict = {}\n\n# iterate over classifiers\nfor name, clf in tqdm(zip(names, classifier_call)):\n    #fit the classifier\n    clf.fit(X_train, y_train)\n\n    #make predictions on the test dataset\n    y_pred = clf.predict(X_test)\n\n    #calculate and track accuracy score\n    accscore = accuracy_score(y_test, y_pred)\n    print(f\"Accuracy of {name} classifier: {accscore}\\n\", flush=True)\n    accscore_dict[name] = accscore\n\n    #plot confusion matrix\n    cm = confusion_matrix(y_test, y_pred, labels=clf.classes_)\n    disp = ConfusionMatrixDisplay(confusion_matrix=cm,display_labels=clf.classes_)\n    disp.plot()\n    plt.show()","position":{"start":{"line":491,"column":1},"end":{"line":549,"column":1}},"key":"dncyHAFfKD"}],"key":"b0U8zxxoiK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#show the summary of the algorithms used and their accuracy score\n#accscore_dict","key":"s54g8DilYV"},{"type":"output","id":"fT1NtS9pgGq0VSuFsH9uV","data":[],"key":"g2iAnaAucY"}],"key":"tTsFK11lsx"},{"type":"block","children":[],"key":"abGRkoMmHy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#save statistics from these runs\n\n# Serialize data into file:\n#json.dump( accscore_dict, open( \"output/accscore.json\", 'w' ) )\n#json.dump( completeness_dict, open( \"output/completeness.json\", 'w' ) )\n#json.dump( homogeneity_dict, open( \"output/homogeneity.json\", 'w' ) )\n\n# Read data from file:\n#accscore_dict = json.load( open( \"output/accscore.json\") )","key":"DEbSUfaapa"},{"type":"output","id":"pcy2rvh50auXpucAJuD9z","data":[],"key":"Scw1fwGSrZ"}],"key":"MJQ19kNZfO"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":568,"column":1},"end":{"line":568,"column":1}},"children":[{"type":"text","value":"5. Create a candidate list","position":{"start":{"line":568,"column":1},"end":{"line":568,"column":1}},"key":"ni07L0md1U"}],"identifier":"id-5-create-a-candidate-list","label":"5. Create a candidate list","html_id":"id-5-create-a-candidate-list","implicit":true,"key":"bRTb5IphvV"},{"type":"paragraph","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"children":[{"type":"text","value":"Lets assume we now have a classifier which can accurately differentiate CLAGN from SDSS QSOs based on their archival light curves.  Next, we would like to use that classifier on our favorite unlabeled sample to identify CLAGN candidates.  To do this, we need to:","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"key":"ihNZkmblxQ"}],"key":"binkCmhyGP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":571,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"children":[{"type":"text","value":"read in a dataframe of our new sample","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"RW5FNZFsuv"}],"key":"PMn5S6ZWyh"},{"type":"listItem","spread":true,"position":{"start":{"line":572,"column":1},"end":{"line":572,"column":1}},"children":[{"type":"text","value":"get that dataset in the same format as what was fed into the classifiers","position":{"start":{"line":572,"column":1},"end":{"line":572,"column":1}},"key":"SfXALil8Xx"}],"key":"TG8nRTt5fB"},{"type":"listItem","spread":true,"position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"use your trained classifier to predict labels for the new sample","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"KiNNthIobm"}],"key":"d2PGexuwH8"},{"type":"listItem","spread":true,"position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"children":[{"type":"text","value":"retrace those objectids to an ra \u0026 dec","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"OCWOADfra5"}],"key":"JrwlKWl4A5"},{"type":"listItem","spread":true,"position":{"start":{"line":575,"column":1},"end":{"line":576,"column":1}},"children":[{"type":"text","value":"write an observing proposal (ok, you have to do that one yourself)","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"key":"BDWZN43UOc"}],"key":"X3Vi6bgAUM"}],"key":"yVIBdkR0Ne"}],"key":"CJxro3UjTo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#read in a dataframe of our new sample:\n# we are going to cheat here and use the same file as we used for input to the above, but you should\n# replace this with your favorite sample run through the light_curve_collector in this same repo.\npath_to_sample = './data/small_CLAGN_SDSS_df_lc.parquet'\nmy_sample = pd.read_parquet(path_to_sample)","key":"xQJMrWUqIO"},{"type":"output","id":"GfvqWWmi7O775D-QtEix8","data":[],"key":"C3syIatayV"}],"key":"WG2Fb5nVt0"},{"type":"block","children":[],"key":"ROyDiFLkvz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#get dataset in same format as what was run through sktime\n#This is not exactly the same as re-running the whole notebook on a different sample,\n#but it is pretty close.  We don't need to do all of the same cleaning because some of that\n#was to appease sktime in training the algorithms.\n\n\n#get rid of indices set in the light curve code and reset them as needed before sktime algorithms\nmy_sample = my_sample.reset_index()\n\n# get rid of some of the bands that don't have enough data for all the sources\n#CLAGN are generall fainter targets, and therefore mostly not found in datasets like TESS \u0026 K2\n#make sure your sample has the same bands as were run to train the classifier\nmy_sample = my_sample[~my_sample[\"band\"].isin(bands_to_drop)]\n\n#drop rows which have Nans\nmy_sample.dropna(inplace = True, axis = 0)\n\n#remove outliers\n#make sure your sample has the same sigmaclip_value as was run to train the classifier\nmy_sample = sigmaclip_lightcurves(my_sample, sigmaclip_value, include_plot = False, verbose= False)\n\n#remove objects without W1 fluxes\nmy_sample = remove_objects_without_band(my_sample, 'W1', verbose=False)\n\n#remove incomplete data\n#make sure your sample has the same threshold_too_few as were run to train the classifier\nmy_sample = remove_incomplete_data(my_sample, threshold_too_few, verbose = False)\n\n#drop missing bands\nmy_sample = missingdata_drop_bands(my_sample, bands_to_keep, verbose = False)\n\n#make arrays have uniform length and spacing\n#make sure your sample has the same final_feq_interpol as was run to train the classifier\ndf_interpol = uniform_length_spacing(my_sample, final_freq_interpol, include_plot = False )\nmy_sample = df_interpol.explode([\"time\", \"flux\",\"err\"], ignore_index=True)\nmy_sample = my_sample.astype({col: \"float\" for col in [\"time\", \"flux\", \"err\"]})\n\n#reformat the data to have columns be the different flux bands\nmy_sample = reformat_df(my_sample)\n\n#normalize\nmy_sample = local_normalization_max(my_sample, norm_column = \"flux_W1\")\n\n#make datetime column\nmy_sample['datetime'] = mjd_to_datetime(my_sample)\n\n#set index expected by sktime\nmy_sample = my_sample.set_index([\"objectid\", \"label\", \"datetime\"])\n\n#drop the uncertainty and time columns\nmy_sample.drop(columns = ['err_panstarrs_g',\t'err_panstarrs_i',\t'err_panstarrs_r',\t'err_panstarrs_y',\n                          'err_panstarrs_z',\t'err_W1',\t'err_W2',\t'err_zg',\t'err_zr','time'], inplace = True)\n\n #make X\nX_mysample  = my_sample.droplevel('label')","key":"nqIaNqPSsR"},{"type":"output","id":"Gfk6N-zqELVbvBxkkbHzJ","data":[],"key":"T5xm4dLE7m"}],"key":"X6eZDSj4zR"},{"type":"block","children":[],"key":"PFX09hgY2I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#what does this look like to make sure we are on track\nX_mysample","key":"an64FaCW40"},{"type":"output","id":"8irxgvZ0P449IsooDUu2w","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"                                      flux_W1   flux_W2  flux_panstarrs_g  \\\nobjectid datetime                                                           \n1        2009-06-03 06:37:08.765742  1.000000  0.927367          0.140308   \n         2009-08-02 06:37:08.765742  1.000000  0.927367          0.140308   \n         2009-10-01 06:37:08.765742  1.000000  0.927367          0.140308   \n         2009-11-30 06:37:08.765742  1.000000  0.927367          0.140308   \n         2010-01-29 06:37:08.765742  1.000000  0.927367          0.140308   \n...                                       ...       ...               ...   \n458      2022-07-25 06:37:08.765742  0.787245  0.568910          0.118627   \n         2022-09-23 06:37:08.765742  0.787245  0.568910          0.118627   \n         2022-11-22 06:37:08.765742  0.787245  0.568910          0.118627   \n         2023-01-21 06:37:08.765742  0.787245  0.568910          0.118627   \n         2023-03-22 06:37:08.765742  0.787245  0.568910          0.118627   \n\n                                     flux_panstarrs_i  flux_panstarrs_r  \\\nobjectid datetime                                                         \n1        2009-06-03 06:37:08.765742          0.331437          0.267991   \n         2009-08-02 06:37:08.765742          0.331437          0.267991   \n         2009-10-01 06:37:08.765742          0.331437          0.267991   \n         2009-11-30 06:37:08.765742          0.331437          0.267991   \n         2010-01-29 06:37:08.765742          0.331437          0.267991   \n...                                               ...               ...   \n458      2022-07-25 06:37:08.765742          0.414211          0.219828   \n         2022-09-23 06:37:08.765742          0.414211          0.219828   \n         2022-11-22 06:37:08.765742          0.414211          0.219828   \n         2023-01-21 06:37:08.765742          0.414211          0.219828   \n         2023-03-22 06:37:08.765742          0.414211          0.219828   \n\n                                     flux_panstarrs_y  flux_panstarrs_z  \\\nobjectid datetime                                                         \n1        2009-06-03 06:37:08.765742          0.461279          0.464892   \n         2009-08-02 06:37:08.765742          0.461279          0.464892   \n         2009-10-01 06:37:08.765742          0.461279          0.464892   \n         2009-11-30 06:37:08.765742          0.461279          0.464892   \n         2010-01-29 06:37:08.765742          0.461279          0.464892   \n...                                               ...               ...   \n458      2022-07-25 06:37:08.765742          0.393996          0.406282   \n         2022-09-23 06:37:08.765742          0.393996          0.406282   \n         2022-11-22 06:37:08.765742          0.393996          0.406282   \n         2023-01-21 06:37:08.765742          0.393996          0.406282   \n         2023-03-22 06:37:08.765742          0.393996          0.406282   \n\n                                      flux_zg   flux_zr  \nobjectid datetime                                        \n1        2009-06-03 06:37:08.765742  0.116756  0.286475  \n         2009-08-02 06:37:08.765742  0.116756  0.286475  \n         2009-10-01 06:37:08.765742  0.116756  0.286475  \n         2009-11-30 06:37:08.765742  0.116756  0.286475  \n         2010-01-29 06:37:08.765742  0.116756  0.286475  \n...                                       ...       ...  \n458      2022-07-25 06:37:08.765742  0.125963  0.283218  \n         2022-09-23 06:37:08.765742  0.125963  0.311635  \n         2022-11-22 06:37:08.765742  0.135551  0.311296  \n         2023-01-21 06:37:08.765742  0.139684  0.305088  \n         2023-03-22 06:37:08.765742  0.127343  0.265804  \n\n[30345 rows x 9 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eflux_W1\u003c/th\u003e\n      \u003cth\u003eflux_W2\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_g\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_i\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_r\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_y\u003c/th\u003e\n      \u003cth\u003eflux_panstarrs_z\u003c/th\u003e\n      \u003cth\u003eflux_zg\u003c/th\u003e\n      \u003cth\u003eflux_zr\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003edatetime\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"5\" valign=\"top\"\u003e1\u003c/th\u003e\n      \u003cth\u003e2009-06-03 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e1.000000\u003c/td\u003e\n      \u003ctd\u003e0.927367\u003c/td\u003e\n      \u003ctd\u003e0.140308\u003c/td\u003e\n      \u003ctd\u003e0.331437\u003c/td\u003e\n      \u003ctd\u003e0.267991\u003c/td\u003e\n      \u003ctd\u003e0.461279\u003c/td\u003e\n      \u003ctd\u003e0.464892\u003c/td\u003e\n      \u003ctd\u003e0.116756\u003c/td\u003e\n      \u003ctd\u003e0.286475\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2009-08-02 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e1.000000\u003c/td\u003e\n      \u003ctd\u003e0.927367\u003c/td\u003e\n      \u003ctd\u003e0.140308\u003c/td\u003e\n      \u003ctd\u003e0.331437\u003c/td\u003e\n      \u003ctd\u003e0.267991\u003c/td\u003e\n      \u003ctd\u003e0.461279\u003c/td\u003e\n      \u003ctd\u003e0.464892\u003c/td\u003e\n      \u003ctd\u003e0.116756\u003c/td\u003e\n      \u003ctd\u003e0.286475\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2009-10-01 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e1.000000\u003c/td\u003e\n      \u003ctd\u003e0.927367\u003c/td\u003e\n      \u003ctd\u003e0.140308\u003c/td\u003e\n      \u003ctd\u003e0.331437\u003c/td\u003e\n      \u003ctd\u003e0.267991\u003c/td\u003e\n      \u003ctd\u003e0.461279\u003c/td\u003e\n      \u003ctd\u003e0.464892\u003c/td\u003e\n      \u003ctd\u003e0.116756\u003c/td\u003e\n      \u003ctd\u003e0.286475\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2009-11-30 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e1.000000\u003c/td\u003e\n      \u003ctd\u003e0.927367\u003c/td\u003e\n      \u003ctd\u003e0.140308\u003c/td\u003e\n      \u003ctd\u003e0.331437\u003c/td\u003e\n      \u003ctd\u003e0.267991\u003c/td\u003e\n      \u003ctd\u003e0.461279\u003c/td\u003e\n      \u003ctd\u003e0.464892\u003c/td\u003e\n      \u003ctd\u003e0.116756\u003c/td\u003e\n      \u003ctd\u003e0.286475\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2010-01-29 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e1.000000\u003c/td\u003e\n      \u003ctd\u003e0.927367\u003c/td\u003e\n      \u003ctd\u003e0.140308\u003c/td\u003e\n      \u003ctd\u003e0.331437\u003c/td\u003e\n      \u003ctd\u003e0.267991\u003c/td\u003e\n      \u003ctd\u003e0.461279\u003c/td\u003e\n      \u003ctd\u003e0.464892\u003c/td\u003e\n      \u003ctd\u003e0.116756\u003c/td\u003e\n      \u003ctd\u003e0.286475\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"5\" valign=\"top\"\u003e458\u003c/th\u003e\n      \u003cth\u003e2022-07-25 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e0.787245\u003c/td\u003e\n      \u003ctd\u003e0.568910\u003c/td\u003e\n      \u003ctd\u003e0.118627\u003c/td\u003e\n      \u003ctd\u003e0.414211\u003c/td\u003e\n      \u003ctd\u003e0.219828\u003c/td\u003e\n      \u003ctd\u003e0.393996\u003c/td\u003e\n      \u003ctd\u003e0.406282\u003c/td\u003e\n      \u003ctd\u003e0.125963\u003c/td\u003e\n      \u003ctd\u003e0.283218\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2022-09-23 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e0.787245\u003c/td\u003e\n      \u003ctd\u003e0.568910\u003c/td\u003e\n      \u003ctd\u003e0.118627\u003c/td\u003e\n      \u003ctd\u003e0.414211\u003c/td\u003e\n      \u003ctd\u003e0.219828\u003c/td\u003e\n      \u003ctd\u003e0.393996\u003c/td\u003e\n      \u003ctd\u003e0.406282\u003c/td\u003e\n      \u003ctd\u003e0.125963\u003c/td\u003e\n      \u003ctd\u003e0.311635\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2022-11-22 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e0.787245\u003c/td\u003e\n      \u003ctd\u003e0.568910\u003c/td\u003e\n      \u003ctd\u003e0.118627\u003c/td\u003e\n      \u003ctd\u003e0.414211\u003c/td\u003e\n      \u003ctd\u003e0.219828\u003c/td\u003e\n      \u003ctd\u003e0.393996\u003c/td\u003e\n      \u003ctd\u003e0.406282\u003c/td\u003e\n      \u003ctd\u003e0.135551\u003c/td\u003e\n      \u003ctd\u003e0.311296\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2023-01-21 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e0.787245\u003c/td\u003e\n      \u003ctd\u003e0.568910\u003c/td\u003e\n      \u003ctd\u003e0.118627\u003c/td\u003e\n      \u003ctd\u003e0.414211\u003c/td\u003e\n      \u003ctd\u003e0.219828\u003c/td\u003e\n      \u003ctd\u003e0.393996\u003c/td\u003e\n      \u003ctd\u003e0.406282\u003c/td\u003e\n      \u003ctd\u003e0.139684\u003c/td\u003e\n      \u003ctd\u003e0.305088\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2023-03-22 06:37:08.765742\u003c/th\u003e\n      \u003ctd\u003e0.787245\u003c/td\u003e\n      \u003ctd\u003e0.568910\u003c/td\u003e\n      \u003ctd\u003e0.118627\u003c/td\u003e\n      \u003ctd\u003e0.414211\u003c/td\u003e\n      \u003ctd\u003e0.219828\u003c/td\u003e\n      \u003ctd\u003e0.393996\u003c/td\u003e\n      \u003ctd\u003e0.406282\u003c/td\u003e\n      \u003ctd\u003e0.127343\u003c/td\u003e\n      \u003ctd\u003e0.265804\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e30345 rows × 9 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"J3ympg5x3a"}],"key":"FGq5hSz7XV"},{"type":"block","children":[],"key":"Dielz8OxEw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#use the trained sktime algorithm to make predictions on the test dataset\ny_mysample = clf.predict(X_mysample)","key":"yLclXsJK1G"},{"type":"output","id":"DwTNAZOv9MYwPlAjODr7w","data":[],"key":"vhw4lKyD8J"}],"key":"GOCzm0i1Wy"},{"type":"block","children":[],"key":"VHEDKrS0kE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#access the sample_table made in the light_curve_collector notebook\n#has information about the sample including ra \u0026 dec\nsavename_sample = './data/small_CLAGN_SDSS_sample.ecsv'\ngdd.download_file_from_google_drive(file_id='1pSEKVP4LbrdWQK9ws3CaI90m3Z_2fazL',\n                                    dest_path=savename_sample,\n                                    unzip=True)\nsample_table = Table.read(savename_sample, format='ascii.ecsv')","key":"MtBUNGEHsw"},{"type":"output","id":"qhOIdwAFxwhga30iHEt0-","data":[{"output_type":"stream","name":"stdout","text":"Downloading 1pSEKVP4LbrdWQK9ws3CaI90m3Z_2fazL into ./data/small_CLAGN_SDSS_sample.ecsv... "},{"output_type":"stream","name":"stdout","text":"Done.\nUnzipping..."},{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/googledrivedownloader/download.py:88: UserWarning: Ignoring `unzip` since \"1pSEKVP4LbrdWQK9ws3CaI90m3Z_2fazL\" does not look like a valid zip file\n  warnings.warn('Ignoring `unzip` since \"{}\" does not look like a valid zip file'.format(file_id))\n"}],"key":"GZl3I6PRdZ"}],"key":"geMpOGWJ7s"},{"type":"block","children":[],"key":"E5Umfv5h4n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#associate these predicted CLAGN with RA \u0026 Dec\n\n#need to first associate objectid with each of y_mysample\n#make a new df with a column = objectid which\n#includes all the unique objectids.\ntest = X_mysample.reset_index()\nmysample_CLAGN = pd.DataFrame(test.objectid.unique(), columns = ['objectid'])\nmysample_CLAGN[\"predicted_label\"] = pd.Series(y_mysample)\n\n#if I am only interested in the CLAGN, could drop anything with label = SDSS\nquerystring = 'predicted_label == \"SDSS\"'\nmysample_CLAGN = mysample_CLAGN.drop(mysample_CLAGN.query(querystring ).index)\n\n#then will need to merge candidate_CLAGN with sample_table along objectid\nsample_table_df = sample_table.to_pandas()\ncandidate_CLAGN = pd.merge(mysample_CLAGN, sample_table_df, on = \"objectid\", how = \"inner\")","key":"C7QLtEUq72"},{"type":"output","id":"rzFzapeP2Ajc6-MyEd7_o","data":[],"key":"d4Pa1MwWk5"}],"key":"wXHPqdsGIg"},{"type":"block","children":[],"key":"k2OPNezeyX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#show the CLAGN candidates ra \u0026 dec\ncandidate_CLAGN","key":"ZIOYRl4bPb"},{"type":"output","id":"iaSIiYlz0GdUYa_My6XfY","data":[{"output_type":"execute_result","execution_count":34,"metadata":{},"data":{"text/plain":{"content":"     objectid predicted_label    coord.ra  coord.dec       label\n0           1           CLAGN   29.990000   0.553010  LaMassa 15\n1           2           CLAGN    5.796083   0.588203    Green 22\n2           3           CLAGN   36.483625   0.507417  MacLeod 16\n3           5           CLAGN  150.584042  45.157583  MacLeod 16\n4           6           CLAGN  155.468083  46.754333  MacLeod 16\n..        ...             ...         ...        ...         ...\n96        204           CLAGN  171.400690  54.382555        SDSS\n97        282           CLAGN  161.163170  38.759552        SDSS\n98        314           CLAGN  259.412720  32.704313        SDSS\n99        380           CLAGN  188.156210  66.414533        SDSS\n100       415           CLAGN  200.730970   8.161559        SDSS\n\n[101 rows x 5 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003epredicted_label\u003c/th\u003e\n      \u003cth\u003ecoord.ra\u003c/th\u003e\n      \u003cth\u003ecoord.dec\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e1\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e29.990000\u003c/td\u003e\n      \u003ctd\u003e0.553010\u003c/td\u003e\n      \u003ctd\u003eLaMassa 15\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e2\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e5.796083\u003c/td\u003e\n      \u003ctd\u003e0.588203\u003c/td\u003e\n      \u003ctd\u003eGreen 22\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e3\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e36.483625\u003c/td\u003e\n      \u003ctd\u003e0.507417\u003c/td\u003e\n      \u003ctd\u003eMacLeod 16\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e5\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e150.584042\u003c/td\u003e\n      \u003ctd\u003e45.157583\u003c/td\u003e\n      \u003ctd\u003eMacLeod 16\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e6\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e155.468083\u003c/td\u003e\n      \u003ctd\u003e46.754333\u003c/td\u003e\n      \u003ctd\u003eMacLeod 16\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e96\u003c/th\u003e\n      \u003ctd\u003e204\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e171.400690\u003c/td\u003e\n      \u003ctd\u003e54.382555\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e97\u003c/th\u003e\n      \u003ctd\u003e282\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e161.163170\u003c/td\u003e\n      \u003ctd\u003e38.759552\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e98\u003c/th\u003e\n      \u003ctd\u003e314\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e259.412720\u003c/td\u003e\n      \u003ctd\u003e32.704313\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e99\u003c/th\u003e\n      \u003ctd\u003e380\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e188.156210\u003c/td\u003e\n      \u003ctd\u003e66.414533\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e100\u003c/th\u003e\n      \u003ctd\u003e415\u003c/td\u003e\n      \u003ctd\u003eCLAGN\u003c/td\u003e\n      \u003ctd\u003e200.730970\u003c/td\u003e\n      \u003ctd\u003e8.161559\u003c/td\u003e\n      \u003ctd\u003eSDSS\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e101 rows × 5 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"zxp5AkBkz7"}],"key":"Aiv3yc14qW"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"text","value":"Conclusions","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"key":"ITwoT03qLn"}],"identifier":"conclusions","label":"Conclusions","html_id":"conclusions","implicit":true,"key":"nQLiAk5cvq"},{"type":"paragraph","position":{"start":{"line":689,"column":1},"end":{"line":689,"column":1}},"children":[{"type":"text","value":"Depending on your comfort level with the accuracy of the classifier you have trained, you could now write an observing proposal to confirm those targets prediced to be CLAGN based on their multiwavelength light curves.","position":{"start":{"line":689,"column":1},"end":{"line":689,"column":1}},"key":"Q8HKEZqsNQ"}],"key":"PfR9fwhtB2"}],"key":"ayBRntgEZP"},{"type":"block","position":{"start":{"line":691,"column":1},"end":{"line":691,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"key":"WsSORRWvIh"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"NiavNnifva"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":695,"column":1},"end":{"line":697,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":695,"column":1},"end":{"line":695,"column":1}},"children":[{"type":"strong","position":{"start":{"line":695,"column":1},"end":{"line":695,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":695,"column":1},"end":{"line":695,"column":1}},"key":"opVfRrTaLs"}],"key":"egZ3XGXcDI"},{"type":"text","value":" Jessica Krick, Shoubaneh Hemmati, Troy Raen, Brigitta Sipőcz, Andreas Faisst, Vandana Desai, David Shupe, and the Fornax team","position":{"start":{"line":695,"column":1},"end":{"line":695,"column":1}},"key":"T25MEdjMVQ"}],"key":"ZA8KVBKQtY"},{"type":"listItem","spread":true,"position":{"start":{"line":696,"column":1},"end":{"line":697,"column":1}},"children":[{"type":"strong","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"gfyqjmFqCV"}],"key":"FNm3cmNFor"},{"type":"text","value":" For help with this notebook, please open a topic in the ","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"hIlWTxD1V0"},{"type":"link","url":"https://discourse.fornax.sciencecloud.nasa.gov/","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"children":[{"type":"text","value":"Fornax Community Forum","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"nZcxd27Sca"}],"urlSource":"https://discourse.fornax.sciencecloud.nasa.gov/","key":"KY5FPu5hj9"},{"type":"text","value":" “Support” category.","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"dGD3fn2I3e"}],"key":"iiXXxrNjqR"}],"key":"S5wI10sb9o"},{"type":"heading","depth":3,"position":{"start":{"line":698,"column":1},"end":{"line":698,"column":1}},"children":[{"type":"text","value":"Acknowledgements","position":{"start":{"line":698,"column":1},"end":{"line":698,"column":1}},"key":"fDTHy2Yejv"}],"identifier":"acknowledgements","label":"Acknowledgements","html_id":"acknowledgements","implicit":true,"key":"a0nM4VLM9u"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":700,"column":1},"end":{"line":701,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":700,"column":1},"end":{"line":701,"column":1}},"children":[{"type":"text","value":"Stephanie La Massa","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"key":"IaYGHxIkvC"}],"key":"hkAp8OkjEg"}],"key":"lzEuq5Ptzu"},{"type":"heading","depth":3,"position":{"start":{"line":702,"column":1},"end":{"line":702,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":702,"column":1},"end":{"line":702,"column":1}},"key":"yl6GbFQPYv"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"zUpgySJkfv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":704,"column":1},"end":{"line":708,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":704,"column":1},"end":{"line":705,"column":1}},"children":[{"type":"text","value":"“sktime: A Unified Interface for Machine Learning with Time Series”\nMarkus Löning, Tony Bagnall, Sajaysurya Ganesh, George Oastler, Jason Lines, ViktorKaz, …, Aadesh Deshmukh (2020). sktime/sktime. Zenodo. ","position":{"start":{"line":704,"column":1},"end":{"line":704,"column":1}},"key":"tyD6Pwjf9D"},{"type":"cite","url":"http://doi.org/10.5281/zenodo.3749000","position":{"start":{"line":704,"column":1},"end":{"line":704,"column":1}},"children":[{"type":"text","value":"Franz Király ","key":"jfxohWZpHq"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"UX0cG4M9cc"}],"key":"WBIT66iKon"},{"type":"text","value":" (2025)","key":"ZmBKUrUf71"}],"kind":"narrative","label":"https://doi.org/10.5281/zenodo.3749000","identifier":"http://doi.org/10.5281/zenodo.3749000","enumerator":"1","key":"ldJkmwPNGn"}],"key":"LxYvr1lveF"},{"type":"listItem","spread":true,"position":{"start":{"line":706,"column":1},"end":{"line":706,"column":1}},"children":[{"type":"text","value":"“Scikit-learn: Machine Learning in Python”, Pedregosa et al., JMLR 12, pp. 2825-2830, 2011.","position":{"start":{"line":706,"column":1},"end":{"line":706,"column":1}},"key":"aQHLG743WZ"}],"key":"QyRhOrPUk6"},{"type":"listItem","spread":true,"position":{"start":{"line":707,"column":1},"end":{"line":707,"column":1}},"children":[{"type":"text","value":"“pandas-dev/pandas: Pandas” The pandas development team, 2020. Zenodo. ","position":{"start":{"line":707,"column":1},"end":{"line":707,"column":1}},"key":"brBbBIDP1A"},{"type":"cite","url":"https://doi.org/10.5281/zenodo.3509134","position":{"start":{"line":707,"column":1},"end":{"line":707,"column":1}},"children":[{"type":"text","value":"team (2025)","key":"YUWvHUW6dN"}],"kind":"narrative","label":"https://doi.org/10.5281/zenodo.3509134","identifier":"https://doi.org/10.5281/zenodo.3509134","enumerator":"2","key":"PrZ3uDK4IL"}],"key":"FBZxai7PqY"},{"type":"listItem","spread":true,"position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"children":[{"type":"text","value":"This work made use of ","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"key":"xkTUgI5ZZI"},{"type":"link","url":"http://www.astropy.org","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"children":[{"type":"text","value":"Astropy","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"key":"heqeO69LAk"}],"urlSource":"http://www.astropy.org","key":"iypTAXSkop"},{"type":"text","value":" a community-developed core Python package and an ecosystem of tools and resources for astronomy (astropy:2013, astropy:2018, astropy:2022).","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"key":"NSdnIT5GOt"}],"key":"A0zjjdLGpI"}],"key":"JiGWP3Gkaq"}],"key":"oDHsVYxQF2"}],"key":"k4BdwlAnMx"},"references":{"cite":{"order":["https://doi.org/10.5281/zenodo.3749000","https://doi.org/10.5281/zenodo.3509134"],"data":{"https://doi.org/10.5281/zenodo.3749000":{"label":"https://doi.org/10.5281/zenodo.3749000","enumerator":"1","doi":"10.5281/ZENODO.3749000","html":"Franz Király, Markus Löning, Tony Bagnall, Matthew Middlehurst, Anirban Ray, Sajaysurya Ganesh, Martin Walter, George Oastler, Jason Lines, ViktorKaz, Benedikt Heidrich, Lukasz Mentel, Sagar Mishra, Jigyasu Krishnan, chrisholder, Daniel Bartling, Armaghan Shakir, Leonidas Tsaprounis, RNKuhns, … ericjb. (2025). \u003ci\u003esktime/sktime: v0.39.0\u003c/i\u003e. Zenodo. \u003ca target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.5281/ZENODO.3749000\"\u003e10.5281/ZENODO.3749000\u003c/a\u003e","url":"https://doi.org/10.5281/ZENODO.3749000"},"https://doi.org/10.5281/zenodo.3509134":{"label":"https://doi.org/10.5281/zenodo.3509134","enumerator":"2","doi":"10.5281/ZENODO.3509134","html":"The pandas development team. (2025). \u003ci\u003epandas-dev/pandas: Pandas\u003c/i\u003e. Zenodo. \u003ca target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.5281/ZENODO.3509134\"\u003e10.5281/ZENODO.3509134\u003c/a\u003e","url":"https://doi.org/10.5281/ZENODO.3509134"}}}},"footer":{"navigation":{"prev":{"title":"Make Multi-Wavelength Light Curves for Large Samples","url":"/scale-up","group":"The Fornax Initiative"},"next":{"title":"AGN Zoo: Comparison of AGN selected with different metrics","url":"/ml-agnzoo","group":"The Fornax Initiative"}}},"domain":"http://localhost:3000"},"project":{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/fornax-demo-notebooks/build/manifest-ED236704.js";
import * as route0 from "/fornax-demo-notebooks/build/root-ZJOPFBMV.js";
import * as route1 from "/fornax-demo-notebooks/build/routes/$-CQPS5IOR.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/fornax-demo-notebooks/build/entry.client-UNPC4GT3.js");</script></body></html>