<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Make Multi-Wavelength Light Curves for Large Samples - The Fornax Initiative</title><meta property="og:title" content="Make Multi-Wavelength Light Curves for Large Samples - The Fornax Initiative"/><meta name="generator" content="mystmd"/><meta name="description" content="Tutorial notebooks for example Fornax use cases"/><meta property="og:description" content="Tutorial notebooks for example Fornax use cases"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/app-KKSZXL3E.css"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/fornax-demo-notebooks/favicon.ico"/><link rel="stylesheet" href="/fornax-demo-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/fornax-demo-notebooks/"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/fornax-demo-notebooks/build/fornax_logo-127635c68cf832a2acdc06e71e831789.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="The Fornax Initiative" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/fornax-demo-notebooks/">The Fornax Initiative</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time Domain" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme">Time Domain</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Spectroscopy" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-1">Spectroscopy</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Multi-band forced photometry" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-2">Multi-band forced photometry</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Cross Matching" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-3">Cross Matching</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Fornax Demo Notebooks</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/nasa-fornax/fornax-demo-notebooks" title="GitHub Repository: nasa-fornax/fornax-demo-notebooks" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/light_curves/scale_up.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Make Multi-Wavelength Light Curves for Large Samples</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">Fornax developers and scientists</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this tutorial, you will be able to:</p><ul><li><p>Parallelize the code demonstrated in the <a class="" href="/fornax-demo-notebooks/light-curve-collector">light<wbr/>_curve<wbr/>_collector</a> notebook to get multi-wavelength light curves.</p></li><li><p>Launch a run using a large sample of objects, monitor the run’s progress automatically, and understand its resource usage (CPU and RAM).</p></li><li><p>Understand some general challenges and requirements when scaling up code.</p></li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This notebook shows how to collect multi-wavelength light curves for a large sample of target objects.
This is a scaling-up of the <a class="" href="/fornax-demo-notebooks/light-curve-collector">light<wbr/>_curve<wbr/>_collector</a> and assumes you are familiar with the content of that notebook.</p><p>Notebook sections are:</p><ul><li><p>Overview: Describes functionality of the included bash script and python helper functions. Compares some parallel processing options. Introduces <code>top</code> and what be aware of.</p></li><li><p>Example 1: Shows how to launch a large-scale run using the bash script, monitor its progress automatically, and diagnose a problem (out of RAM). This method is recommended for sample sizes greater than a few hundred.</p></li><li><p>Example 2: Shows how to parallelize the example from the light_curve_collector notebook using the helper and python’s <code>multiprocessing</code> library.</p></li><li><p>Example 3: Details the helper parameter options and how to use them in python and bash.</p></li><li><p>Appendix: Contains background information including a discussion of the challenges, needs, and wants encountered when scaling up this code, and general advice for the user which can be applied to other use cases.</p></li></ul><p>As written, this notebook is expected to require at least 1 CPU and 6G RAM.</p><p><strong>Many of the bash commands below are shown in non-executable cells because they are not intended to be run in this notebook.</strong>
Bash commands that are not executed below begin with the symbol <code>$ </code>, and those that are executed begin with <code>!</code>.
Both types can be called from the command-line -- open a new terminal and copy/paste the cell text without the beginning symbol. The bash script is not intended to be executed from within a notebook and may behave strangely if attempted.
Also be aware that the script path shown in the commands below assumes you are in the same directory as this notebook. Adjust it if needed.</p><h3 id="parallel-processing-methods-bash-script-vs-pythons-multiprocessing" class="relative group"><span class="heading-text">Parallel processing methods: bash script vs. python’s <code>multiprocessing</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#parallel-processing-methods-bash-script-vs-pythons-multiprocessing" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Bash script: Recommended for most runs with medium to large sample sizes (&gt;~500). Allows ZTF to use additional parallelization internally, and so is often faster (ZTF often takes the longest and returns the most data for AGN-like samples). Writes stdout and stderr to log files, useful for monitoring jobs and resource usage. Can save <code>top</code> output to a file to help identify CPU and RAM usage/needs.</p></li><li><p>Python’s <code>multiprocessing</code> library: Can be convenient for runs with small to medium sample sizes, up to ~500. Has drawbacks that may be significant including the inability to use ZTF’s internal parallelization and that it does not save the log output (stdout and stderr) to file. An advantage of the <code>multiprocessing</code> example in this notebook over the light_curve_collector is that it automatically saves the sample and light curve data to disk after loading them and can automatically skip those functions in subsequent calls and use the files instead.</p></li></ul><h3 id="the-python-helper" class="relative group"><span class="heading-text">The python helper</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#the-python-helper" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The python “helper” is a set of wrapper functions around the same ‘code_src/’ functions used in the light_curve_collector notebook.</p><ul><li><p>The wrappers facilitate parallelization and large-scale runs by automating tasks like saving the function outputs to files.</p></li><li><p>The helper does not actually implement parallelization and can only run one function per call.</p></li><li><p>The helper can be used in combination with any parallel processing method.</p></li><li><p>The helper can load <code>top</code> output from a file to pandas DataFrames and make some figures.</p></li></ul><h3 id="the-bash-script" class="relative group"><span class="heading-text">The bash script</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#the-bash-script" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The bash script allows the user to collect light curves from a large scale sample with a single command and provides options to help manage and monitor the run.
In a nutshell, the script does the following when called using flags that “launch a run”:</p><ul><li><p>calls the helper to gather the requested sample and then launches jobs for each archive query in separate, parallel processes.</p></li><li><p>redirects stdout and stderr to log files.</p></li><li><p>tells the user what the process PIDs are and where the log and data files are.</p></li><li><p>exits, leaving the archive jobs running in the background.</p></li></ul><p>In case all the archive calls need to be canceled after the script exits, the user can call the script again with a different flag to have it find and kill all the processes it launched.</p><p>While the jobs are running, the user can call the script again with a different flag to have it save <code>top</code> output to a log file at a user-defined interval.
The helper can be used to load this file to pandas DataFrames and make some figures.</p><h3 id="interpreting-top" class="relative group"><span class="heading-text">Interpreting <code>top</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#interpreting-top" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>If you are unfamiliar with <code>top</code>, the answer to this <a target="_blank" rel="noreferrer" href="https://superuser.com/questions/575202/understanding-top-command-in-unix" class="">StackExchange question</a> contains a basic description of the fields in the output.
Also, beware that <code>top</code> can be configured to display values in different ways (e.g., as a percentage of either a single CPU or of all available CPUs).
To understand the local configuration, read the man page (run <code>man top</code> in a terminal), particularly the sections “SUMMARY Display” and “FIELDS / Columns Display”.</p><h3 id="fornax-science-console" class="relative group"><span class="heading-text">Fornax Science Console</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#fornax-science-console" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>There are a couple of things to be aware of when running on the Fornax Science Console.</p><p>Take note of the amount of CPU and RAM available to the server type you choose when starting the session.
In particular, beware that <code>top</code> can show a larger amount of total RAM than is actually accessible to your server due to resource sharing between users.</p><p>The Science Console is primarily intended for interactive use and will cull sessions which appear to be inactive.
If you want a notebook or script to run for longer than about 30 minutes and you will not be interacting with the Console, running <code>top</code> during that time can help keep the session active.</p><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This cell will install the dependencies, if needed:</p><div id="cFy9TygLDH" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# %pip install -r requirements_scale_up.txt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="vwofdOeq2Tqx04m6Thr6g" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="f8eWLS4vSX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import multiprocessing  # python parallelization method
import pandas as pd  # use a DataFrame to work with light-curve and other data
import sys  # add code directories to the path

sys.path.append(&quot;code_src/&quot;)
import helpers.scale_up  # python &quot;helper&quot; for parallelization and large scale runs
import helpers.top  # load `top` output to DataFrames and make figures
from data_structures import MultiIndexDFObject  # load light curve data as a MultiIndexDFObject
from plot_functions import create_figures  # make light curve figures</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WQFeSLjAHU5eQJaNwzoPJ" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-1-multi-wavelength-light-curves-for-500-000-sdss-agn" class="relative group"><span class="heading-text">1. Multi-wavelength light curves for 500,000 SDSS AGN</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-multi-wavelength-light-curves-for-500-000-sdss-agn" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This example shows how to launch a large-scale collection of light curves using the bash script, monitor its performance, and diagnose a problem (out of RAM).
This run collects light curves for 500,000 SDSS objects and takes several hours to complete, but is not actually executed here.
Instead, we show the bash commands and then look at logs that were generated by running the commands on 2024/03/01.
If executed, the run is expected to require at least 2 CPUs and 100G RAM.</p><h3 id="id-1-1-launch-the-run" class="relative group"><span class="heading-text">1.1 Launch the run</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-1-launch-the-run" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre"># This will launch a very large scale run.
# See Example 3 for a detailed explanation of parameter options.
# If you are running this for the first time, reduce the sample size 500000 -&gt; 50.

# run_id will be used in future calls to manage this run, and also determines the name of the output directory.
# If you are executing this, change run_id to your own value to avoid overwriting the demo logs.
$ run_id=&quot;demo-SDSS-500k&quot;

# Execute the run.
# This will get the sample and then call all archives specified by the &#x27;-a&#x27; flag.
# Defaults will be used for all keyword arguments that are not specified.
$ bash code_src/helpers/scale_up.sh \
    -r &quot;$run_id&quot; \
    -j &#x27;{&quot;get_samples&quot;: {&quot;SDSS&quot;: {&quot;num&quot;: 500000}}, &quot;archives&quot;: {&quot;ZTF&quot;: {&quot;nworkers&quot;: 8}}}&#x27; \
    -a &quot;Gaia HEASARC IceCube WISE ZTF&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>The script will run the ‘get sample’ job, then launch the archive query jobs in parallel and exit.
Archive jobs will continue running in the background until they either complete or encounter an error.
Example 2 shows how to load the data.</p><p>Command output from 2024/03/01 logs:</p><div id="f4ZIvmJ8l9" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!cat output/lightcurves-demo-SDSS-500k/logs/scale_up.sh.log
# There is a warning that the SDSS &#x27;specObjID&#x27; column was converted from an int to a string.
# The column is immediately dropped. It is not used in the code.</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="_B6IlNZDZkW989UekKPLb" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>*********************************************************************
**                          Run starting.                          **
run_id=SDSS-500k
base_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k
logs_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/logs
parquet_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/lightcurves.parquet
**                                                                 **

Build sample is starting. logfile=get_sample.log
Build sample is done. Printing the log for convenience:

-- /home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/logs/get_sample.log:
2024/03/01 20:31:27 UTC | [pid=3289] Starting build=sample
Building object sample from: [&#x27;sdss&#x27;]
WARNING: OverflowError converting to IntType in column specObjID, reverting to String. [astropy.io.ascii.fastbasic]
SDSS Quasar: 500000
Object sample size, after duplicates removal: 498877
Object sample saved to: /home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/object_sample.ecsv
2024/03/01 20:36:59 UTC
--

Archive calls are starting.

[pid=3968] Gaia started. logfile=gaia.log
[pid=3972] HEASARC started. logfile=heasarc.log
[pid=3976] IceCube started. logfile=icecube.log
[pid=3980] WISE started. logfile=wise.log
[pid=3984] ZTF started. logfile=ztf.log

**                                                                  **
**                       Main process exiting.                      **
**           Jobs may continue running in the background.           **
**********************************************************************
</span></code></pre></div></div></div><h3 id="id-1-2-cancel" class="relative group"><span class="heading-text">1.2 Cancel</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-2-cancel" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>You can cancel jobs at any time.</p><p>If the script is still running, press <code>Control-C</code>.</p><p>If the script has exited, there are two options.</p><ol start="1"><li><p>To cancel an individual job, kill the job’s process using:</p></li></ol><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">$ pid=0000  # get the number from script output
$ kill $pid</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><ol start="2"><li><p>To cancel the entire run, use the <code>-k</code> (kill) flag:</p></li></ol><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">$ bash code_src/helpers/scale_up.sh -r &quot;$run_id&quot; -k</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="id-1-3-restart" class="relative group"><span class="heading-text">1.3 Restart</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-3-restart" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>If you want to restart and skip step(s) that previously completed, run the first command again and add one or both “overwrite” flags set to false:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre"># use the same run_id as before
$ bash code_src/helpers/scale_up.sh \
    -r &quot;$run_id&quot; \
    -j &#x27;{&quot;get_samples&quot;: {&quot;SDSS&quot;: {&quot;num&quot;: 500000}}, &quot;archives&quot;: {&quot;ZTF&quot;: {&quot;nworkers&quot;: 8}}}&#x27; \
    -a &quot;Gaia HEASARC IceCube WISE ZTF&quot; \
    -d &quot;overwrite_existing_sample=false&quot; \
    -d &quot;overwrite_existing_lightcurves=false&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="id-1-4-monitor" class="relative group"><span class="heading-text">1.4 Monitor</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-4-monitor" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>There are at least three places to look for information about a run’s status.</p><ul><li><p>Check the logs for job status or errors. The bash script will redirect stdout and stderr to log files and print out the paths for you.</p></li><li><p>Check for light curve (parquet) data. The script will print out the “parquet_dir”. <code>ls</code> this directory. You will see a subdirectory for each archive call that has completed successfully, assuming it retrieved data for the sample.</p></li><li><p>Watch <code>top</code>. The script will print the job PIDs. The script can also monitor <code>top</code> for you and save the output to a log file.</p></li></ul><h4 id="id-1-4-1-logs" class="relative group"><span class="heading-text">1.4.1 Logs</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-4-1-logs" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><div id="yBmEUfMoCz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Gaia log from 2024/03/01 (success)
!cat output/lightcurves-demo-SDSS-500k/logs/gaia.log</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="f91r2jB0zsKS5ZhWaCKot" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>2024/03/01 20:37:00 UTC | [pid=3968] Starting build=lightcurves, archive=gaia
INFO: Query finished. [astroquery.utils.tap.core]
Light curves saved to:
	parquet_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/lightcurves.parquet
	file=archive=gaia/part0.snappy.parquet
2024/03/01 21:07:38 UTC
</span></code></pre></div></div></div><div id="PjWcF52MbN" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># ZTF log from 2024/03/01 (failure)
!cat output/lightcurves-demo-SDSS-500k/logs/ztf.log</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="n1GZ62Xp7sxXOAVT4QlRS" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-long-loading">Fetching long content....</div></div></div><p>The logs above show that the ZTF job loaded the light curve data successfully (“100%”) but exited without writing the parquet file (no “Light curves saved” message like Gaia).
The data was lost.
There is also no indication of an error; the job just ends.
We can diagnose what happened by looking at the <code>top</code> output.</p><h4 id="id-1-4-2-top" class="relative group"><span class="heading-text">1.4.2 <code>top</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-4-2-top" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>While the jobs are running, you can monitor <code>top</code> and save the output to a log file by calling the script again with the <code>-t</code> flag.
This call must be separate from the call that launches the run.
If you want to capture the sample step as well as the archive queries, open a second terminal and call the script with <code>-t</code> right after launching the run in the first terminal.</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">$ interval=10m  # choose your interval
$ bash code_src/helpers/scale_up.sh -r &quot;run_id&quot; -t &quot;$interval&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>The script will continue running until after all of run_id’s jobs have completed.
You can cancel at anytime with <code>Control-C</code> and start it again with a new interval.</p><p>Once saved to file, the helper can parse the <code>top</code> output into pandas DataFrames and make some figures.</p><p><code>top</code> output from 2024/03/01:</p><div id="EO3vUrImsO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">run_id = &quot;demo-SDSS-500k&quot;
logs_dir = helpers.scale_up.run(build=&quot;logs_dir&quot;, run_id=run_id)

toplog = helpers.top.load_top_output(toptxt_dir=logs_dir, run_id=run_id)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ZtbT0bmNJKC5WJxK-bURw" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OGwUdOxEhl" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># System summary information from lines 1-5 of `top` output. One row per time step.
toplog.summary_df.sample(5)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GE34J7TyYOI4122X9Ry02" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="K7SOLfCNoM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Information about running processes from lines 6+ of `top` output. One row per process, per time step.
toplog.pids_df.sample(5)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="JdwlxynotaunEq_FUuOj1" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="vaEMYY8nVE" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig = toplog.plot_overview()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="h-2CNazEQ2Z7JRP-gD_Ts" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/fornax-demo-notebooks/build/b381d4e230aa96fe4b93f1b5776331a3.png" alt="&lt;Figure size 1200x800 with 4 Axes&gt;"/></div></div><p>In the figure, panels 1 and 2 show CPU usage while 3 and 4 show memory usage.
Panels 1 and 3 show system totals while panels 2 and 4 show usage by individual processes.
Specifically:</p><ul><li><p>Panel 1: System CPU load, averaged over the previous one minute. A value of “1” means that all compute tasks could have been completed by one CPU working 100% of the time (in reality, the tasks would have been split between the available CPUs). If this value exceeds the number of CPUs available, some tasks will wait in a queue before being executed.</p></li><li><p>Panel 2: Percentage of time the given process used a CPU. This can be greater than 100% if a process uses multiple threads.</p></li><li><p>Panel 3: Amount of unused memory available to the system. If this nears zero, the system will start killing processes so that the entire machine doesn’t go down.</p></li><li><p>Panel 4: Percentage of total RAM used by the given process.</p></li></ul><p>There are many interesting features in the figure that the reader may want to look at in more detail.
For example, other than ZTF’s memory spike at the end, we see that the full run collecting multi-wavelength light curves for the SDSS 500k sample could be completed with about 2 CPU and 60G RAM.
We also see that the IceCube call completes very quickly but requires a significant amount of memory.
Another observation is that the WISE call’s CPU activity seems to slow down when the ZTF workers are running, indicating that a different number of ZTF workers may be more efficient overall.</p><p>We want to learn why the ZTF job failed.
Let’s zoom in on that time period:</p><div id="FUtyrnJigw" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig = toplog.plot_overview(between_time=(&quot;22:55&quot;, &quot;23:10&quot;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GuyEYyFpL-UAukMSK6AJM" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/fornax-demo-notebooks/build/c49ee08f3a93873f97e1060c85e9722a.png" alt="&lt;Figure size 1200x800 with 4 Axes&gt;"/></div></div><p>In the second panel above we see the ZTF worker processes (which load the light curve data) ending just after 23:00 and then the ZTF parent process continues by itself.
Around 23:06 in the fourth panel, we see the ZTF job’s memory usage rise sharply to almost 100% and then drop immediately to zero when the job terminates.
This coincides with the total available memory dropping to near zero in the third panel.
This shows that the machine did not have enough memory for the ZTF call to successfully transform the light curve data collected by the workers into a <code>MultiIndexDFObject</code> and write it as a parquet file, so the machine killed the job.</p><p>The solution is to rerun the ZTF archive call on a machine with more RAM.</p><p>To learn exactly which step in <code>ztf_get_lightcurves</code> was causing this and how much memory it actually needed, additional print statements were inserted into the code similar to the following:</p><div id="nSgnTgJFN2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># this was inserted just before &quot;exploding&quot; the dataframe in ztf_functions.py
# helpers.scale_up._now() prints the current timestamp
print(f&quot;{helpers.scale_up._now()} | starting explode&quot;, flush=True)
# ztf_df = ztf_df.explode(...  # this is the next line in ztf_functions.py</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="w4mQbTqefBjuIwaRkWPsz" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>2025/11/25 21:27:50 UTC | starting explode
</span></code></pre></div></div></div><p>ZTF was then rerun on a large machine and <code>top</code> output was saved.
After the run, we manually compared timestamps between the ZTF log and <code>top</code> output and tagged relevant <code>top</code> timestamps with corresponding step names by appending the name to the ‘----’ delineator, like this for the “explode” step:</p><div id="xDT2jtdePg" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">!cat output/lightcurves-demo-SDSS-500k/logs/top.tag-ztf.txt | grep -A12 explode</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="z4t98ruQ3GQCwe55PQRyz" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>----explode
2024/02/25 02:09:32 UTC
top - 02:09:32 up  1:20,  0 users,  load average: 1.00, 0.68, 0.43
Tasks:   1 total,   1 running,   0 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.6 us,  0.2 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
GiB Mem :    496.0 total,    454.7 free,     13.6 used,     27.7 buff/cache
GiB Swap:      0.0 total,      0.0 free,      0.0 used.    479.4 avail Mem 

   PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
  1418 jovyan    20   0   82.5g  11.8g   0.1g R 100.0   2.4   4:20.44 ipython
----
2024/02/25 02:09:34 UTC
top - 02:09:34 up  1:20,  0 users,  load average: 1.08, 0.70, 0.44
</span></code></pre></div></div></div><p>The helper can recognize these tags and show them on a figure:</p><div id="rBOdmd59Qv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ztf_toplog = helpers.top.load_top_output(toptxt_file=&quot;top.tag-ztf.txt&quot;, toptxt_dir=logs_dir, run_id=run_id)

fig = ztf_toplog.plot_time_tags(summary_y=&quot;used_GiB&quot;)
# (This run starts by reading a previously cached parquet file containing the raw data returned by workers.)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FqQSsYHT0vYX1fiP6InBp" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/fornax-demo-notebooks/build/df5bcf74fcb074c4c273697c3710b374.png" alt="&lt;Figure size 800x600 with 1 Axes&gt;"/></div></div><p>This figure shows that almost 100G RAM is required for the ZTF job to succeed.
It further shows that the “explode” step requires the most memory, followed by creating the MultiIndexDFObject.
From here, the user can choose an appropriately sized machine and/or consider whether <code>ztf_get_lightcurves</code> could be made to use less memory.</p><h2 id="id-2-parallelizing-the-light-curve-collector-notebook" class="relative group"><span class="heading-text">2. Parallelizing the light_curve_collector notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-parallelizing-the-light-curve-collector-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This example shows how to parallelize the example from the light_curve_collector notebook using the helper and python’s <code>multiprocessing</code>.
An advantage of the method shown here is that it automatically saves the sample and light curve data to disk after loading them and can automatically skip those steps in subsequent calls and use the files instead.
This is a small sample (Yang, 30 objects).
If you want a sample larger than a few hundred, consider using the bash script instead.</p><p>Define the keyword arguments for the run:</p><div id="fsJNSBhlxu" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">kwargs_dict = {
    &quot;run_id&quot;: &quot;demo-Yang-sample&quot;,
    # Paper names to gather the sample from.
    &quot;get_samples&quot;: [&quot;Yang&quot;],
    # Keyword arguments for *_get_lightcurves archive calls.
    &quot;archives&quot;: {
        &quot;Gaia&quot;: {&quot;search_radius&quot;: 1 / 3600, &quot;verbose&quot;: 0},
        &quot;HEASARC&quot;: {&quot;catalog_error_radii&quot;: {&quot;FERMIGTRIG&quot;: 1.0, &quot;SAXGRBMGRB&quot;: 3.0}},
        &quot;IceCube&quot;: {&quot;icecube_select_topN&quot;: 3, &quot;max_search_radius&quot;: 2.0},
        &quot;WISE&quot;: {&quot;radius&quot;: 1.0, &quot;bandlist&quot;: [&quot;W1&quot;, &quot;W2&quot;]},
        &quot;ZTF&quot;: {&quot;match_radius&quot;: 1 / 3600, &quot;nworkers&quot;: None},
    },
}
# See Example 3 for a detailed explanation of parameter options.
kwargs_dict</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Zx-HKuAhIHQm9EL09Loe4" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>{&#x27;run_id&#x27;: &#x27;demo-Yang-sample&#x27;,
 &#x27;get_samples&#x27;: [&#x27;Yang&#x27;],
 &#x27;archives&#x27;: {&#x27;Gaia&#x27;: {&#x27;search_radius&#x27;: 0.0002777777777777778, &#x27;verbose&#x27;: 0},
  &#x27;HEASARC&#x27;: {&#x27;catalog_error_radii&#x27;: {&#x27;FERMIGTRIG&#x27;: 1.0, &#x27;SAXGRBMGRB&#x27;: 3.0}},
  &#x27;IceCube&#x27;: {&#x27;icecube_select_topN&#x27;: 3, &#x27;max_search_radius&#x27;: 2.0},
  &#x27;WISE&#x27;: {&#x27;radius&#x27;: 1.0, &#x27;bandlist&#x27;: [&#x27;W1&#x27;, &#x27;W2&#x27;]},
  &#x27;ZTF&#x27;: {&#x27;match_radius&#x27;: 0.0002777777777777778, &#x27;nworkers&#x27;: None}}}</span></code></div></div></div><p>Decide which archives to query.
This is a separate list because the helper can only run one archive call at a time.
We will iterate over this list and launch each job separately.</p><div id="o2Y2CPbcbU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># archive_names = [&quot;PanSTARRS&quot;, &quot;WISE&quot;]  # choose your own list
archive_names = helpers.scale_up.ARCHIVE_NAMES[&quot;all&quot;]  # predefined list
archive_names</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="blm-HGZ9tLBRfQ8R3prxB" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>[&#x27;Gaia&#x27;,
 &#x27;HCV&#x27;,
 &#x27;HEASARC&#x27;,
 &#x27;IceCube&#x27;,
 &#x27;PanSTARRS&#x27;,
 &#x27;TESS_Kepler&#x27;,
 &#x27;WISE&#x27;,
 &#x27;ZTF&#x27;]</span></code></div></div></div><p>In the next cell, we:</p><ul><li><p>collect the sample and write it as a .ecsv file; then</p></li><li><p>query the archives in parallel using a <code>multiprocessing.Pool</code> and write the light curve data as .parquet files.</p></li></ul><p>Note: Since the next cell launches each archive call in a child process (through <code>multiprocessing.Pool</code>),
the archive calls themselves will not be allowed to launch child processes of their own.
We’ll just skip the affected archive calls here and encourage the user towards the bash script since this
is one of the main reasons that it was developed -- it launches the archive jobs in parallel, but in a
different way, so that the calls are also allowed to parallelize their own internal code and thus run much faster.</p><div id="PXBMPDkv46" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
# Skip archive calls that use internal parallelization.
_archive_names = [name for name in archive_names if name.lower() not in [&quot;panstarrs&quot;, &quot;ztf&quot;]]

sample_table = helpers.scale_up.run(build=&quot;sample&quot;, **kwargs_dict)
# sample_table is returned if you want to look at it but it is not used below

with multiprocessing.Pool(processes=len(_archive_names)) as pool:
    # submit one job per archive
    for archive in _archive_names:
        pool.apply_async(helpers.scale_up.run, kwds={&quot;build&quot;: &quot;lightcurves&quot;, &quot;archive&quot;: archive, **kwargs_dict})
    pool.close()  # signal that no more jobs will be submitted to the pool
    pool.join()  # wait for all jobs to complete

# Note: The console output from different archive calls gets jumbled together below.
# Worse, error messages tend to get lost in the background and never displayed.
# If you have trouble, consider running an archive call individually without the Pool
# or using the bash script instead.</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="zfiURkA5tOHI6cynbin53" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><p>The light curves are saved in the “parquet_dir” directory.
Each archive call writes data to a parquet file in its own subdirectory.
These can be loaded together as a single dataset:</p><div id="ioWAcrp9nR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># copy/paste the directory path from the output above, or ask the helper for it like this:
parquet_dir = helpers.scale_up.run(build=&quot;parquet_dir&quot;, **kwargs_dict)
df_lc = pd.read_parquet(parquet_dir)

df_lc.sample(10)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="CMoUPq_f0ykKG1uJ2Zvyg" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><p>Now we can make figures:</p><div id="aMHRO1HD9s" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">_ = create_figures(df_lc=MultiIndexDFObject(data=df_lc), show_nbr_figures=1, save_output=False)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SgUyj02vwuGtMykt9RTiV" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/fornax-demo-notebooks/build/031368e8637337ad8c58c6ed0e571fa5.png" alt="&lt;Figure size 1000x800 with 2 Axes&gt;"/><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Done
</span></code></pre></div></div></div><h2 id="id-3-keyword-arguments-and-script-flags" class="relative group"><span class="heading-text">3. Keyword arguments and script flags</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-keyword-arguments-and-script-flags" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This example shows the python <code>kwargs_dict</code> and bash script flag options in more detail.</p><h3 id="id-3-1-python-kwargs-dict" class="relative group"><span class="heading-text">3.1 Python <code>kwargs_dict</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-python-kwargs-dict" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p><code>kwargs_dict</code> is a dictionary containing all keyword arguments for the run. It can contain:</p><ul><li><p>names and keyword arguments for any of the <code>get_*_sample</code> functions.</p></li><li><p>keyword arguments for any of the <code>*_get_lightcurves</code> functions.</p></li><li><p>other keyword arguments used directly by the helper.
These options and their defaults are shown below, further documented in the helper’s <code>run</code> function.</p></li></ul><div id="FFXE9KzhDR" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># show kwargs_dict defaults
helpers.scale_up.DEFAULTS</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="USFe9vCoIVg7OG8SuRY83" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="myst-jp-safe-output-text font-mono text-sm whitespace-pre-wrap"><code><span>{&#x27;run_id&#x27;: &#x27;my-run&#x27;,
 &#x27;get_samples&#x27;: [&#x27;Yang&#x27;],
 &#x27;consolidate_nearby_objects&#x27;: True,
 &#x27;overwrite_existing_sample&#x27;: True,
 &#x27;archives&#x27;: [&#x27;Gaia&#x27;,
  &#x27;HCV&#x27;,
  &#x27;HEASARC&#x27;,
  &#x27;IceCube&#x27;,
  &#x27;PanSTARRS&#x27;,
  &#x27;TESS_Kepler&#x27;,
  &#x27;WISE&#x27;,
  &#x27;ZTF&#x27;],
 &#x27;overwrite_existing_lightcurves&#x27;: True,
 &#x27;use_yaml&#x27;: False,
 &#x27;yaml_filename&#x27;: &#x27;kwargs.yml&#x27;,
 &#x27;sample_filename&#x27;: &#x27;object_sample.ecsv&#x27;,
 &#x27;parquet_dataset_name&#x27;: &#x27;lightcurves.parquet&#x27;}</span></code></div></div></div><div id="onAeJtxOia" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># show parameter documentation
print(helpers.scale_up.run.__doc__)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="G9kYNq0jLZRWDYxGY3CoC" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>
    Run the light_curve_collector step indicated by `build`.

    Parameters
    ----------
    build : str
        Which step to run. Generally either &quot;sample&quot; or &quot;lightcurves&quot;. Can also be either &quot;kwargs&quot;
        or any of the `kwargs_dict` keys, and then the full set of kwargs is built from `kwargs_dict`
        and either the whole dictionary is returned (if &quot;kwargs&quot;) or the value of this key is returned.
    kwargs_dict : dict
        Key/value pairs for the build function. This can include any key in the dict
        `helpers.scale_up.DEFAULTS` plus &quot;archive&quot;.

        run_id : str
            ID for this run. This is used to name the output subdirectory (&quot;base_dir&quot;) where the
            scale_up helper will read/write files.

        get_samples : list or dict[dict]
            Names of get_&lt;name&gt;_sample functions from which to gather the object sample.
            To send keyword arguments for any of the named functions, use a dict with key=name
            value=dict of keyword arguments for the named function). Defaults will be
            used for any parameter not provided.

        consolidate_nearby_objects : bool
            Whether to consolidate nearby objects in the sample. Passed to the clean_sample function.

        overwrite_existing_sample : bool
            Whether to overwrite an existing .ecsv file. If false and the file exists, the sample will simply
            be loaded from the file and returned.

        archive : str
            Name of a &lt;name&gt;_get_lightcurves archive function to call when building light curves.

        archives : list or dict[dict]
            Names of &lt;name&gt;_get_lightcurves functions. Use a dict (key=name, value=dict of kwargs for the named
            function) to override defaults for the named function. **Note that this does not determine which
            archives are actually called** (unlike `get_samples` with sample names). This is because the
            scale_up helper can only run one function at a time, so a single archive name must be passed separately
            when building light curves.

        overwrite_existing_lightcurves : bool
            Whether to overwrite an existing .parquet file. If false and the file exists, the light curve
            data will simply be loaded from the file and returned.

        use_yaml : bool
            Whether to load additional kwargs from a yaml file.

        yaml_filename : str
            Name of the yaml to read/write, relative to the base_dir.

        sample_filename: str
            Name of the `sample_table` .ecsv file to read/write, relative to the base_dir.

        parquet_dataset_name : str
            Name of the directory to read/write the parquet dataset, relative to the base_dir.
            The dataset will contain one .parquet file for each archive that returned light curve data.

    Returns
    -------
    Various
        Depending on the `build` parameter, returns the result of the corresponding build function.
    
</span></code></pre></div></div></div><h3 id="id-3-2-bash-script-flags" class="relative group"><span class="heading-text">3.2 Bash script flags</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-2-bash-script-flags" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Use the <code>-h</code> (help) flag to view the script’s flag options:</p><div id="hixzunqx3f" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># show flag documentation
!bash code_src/helpers/scale_up.sh -h</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="XqXD5debPyyoMnyZb9erA" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>---- scale_up.sh ----

Use this script to launch and monitor a large-scale &quot;run&quot; to load a sample of target objects
from the literature and collect their multi-wavelength light curves from various archives.
For complete usage information, see the scale_up notebook tutorial.

FLAG OPTIONS
------------

Required flags:

    -r &#x27;run_id&#x27;
        ID for the run. No spaces or special characters.
        Determines the name of the output directory.
        Can be used in multiple script calls to manage the same run.

Flags used to launch a run (optional):

    -a &#x27;archive names&#x27;
        Space-separated list of archive names like &#x27;HEASARC PanSTARRS WISE&#x27; (case insensitive),
        or a shortcut, e.g., &#x27;all&#x27;.
        The get_&lt;name&gt;_lightcurves function will be called once for each name.
        If this flag is not supplied, no light-curve data will be retrieved.

    -d &#x27;key=value&#x27;
        Any top-level key/value pair in the python kwargs_dict where the
        value is a basic type (e.g., bool or string, but not list or dict).
        Repeat the flag to send multiple kwargs.
        For more flexibility, use the -j flag and/or store the kwargs_dict as a
        yaml file and use: -d &#x27;use_yaml=true&#x27;. Order of precedence is dict, json, yaml.

    -j &#x27;json string&#x27;
        The python kwargs_dict as a json string. An example usage is:
        -j &#x27;{get_samples: {SDSS: {num: 50}}, archives: {ZTF: {nworkers: 8}}}&#x27;
        The string can be created in python by first constructing the dictionary and then using:
            &gt;&gt;&gt; import json
            &gt;&gt;&gt; json.dumps(kwargs_dict)
        Copy the output, including the surrounding single quotes (&#x27;), and paste it as the flag value.

Other flags (optional):
    These must be used independently and cannot be combined with any other optional flag.

    -t &#x27;nsleep&#x27;
        Use this flag to monitor top after launching a run. This will filter for PIDs
        launched by &#x27;run_id&#x27; and save the output to a log file once every &#x27;nsleep&#x27; interval.
        &#x27;nsleep&#x27; will be passed to the sleep command, so values like &#x27;10s&#x27; and &#x27;30m&#x27; are allowed.
        The python helper can load the output.
        This option is only available on Linux machines.

    -k (kill)
        Use this flag to kill all processes that were started using the given &#x27;run_id&#x27;.
        This option is only available on Linux machines.

    -h (help)
        Print this help message.

</span></code></pre></div></div></div><h3 id="id-3-3-using-a-yaml-file" class="relative group"><span class="heading-text">3.3 Using a yaml file</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-3-using-a-yaml-file" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>It can be convenient to save the parameters in a yaml file, especially when using the bash script or in cases where you want to store parameters for later reference or re-use.</p><p>Define an extended set of parameters and save it as a yaml file:</p><div id="P7V0xkDI0q" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">yaml_run_id = &quot;demo-kwargs-yaml&quot;

get_samples = {
    &quot;green&quot;: {},
    &quot;ruan&quot;: {},
    &quot;papers_list&quot;: {
        &quot;paper_kwargs&quot;: [
            {&quot;paper_link&quot;: &quot;2022ApJ...933...37W&quot;, &quot;label&quot;: &quot;Galex variable 22&quot;},
            {&quot;paper_link&quot;: &quot;2020ApJ...896...10B&quot;, &quot;label&quot;: &quot;Palomar variable 20&quot;},
        ]
    },
    &quot;SDSS&quot;: {&quot;num&quot;: 10, &quot;zmin&quot;: 0.5, &quot;zmax&quot;: 2, &quot;randomize_z&quot;: True},
    &quot;ZTF_objectid&quot;: {&quot;objectids&quot;: [&quot;ZTF18aabtxvd&quot;, &quot;ZTF18aahqkbt&quot;, &quot;ZTF18abxftqm&quot;, &quot;ZTF18acaqdaa&quot;]},
}

archives = {
    &quot;Gaia&quot;: {&quot;search_radius&quot;: 2 / 3600},
    &quot;HEASARC&quot;: {&quot;catalog_error_radii&quot;: {&quot;FERMIGTRIG&quot;: 1.0, &quot;SAXGRBMGRB&quot;: 3.0}},
    &quot;IceCube&quot;: {&quot;icecube_select_topN&quot;: 4, &quot;max_search_radius&quot;: 2.0},
    &quot;WISE&quot;: {&quot;radius&quot;: 1.5, &quot;bandlist&quot;: [&quot;W1&quot;, &quot;W2&quot;]},
    &quot;ZTF&quot;: {&quot;nworkers&quot;: 6, &quot;match_radius&quot;: 2 / 3600},
}

yaml_kwargs_dict = {
    &quot;get_samples&quot;: get_samples,
    &quot;consolidate_nearby_objects&quot;: False,
    &quot;archives&quot;: archives,
}

helpers.scale_up.write_kwargs_to_yaml(run_id=yaml_run_id, **yaml_kwargs_dict)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7I9LThOBllfNCai0QQfiO" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>kwargs written to /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-kwargs-yaml/kwargs.yml
</span></code></pre></div></div></div><p>The path to the yaml file is printed in the output above.
You can alter the contents of the file as you like.
To use the file, set the kwarg <code>use_yaml=True</code>.</p><p>Python example for the get-sample step:</p><div id="fj7DOoLg1G" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">sample_table = helpers.scale_up.run(build=&quot;sample&quot;, run_id=yaml_run_id, use_yaml=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="1JlOd61AjuWOzXb8NingV" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>2025/11/25 21:29:54 UTC | [pid=2491] Starting build=sample
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Building object sample from: [&#x27;sdss&#x27;, &#x27;ztf_objectid&#x27;, &#x27;green&#x27;, &#x27;papers_list&#x27;, &#x27;ruan&#x27;]
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>WARNING: OverflowError converting to IntType in column specObjID, reverting to String. [astropy.io.ascii.fastbasic]
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>SDSS Quasar: 10
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>number of ztf coords added by Objectname: 4
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Changing Look AGN- Green et al 2022:  19
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>number of sources added from Galex variable 22 :48
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>number of sources added from Palomar variable 20 :20
</span></code></pre></div><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Changing Look AGN- Ruan et al 2016:  3
Object sample size: 104
Object sample saved to: /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-kwargs-yaml/object_sample.ecsv
2025/11/25 21:30:06 UTC
</span></code></pre></div></div></div><p>Bash example:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">$ yaml_run_id=demo-kwargs-yaml
$ bash code_src/helpers/scale_up.sh -r &quot;$yaml_run_id&quot; -d &quot;use_yaml=true&quot; -a &quot;Gaia HEASARC IceCube PanSTARRS WISE ZTF&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="appendix-what-to-expect" class="relative group"><span class="heading-text">Appendix: What to expect</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#appendix-what-to-expect" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="challenges-of-large-scale-runs" class="relative group"><span class="heading-text">Challenges of large-scale runs</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#challenges-of-large-scale-runs" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Scaling up to large sample sizes brings new challenges.
Even if things go smoothly, each function call may need to use a lot more resources like CPU, RAM, and bandwidth, and may take much longer to complete.
Also, we’ll want to run some functions in parallel to save time overall, but that will mean they must compete with each other for resources.</p><p>These issues are complicated by the fact that different combinations of samples and archive calls can trigger different problems.
Inefficiencies in any part of the process -- our code, archive backends, etc. -- which may have been negligible at small scale can balloon into significant hurdles.</p><p>Problems can manifest in different ways.
For example, progress may slow to a crawl, or it may run smoothly for several hours and then crash suddenly.
If the job is running in the background, print statements and error messages may get lost and never be displayed for the user if they are not redirected to a file.</p><h3 id="needs-and-wants-for-large-scale-runs" class="relative group"><span class="heading-text">Needs and wants for large-scale runs</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#needs-and-wants-for-large-scale-runs" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The main goal is to reduce the total time it takes to run the full code, so we want to look for opportunities to parallelize.
We can group the light_curve_collector code into two main steps: (1) gather the target object sample; then (2) generate light curves by querying the archives and standardizing the returned data.
All of the archive calls have to wait for the sample to be available before starting, but then they can run independently in parallel.
This is fortunate, since gathering the sample does not take long compared to the archive calls.</p><p>It is useful to be able to monitor the run’s resource usage and capture print statements, error messages, etc. to log files in order to understand if/when something goes wrong.
Even with parallelization, gathering light curves for a large sample of objects is likely to take a few hours at least.
So we want to automate the monitoring tasks as much as possible.</p><p>If the run fails, we’d like to be able to restart it without having to redo steps that were previously successful.
To accomplish this, the inputs and outputs need to be less tightly coupled than they are in the light_curve_collector notebook.
Specifically, we want to save the sample and light curve data to file as soon as each piece is collected, and we want the archive functions to be able to get the <code>sample_table</code> input from file.</p><p>The python helper and bash script were specifically designed to fulfill many of these wants and needs.</p><h3 id="advice-for-the-user" class="relative group"><span class="heading-text">Advice for the user</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#advice-for-the-user" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Getting started:</p><ol start="1"><li><p>Skim this notebook to understand the process, available options, and potential sticking points.</p></li><li><p>Try things with a small sample size first, then scale up to your desired full sample.</p></li><li><p>Don’t be surprised if something goes wrong.
Every new combination of factors can present different challenges and reasons for the code to fail.
This includes the sample selection, which archives are called and what parameters are used, runtime environment, machine CPU and RAM capabilities, network bandwidth, etc.
Scaling up any code base comes with challenges, and some of these cannot be fully managed by pre-written code.
You may need to observe how the code performs, diagnose a problem, and adapt the input parameters, machine size, etc. in order to successfully execute.</p></li></ol><p>To execute a run:</p><ol start="1"><li><p>Define all of the get-sample and get-lightcurve parameters.</p></li><li><p>Launch the run by calling the bash script or some other multi-processing method.
Capturing stdout, stderr and <code>top</code> output to log files is highly recommended.</p></li><li><p>If a get-lightcurve (get-sample) job exits without writing a .parquet (.ecsv) file, inspect the logs and <code>top</code> output to try to determine the reason it failed.
It could be anything from a missing python library (install it), to an archive encountering an internal error (wait a bit and try again), to the job getting killed prematurely because its needs exceeded the available RAM (try a machine with more RAM, a smaller sample size, or running fewer archive calls at a time), to many other things.</p></li></ol><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p><strong>Authors</strong>: Troy Raen, Jessica Krick, Brigitta Sipőcz, Shoubaneh Hemmati, Andreas Faisst, David Shupe, and the Fornax team</p></li><li><p><strong>Contact:</strong> For help with this notebook, please open a topic in the <a target="_blank" rel="noreferrer" href="https://discourse.fornax.sciencecloud.nasa.gov/" class="">Fornax Community Forum</a> “Support” category.</p></li></ul><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/fornax-demo-notebooks/light-curve-collector"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Make Multi-Wavelength Light Curves Using Archival Data</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/fornax-demo-notebooks/light-curve-classifier"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Light Curve Classifier</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let d=Math.random().toString(32).slice(2);window.history.replaceState({key:d},"")}try{let u=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof u=="number"&&window.scrollTo(0,u)}catch(d){console.error(d),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-UGO2RSJF.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-HHKX4TLX.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-YATQFWLS.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-MBMQ6BQC.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-CVDX4WR7.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-NK7RXO5Q.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/root-TRTRBUUN.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-6NUWI4AQ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-M5KN76GI.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/routes/$-VLPGWU3Z.js"/><script>window.__remixContext = {"url":"/scale-up","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.4","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-1c55a67036ba11e5dc00e7d2a2843a40.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-127635c68cf832a2acdc06e71e831789.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/fornax-demo-notebooks"},"routes/$":{"config":{"version":2,"myst":"1.6.4","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-1c55a67036ba11e5dc00e7d2a2843a40.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-127635c68cf832a2acdc06e71e831789.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Notebook","sha256":"14f0467d8ac37fc05b3cbc3f017dcb3d33bc57a7510cd9e26a27388a5883b189","slug":"scale-up","location":"/light_curves/scale_up.md","dependencies":[],"frontmatter":{"title":"Make Multi-Wavelength Light Curves for Large Samples","kernelspec":{"name":"python3","display_name":"py-scale_up","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.1"}},"content_includes_title":false,"authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","subject":"Fornax Demo Notebooks","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/light_curves/scale_up.md","edit_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/light_curves/scale_up.md","exports":[{"format":"md","filename":"scale_up.md","url":"/fornax-demo-notebooks/build/scale_up-af78047f64a21bf2a1907699efd8d81d.md"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"NkT8wJl15l"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"jMtDrg1BjE"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will be able to:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"C1oKQ6U3JK"}],"key":"yZ7keU6t7N"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Parallelize the code demonstrated in the ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"PemCuaqEUE"},{"type":"link","url":"/light-curve-collector","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"light​_curve​_collector","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"o9bTPSuU7M"}],"urlSource":"light_curve_collector.md","dataUrl":"/light-curve-collector.json","internal":true,"protocol":"file","key":"LSlXKl382S"},{"type":"text","value":" notebook to get multi-wavelength light curves.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Hny3dbBvUy"}],"key":"YN3HHtJYMz"}],"key":"YhqsE1e4gd"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Launch a run using a large sample of objects, monitor the run’s progress automatically, and understand its resource usage (CPU and RAM).","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"tQNP0YOj0N"}],"key":"XUck1ABNqY"}],"key":"rWsBgKe68N"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Understand some general challenges and requirements when scaling up code.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"uIZL0lEdyX"}],"key":"ukpPXId9rK"}],"key":"GuhMgZjnCv"}],"key":"H9GZkmKK4b"}],"key":"t8pCLPnNz0"},{"type":"block","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"OtiEmdaqYe"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"GzPvcssH7p"}],"key":"qdaQ8HSrlw"},{"type":"block","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"This notebook shows how to collect multi-wavelength light curves for a large sample of target objects.\nThis is a scaling-up of the ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"CUTw0xuBlD"},{"type":"link","url":"/light-curve-collector","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"light​_curve​_collector","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"TsbDFRKmMU"}],"urlSource":"light_curve_collector.md","dataUrl":"/light-curve-collector.json","internal":true,"protocol":"file","key":"SwXCwxEQBr"},{"type":"text","value":" and assumes you are familiar with the content of that notebook.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"eY9VRhc4OF"}],"key":"AF7PsccoUA"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Notebook sections are:","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"efXGbaNIxg"}],"key":"HXrdwMHdla"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":40,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Overview: Describes functionality of the included bash script and python helper functions. Compares some parallel processing options. Introduces ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"QHvdps4wPc"},{"type":"inlineCode","value":"top","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"dtB8ojOvdC"},{"type":"text","value":" and what be aware of.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"jVD8n7oWhr"}],"key":"EPnXdOoiQf"}],"key":"WoRHmO2Ct7"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Example 1: Shows how to launch a large-scale run using the bash script, monitor its progress automatically, and diagnose a problem (out of RAM). This method is recommended for sample sizes greater than a few hundred.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"Xd7Q7afE8E"}],"key":"tge2SVOc1c"}],"key":"sUUj8gWaVY"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Example 2: Shows how to parallelize the example from the light_curve_collector notebook using the helper and python’s ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"myEWFSrV3C"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"AaGWzlSHg6"},{"type":"text","value":" library.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"dbqe17PFtL"}],"key":"ejuh8dXCYQ"}],"key":"mYjXfK0SnU"},{"type":"listItem","spread":true,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Example 3: Details the helper parameter options and how to use them in python and bash.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"sIaQBi4Lle"}],"key":"QqENWi31I5"}],"key":"gkJ5J2w91G"},{"type":"listItem","spread":true,"position":{"start":{"line":44,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Appendix: Contains background information including a discussion of the challenges, needs, and wants encountered when scaling up this code, and general advice for the user which can be applied to other use cases.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"OR2QMFfEZR"}],"key":"syBWaPdlMF"}],"key":"yRU3GOjUtc"}],"key":"hptzFzjOBx"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"As written, this notebook is expected to require at least 1 CPU and 6G RAM.","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"jJQ9UJmtpY"}],"key":"YTinIVvTCP"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"strong","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Many of the bash commands below are shown in non-executable cells because they are not intended to be run in this notebook.","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"G8hRF1S92I"}],"key":"uDXah1WtJC"},{"type":"text","value":"\nBash commands that are not executed below begin with the symbol ","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"BGbjwQqlE5"},{"type":"inlineCode","value":"$ ","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"SK0KE7bizI"},{"type":"text","value":", and those that are executed begin with ","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"WMRmNihtTT"},{"type":"inlineCode","value":"!","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"Cxm7cAaJgm"},{"type":"text","value":".\nBoth types can be called from the command-line -- open a new terminal and copy/paste the cell text without the beginning symbol. The bash script is not intended to be executed from within a notebook and may behave strangely if attempted.\nAlso be aware that the script path shown in the commands below assumes you are in the same directory as this notebook. Adjust it if needed.","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"LT9EmWdw3H"}],"key":"yZZQ3exasQ"}],"key":"C2zlrtuEnt"},{"type":"block","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Parallel processing methods: bash script vs. python’s ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"kK6QBduGBV"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"yDoddggh4W"}],"identifier":"parallel-processing-methods-bash-script-vs-pythons-multiprocessing","label":"Parallel processing methods: bash script vs. python’s multiprocessing","html_id":"parallel-processing-methods-bash-script-vs-pythons-multiprocessing","implicit":true,"key":"rsS0V9JEfo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":57,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Bash script: Recommended for most runs with medium to large sample sizes (\u003e~500). Allows ZTF to use additional parallelization internally, and so is often faster (ZTF often takes the longest and returns the most data for AGN-like samples). Writes stdout and stderr to log files, useful for monitoring jobs and resource usage. Can save ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"SCv0sfZCXW"},{"type":"inlineCode","value":"top","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"at1iMnwk8D"},{"type":"text","value":" output to a file to help identify CPU and RAM usage/needs.","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"W7uCU7rf3P"}],"key":"h0Z4Uroxg1"}],"key":"TNQdA8Ho4G"},{"type":"listItem","spread":true,"position":{"start":{"line":58,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Python’s ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"BCROMN6l35"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"jxgAOrqz9z"},{"type":"text","value":" library: Can be convenient for runs with small to medium sample sizes, up to ~500. Has drawbacks that may be significant including the inability to use ZTF’s internal parallelization and that it does not save the log output (stdout and stderr) to file. An advantage of the ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"lMFCtMvDFg"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"U5ziZ5i3rI"},{"type":"text","value":" example in this notebook over the light_curve_collector is that it automatically saves the sample and light curve data to disk after loading them and can automatically skip those functions in subsequent calls and use the files instead.","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"TAkfiB6vYQ"}],"key":"gFpMpd2FDZ"}],"key":"O2Faq7jcXa"}],"key":"RvvKiOzCJJ"}],"key":"UrJJQwY9eF"},{"type":"block","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"The python helper","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"PalubBrxAk"}],"identifier":"the-python-helper","label":"The python helper","html_id":"the-python-helper","implicit":true,"key":"TONcGQApYD"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"The python “helper” is a set of wrapper functions around the same ‘code_src/’ functions used in the light_curve_collector notebook.","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"lvNlglmlz8"}],"key":"lnWLyK8aXk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":66,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The wrappers facilitate parallelization and large-scale runs by automating tasks like saving the function outputs to files.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"ewqsmreCed"}],"key":"eY0mjsoKd7"}],"key":"L4RIgNLhN8"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The helper does not actually implement parallelization and can only run one function per call.","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"bmOM53uQWm"}],"key":"TTdOk8eq3c"}],"key":"muYH37eZ4s"},{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The helper can be used in combination with any parallel processing method.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"kpIrpEJuCS"}],"key":"PrTeJhIAzc"}],"key":"EYAN01YcPi"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The helper can load ","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"ozoEr2ONPM"},{"type":"inlineCode","value":"top","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"dxYzMv9UOy"},{"type":"text","value":" output from a file to pandas DataFrames and make some figures.","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"qdEIonv2n8"}],"key":"ndOVtfm9np"}],"key":"dOfltDoyCl"}],"key":"yp7GSQLSLh"}],"key":"Zzu3tzFrZ9"},{"type":"block","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"The bash script","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"ZajMHiM4qR"}],"identifier":"the-bash-script","label":"The bash script","html_id":"the-bash-script","implicit":true,"key":"v6EEkhyT79"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"The bash script allows the user to collect light curves from a large scale sample with a single command and provides options to help manage and monitor the run.\nIn a nutshell, the script does the following when called using flags that “launch a run”:","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"PkoqeR8M1v"}],"key":"JJAGaDZIjN"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":78,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"calls the helper to gather the requested sample and then launches jobs for each archive query in separate, parallel processes.","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"JI0UVldQCK"}],"key":"Z48pK9r8tE"}],"key":"mWueJ8QWWn"},{"type":"listItem","spread":true,"position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"redirects stdout and stderr to log files.","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"DL8JzNQ6Ij"}],"key":"m2TVmyFnK9"}],"key":"btRxBYalpG"},{"type":"listItem","spread":true,"position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"tells the user what the process PIDs are and where the log and data files are.","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"ZPe0sEjCGy"}],"key":"Hm1pnLwP6n"}],"key":"rciPUbyJyU"},{"type":"listItem","spread":true,"position":{"start":{"line":81,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"exits, leaving the archive jobs running in the background.","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"z3yRqyCAiv"}],"key":"NLIRVnpmIz"}],"key":"HY9Zv1Jyb0"}],"key":"xRK8c0xUYe"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"In case all the archive calls need to be canceled after the script exits, the user can call the script again with a different flag to have it find and kill all the processes it launched.","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"LtUR8Dd7Mm"}],"key":"lAlYefI5Q5"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"While the jobs are running, the user can call the script again with a different flag to have it save ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"Y7lnRTh0l5"},{"type":"inlineCode","value":"top","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"Nf0OuzdglE"},{"type":"text","value":" output to a log file at a user-defined interval.\nThe helper can be used to load this file to pandas DataFrames and make some figures.","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"BHjTkflUIr"}],"key":"rQADHGHonf"}],"key":"VFUhAGbx2L"},{"type":"block","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"text","value":"Interpreting ","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"xayQ2UvsEp"},{"type":"inlineCode","value":"top","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"iamQzJG2dC"}],"identifier":"interpreting-top","label":"Interpreting top","html_id":"interpreting-top","implicit":true,"key":"FBThTqHQx0"},{"type":"paragraph","position":{"start":{"line":92,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"If you are unfamiliar with ","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"vWAjSvrYBZ"},{"type":"inlineCode","value":"top","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"yVee31xeMv"},{"type":"text","value":", the answer to this ","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"U9uHbaaQ17"},{"type":"link","url":"https://superuser.com/questions/575202/understanding-top-command-in-unix","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"StackExchange question","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"Fevw1JasAF"}],"urlSource":"https://superuser.com/questions/575202/understanding-top-command-in-unix","key":"rej4n10zWJ"},{"type":"text","value":" contains a basic description of the fields in the output.\nAlso, beware that ","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"e0H0cqyptU"},{"type":"inlineCode","value":"top","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"jtspA0zmSu"},{"type":"text","value":" can be configured to display values in different ways (e.g., as a percentage of either a single CPU or of all available CPUs).\nTo understand the local configuration, read the man page (run ","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"i7h4y5aaba"},{"type":"inlineCode","value":"man top","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"uhIbb9s94N"},{"type":"text","value":" in a terminal), particularly the sections “SUMMARY Display” and “FIELDS / Columns Display”.","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"KiPeYgP8IU"}],"key":"qJRxIKciJZ"}],"key":"rYqZ3sImC9"},{"type":"block","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"Fornax Science Console","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"F3J2lIEiSG"}],"identifier":"fornax-science-console","label":"Fornax Science Console","html_id":"fornax-science-console","implicit":true,"key":"VsHMQkHaUN"},{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"There are a couple of things to be aware of when running on the Fornax Science Console.","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"ttejDt2zZH"}],"key":"hC4QZ0uizl"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"Take note of the amount of CPU and RAM available to the server type you choose when starting the session.\nIn particular, beware that ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"sanU2lILSx"},{"type":"inlineCode","value":"top","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"HX2lEJF0vO"},{"type":"text","value":" can show a larger amount of total RAM than is actually accessible to your server due to resource sharing between users.","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"An0sX0c3xr"}],"key":"Lb7vSxxbI4"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"The Science Console is primarily intended for interactive use and will cull sessions which appear to be inactive.\nIf you want a notebook or script to run for longer than about 30 minutes and you will not be interacting with the Console, running ","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"fnCjzwJpmo"},{"type":"inlineCode","value":"top","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"sCazBv28bF"},{"type":"text","value":" during that time can help keep the session active.","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"Bz68cHnEPH"}],"key":"hCoJanPghR"}],"key":"UMYQXxX7B4"},{"type":"block","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"WezDeMTX9a"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"VX4GJxHz5e"},{"type":"paragraph","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"This cell will install the dependencies, if needed:","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"vHTLRBfLZv"}],"key":"RbsmRxHAXr"}],"key":"OddoDkXof0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# %pip install -r requirements_scale_up.txt","key":"smpvqaSIp8"},{"type":"output","id":"vwofdOeq2Tqx04m6Thr6g","data":[],"key":"xVzMQ3paRL"}],"key":"cFy9TygLDH"},{"type":"block","children":[],"key":"weE26wK3xc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import multiprocessing  # python parallelization method\nimport pandas as pd  # use a DataFrame to work with light-curve and other data\nimport sys  # add code directories to the path\n\nsys.path.append(\"code_src/\")\nimport helpers.scale_up  # python \"helper\" for parallelization and large scale runs\nimport helpers.top  # load `top` output to DataFrames and make figures\nfrom data_structures import MultiIndexDFObject  # load light curve data as a MultiIndexDFObject\nfrom plot_functions import create_figures  # make light curve figures","key":"A1zoIE5rcs"},{"type":"output","id":"WQFeSLjAHU5eQJaNwzoPJ","data":[],"key":"kdUKEP2Nqr"}],"key":"f8eWLS4vSX"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"children":[{"type":"text","value":"1. Multi-wavelength light curves for 500,000 SDSS AGN","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"key":"tT3coXiX4e"}],"identifier":"id-1-multi-wavelength-light-curves-for-500-000-sdss-agn","label":"1. Multi-wavelength light curves for 500,000 SDSS AGN","html_id":"id-1-multi-wavelength-light-curves-for-500-000-sdss-agn","implicit":true,"key":"sYrmfx1qp5"}],"key":"gMUVPPsZkt"},{"type":"block","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":135,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"This example shows how to launch a large-scale collection of light curves using the bash script, monitor its performance, and diagnose a problem (out of RAM).\nThis run collects light curves for 500,000 SDSS objects and takes several hours to complete, but is not actually executed here.\nInstead, we show the bash commands and then look at logs that were generated by running the commands on 2024/03/01.\nIf executed, the run is expected to require at least 2 CPUs and 100G RAM.","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"TkbG76t7RU"}],"key":"ac8jtt3dbN"}],"key":"ZJclV5lbuA"},{"type":"block","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"1.1 Launch the run","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"oLMlzb0Cnj"}],"identifier":"id-1-1-launch-the-run","label":"1.1 Launch the run","html_id":"id-1-1-launch-the-run","implicit":true,"key":"wga0ufhR76"}],"key":"zNxamy5seT"},{"type":"block","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"code","lang":"bash","value":"# This will launch a very large scale run.\n# See Example 3 for a detailed explanation of parameter options.\n# If you are running this for the first time, reduce the sample size 500000 -\u003e 50.\n\n# run_id will be used in future calls to manage this run, and also determines the name of the output directory.\n# If you are executing this, change run_id to your own value to avoid overwriting the demo logs.\n$ run_id=\"demo-SDSS-500k\"\n\n# Execute the run.\n# This will get the sample and then call all archives specified by the '-a' flag.\n# Defaults will be used for all keyword arguments that are not specified.\n$ bash code_src/helpers/scale_up.sh \\\n    -r \"$run_id\" \\\n    -j '{\"get_samples\": {\"SDSS\": {\"num\": 500000}}, \"archives\": {\"ZTF\": {\"nworkers\": 8}}}' \\\n    -a \"Gaia HEASARC IceCube WISE ZTF\"","position":{"start":{"line":146,"column":1},"end":{"line":162,"column":1}},"key":"J3jnhstKDh"}],"key":"FfvxioqqwF"},{"type":"block","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":166,"column":1},"end":{"line":168,"column":1}},"children":[{"type":"text","value":"The script will run the ‘get sample’ job, then launch the archive query jobs in parallel and exit.\nArchive jobs will continue running in the background until they either complete or encounter an error.\nExample 2 shows how to load the data.","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"Yzy6vFOVyO"}],"key":"pJUhi9cCOc"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"Command output from 2024/03/01 logs:","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"j7M5NriGnq"}],"key":"X7DhioxpXe"}],"key":"X0nHfYHWUW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!cat output/lightcurves-demo-SDSS-500k/logs/scale_up.sh.log\n# There is a warning that the SDSS 'specObjID' column was converted from an int to a string.\n# The column is immediately dropped. It is not used in the code.","key":"a0cO5DGIJy"},{"type":"output","id":"_B6IlNZDZkW989UekKPLb","data":[{"output_type":"stream","name":"stdout","text":"*********************************************************************\r\n**                          Run starting.                          **\r\nrun_id=SDSS-500k\r\nbase_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k\r\nlogs_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/logs\r\nparquet_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/lightcurves.parquet\r\n**                                                                 **\r\n\r\nBuild sample is starting. logfile=get_sample.log\r\nBuild sample is done. Printing the log for convenience:\r\n\r\n-- /home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/logs/get_sample.log:\r\n2024/03/01 20:31:27 UTC | [pid=3289] Starting build=sample\r\nBuilding object sample from: ['sdss']\r\nWARNING: OverflowError converting to IntType in column specObjID, reverting to String. [astropy.io.ascii.fastbasic]\r\nSDSS Quasar: 500000\r\nObject sample size, after duplicates removal: 498877\r\nObject sample saved to: /home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/object_sample.ecsv\r\n2024/03/01 20:36:59 UTC\r\n--\r\n\r\nArchive calls are starting.\r\n\r\n[pid=3968] Gaia started. logfile=gaia.log\r\n[pid=3972] HEASARC started. logfile=heasarc.log\r\n[pid=3976] IceCube started. logfile=icecube.log\r\n[pid=3980] WISE started. logfile=wise.log\r\n[pid=3984] ZTF started. logfile=ztf.log\r\n\r\n**                                                                  **\r\n**                       Main process exiting.                      **\r\n**           Jobs may continue running in the background.           **\r\n**********************************************************************\r\n"}],"key":"lAQVh1IHwL"}],"key":"f4ZIvmJ8l9"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"1.2 Cancel","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"kq8ydXgHmk"}],"identifier":"id-1-2-cancel","label":"1.2 Cancel","html_id":"id-1-2-cancel","implicit":true,"key":"ufuKpQd4CR"}],"key":"zo0zOrNiNM"},{"type":"block","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"text","value":"You can cancel jobs at any time.","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"gErBK9yrZg"}],"key":"dLRtCWIgXK"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"If the script is still running, press ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"Os99QfEftt"},{"type":"inlineCode","value":"Control-C","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"dyZQRPe0pl"},{"type":"text","value":".","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"UIcZP9Yatb"}],"key":"Cvz8lY74IU"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"If the script has exited, there are two options.","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"eW3OctBnW4"}],"key":"Xb6LVQnRvD"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":188,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":188,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"To cancel an individual job, kill the job’s process using:","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"APfeMO5nwy"}],"key":"oYFzRCntIj"}],"key":"hgjFQiIOS6"}],"key":"pInZtPF3Vk"}],"key":"pbMvRQlFNY"},{"type":"block","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"code","lang":"bash","value":"$ pid=0000  # get the number from script output\n$ kill $pid","position":{"start":{"line":192,"column":1},"end":{"line":195,"column":1}},"key":"RDfC8aBba6"}],"key":"Ew6A7EteKU"},{"type":"block","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":199,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":199,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"To cancel the entire run, use the ","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"OLeVJlKmvp"},{"type":"inlineCode","value":"-k","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"ugsfbENTy7"},{"type":"text","value":" (kill) flag:","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"cdmuUz8xC8"}],"key":"DCK14nhwOD"}],"key":"ObD7zXYjLX"}],"key":"PVbQ5aqqqE"}],"key":"Us0hAipy6m"},{"type":"block","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"code","lang":"bash","value":"$ bash code_src/helpers/scale_up.sh -r \"$run_id\" -k","position":{"start":{"line":203,"column":1},"end":{"line":205,"column":1}},"key":"FMpk3nlRNg"}],"key":"e5ajFkPvB5"},{"type":"block","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"1.3 Restart","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"kyLosxYEQD"}],"identifier":"id-1-3-restart","label":"1.3 Restart","html_id":"id-1-3-restart","implicit":true,"key":"vwLuJFxZBw"}],"key":"b2u0PLMUXG"},{"type":"block","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"text","value":"If you want to restart and skip step(s) that previously completed, run the first command again and add one or both “overwrite” flags set to false:","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"woMRvk7Kta"}],"key":"sey1TqMqvy"}],"key":"T1cYdEQRSq"},{"type":"block","position":{"start":{"line":215,"column":1},"end":{"line":215,"column":1}},"children":[{"type":"code","lang":"bash","value":"# use the same run_id as before\n$ bash code_src/helpers/scale_up.sh \\\n    -r \"$run_id\" \\\n    -j '{\"get_samples\": {\"SDSS\": {\"num\": 500000}}, \"archives\": {\"ZTF\": {\"nworkers\": 8}}}' \\\n    -a \"Gaia HEASARC IceCube WISE ZTF\" \\\n    -d \"overwrite_existing_sample=false\" \\\n    -d \"overwrite_existing_lightcurves=false\"","position":{"start":{"line":217,"column":1},"end":{"line":225,"column":1}},"key":"hJRtlFz2Pr"}],"key":"cD6zHEVTWF"},{"type":"block","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"1.4 Monitor","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"UCdARVgbpd"}],"identifier":"id-1-4-monitor","label":"1.4 Monitor","html_id":"id-1-4-monitor","implicit":true,"key":"lhGGgtuUIo"}],"key":"Odv6CqbnQs"},{"type":"block","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},"children":[{"type":"text","value":"There are at least three places to look for information about a run’s status.","position":{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},"key":"OHAvauDHMd"}],"key":"qyqYf6cR0w"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":235,"column":1},"end":{"line":238,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Check the logs for job status or errors. The bash script will redirect stdout and stderr to log files and print out the paths for you.","position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"key":"fbSgPwO9sz"}],"key":"AuScAoUDN7"}],"key":"xuAGkChpGK"},{"type":"listItem","spread":true,"position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Check for light curve (parquet) data. The script will print out the “parquet_dir”. ","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"JFAnrK2AtF"},{"type":"inlineCode","value":"ls","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"DiFmvHfZx4"},{"type":"text","value":" this directory. You will see a subdirectory for each archive call that has completed successfully, assuming it retrieved data for the sample.","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"tenSs1RNve"}],"key":"a7j1pix0BZ"}],"key":"N7AnhFprmZ"},{"type":"listItem","spread":true,"position":{"start":{"line":237,"column":1},"end":{"line":238,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Watch ","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"cgOr1KOWKV"},{"type":"inlineCode","value":"top","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"VSIu6iu0Zv"},{"type":"text","value":". The script will print the job PIDs. The script can also monitor ","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"Pp8gRTanqE"},{"type":"inlineCode","value":"top","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"YaAitokPkp"},{"type":"text","value":" for you and save the output to a log file.","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"rsEDKKMCcJ"}],"key":"ZXm1gT9UC9"}],"key":"A3SiHNfk2T"}],"key":"RTQjJJq5we"}],"key":"ztsgmycYLa"},{"type":"block","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"heading","depth":4,"position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"1.4.1 Logs","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"QaveYqYWVQ"}],"identifier":"id-1-4-1-logs","label":"1.4.1 Logs","html_id":"id-1-4-1-logs","implicit":true,"key":"OhHeze07aJ"}],"key":"NwhmwSqgmC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Gaia log from 2024/03/01 (success)\n!cat output/lightcurves-demo-SDSS-500k/logs/gaia.log","key":"dt9OF0UGTw"},{"type":"output","id":"f91r2jB0zsKS5ZhWaCKot","data":[{"output_type":"stream","name":"stdout","text":"2024/03/01 20:37:00 UTC | [pid=3968] Starting build=lightcurves, archive=gaia\r\nINFO: Query finished. [astroquery.utils.tap.core]\r\nLight curves saved to:\r\n\tparquet_dir=/home/jovyan/raen/fornax-demo-notebooks/light_curves/output/lightcurves-SDSS-500k/lightcurves.parquet\r\n\tfile=archive=gaia/part0.snappy.parquet\r\n2024/03/01 21:07:38 UTC\r\n"}],"key":"hCfLeFRutC"}],"key":"yBmEUfMoCz"},{"type":"block","children":[],"key":"ZoqE7mjaDj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ZTF log from 2024/03/01 (failure)\n!cat output/lightcurves-demo-SDSS-500k/logs/ztf.log","key":"JhIxZ6Nxw7"},{"type":"output","id":"n1GZ62Xp7sxXOAVT4QlRS","data":[{"output_type":"stream","name":"stdout","text":"2024/03/01 20:37:00 UTC | [pid=3984] Starting build=lightcurv...","hash":"0b0e4b36451a370ef714a5caf7ba27e0","path":"/fornax-demo-notebooks/build/0b0e4b36451a370ef714a5caf7ba27e0.txt"}],"key":"uuvIUZpnAd"}],"key":"PjWcF52MbN"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":253,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"The logs above show that the ZTF job loaded the light curve data successfully (“100%”) but exited without writing the parquet file (no “Light curves saved” message like Gaia).\nThe data was lost.\nThere is also no indication of an error; the job just ends.\nWe can diagnose what happened by looking at the ","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"dFDyOu6rmI"},{"type":"inlineCode","value":"top","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"TGpPootEl5"},{"type":"text","value":" output.","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"AUQoZ04wgq"}],"key":"S6w6w3GG7W"}],"key":"YYyci1n37M"},{"type":"block","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"children":[{"type":"heading","depth":4,"position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"1.4.2 ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"WTQGOym1tD"},{"type":"inlineCode","value":"top","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"pIupuUdMHq"}],"identifier":"id-1-4-2-top","label":"1.4.2 top","html_id":"id-1-4-2-top","implicit":true,"key":"IxRZohZrOs"},{"type":"paragraph","position":{"start":{"line":262,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"While the jobs are running, you can monitor ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"ArRkVTMr16"},{"type":"inlineCode","value":"top","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"pZKYtpVUbd"},{"type":"text","value":" and save the output to a log file by calling the script again with the ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"J3BtrXlHt9"},{"type":"inlineCode","value":"-t","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"AuUEVpTv9a"},{"type":"text","value":" flag.\nThis call must be separate from the call that launches the run.\nIf you want to capture the sample step as well as the archive queries, open a second terminal and call the script with ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"Uv9NOcRVHm"},{"type":"inlineCode","value":"-t","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"amdZwF7FzX"},{"type":"text","value":" right after launching the run in the first terminal.","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"owCRW1tY6b"}],"key":"w52vrHpnnv"}],"key":"UB5LOjMyLP"},{"type":"block","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"children":[{"type":"code","lang":"bash","value":"$ interval=10m  # choose your interval\n$ bash code_src/helpers/scale_up.sh -r \"run_id\" -t \"$interval\"","position":{"start":{"line":268,"column":1},"end":{"line":271,"column":1}},"key":"v1lNAZNztq"}],"key":"iTPoBOIjya"},{"type":"block","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":275,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"The script will continue running until after all of run_id’s jobs have completed.\nYou can cancel at anytime with ","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"lvKQsliuv5"},{"type":"inlineCode","value":"Control-C","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"srAISU12Ah"},{"type":"text","value":" and start it again with a new interval.","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"p5AxqRFOTv"}],"key":"C2HSjOJzpc"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"Once saved to file, the helper can parse the ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"CbzVGUQanc"},{"type":"inlineCode","value":"top","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"VnSwb3cCDs"},{"type":"text","value":" output into pandas DataFrames and make some figures.","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"gN7bkzb4dB"}],"key":"JVLb2rgVkT"},{"type":"paragraph","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"children":[{"type":"inlineCode","value":"top","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"OqXqFoW7i1"},{"type":"text","value":" output from 2024/03/01:","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"GGFe2Guicv"}],"key":"l5otIR3Lmu"}],"key":"L7oIZnH1VB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"run_id = \"demo-SDSS-500k\"\nlogs_dir = helpers.scale_up.run(build=\"logs_dir\", run_id=run_id)\n\ntoplog = helpers.top.load_top_output(toptxt_dir=logs_dir, run_id=run_id)","key":"MGWIe0VoGi"},{"type":"output","id":"ZtbT0bmNJKC5WJxK-bURw","data":[],"key":"AzNQq7P6Cp"}],"key":"EO3vUrImsO"},{"type":"block","children":[],"key":"KiIdaLmWYE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# System summary information from lines 1-5 of `top` output. One row per time step.\ntoplog.summary_df.sample(5)","key":"NyBx5jg7Bj"},{"type":"output","id":"GE34J7TyYOI4122X9Ry02","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"                           load_avg_per_1min  load_avg_per_5min  \\\ntime                                                              \n2024-03-01 20:39:41+00:00               1.66               1.23   \n2024-03-01 21:13:46+00:00               0.41               0.64   \n2024-03-01 20:53:53+00:00               0.96               1.01   \n2024-03-01 21:44:47+00:00               1.48               2.14   \n2024-03-01 21:09:22+00:00               0.60               0.83   \n\n                           load_avg_per_15min  total_GiB  free_GiB  used_GiB  \\\ntime                                                                           \n2024-03-01 20:39:41+00:00                0.69       61.8      51.0       2.4   \n2024-03-01 21:13:46+00:00                0.80       61.8      49.0       3.9   \n2024-03-01 20:53:53+00:00                0.95       61.8      47.7       5.7   \n2024-03-01 21:44:47+00:00                1.98       61.8      33.8      19.1   \n2024-03-01 21:09:22+00:00                0.89       61.8      49.1       3.8   \n\n                           avail_GiB      delta_time  \ntime                                                  \n2024-03-01 20:39:41+00:00       58.7 0 days 00:08:13  \n2024-03-01 21:13:46+00:00       57.2 0 days 00:42:18  \n2024-03-01 20:53:53+00:00       55.5 0 days 00:22:25  \n2024-03-01 21:44:47+00:00       43.8 0 days 01:13:19  \n2024-03-01 21:09:22+00:00       57.3 0 days 00:37:54  ","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eload_avg_per_1min\u003c/th\u003e\n      \u003cth\u003eload_avg_per_5min\u003c/th\u003e\n      \u003cth\u003eload_avg_per_15min\u003c/th\u003e\n      \u003cth\u003etotal_GiB\u003c/th\u003e\n      \u003cth\u003efree_GiB\u003c/th\u003e\n      \u003cth\u003eused_GiB\u003c/th\u003e\n      \u003cth\u003eavail_GiB\u003c/th\u003e\n      \u003cth\u003edelta_time\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 20:39:41+00:00\u003c/th\u003e\n      \u003ctd\u003e1.66\u003c/td\u003e\n      \u003ctd\u003e1.23\u003c/td\u003e\n      \u003ctd\u003e0.69\u003c/td\u003e\n      \u003ctd\u003e61.8\u003c/td\u003e\n      \u003ctd\u003e51.0\u003c/td\u003e\n      \u003ctd\u003e2.4\u003c/td\u003e\n      \u003ctd\u003e58.7\u003c/td\u003e\n      \u003ctd\u003e0 days 00:08:13\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 21:13:46+00:00\u003c/th\u003e\n      \u003ctd\u003e0.41\u003c/td\u003e\n      \u003ctd\u003e0.64\u003c/td\u003e\n      \u003ctd\u003e0.80\u003c/td\u003e\n      \u003ctd\u003e61.8\u003c/td\u003e\n      \u003ctd\u003e49.0\u003c/td\u003e\n      \u003ctd\u003e3.9\u003c/td\u003e\n      \u003ctd\u003e57.2\u003c/td\u003e\n      \u003ctd\u003e0 days 00:42:18\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 20:53:53+00:00\u003c/th\u003e\n      \u003ctd\u003e0.96\u003c/td\u003e\n      \u003ctd\u003e1.01\u003c/td\u003e\n      \u003ctd\u003e0.95\u003c/td\u003e\n      \u003ctd\u003e61.8\u003c/td\u003e\n      \u003ctd\u003e47.7\u003c/td\u003e\n      \u003ctd\u003e5.7\u003c/td\u003e\n      \u003ctd\u003e55.5\u003c/td\u003e\n      \u003ctd\u003e0 days 00:22:25\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 21:44:47+00:00\u003c/th\u003e\n      \u003ctd\u003e1.48\u003c/td\u003e\n      \u003ctd\u003e2.14\u003c/td\u003e\n      \u003ctd\u003e1.98\u003c/td\u003e\n      \u003ctd\u003e61.8\u003c/td\u003e\n      \u003ctd\u003e33.8\u003c/td\u003e\n      \u003ctd\u003e19.1\u003c/td\u003e\n      \u003ctd\u003e43.8\u003c/td\u003e\n      \u003ctd\u003e0 days 01:13:19\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 21:09:22+00:00\u003c/th\u003e\n      \u003ctd\u003e0.60\u003c/td\u003e\n      \u003ctd\u003e0.83\u003c/td\u003e\n      \u003ctd\u003e0.89\u003c/td\u003e\n      \u003ctd\u003e61.8\u003c/td\u003e\n      \u003ctd\u003e49.1\u003c/td\u003e\n      \u003ctd\u003e3.8\u003c/td\u003e\n      \u003ctd\u003e57.3\u003c/td\u003e\n      \u003ctd\u003e0 days 00:37:54\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"sZqtqwdiM4"}],"key":"OGwUdOxEhl"},{"type":"block","children":[],"key":"s5PXXnaTkV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Information about running processes from lines 6+ of `top` output. One row per process, per time step.\ntoplog.pids_df.sample(5)","key":"OrYLG2mWQd"},{"type":"output","id":"JdwlxynotaunEq_FUuOj1","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"                          job_name pid_name   PID    USER  PR  NI  VIRTg  \\\ntime                                                                       \n2024-03-01 20:43:32+00:00      ztf      ztf  3984  jovyan  20   0    2.9   \n2024-03-01 23:05:31+00:00     wise     wise  3980  jovyan  20   0   11.7   \n2024-03-01 21:03:25+00:00     gaia     gaia  3968  jovyan  20   0    5.6   \n2024-03-01 23:00:25+00:00     wise     wise  3980  jovyan  20   0   11.8   \n2024-03-01 20:37:38+00:00     gaia     gaia  3968  jovyan  20   0    2.8   \n\n                           RESg  SHRg  S   %CPU  %MEM     TIME+ COMMAND  \\\ntime                                                                      \n2024-03-01 20:43:32+00:00   0.3   0.1  S    0.0   0.5   0:09.00  python   \n2024-03-01 23:05:31+00:00   3.0   0.1  R  106.7   4.9  79:14.99  python   \n2024-03-01 21:03:25+00:00   3.3   0.1  S    0.0   5.3  10:08.18  python   \n2024-03-01 23:00:25+00:00   3.0   0.1  R  100.0   4.9  76:27.42  python   \n2024-03-01 20:37:38+00:00   0.5   0.1  S    0.0   0.8   0:12.50  python   \n\n                               delta_time  \ntime                                       \n2024-03-01 20:43:32+00:00 0 days 00:12:04  \n2024-03-01 23:05:31+00:00 0 days 02:34:03  \n2024-03-01 21:03:25+00:00 0 days 00:31:57  \n2024-03-01 23:00:25+00:00 0 days 02:28:57  \n2024-03-01 20:37:38+00:00 0 days 00:06:10  ","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003ejob_name\u003c/th\u003e\n      \u003cth\u003epid_name\u003c/th\u003e\n      \u003cth\u003ePID\u003c/th\u003e\n      \u003cth\u003eUSER\u003c/th\u003e\n      \u003cth\u003ePR\u003c/th\u003e\n      \u003cth\u003eNI\u003c/th\u003e\n      \u003cth\u003eVIRTg\u003c/th\u003e\n      \u003cth\u003eRESg\u003c/th\u003e\n      \u003cth\u003eSHRg\u003c/th\u003e\n      \u003cth\u003eS\u003c/th\u003e\n      \u003cth\u003e%CPU\u003c/th\u003e\n      \u003cth\u003e%MEM\u003c/th\u003e\n      \u003cth\u003eTIME+\u003c/th\u003e\n      \u003cth\u003eCOMMAND\u003c/th\u003e\n      \u003cth\u003edelta_time\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 20:43:32+00:00\u003c/th\u003e\n      \u003ctd\u003eztf\u003c/td\u003e\n      \u003ctd\u003eztf\u003c/td\u003e\n      \u003ctd\u003e3984\u003c/td\u003e\n      \u003ctd\u003ejovyan\u003c/td\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e2.9\u003c/td\u003e\n      \u003ctd\u003e0.3\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n      \u003ctd\u003eS\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n      \u003ctd\u003e0.5\u003c/td\u003e\n      \u003ctd\u003e0:09.00\u003c/td\u003e\n      \u003ctd\u003epython\u003c/td\u003e\n      \u003ctd\u003e0 days 00:12:04\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 23:05:31+00:00\u003c/th\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n      \u003ctd\u003e3980\u003c/td\u003e\n      \u003ctd\u003ejovyan\u003c/td\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e11.7\u003c/td\u003e\n      \u003ctd\u003e3.0\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n      \u003ctd\u003eR\u003c/td\u003e\n      \u003ctd\u003e106.7\u003c/td\u003e\n      \u003ctd\u003e4.9\u003c/td\u003e\n      \u003ctd\u003e79:14.99\u003c/td\u003e\n      \u003ctd\u003epython\u003c/td\u003e\n      \u003ctd\u003e0 days 02:34:03\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 21:03:25+00:00\u003c/th\u003e\n      \u003ctd\u003egaia\u003c/td\u003e\n      \u003ctd\u003egaia\u003c/td\u003e\n      \u003ctd\u003e3968\u003c/td\u003e\n      \u003ctd\u003ejovyan\u003c/td\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e5.6\u003c/td\u003e\n      \u003ctd\u003e3.3\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n      \u003ctd\u003eS\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n      \u003ctd\u003e5.3\u003c/td\u003e\n      \u003ctd\u003e10:08.18\u003c/td\u003e\n      \u003ctd\u003epython\u003c/td\u003e\n      \u003ctd\u003e0 days 00:31:57\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 23:00:25+00:00\u003c/th\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n      \u003ctd\u003e3980\u003c/td\u003e\n      \u003ctd\u003ejovyan\u003c/td\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e11.8\u003c/td\u003e\n      \u003ctd\u003e3.0\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n      \u003ctd\u003eR\u003c/td\u003e\n      \u003ctd\u003e100.0\u003c/td\u003e\n      \u003ctd\u003e4.9\u003c/td\u003e\n      \u003ctd\u003e76:27.42\u003c/td\u003e\n      \u003ctd\u003epython\u003c/td\u003e\n      \u003ctd\u003e0 days 02:28:57\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2024-03-01 20:37:38+00:00\u003c/th\u003e\n      \u003ctd\u003egaia\u003c/td\u003e\n      \u003ctd\u003egaia\u003c/td\u003e\n      \u003ctd\u003e3968\u003c/td\u003e\n      \u003ctd\u003ejovyan\u003c/td\u003e\n      \u003ctd\u003e20\u003c/td\u003e\n      \u003ctd\u003e0\u003c/td\u003e\n      \u003ctd\u003e2.8\u003c/td\u003e\n      \u003ctd\u003e0.5\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n      \u003ctd\u003eS\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n      \u003ctd\u003e0.8\u003c/td\u003e\n      \u003ctd\u003e0:12.50\u003c/td\u003e\n      \u003ctd\u003epython\u003c/td\u003e\n      \u003ctd\u003e0 days 00:06:10\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"z4USVOH4h0"}],"key":"K7SOLfCNoM"},{"type":"block","children":[],"key":"mRAj0ejIdU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = toplog.plot_overview()","key":"xn63Du2zoD"},{"type":"output","id":"h-2CNazEQ2Z7JRP-gD_Ts","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x800 with 4 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b381d4e230aa96fe4b93f1b5776331a3","path":"/fornax-demo-notebooks/build/b381d4e230aa96fe4b93f1b5776331a3.png"}}}],"key":"vbIkmae4qI"}],"key":"vaEMYY8nVE"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"In the figure, panels 1 and 2 show CPU usage while 3 and 4 show memory usage.\nPanels 1 and 3 show system totals while panels 2 and 4 show usage by individual processes.\nSpecifically:","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"X9SGBKtrFi"}],"key":"VqVTyqZqdy"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":307,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Panel 1: System CPU load, averaged over the previous one minute. A value of “1” means that all compute tasks could have been completed by one CPU working 100% of the time (in reality, the tasks would have been split between the available CPUs). If this value exceeds the number of CPUs available, some tasks will wait in a queue before being executed.","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"dNbPKHE2xi"}],"key":"fRJrJn1olG"}],"key":"FxXoCrzgzq"},{"type":"listItem","spread":true,"position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Panel 2: Percentage of time the given process used a CPU. This can be greater than 100% if a process uses multiple threads.","position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"key":"tam2Hx9RrA"}],"key":"V1Y4Zk79O3"}],"key":"QsD5tub3J8"},{"type":"listItem","spread":true,"position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Panel 3: Amount of unused memory available to the system. If this nears zero, the system will start killing processes so that the entire machine doesn’t go down.","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"ugBikLgxK9"}],"key":"RmOyxGBXuD"}],"key":"VEycvgKUxu"},{"type":"listItem","spread":true,"position":{"start":{"line":310,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Panel 4: Percentage of total RAM used by the given process.","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"KA69z8jpRL"}],"key":"Jc5R9Ss4uR"}],"key":"pkvhenzHv1"}],"key":"tg1lYbLxPu"},{"type":"paragraph","position":{"start":{"line":312,"column":1},"end":{"line":315,"column":1}},"children":[{"type":"text","value":"There are many interesting features in the figure that the reader may want to look at in more detail.\nFor example, other than ZTF’s memory spike at the end, we see that the full run collecting multi-wavelength light curves for the SDSS 500k sample could be completed with about 2 CPU and 60G RAM.\nWe also see that the IceCube call completes very quickly but requires a significant amount of memory.\nAnother observation is that the WISE call’s CPU activity seems to slow down when the ZTF workers are running, indicating that a different number of ZTF workers may be more efficient overall.","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"EbLra5ZMSY"}],"key":"KQXirqDJlv"},{"type":"paragraph","position":{"start":{"line":317,"column":1},"end":{"line":318,"column":1}},"children":[{"type":"text","value":"We want to learn why the ZTF job failed.\nLet’s zoom in on that time period:","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"key":"UyWJkiD9WJ"}],"key":"zyJlTcrjeA"}],"key":"a0Ln6kjp1S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = toplog.plot_overview(between_time=(\"22:55\", \"23:10\"))","key":"Rjs1jEUNml"},{"type":"output","id":"GuyEYyFpL-UAukMSK6AJM","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x800 with 4 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c49ee08f3a93873f97e1060c85e9722a","path":"/fornax-demo-notebooks/build/c49ee08f3a93873f97e1060c85e9722a.png"}}}],"key":"QKcxlsGF1j"}],"key":"FUtyrnJigw"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":324,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"text","value":"In the second panel above we see the ZTF worker processes (which load the light curve data) ending just after 23:00 and then the ZTF parent process continues by itself.\nAround 23:06 in the fourth panel, we see the ZTF job’s memory usage rise sharply to almost 100% and then drop immediately to zero when the job terminates.\nThis coincides with the total available memory dropping to near zero in the third panel.\nThis shows that the machine did not have enough memory for the ZTF call to successfully transform the light curve data collected by the workers into a ","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"AGSfZizqMz"},{"type":"inlineCode","value":"MultiIndexDFObject","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"LuQ7AyyPP5"},{"type":"text","value":" and write it as a parquet file, so the machine killed the job.","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"N5YuzsLgwI"}],"key":"KbzGutZR65"},{"type":"paragraph","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"children":[{"type":"text","value":"The solution is to rerun the ZTF archive call on a machine with more RAM.","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"pDPZjW3tn4"}],"key":"wC7TvOnOiQ"},{"type":"paragraph","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"children":[{"type":"text","value":"To learn exactly which step in ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"O0cYBbizmH"},{"type":"inlineCode","value":"ztf_get_lightcurves","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"h0UnikQ5CG"},{"type":"text","value":" was causing this and how much memory it actually needed, additional print statements were inserted into the code similar to the following:","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"eMraScxcJS"}],"key":"jVOh56O9Yh"}],"key":"bSgaGDYPU3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# this was inserted just before \"exploding\" the dataframe in ztf_functions.py\n# helpers.scale_up._now() prints the current timestamp\nprint(f\"{helpers.scale_up._now()} | starting explode\", flush=True)\n# ztf_df = ztf_df.explode(...  # this is the next line in ztf_functions.py","key":"rM6UgoPZDJ"},{"type":"output","id":"w4mQbTqefBjuIwaRkWPsz","data":[{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:50 UTC | starting explode\n"}],"key":"UpsnXZMTfS"}],"key":"nSgnTgJFN2"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":340,"column":1},"end":{"line":341,"column":1}},"children":[{"type":"text","value":"ZTF was then rerun on a large machine and ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"pkoHDWDS2n"},{"type":"inlineCode","value":"top","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"NUnZxtOxnr"},{"type":"text","value":" output was saved.\nAfter the run, we manually compared timestamps between the ZTF log and ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"kYsYjKe6ua"},{"type":"inlineCode","value":"top","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"UDcWZLWZIZ"},{"type":"text","value":" output and tagged relevant ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"czI6vEFhEM"},{"type":"inlineCode","value":"top","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"xynvp0NuH8"},{"type":"text","value":" timestamps with corresponding step names by appending the name to the ‘----’ delineator, like this for the “explode” step:","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"gXDVfDexUi"}],"key":"QPg0jtnCGb"}],"key":"b5mud3ClLl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!cat output/lightcurves-demo-SDSS-500k/logs/top.tag-ztf.txt | grep -A12 explode","key":"gHujwLODR5"},{"type":"output","id":"z4t98ruQ3GQCwe55PQRyz","data":[{"output_type":"stream","name":"stdout","text":"----explode\r\n2024/02/25 02:09:32 UTC\r\ntop - 02:09:32 up  1:20,  0 users,  load average: 1.00, 0.68, 0.43\r\nTasks:   1 total,   1 running,   0 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.6 us,  0.2 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nGiB Mem :    496.0 total,    454.7 free,     13.6 used,     27.7 buff/cache\r\nGiB Swap:      0.0 total,      0.0 free,      0.0 used.    479.4 avail Mem \r\n\r\n   PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n  1418 jovyan    20   0   82.5g  11.8g   0.1g R 100.0   2.4   4:20.44 ipython\r\n----\r\n2024/02/25 02:09:34 UTC\r\ntop - 02:09:34 up  1:20,  0 users,  load average: 1.08, 0.70, 0.44\r\n"}],"key":"GbNb5vAP5o"}],"key":"xDT2jtdePg"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"text","value":"The helper can recognize these tags and show them on a figure:","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"Oet3d8u8X5"}],"key":"bZctOthB1v"}],"key":"QPOYgKLJst"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_toplog = helpers.top.load_top_output(toptxt_file=\"top.tag-ztf.txt\", toptxt_dir=logs_dir, run_id=run_id)\n\nfig = ztf_toplog.plot_time_tags(summary_y=\"used_GiB\")\n# (This run starts by reading a previously cached parquet file containing the raw data returned by workers.)","key":"Etqt077usR"},{"type":"output","id":"FqQSsYHT0vYX1fiP6InBp","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 800x600 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"df5bcf74fcb074c4c273697c3710b374","path":"/fornax-demo-notebooks/build/df5bcf74fcb074c4c273697c3710b374.png"}}}],"key":"gvJmkOwaIe"}],"key":"rBOdmd59Qv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":356,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"This figure shows that almost 100G RAM is required for the ZTF job to succeed.\nIt further shows that the “explode” step requires the most memory, followed by creating the MultiIndexDFObject.\nFrom here, the user can choose an appropriately sized machine and/or consider whether ","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"cS5TvDH9k5"},{"type":"inlineCode","value":"ztf_get_lightcurves","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"ZcZIDW6KdL"},{"type":"text","value":" could be made to use less memory.","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"P8Gf9HGJo6"}],"key":"Vzkhm3rDPq"}],"key":"Smu0sjgACR"},{"type":"block","position":{"start":{"line":360,"column":1},"end":{"line":360,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"children":[{"type":"text","value":"2. Parallelizing the light_curve_collector notebook","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"Nm85tQ0E7D"}],"identifier":"id-2-parallelizing-the-light-curve-collector-notebook","label":"2. Parallelizing the light_curve_collector notebook","html_id":"id-2-parallelizing-the-light-curve-collector-notebook","implicit":true,"key":"noM7TSeYkI"}],"key":"bHcKKxfhr0"},{"type":"block","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":366,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"This example shows how to parallelize the example from the light_curve_collector notebook using the helper and python’s ","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"r1djqLWYNy"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"TnPsu142OJ"},{"type":"text","value":".\nAn advantage of the method shown here is that it automatically saves the sample and light curve data to disk after loading them and can automatically skip those steps in subsequent calls and use the files instead.\nThis is a small sample (Yang, 30 objects).\nIf you want a sample larger than a few hundred, consider using the bash script instead.","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"kxhakpYyTb"}],"key":"hlYpXIwISQ"},{"type":"paragraph","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"Define the keyword arguments for the run:","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"bMrgXTe6TI"}],"key":"pAUOLkeIeL"}],"key":"rKF8q6Wteg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"kwargs_dict = {\n    \"run_id\": \"demo-Yang-sample\",\n    # Paper names to gather the sample from.\n    \"get_samples\": [\"Yang\"],\n    # Keyword arguments for *_get_lightcurves archive calls.\n    \"archives\": {\n        \"Gaia\": {\"search_radius\": 1 / 3600, \"verbose\": 0},\n        \"HEASARC\": {\"catalog_error_radii\": {\"FERMIGTRIG\": 1.0, \"SAXGRBMGRB\": 3.0}},\n        \"IceCube\": {\"icecube_select_topN\": 3, \"max_search_radius\": 2.0},\n        \"WISE\": {\"radius\": 1.0, \"bandlist\": [\"W1\", \"W2\"]},\n        \"ZTF\": {\"match_radius\": 1 / 3600, \"nworkers\": None},\n    },\n}\n# See Example 3 for a detailed explanation of parameter options.\nkwargs_dict","key":"dOLN0DSxKM"},{"type":"output","id":"Zx-HKuAhIHQm9EL09Loe4","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"{'run_id': 'demo-Yang-sample',\n 'get_samples': ['Yang'],\n 'archives': {'Gaia': {'search_radius': 0.0002777777777777778, 'verbose': 0},\n  'HEASARC': {'catalog_error_radii': {'FERMIGTRIG': 1.0, 'SAXGRBMGRB': 3.0}},\n  'IceCube': {'icecube_select_topN': 3, 'max_search_radius': 2.0},\n  'WISE': {'radius': 1.0, 'bandlist': ['W1', 'W2']},\n  'ZTF': {'match_radius': 0.0002777777777777778, 'nworkers': None}}}","content_type":"text/plain"}}}],"key":"KYDzazu7Ra"}],"key":"fsJNSBhlxu"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":391,"column":1},"end":{"line":393,"column":1}},"children":[{"type":"text","value":"Decide which archives to query.\nThis is a separate list because the helper can only run one archive call at a time.\nWe will iterate over this list and launch each job separately.","position":{"start":{"line":391,"column":1},"end":{"line":391,"column":1}},"key":"gfE8acyKUE"}],"key":"NUmCXSRBVd"}],"key":"vLZWIUtK7P"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# archive_names = [\"PanSTARRS\", \"WISE\"]  # choose your own list\narchive_names = helpers.scale_up.ARCHIVE_NAMES[\"all\"]  # predefined list\narchive_names","key":"N8SNF7qzba"},{"type":"output","id":"blm-HGZ9tLBRfQ8R3prxB","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"['Gaia',\n 'HCV',\n 'HEASARC',\n 'IceCube',\n 'PanSTARRS',\n 'TESS_Kepler',\n 'WISE',\n 'ZTF']","content_type":"text/plain"}}}],"key":"BnL0TbTWNT"}],"key":"o2Y2CPbcbU"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"children":[{"type":"text","value":"In the next cell, we:","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"key":"pXNTL8j0dg"}],"key":"Tf0HLhoxOd"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":403,"column":1},"end":{"line":405,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"collect the sample and write it as a .ecsv file; then","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"YGzRSWP2ux"}],"key":"L8nzFe4p9K"}],"key":"qUrmSjB4qX"},{"type":"listItem","spread":true,"position":{"start":{"line":404,"column":1},"end":{"line":405,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"query the archives in parallel using a ","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"fAfn2OMJOh"},{"type":"inlineCode","value":"multiprocessing.Pool","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"i1I87ryKPS"},{"type":"text","value":" and write the light curve data as .parquet files.","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"V436oR7o7K"}],"key":"UYpyAv8F0e"}],"key":"JQdLRLWqTD"}],"key":"z0cUTmZMpk"},{"type":"paragraph","position":{"start":{"line":406,"column":1},"end":{"line":410,"column":1}},"children":[{"type":"text","value":"Note: Since the next cell launches each archive call in a child process (through ","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"DixKdGR0T4"},{"type":"inlineCode","value":"multiprocessing.Pool","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"EqsquBLYnR"},{"type":"text","value":"),\nthe archive calls themselves will not be allowed to launch child processes of their own.\nWe’ll just skip the affected archive calls here and encourage the user towards the bash script since this\nis one of the main reasons that it was developed -- it launches the archive jobs in parallel, but in a\ndifferent way, so that the calls are also allowed to parallelize their own internal code and thus run much faster.","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"NvOZnP8AM8"}],"key":"zaJjfwfPYP"}],"key":"EZA8AiNNOs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# Skip archive calls that use internal parallelization.\n_archive_names = [name for name in archive_names if name.lower() not in [\"panstarrs\", \"ztf\"]]\n\nsample_table = helpers.scale_up.run(build=\"sample\", **kwargs_dict)\n# sample_table is returned if you want to look at it but it is not used below\n\nwith multiprocessing.Pool(processes=len(_archive_names)) as pool:\n    # submit one job per archive\n    for archive in _archive_names:\n        pool.apply_async(helpers.scale_up.run, kwds={\"build\": \"lightcurves\", \"archive\": archive, **kwargs_dict})\n    pool.close()  # signal that no more jobs will be submitted to the pool\n    pool.join()  # wait for all jobs to complete\n\n# Note: The console output from different archive calls gets jumbled together below.\n# Worse, error messages tend to get lost in the background and never displayed.\n# If you have trouble, consider running an archive call individually without the Pool\n# or using the bash script instead.","key":"yU7lmpE4PT"},{"type":"output","id":"zfiURkA5tOHI6cynbin53","data":[{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:50 UTC | [pid=2491] Starting build=sample\n"},{"output_type":"stream","name":"stdout","text":"Building object sample from: ['yang']\n"},{"output_type":"stream","name":"stdout","text":"Changing Look AGN- Yang et al:  31\nObject sample size, after duplicates removal: 30\nObject sample saved to: /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-Yang-sample/object_sample.ecsv\n2025/11/25 21:27:52 UTC\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:52 UTC | [pid=2630] Starting build=lightcurves, archive=hcv"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:52 UTC | [pid=2629] Starting build=lightcurves, archive=gaia"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:52 UTC | [pid=2631] Starting build=lightcurves, archive=heasarc"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:52 UTC | [pid=2632] Starting build=lightcurves, archive=icecube"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:52 UTC | [pid=2633] Starting build=lightcurves, archive=tess_kepler"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:52 UTC | [pid=2634] Starting build=lightcurves, archive=wise"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/lightkurve/prf/__init__.py:7: UserWarning: Warning: the tpfmodel submodule is not available without oktopus installed, which requires a current version of autograd. See #1452 for details.\n  warnings.warn(\n"},{"output_type":"stream","name":"stderr","text":"WARNING"},{"output_type":"stream","name":"stderr","text":": W23: None:116:4860: W23: The executionDuration element must not occur more than once [pyvo.utils.xml.elements]"},{"output_type":"stream","name":"stderr","text":"\n"},{"output_type":"stream","name":"stderr","text":"WARNING"},{"output_type":"stream","name":"stderr","text":": W25: None:116:5090: W25: The uploadLimit element must not occur more than once [pyvo.utils.xml.elements]"},{"output_type":"stream","name":"stderr","text":"\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"  0%|          | 0/30 [00:00\u003c?, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"b17ad5899646430b8325f16809244787\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"  0%|          | 0/2 [00:00\u003c?, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"8df272c14f624717885ebc3b2cde198d\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stdout","text":"working on mission"},{"output_type":"stream","name":"stdout","text":" "},{"output_type":"stream","name":"stdout","text":"FERMIGTRIG"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"INFO"},{"output_type":"stream","name":"stdout","text":": Query finished. [astroquery.utils.tap.core]"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"working on mission"},{"output_type":"stream","name":"stdout","text":" "},{"output_type":"stream","name":"stdout","text":"SAXGRBMGRB"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"Light curves saved to:\n\tparquet_dir=/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-Yang-sample/lightcurves.parquet\n\tfile=archive=gaia/part0.snappy.parquet"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:56 UTC"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (0.28136, -0.09792)\u003e\".\n"},{"output_type":"stream","name":"stdout","text":"Light curves saved to:\n\tparquet_dir=/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-Yang-sample/lightcurves.parquet\n\tfile=archive=heasarc/part0.snappy.parquet"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:27:58 UTC"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"Light curves saved to:\n\tparquet_dir=/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-Yang-sample/lightcurves.parquet\n\tfile=archive=icecube/part0.snappy.parquet"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:28:00 UTC"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"  0%|          | 0/42 [00:00\u003c?, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"d8d5031ce06242aa9d0c193331d44f0c\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (21.70042, -8.66336)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (29.99, 0.55301)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (120.9482, 42.97751)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (127.88438, 36.77141)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (132.49079, 27.79135)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (137.38344, 47.79187)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (144.37634, 26.04227)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (144.39779, 32.54717)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (150.84779, 35.41774)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (152.97079, 54.70177)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (166.09679, 63.71812)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (166.22988, 1.31573)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (167.60604, -0.05948)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (168.90237, 5.74715)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (169.62359, 32.06669)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (173.12143, 3.9581)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (177.66379, 36.54955)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (178.11453, 32.16649)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (194.81977, 55.25198)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (199.87816, 67.89873)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (209.07708, -1.25389)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (209.73261, 49.57057)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (221.97599, 28.55671)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (233.48329, 1.17494)\u003e\".\n"},{"output_type":"stream","name":"stdout","text":"No light curve data was returned from hcv."},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (236.37346, 25.19108)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (237.57182, 41.65067)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (238.24283, 27.62461)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (238.66777, 36.49777)\u003e\".\n"},{"output_type":"stream","name":"stderr","text":"No data found for target \"\u003cSkyCoord (ICRS): (ra, dec) in deg\n    (354.01239, 0.29138)\u003e\".\n"},{"output_type":"stream","name":"stdout","text":"No light curve data was returned from tess_kepler."},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"Light curves saved to:\n\tparquet_dir=/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-Yang-sample/lightcurves.parquet\n\tfile=archive=wise/part0.snappy.parquet"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"2025/11/25 21:29:53 UTC"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"stream","name":"stdout","text":"CPU times: user 751 ms, sys: 198 ms, total: 949 ms\nWall time: 2min 2s\n"}],"key":"K2vh2DiAgp"}],"key":"PXBMPDkv46"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":433,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"text","value":"The light curves are saved in the “parquet_dir” directory.\nEach archive call writes data to a parquet file in its own subdirectory.\nThese can be loaded together as a single dataset:","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"key":"TWLTwTVboq"}],"key":"aChSF7FwCO"}],"key":"w7VwftZKdt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# copy/paste the directory path from the output above, or ask the helper for it like this:\nparquet_dir = helpers.scale_up.run(build=\"parquet_dir\", **kwargs_dict)\ndf_lc = pd.read_parquet(parquet_dir)\n\ndf_lc.sample(10)","key":"YpU7MhNigI"},{"type":"output","id":"CMoUPq_f0ykKG1uJ2Zvyg","data":[{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/plain":{"content":"                                           flux       err  archive\nobjectid label   band    time                                     \n22       Yang 18 W2      56855.740636  0.612358  0.015881     wise\n                         57214.602471  0.682569  0.015782     wise\n29       Yang 18 W2      57591.706706  0.999870  0.011676     wise\n                 G       57868.796722  0.084478  0.001034     gaia\n27       Yang 18 W2      57414.787522  0.913322  0.011803     wise\n4        Yang 18 W2      57680.066284  0.138925  0.015157     wise\n10       Yang 18 W2      55513.628194  0.591030  0.014276     wise\n                 IceCube 54593.897655  3.660000  0.000000  icecube\n13       Yang 18 W1      58096.160068  0.326728  0.007631     wise\n1        Yang 18 W1      59183.926889  0.302206  0.006442     wise","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eflux\u003c/th\u003e\n      \u003cth\u003eerr\u003c/th\u003e\n      \u003cth\u003earchive\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eband\u003c/th\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e22\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003eYang 18\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003eW2\u003c/th\u003e\n      \u003cth\u003e56855.740636\u003c/th\u003e\n      \u003ctd\u003e0.612358\u003c/td\u003e\n      \u003ctd\u003e0.015881\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e57214.602471\u003c/th\u003e\n      \u003ctd\u003e0.682569\u003c/td\u003e\n      \u003ctd\u003e0.015782\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e29\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003eYang 18\u003c/th\u003e\n      \u003cth\u003eW2\u003c/th\u003e\n      \u003cth\u003e57591.706706\u003c/th\u003e\n      \u003ctd\u003e0.999870\u003c/td\u003e\n      \u003ctd\u003e0.011676\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eG\u003c/th\u003e\n      \u003cth\u003e57868.796722\u003c/th\u003e\n      \u003ctd\u003e0.084478\u003c/td\u003e\n      \u003ctd\u003e0.001034\u003c/td\u003e\n      \u003ctd\u003egaia\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e27\u003c/th\u003e\n      \u003cth\u003eYang 18\u003c/th\u003e\n      \u003cth\u003eW2\u003c/th\u003e\n      \u003cth\u003e57414.787522\u003c/th\u003e\n      \u003ctd\u003e0.913322\u003c/td\u003e\n      \u003ctd\u003e0.011803\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003cth\u003eYang 18\u003c/th\u003e\n      \u003cth\u003eW2\u003c/th\u003e\n      \u003cth\u003e57680.066284\u003c/th\u003e\n      \u003ctd\u003e0.138925\u003c/td\u003e\n      \u003ctd\u003e0.015157\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e10\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003eYang 18\u003c/th\u003e\n      \u003cth\u003eW2\u003c/th\u003e\n      \u003cth\u003e55513.628194\u003c/th\u003e\n      \u003ctd\u003e0.591030\u003c/td\u003e\n      \u003ctd\u003e0.014276\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eIceCube\u003c/th\u003e\n      \u003cth\u003e54593.897655\u003c/th\u003e\n      \u003ctd\u003e3.660000\u003c/td\u003e\n      \u003ctd\u003e0.000000\u003c/td\u003e\n      \u003ctd\u003eicecube\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e13\u003c/th\u003e\n      \u003cth\u003eYang 18\u003c/th\u003e\n      \u003cth\u003eW1\u003c/th\u003e\n      \u003cth\u003e58096.160068\u003c/th\u003e\n      \u003ctd\u003e0.326728\u003c/td\u003e\n      \u003ctd\u003e0.007631\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003cth\u003eYang 18\u003c/th\u003e\n      \u003cth\u003eW1\u003c/th\u003e\n      \u003cth\u003e59183.926889\u003c/th\u003e\n      \u003ctd\u003e0.302206\u003c/td\u003e\n      \u003ctd\u003e0.006442\u003c/td\u003e\n      \u003ctd\u003ewise\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"gsDVTAEbGP"}],"key":"ioWAcrp9nR"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":445,"column":1},"end":{"line":445,"column":1}},"children":[{"type":"text","value":"Now we can make figures:","position":{"start":{"line":445,"column":1},"end":{"line":445,"column":1}},"key":"oONTA9Vk8i"}],"key":"DbFsj0IDTt"}],"key":"DXV29mWIZc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"_ = create_figures(df_lc=MultiIndexDFObject(data=df_lc), show_nbr_figures=1, save_output=False)","key":"b6bllcitjm"},{"type":"output","id":"SgUyj02vwuGtMykt9RTiV","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1000x800 with 2 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"031368e8637337ad8c58c6ed0e571fa5","path":"/fornax-demo-notebooks/build/031368e8637337ad8c58c6ed0e571fa5.png"}}},{"output_type":"stream","name":"stdout","text":"Done\n"}],"key":"G0mLyYYPWf"}],"key":"aMHRO1HD9s"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"3. Keyword arguments and script flags","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"DUQj3ydXfC"}],"identifier":"id-3-keyword-arguments-and-script-flags","label":"3. Keyword arguments and script flags","html_id":"id-3-keyword-arguments-and-script-flags","implicit":true,"key":"mD1nYu2BNo"}],"key":"fuwVdTXoyL"},{"type":"block","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"children":[{"type":"text","value":"This example shows the python ","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"key":"dcjSmn9V2U"},{"type":"inlineCode","value":"kwargs_dict","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"key":"Xq3DGxkAoC"},{"type":"text","value":" and bash script flag options in more detail.","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"key":"asSh3XluBY"}],"key":"kAScOHGKpq"},{"type":"heading","depth":3,"position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"children":[{"type":"text","value":"3.1 Python ","position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"key":"hAVghCVgVL"},{"type":"inlineCode","value":"kwargs_dict","position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"key":"RifQkPWnMV"}],"identifier":"id-3-1-python-kwargs-dict","label":"3.1 Python kwargs_dict","html_id":"id-3-1-python-kwargs-dict","implicit":true,"key":"dfVmV0RSX8"},{"type":"paragraph","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"inlineCode","value":"kwargs_dict","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"f2URuYXdsm"},{"type":"text","value":" is a dictionary containing all keyword arguments for the run. It can contain:","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"P8EP7XhP1q"}],"key":"BpBoOjvTgk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":461,"column":1},"end":{"line":465,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"names and keyword arguments for any of the ","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"ftYkQMDDQo"},{"type":"inlineCode","value":"get_*_sample","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"guGNM5pFcA"},{"type":"text","value":" functions.","position":{"start":{"line":461,"column":1},"end":{"line":461,"column":1}},"key":"YBV1yvwTe9"}],"key":"Z5yRtlaxJc"}],"key":"m147DlubKx"},{"type":"listItem","spread":true,"position":{"start":{"line":462,"column":1},"end":{"line":462,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"keyword arguments for any of the ","position":{"start":{"line":462,"column":1},"end":{"line":462,"column":1}},"key":"ZK5fWjjPsP"},{"type":"inlineCode","value":"*_get_lightcurves","position":{"start":{"line":462,"column":1},"end":{"line":462,"column":1}},"key":"JHDFFdbs25"},{"type":"text","value":" functions.","position":{"start":{"line":462,"column":1},"end":{"line":462,"column":1}},"key":"VHKjuEVE0D"}],"key":"FlS4BUCGX9"}],"key":"lhiC2LhzBe"},{"type":"listItem","spread":true,"position":{"start":{"line":463,"column":1},"end":{"line":465,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"other keyword arguments used directly by the helper.\nThese options and their defaults are shown below, further documented in the helper’s ","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"uBnosDzvIm"},{"type":"inlineCode","value":"run","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"m4vUl3XKi5"},{"type":"text","value":" function.","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"kNKYlVUnVm"}],"key":"YEjPogblO1"}],"key":"eMjInmTL8k"}],"key":"SwY0ccym4G"}],"key":"ISSyxVY0da"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# show kwargs_dict defaults\nhelpers.scale_up.DEFAULTS","key":"auoMH5D86Y"},{"type":"output","id":"USFe9vCoIVg7OG8SuRY83","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"{'run_id': 'my-run',\n 'get_samples': ['Yang'],\n 'consolidate_nearby_objects': True,\n 'overwrite_existing_sample': True,\n 'archives': ['Gaia',\n  'HCV',\n  'HEASARC',\n  'IceCube',\n  'PanSTARRS',\n  'TESS_Kepler',\n  'WISE',\n  'ZTF'],\n 'overwrite_existing_lightcurves': True,\n 'use_yaml': False,\n 'yaml_filename': 'kwargs.yml',\n 'sample_filename': 'object_sample.ecsv',\n 'parquet_dataset_name': 'lightcurves.parquet'}","content_type":"text/plain"}}}],"key":"JRCcnU82Ob"}],"key":"FFXE9KzhDR"},{"type":"block","children":[],"key":"PiOudGPmcF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# show parameter documentation\nprint(helpers.scale_up.run.__doc__)","key":"J2ETmF4j0t"},{"type":"output","id":"G9kYNq0jLZRWDYxGY3CoC","data":[{"output_type":"stream","name":"stdout","text":"\n    Run the light_curve_collector step indicated by `build`.\n\n    Parameters\n    ----------\n    build : str\n        Which step to run. Generally either \"sample\" or \"lightcurves\". Can also be either \"kwargs\"\n        or any of the `kwargs_dict` keys, and then the full set of kwargs is built from `kwargs_dict`\n        and either the whole dictionary is returned (if \"kwargs\") or the value of this key is returned.\n    kwargs_dict : dict\n        Key/value pairs for the build function. This can include any key in the dict\n        `helpers.scale_up.DEFAULTS` plus \"archive\".\n\n        run_id : str\n            ID for this run. This is used to name the output subdirectory (\"base_dir\") where the\n            scale_up helper will read/write files.\n\n        get_samples : list or dict[dict]\n            Names of get_\u003cname\u003e_sample functions from which to gather the object sample.\n            To send keyword arguments for any of the named functions, use a dict with key=name\n            value=dict of keyword arguments for the named function). Defaults will be\n            used for any parameter not provided.\n\n        consolidate_nearby_objects : bool\n            Whether to consolidate nearby objects in the sample. Passed to the clean_sample function.\n\n        overwrite_existing_sample : bool\n            Whether to overwrite an existing .ecsv file. If false and the file exists, the sample will simply\n            be loaded from the file and returned.\n\n        archive : str\n            Name of a \u003cname\u003e_get_lightcurves archive function to call when building light curves.\n\n        archives : list or dict[dict]\n            Names of \u003cname\u003e_get_lightcurves functions. Use a dict (key=name, value=dict of kwargs for the named\n            function) to override defaults for the named function. **Note that this does not determine which\n            archives are actually called** (unlike `get_samples` with sample names). This is because the\n            scale_up helper can only run one function at a time, so a single archive name must be passed separately\n            when building light curves.\n\n        overwrite_existing_lightcurves : bool\n            Whether to overwrite an existing .parquet file. If false and the file exists, the light curve\n            data will simply be loaded from the file and returned.\n\n        use_yaml : bool\n            Whether to load additional kwargs from a yaml file.\n\n        yaml_filename : str\n            Name of the yaml to read/write, relative to the base_dir.\n\n        sample_filename: str\n            Name of the `sample_table` .ecsv file to read/write, relative to the base_dir.\n\n        parquet_dataset_name : str\n            Name of the directory to read/write the parquet dataset, relative to the base_dir.\n            The dataset will contain one .parquet file for each archive that returned light curve data.\n\n    Returns\n    -------\n    Various\n        Depending on the `build` parameter, returns the result of the corresponding build function.\n    \n"}],"key":"y3IkkUUJ1d"}],"key":"onAeJtxOia"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"children":[{"type":"text","value":"3.2 Bash script flags","position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"key":"N8RLkvVybH"}],"identifier":"id-3-2-bash-script-flags","label":"3.2 Bash script flags","html_id":"id-3-2-bash-script-flags","implicit":true,"key":"ieDOPcJJRi"},{"type":"paragraph","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"children":[{"type":"text","value":"Use the ","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"bjukZwchlC"},{"type":"inlineCode","value":"-h","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"RJZGTtHVfK"},{"type":"text","value":" (help) flag to view the script’s flag options:","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"EehrbLF1yY"}],"key":"JkFLQTJ7vc"}],"key":"WUEluBbZKo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# show flag documentation\n!bash code_src/helpers/scale_up.sh -h","key":"yw7yW5Ix0a"},{"type":"output","id":"XqXD5debPyyoMnyZb9erA","data":[{"output_type":"stream","name":"stdout","text":"---- scale_up.sh ----\r\n\r\nUse this script to launch and monitor a large-scale \"run\" to load a sample of target objects\r\nfrom the literature and collect their multi-wavelength light curves from various archives.\r\nFor complete usage information, see the scale_up notebook tutorial.\r\n\r\nFLAG OPTIONS\r\n------------\r\n\r\nRequired flags:\r\n\r\n    -r 'run_id'\r\n        ID for the run. No spaces or special characters.\r\n        Determines the name of the output directory.\r\n        Can be used in multiple script calls to manage the same run.\r\n\r\nFlags used to launch a run (optional):\r\n\r\n    -a 'archive names'\r\n        Space-separated list of archive names like 'HEASARC PanSTARRS WISE' (case insensitive),\r\n        or a shortcut, e.g., 'all'.\r\n        The get_\u003cname\u003e_lightcurves function will be called once for each name.\r\n        If this flag is not supplied, no light-curve data will be retrieved.\r\n\r\n    -d 'key=value'\r\n        Any top-level key/value pair in the python kwargs_dict where the\r\n        value is a basic type (e.g., bool or string, but not list or dict).\r\n        Repeat the flag to send multiple kwargs.\r\n        For more flexibility, use the -j flag and/or store the kwargs_dict as a\r\n        yaml file and use: -d 'use_yaml=true'. Order of precedence is dict, json, yaml.\r\n\r\n    -j 'json string'\r\n        The python kwargs_dict as a json string. An example usage is:\r\n        -j '{get_samples: {SDSS: {num: 50}}, archives: {ZTF: {nworkers: 8}}}'\r\n        The string can be created in python by first constructing the dictionary and then using:\r\n            \u003e\u003e\u003e import json\r\n            \u003e\u003e\u003e json.dumps(kwargs_dict)\r\n        Copy the output, including the surrounding single quotes ('), and paste it as the flag value.\r\n\r\nOther flags (optional):\r\n    These must be used independently and cannot be combined with any other optional flag.\r\n\r\n    -t 'nsleep'\r\n        Use this flag to monitor top after launching a run. This will filter for PIDs\r\n        launched by 'run_id' and save the output to a log file once every 'nsleep' interval.\r\n        'nsleep' will be passed to the sleep command, so values like '10s' and '30m' are allowed.\r\n        The python helper can load the output.\r\n        This option is only available on Linux machines.\r\n\r\n    -k (kill)\r\n        Use this flag to kill all processes that were started using the given 'run_id'.\r\n        This option is only available on Linux machines.\r\n\r\n    -h (help)\r\n        Print this help message.\r\n\r\n"}],"key":"wCYbWAGneI"}],"key":"hixzunqx3f"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"children":[{"type":"text","value":"3.3 Using a yaml file","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"UYYRrGe2ZS"}],"identifier":"id-3-3-using-a-yaml-file","label":"3.3 Using a yaml file","html_id":"id-3-3-using-a-yaml-file","implicit":true,"key":"uX6mdmu9eu"},{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"It can be convenient to save the parameters in a yaml file, especially when using the bash script or in cases where you want to store parameters for later reference or re-use.","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"c4PUSczK3E"}],"key":"risA45ueoO"},{"type":"paragraph","position":{"start":{"line":489,"column":1},"end":{"line":489,"column":1}},"children":[{"type":"text","value":"Define an extended set of parameters and save it as a yaml file:","position":{"start":{"line":489,"column":1},"end":{"line":489,"column":1}},"key":"A3PbvN9lM2"}],"key":"XnjyJIyYSz"}],"key":"PGl20tuv8p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"yaml_run_id = \"demo-kwargs-yaml\"\n\nget_samples = {\n    \"green\": {},\n    \"ruan\": {},\n    \"papers_list\": {\n        \"paper_kwargs\": [\n            {\"paper_link\": \"2022ApJ...933...37W\", \"label\": \"Galex variable 22\"},\n            {\"paper_link\": \"2020ApJ...896...10B\", \"label\": \"Palomar variable 20\"},\n        ]\n    },\n    \"SDSS\": {\"num\": 10, \"zmin\": 0.5, \"zmax\": 2, \"randomize_z\": True},\n    \"ZTF_objectid\": {\"objectids\": [\"ZTF18aabtxvd\", \"ZTF18aahqkbt\", \"ZTF18abxftqm\", \"ZTF18acaqdaa\"]},\n}\n\narchives = {\n    \"Gaia\": {\"search_radius\": 2 / 3600},\n    \"HEASARC\": {\"catalog_error_radii\": {\"FERMIGTRIG\": 1.0, \"SAXGRBMGRB\": 3.0}},\n    \"IceCube\": {\"icecube_select_topN\": 4, \"max_search_radius\": 2.0},\n    \"WISE\": {\"radius\": 1.5, \"bandlist\": [\"W1\", \"W2\"]},\n    \"ZTF\": {\"nworkers\": 6, \"match_radius\": 2 / 3600},\n}\n\nyaml_kwargs_dict = {\n    \"get_samples\": get_samples,\n    \"consolidate_nearby_objects\": False,\n    \"archives\": archives,\n}\n\nhelpers.scale_up.write_kwargs_to_yaml(run_id=yaml_run_id, **yaml_kwargs_dict)","key":"BAKO4zhnfp"},{"type":"output","id":"7I9LThOBllfNCai0QQfiO","data":[{"output_type":"stream","name":"stdout","text":"kwargs written to /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-kwargs-yaml/kwargs.yml\n"}],"key":"aAnxEpTDAC"}],"key":"P7V0xkDI0q"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":524,"column":1},"end":{"line":526,"column":1}},"children":[{"type":"text","value":"The path to the yaml file is printed in the output above.\nYou can alter the contents of the file as you like.\nTo use the file, set the kwarg ","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"key":"GtmIqtPuHC"},{"type":"inlineCode","value":"use_yaml=True","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"key":"oK0l1UjZ7O"},{"type":"text","value":".","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"key":"yAdP4KGa94"}],"key":"ytV0HUXmLn"},{"type":"paragraph","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"children":[{"type":"text","value":"Python example for the get-sample step:","position":{"start":{"line":528,"column":1},"end":{"line":528,"column":1}},"key":"TS2VNYBY1X"}],"key":"WbjjQM2Fff"}],"key":"ujyITmuuUK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sample_table = helpers.scale_up.run(build=\"sample\", run_id=yaml_run_id, use_yaml=True)","key":"QpfLujiKVm"},{"type":"output","id":"1JlOd61AjuWOzXb8NingV","data":[{"output_type":"stream","name":"stdout","text":"2025/11/25 21:29:54 UTC | [pid=2491] Starting build=sample\n"},{"output_type":"stream","name":"stdout","text":"Building object sample from: ['sdss', 'ztf_objectid', 'green', 'papers_list', 'ruan']\n"},{"output_type":"stream","name":"stderr","text":"WARNING: OverflowError converting to IntType in column specObjID, reverting to String. [astropy.io.ascii.fastbasic]\n"},{"output_type":"stream","name":"stdout","text":"SDSS Quasar: 10\n"},{"output_type":"stream","name":"stdout","text":"number of ztf coords added by Objectname: 4\n"},{"output_type":"stream","name":"stdout","text":"Changing Look AGN- Green et al 2022:  19\n"},{"output_type":"stream","name":"stdout","text":"number of sources added from Galex variable 22 :48\n"},{"output_type":"stream","name":"stdout","text":"number of sources added from Palomar variable 20 :20\n"},{"output_type":"stream","name":"stdout","text":"Changing Look AGN- Ruan et al 2016:  3\nObject sample size: 104\nObject sample saved to: /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/output/lightcurves-demo-kwargs-yaml/object_sample.ecsv\n2025/11/25 21:30:06 UTC\n"}],"key":"mR5Dhh2waw"}],"key":"fj7DOoLg1G"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"Bash example:","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"WD6xJ7Fu89"}],"key":"yp4nTcyVNa"}],"key":"bGC6eub7Gb"},{"type":"block","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"code","lang":"bash","value":"$ yaml_run_id=demo-kwargs-yaml\n$ bash code_src/helpers/scale_up.sh -r \"$yaml_run_id\" -d \"use_yaml=true\" -a \"Gaia HEASARC IceCube PanSTARRS WISE ZTF\"","position":{"start":{"line":538,"column":1},"end":{"line":541,"column":1}},"key":"Y1dZkcRG5M"}],"key":"HFAaIcweLv"},{"type":"block","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"children":[{"type":"text","value":"Appendix: What to expect","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"dcJzGgNjfS"}],"identifier":"appendix-what-to-expect","label":"Appendix: What to expect","html_id":"appendix-what-to-expect","implicit":true,"key":"QvgYJUCIyZ"}],"key":"wZxDgcMWuH"},{"type":"block","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":549,"column":1},"end":{"line":549,"column":1}},"children":[{"type":"text","value":"Challenges of large-scale runs","position":{"start":{"line":549,"column":1},"end":{"line":549,"column":1}},"key":"h4Geahn2I7"}],"identifier":"challenges-of-large-scale-runs","label":"Challenges of large-scale runs","html_id":"challenges-of-large-scale-runs","implicit":true,"key":"NYQKXZTBa3"}],"key":"TApA3EojDb"},{"type":"block","position":{"start":{"line":551,"column":1},"end":{"line":551,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":553,"column":1},"end":{"line":555,"column":1}},"children":[{"type":"text","value":"Scaling up to large sample sizes brings new challenges.\nEven if things go smoothly, each function call may need to use a lot more resources like CPU, RAM, and bandwidth, and may take much longer to complete.\nAlso, we’ll want to run some functions in parallel to save time overall, but that will mean they must compete with each other for resources.","position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"key":"EErT8O6R09"}],"key":"LttyBj6nX2"},{"type":"paragraph","position":{"start":{"line":557,"column":1},"end":{"line":558,"column":1}},"children":[{"type":"text","value":"These issues are complicated by the fact that different combinations of samples and archive calls can trigger different problems.\nInefficiencies in any part of the process -- our code, archive backends, etc. -- which may have been negligible at small scale can balloon into significant hurdles.","position":{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},"key":"Opeax56AOf"}],"key":"asGmcsqUwU"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"Problems can manifest in different ways.\nFor example, progress may slow to a crawl, or it may run smoothly for several hours and then crash suddenly.\nIf the job is running in the background, print statements and error messages may get lost and never be displayed for the user if they are not redirected to a file.","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"h5gqnOCftk"}],"key":"ALroYbDc9c"}],"key":"CAvijglpPc"},{"type":"block","position":{"start":{"line":564,"column":1},"end":{"line":564,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":566,"column":1},"end":{"line":566,"column":1}},"children":[{"type":"text","value":"Needs and wants for large-scale runs","position":{"start":{"line":566,"column":1},"end":{"line":566,"column":1}},"key":"CD04hDqS7l"}],"identifier":"needs-and-wants-for-large-scale-runs","label":"Needs and wants for large-scale runs","html_id":"needs-and-wants-for-large-scale-runs","implicit":true,"key":"Bv4kjnycbV"}],"key":"i2snyrB5hU"},{"type":"block","position":{"start":{"line":568,"column":1},"end":{"line":568,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":570,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"The main goal is to reduce the total time it takes to run the full code, so we want to look for opportunities to parallelize.\nWe can group the light_curve_collector code into two main steps: (1) gather the target object sample; then (2) generate light curves by querying the archives and standardizing the returned data.\nAll of the archive calls have to wait for the sample to be available before starting, but then they can run independently in parallel.\nThis is fortunate, since gathering the sample does not take long compared to the archive calls.","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"key":"zmSol4tJsP"}],"key":"FD9Blrn0pP"},{"type":"paragraph","position":{"start":{"line":575,"column":1},"end":{"line":577,"column":1}},"children":[{"type":"text","value":"It is useful to be able to monitor the run’s resource usage and capture print statements, error messages, etc. to log files in order to understand if/when something goes wrong.\nEven with parallelization, gathering light curves for a large sample of objects is likely to take a few hours at least.\nSo we want to automate the monitoring tasks as much as possible.","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"key":"OMhf02vy2Z"}],"key":"WNtDuLfSgz"},{"type":"paragraph","position":{"start":{"line":579,"column":1},"end":{"line":581,"column":1}},"children":[{"type":"text","value":"If the run fails, we’d like to be able to restart it without having to redo steps that were previously successful.\nTo accomplish this, the inputs and outputs need to be less tightly coupled than they are in the light_curve_collector notebook.\nSpecifically, we want to save the sample and light curve data to file as soon as each piece is collected, and we want the archive functions to be able to get the ","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"QSD3ilKY70"},{"type":"inlineCode","value":"sample_table","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"YhTCqpdQDw"},{"type":"text","value":" input from file.","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"doYWB9ge24"}],"key":"W1dqqgBDJh"},{"type":"paragraph","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"children":[{"type":"text","value":"The python helper and bash script were specifically designed to fulfill many of these wants and needs.","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"VhavjWwxam"}],"key":"z8483zB5T2"}],"key":"HcyBtzuXQZ"},{"type":"block","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"Advice for the user","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"BchpakaoI1"}],"identifier":"advice-for-the-user","label":"Advice for the user","html_id":"advice-for-the-user","implicit":true,"key":"PGRujiCv9K"}],"key":"sepZi9v1bk"},{"type":"block","position":{"start":{"line":589,"column":1},"end":{"line":589,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"text","value":"Getting started:","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"Mfw5oAe8dN"}],"key":"UGyQb3WlKo"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":592,"column":1},"end":{"line":599,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Skim this notebook to understand the process, available options, and potential sticking points.","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"key":"ylRndbVUBq"}],"key":"T6Bck9kuDG"}],"key":"H21sL2BgfL"},{"type":"listItem","spread":true,"position":{"start":{"line":593,"column":1},"end":{"line":593,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Try things with a small sample size first, then scale up to your desired full sample.","position":{"start":{"line":593,"column":1},"end":{"line":593,"column":1}},"key":"FM5D8PArhg"}],"key":"MLCBqf0FpW"}],"key":"gBQYNiepZa"},{"type":"listItem","spread":true,"position":{"start":{"line":594,"column":1},"end":{"line":599,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Don’t be surprised if something goes wrong.\nEvery new combination of factors can present different challenges and reasons for the code to fail.\nThis includes the sample selection, which archives are called and what parameters are used, runtime environment, machine CPU and RAM capabilities, network bandwidth, etc.\nScaling up any code base comes with challenges, and some of these cannot be fully managed by pre-written code.\nYou may need to observe how the code performs, diagnose a problem, and adapt the input parameters, machine size, etc. in order to successfully execute.","position":{"start":{"line":594,"column":1},"end":{"line":594,"column":1}},"key":"CAFOdm2j7w"}],"key":"g0gdIo6rJQ"}],"key":"H506vJl60G"}],"key":"dCSdJv1u9E"},{"type":"paragraph","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"children":[{"type":"text","value":"To execute a run:","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"Rj630xFwuA"}],"key":"IROmb3hHn0"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":601,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Define all of the get-sample and get-lightcurve parameters.","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"cLWyYSgkAe"}],"key":"vEX3mwknSJ"}],"key":"mdceiiFaPo"},{"type":"listItem","spread":true,"position":{"start":{"line":602,"column":1},"end":{"line":603,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Launch the run by calling the bash script or some other multi-processing method.\nCapturing stdout, stderr and ","position":{"start":{"line":602,"column":1},"end":{"line":602,"column":1}},"key":"LkcjN9iZWp"},{"type":"inlineCode","value":"top","position":{"start":{"line":602,"column":1},"end":{"line":602,"column":1}},"key":"mkAtmtjmEZ"},{"type":"text","value":" output to log files is highly recommended.","position":{"start":{"line":602,"column":1},"end":{"line":602,"column":1}},"key":"BQThpiu5Nb"}],"key":"aukNd2D5x4"}],"key":"ZbwtUlEtdE"},{"type":"listItem","spread":true,"position":{"start":{"line":604,"column":1},"end":{"line":606,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If a get-lightcurve (get-sample) job exits without writing a .parquet (.ecsv) file, inspect the logs and ","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"iy0rSNQHxC"},{"type":"inlineCode","value":"top","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"iZF8dwP2be"},{"type":"text","value":" output to try to determine the reason it failed.\nIt could be anything from a missing python library (install it), to an archive encountering an internal error (wait a bit and try again), to the job getting killed prematurely because its needs exceeded the available RAM (try a machine with more RAM, a smaller sample size, or running fewer archive calls at a time), to many other things.","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"aHeSaefCet"}],"key":"aX2QtgbO5c"}],"key":"XdFbfLqwT3"}],"key":"W9KFPtXprz"}],"key":"cHgHIkB4Zz"},{"type":"block","position":{"start":{"line":607,"column":1},"end":{"line":607,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"PcrJV5mndJ"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"B28jiaLbJ1"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":611,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"children":[{"type":"text","value":"Authors","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"OW7Wzgz7OT"}],"key":"PQ5T97taxE"},{"type":"text","value":": Troy Raen, Jessica Krick, Brigitta Sipőcz, Shoubaneh Hemmati, Andreas Faisst, David Shupe, and the Fornax team","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"wbdJaTxzu7"}],"key":"GhIoGvjhnO"}],"key":"tqZT08mLcd"},{"type":"listItem","spread":true,"position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"O38bt4Qv5o"}],"key":"M4J7I1gIy6"},{"type":"text","value":" For help with this notebook, please open a topic in the ","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"mNDr5ZhX15"},{"type":"link","url":"https://discourse.fornax.sciencecloud.nasa.gov/","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"text","value":"Fornax Community Forum","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"npcdFaoeBo"}],"urlSource":"https://discourse.fornax.sciencecloud.nasa.gov/","key":"C5jx2hpuFe"},{"type":"text","value":" “Support” category.","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"uOIRy4MuMO"}],"key":"oCVnfFybEa"}],"key":"GIQwbfQhBV"}],"key":"qpH8rWWiBZ"}],"key":"ae0N2drg3w"}],"key":"bVxaV4CSMe"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Make Multi-Wavelength Light Curves Using Archival Data","url":"/light-curve-collector","group":"The Fornax Initiative"},"next":{"title":"Light Curve Classifier","url":"/light-curve-classifier","group":"The Fornax Initiative"}}},"domain":"http://localhost:3000"},"project":{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/fornax-demo-notebooks/build/manifest-51D9907C.js";
import * as route0 from "/fornax-demo-notebooks/build/root-TRTRBUUN.js";
import * as route1 from "/fornax-demo-notebooks/build/routes/$-VLPGWU3Z.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js");</script></body></html>