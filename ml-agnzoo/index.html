<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>AGN Zoo: Comparison of AGN selected with different metrics - The Fornax Initiative</title><meta property="og:title" content="AGN Zoo: Comparison of AGN selected with different metrics - The Fornax Initiative"/><meta name="generator" content="mystmd"/><meta name="description" content="Tutorial notebooks for example Fornax use cases"/><meta property="og:description" content="Tutorial notebooks for example Fornax use cases"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/app-AIT5GAEP.css"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/fornax-demo-notebooks/favicon.ico"/><link rel="stylesheet" href="/fornax-demo-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/fornax-demo-notebooks/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/fornax-demo-notebooks/build/fornax_logo-4cc31726eadc04c560c90703184b963a.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="The Fornax Initiative" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/fornax-demo-notebooks/">The Fornax Initiative</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time Domain" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/time-domain">Time Domain</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Spectroscopy" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/spectroscopy">Spectroscopy</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Multi-band forced photometry" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/forced-photometry">Multi-band forced photometry</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Cross Matching" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/crossmatch">Cross Matching</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Fornax Demo Notebooks</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/nasa-fornax/fornax-demo-notebooks" title="GitHub Repository: nasa-fornax/fornax-demo-notebooks" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/light_curves/ML_AGNzoo.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">AGN Zoo: Comparison of AGN selected with different metrics</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">Fornax developers and scientists</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this tutorial, you will:</p><ul><li><p>Work with multi-band lightcurve data</p></li><li><p>Learn high dimensional manifold of light curves with UMAPs and SOMs</p></li><li><p>Visualize and compare different samples on reduced dimension projections/grids</p></li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Active Galactic Nuclei (AGNs), some of the most powerful sources in the universe, emit a broad range of electromagnetic radiation, from radio waves to gamma rays. Consequently, there is a wide variety of AGN labels depending on the identification/selection scheme and the presence or absence of certain emissions (e.g., Radio loud/quiet, Quasars, Blazars, Seiferts, Changing looks). According to the unified model, this zoo of labels we see depend on a limited number of parameters, namely the viewing angle, the accretion rate, presence or lack of jets, and perhaps the properties of the host/environment (e.g., <a target="_blank" rel="noreferrer" href="https://arxiv.org/pdf/1707.07134.pdf" class="">Padovani et al. 2017</a>). Here, we collect archival photometry and labels from the literature to compare how some of these different labels/selection schemes compare.</p><p>We use manifold learning and dimensionality reduction to learn the distribution of AGN lightcurves observed with different facilities. We mostly focus on UMAP (<a target="_blank" rel="noreferrer" href="https://arxiv.org/pdf/1802.03426.pdf" class="">Uniform Manifold Approximation and Projection, McInnes 2020</a>) but also show SOM (<a target="_blank" rel="noreferrer" href="https://ieeexplore.ieee.org/document/58325" class="">Self organizing Map, Kohonen 1990</a>) examples. The reduced 2D projections from these two unsupervised ML techniques reveal similarities and overlaps of different selection techniques. Coloring the projections with various statistical physical properties (e.g., mean brightness, fractional lightcurve variation) is informative of correlations of the selections technique with physics such as AGN variability. Using different parts of the EM in training (or in building the initial higher dimensional manifold) demonstrates how much information if any is in that part of the data for each labeling scheme, for example whether with ZTF optical light curves alone, we can identify sources with variability in WISE near IR bands. These techniques also have a potential for identifying targets of a specific class or characteristic for future follow up observations.</p><h3 id="runtime" class="relative group"><span class="heading-text">Runtime</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#runtime" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As of 2024 September, this notebook takes ~160s to run to completion (after installs and imports) on Fornax using the ‘Astrophysics Default Image’ environment and the ‘Large’ server with 16GB RAM/ 4CPU.</p><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here are the libraries used in this network. They are also mostly mentioned in the requirements in case you don’t have them installed.</p><ul><li><p><em>sys</em> and <em>os</em> to handle file names, paths, and directories</p></li><li><p><em>numpy</em>  and <em>pandas</em> to handle array functions</p></li><li><p><em>matplotlib</em> <em>pyplot</em> and <em>cm</em> for plotting data</p></li><li><p><em><a target="_blank" rel="noreferrer" href="http://astropy.io" class="">astropy.io</a> fits</em> for accessing FITS files</p></li><li><p><em>astropy.table Table</em> for creating tidy tables of the data</p></li><li><p><em>AGNzoo_functions</em> for reading in and prepreocessing of lightcurve data</p></li><li><p><em>umap</em> and <em>minisom</em> for manifold learning, dimensionality reduction, and visualization</p></li></ul><p>This cell will install them if needed:</p><div id="FATzrTliq7" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# %pip install -r requirements_ML_AGNzoo.txt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="iXyc6JvSJO7kjFrAJfBfq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="TY5GHC2bTY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import sys

import astropy.units as u
from astropy.table import Table
import matplotlib.pyplot as plt
from matplotlib.colors import LinearSegmentedColormap
import matplotlib.gridspec as gridspec

from mpl_toolkits.axes_grid1 import make_axes_locatable

import numpy as np
import pandas as pd
sys.path.append(&#x27;code_src/&#x27;)
from AGNzoo_functions import (unify_lc, unify_lc_gp, stat_bands, autopct_format, combine_bands,
                      normalize_clipmax_objects, shuffle_datalabel, dtw_distance,
                      stretch_small_values_arctan, translate_bitwise_sum_to_labels, update_bitsums)
from collections import Counter, defaultdict

import umap
from minisom import MiniSom

import logging

# Get the root logger
logger = logging.getLogger()
logger.setLevel(logging.WARNING)

plt.style.use(&#x27;bmh&#x27;)
colors = [
    &quot;#3F51B5&quot;,  # Ultramarine Blue
    &quot;#003153&quot;,  # Prussian Blue
    &quot;#0047AB&quot;,  # Cobalt Blue
    &quot;#40826D&quot;,  # Viridian Green
    &quot;#50C878&quot;,  # Emerald Green
    &quot;#FFEA00&quot;,  # Chrome Yellow
    &quot;#CC7722&quot;,  # Yellow Ochre
    &quot;#E34234&quot;,  # Vermilion
    &quot;#E30022&quot;,  # Cadmium Red
    &quot;#D68A59&quot;,  # Raw Sienna
    &quot;#8A360F&quot;,  # Burnt Sienna
    &quot;#826644&quot;,  # Raw Umber
]

custom_cmap = LinearSegmentedColormap.from_list(&quot;custom_theme&quot;, colors[1:])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="VqN_smHrP86zRINxs-_bZ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-1-loading-data" class="relative group"><span class="heading-text">1. Loading data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-loading-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here we load a parquet file of light curves generated using the light_curve_collector notebook in this same GitHub repo. With that light_curve_collector notebook, you can build your favorite sample from different sources in the literature and grab the data from archives of interest. This sample contains both spatial coordinates and categorical labels for each AGN. The labels are generated by a bitwise addition of a set of binary indicators. Each binary indicator corresponds to the AGN’s membership in various categories, such as being an SDSS_QSO or a WISE_Variable. For example, an AGN that is both an SDSS_QSO, a WISE_Variable, and also shows ‘Turn_on’ characteristics, would have a label calculated by combining these specific binary indicators using bitwise addition.</p><div id="oAXgZcdyrf" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%bash

# To download the data file containing the light curves from Googledrive
gdown 1gb2vWn0V2unstElGTTrHIIWIftHbXJvz -O ./data/df_lc_020724.parquet.gzip</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="yDNMV1MrcNiB50bTCIMoW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Downloading...
From (original): https://drive.google.com/uc?id=1gb2vWn0V2unstElGTTrHIIWIftHbXJvz
Fro</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>m (redirected): https://drive.google.com/uc?id=1gb2vWn0V2unstElGTTrHIIWIftHbXJvz&amp;confirm=t&amp;uuid=3643</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>1fa1-762c-4772-9ccd-7172ce64bd1e
To: /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/l</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>ight_curves/data/df_lc_020724.parquet.gzip
</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>  0%|          | 0.00/243M [00:00&lt;?, ?B/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>  2%|▏         | 5.24M/243M [00:00&lt;00:04, 50.1MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>  5%|▌         | 13.1M/243M [00:00&lt;00:03, 65.7MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 12%|█▏        | 28.3M/243M [00:00&lt;00:02, 104MB/s] </span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 19%|█▊        | 45.6M/243M [00:00&lt;00:01, 127MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 27%|██▋       | 65.0M/243M [00:00&lt;00:01, 150MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 33%|███▎      | 80.2M/243M [00:00&lt;00:01, 119MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 40%|████      | 98.0M/243M [00:00&lt;00:01, 135MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 47%|████▋     | 114M/243M [00:00&lt;00:00, 137MB/s] </span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 54%|█████▍    | 133M/243M [00:01&lt;00:00, 151MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 62%|██████▏   | 152M/243M [00:01&lt;00:00, 161MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 70%|███████   | 171M/243M [00:01&lt;00:00, 168MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 77%|███████▋  | 188M/243M [00:01&lt;00:00, 167MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 84%|████████▍ | 206M/243M [00:01&lt;00:00, 93.1MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 90%|█████████ | 219M/243M [00:01&lt;00:00, 98.3MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span> 95%|█████████▌| 232M/243M [00:02&lt;00:00, 69.4MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>100%|█████████▉| 243M/243M [00:02&lt;00:00, 65.5MB/s]</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>100%|██████████| 243M/243M [00:02&lt;00:00, 103MB/s] </span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>
</span></code></pre></div></div></div></div><div id="EL5zKIXLrB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df_lc = pd.read_parquet(&#x27;data/df_lc_020724.parquet.gzip&#x27;)

# remove 64 for SPIDER only as its too large compared to the rest of the labels
df_lc = df_lc[df_lc.index.get_level_values(&#x27;label&#x27;) != &#x27;64&#x27;]
# remove all bitwise sums that had 64 in them
df_lc = update_bitsums(df_lc)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="G6SBxTpl-0iVz--L0KZnU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="RGJD6ACWyS" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">df_lc</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="c64-_1VN3qMDkl3jbO5AG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><h3 id="id-1-1-what-is-in-this-sample" class="relative group"><span class="heading-text">1.1 What is in this sample</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-1-what-is-in-this-sample" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To effectively undertake machine learning (ML) in addressing a specific question, it’s imperative to have a clear understanding of the data we’ll be utilizing. This understanding aids in selecting the appropriate ML approach and, critically, allows for informed and necessary data preprocessing. For example whether a normalization is needed, and what band to choose for normalization.</p><div id="dgsPVz0YwY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">objid = df_lc.index.get_level_values(&#x27;objectid&#x27;)[:].unique()
seen = Counter()

for (objectid, label), singleobj in df_lc.groupby(level=[&quot;objectid&quot;, &quot;label&quot;]):
    bitwise_sum = int(label)
    active_labels = translate_bitwise_sum_to_labels(bitwise_sum)
    seen.update(active_labels)
# changing order of labels in dictionary only for text to be readable on the plot
key_order = (&#x27;SDSS_QSO&#x27;, &#x27;SPIDER_AGN&#x27;, &#x27;SPIDER_BL&#x27;, &#x27;SPIDER_QSOBL&#x27;, &#x27;SPIDER_AGNBL&#x27;,
             &#x27;WISE_Variable&#x27;, &#x27;Optical_Variable&#x27;, &#x27;Galex_Variable&#x27;, &#x27;Turn-on&#x27;, &#x27;Turn-off&#x27;, &#x27;TDE&#x27;)
new_queue = {}
for k in key_order:
    new_queue[k] = seen[k]

plt.figure(figsize=(8, 8))
plt.title(r&#x27;Sample consists of:&#x27;, size=15)
h = plt.pie(new_queue.values(), labels=new_queue.keys(), autopct=autopct_format(new_queue.values()),
            textprops={&#x27;fontsize&#x27;: 15}, startangle=30, labeldistance=1.1,
            wedgeprops={&#x27;linewidth&#x27;: 3, &#x27;edgecolor&#x27;: &#x27;white&#x27;}, colors=colors)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="JOdQ5uH2wTvd7kWUnqjlM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/c5fa3835d9e556b755a95847cda014f0.png" alt="&lt;Figure size 800x800 with 1 Axes&gt;"/></div></div></div><p>In this particular example, the largest subsamples of AGNs, all with a criteria on redshift (z&lt;1), are from the optical spectra by the <a target="_blank" rel="noreferrer" href="https://www.sdss4.org/dr17/algorithms/qso_catalog/" class="">SDSS quasar sample DR16Q</a>, the value added SDSS spectra from <a target="_blank" rel="noreferrer" href="https://www.sdss.org/dr18/bhm/programs/spiders/" class="">SPIDERS</a>, and a subset of AGNs selected in MIR WISE bands based on their variability (<a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2019AAS...23333004P/abstract" class="">csv in data folder credit RChary</a>).
We also include some smaller samples from the literature to see where they sit compared to the rest of the population and if they are localized on the 2D projection.
These include the Changing Look AGNs from the literature (e.g., <a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2015ApJ...800..144L/abstract" class="">LaMassa et al. 2015</a>, <a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2022ApJ...927..227L/abstract" class="">Lyu et al. 2022</a>, <a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2022MNRAS.511...54H/abstract" class="">Hon et al. 2022</a>), a sample which showed variability in Galex UV images (<a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2022ApJ...933...37W/abstract" class="">Wasleske et al. 2022</a>), a sample of variable sources identified in optical Palomar observations (<a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2020ApJ...896...10B/abstract" class="">Baldassare et al. 2020</a>), and the optically variable AGNs in the COSMOS field from a three year program on the VLT(<a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2019A%26A...627A..33D/abstract" class="">De Cicco et al. 2019</a>).
We also include 30 Tidal Disruption Event coordinates identified from ZTF light curves <cite class="" data-state="closed"><a href="https://doi.org/10.3847/1538-4357/aca283" target="_blank" rel="noreferrer" class="hover-link">Hammerstein <em>et al.</em> (2022)</a></cite>.</p><div id="gmQycU47EJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">seen = Counter()
seen = df_lc.reset_index().groupby(&#x27;band&#x27;).objectid.nunique().to_dict()

plt.figure(figsize=(20, 4))
plt.title(r&#x27;Number of lightcurves in each waveband in this sample:&#x27;, size=20)
h = plt.bar(seen.keys(), seen.values())
plt.ylabel(r&#x27;#&#x27;, size=20)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="D9TWYbFPfNqhHCqZUdD-k" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/7b64d5ebd782debf2a8d38e42ac9b755.png" alt="&lt;Figure size 2000x400 with 1 Axes&gt;"/></div></div></div><p>The histogram shows the number of lightcurves which ended up in the multi-index data frame from each of the archive calls in different wavebands/filters.</p><div id="gryzFcghJJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cadence = dict((el, []) for el in seen.keys())
timerange = dict((el, []) for el in seen.keys())

for (_, band), times in df_lc.reset_index().groupby([&quot;objectid&quot;, &quot;band&quot;]).time:
    cadence[band].append(len(times))
    if times.max() - times.min() &gt; 0:
        timerange[band].append(np.round(times.max() - times.min(), 1))

plt.figure(figsize=(20, 4))
plt.title(r&#x27;Time range and cadence covered in each in each waveband averaged over this sample:&#x27;)
for el in cadence.keys():
    plt.scatter(np.mean(timerange[el]), np.mean(cadence[el]), label=el, s=len(timerange[el]))
    plt.errorbar(np.mean(timerange[el]), np.mean(cadence[el]),
                 xerr=np.std(timerange[el]), yerr=np.std(cadence[el]), alpha=0.2)
    plt.annotate(el, (np.mean(timerange[el]), np.mean(cadence[el])+2), size=12, rotation=40)
plt.ylabel(r&#x27;Average number of visits&#x27;, size=20)
plt.xlabel(r&#x27;Average baseline (days)&#x27;, size=20)
plt.xlim([0, 4000])
plt.yscale(&#x27;log&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_N-QccM338tFJLmPBV-K6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/fromnumeric.py:3860: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:145: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:223: RuntimeWarning: Degrees of freedom &lt;= 0 for slice
  ret = _var(a, axis=axis, dtype=dtype, out=out, ddof=ddof,
/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:181: RuntimeWarning: invalid value encountered in divide
  arrmean = um.true_divide(arrmean, div, out=arrmean,
/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:215: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/d828b068b9a678864f4f535b5c2273e4.png" alt="&lt;Figure size 2000x400 with 1 Axes&gt;"/></div></div></div><p>While from the histogram plot we see which bands have the highest number of observed lightcurves, what might matter more in finding/selecting variability or changing look in lightcurves is the cadence and the average baseline of observations. For instance, Panstarrs has a large number of lightcurve detections in our sample, but from the figure above we see that the average number of visits and the baseline for those observations are considerably less than ZTF. WISE also shows the longest baseline of observations which is suitable to finding longer term variability in objects.</p><h2 id="id-2-preprocess-data-for-ml-ztf-bands" class="relative group"><span class="heading-text">2. Preprocess data for ML (ZTF bands)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-preprocess-data-for-ml-ztf-bands" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We first look at this sample only in ZTF bands which have the largest number of visits. We start by unifying the time grid of the light curves so oobjects with different start time or number of observations can be compared. We do this by interpolation to a new grid. The choice of the grid resolution and baseline is strictly dependent on the input data, in this case ZTF, to preserve as much as possible all the information from the observations.
The unify_lc, or unify_lc_gp functions do the unification of the lightcurve arrays. For details please see the codes. The time arrays are chosen based on the average duration of observations, with ZTF and WISE covering 1600, 4000 days respectively. We note that we disregard the time of observation of each source, by subtracting the initial time from the array and bringing all lightcurves to the same footing. This has to be taken into account if it influences the science of interest. We then interoplate the time arrays with linear or Gaussian Process regression (unift_lc/ unify_lc_gp respectively). We also remove from the sample objects with less than 5 datapoints in their light curve. We measure basic statistics and combine the tree observed ZTF bands into one longer array as input to dimensionailty reduction after deciding on normalization. We also do a shuffling of the sample to be sure that the separations of different classes by ML are not simply due to the order they are seen in training (in case it is not done by the ML routine itself).</p><div id="Q0sRaKY1rt" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bands_inlc = [&#x27;zg&#x27;, &#x27;zr&#x27;, &#x27;zi&#x27;]

# nearest neighbor linear interpolation:
objects, dobjects, flabels, keeps = unify_lc(df_lc, bands_inlc, xres=60, numplots=5,
                                             low_limit_size=5)

# Gaussian process unification
# objects, dobjects, flabels, keeps = unify_lc_gp(df_lc, bands_inlc, xres=60, numplots=5,
#                                                 low_limit_size=5)

# keeps can be used as index of objects that are kept in &quot;objects&quot; from the initial &quot;df_lc&quot;,
# in case information about some properties of sample (e.g., redshifts) is of interest
# this array of indecies would be helpful

# calculate some basic statistics with a sigmaclipping with width 5sigma
fvar, maxarray, meanarray = stat_bands(objects, dobjects, bands_inlc, sigmacl=5)

# combine different waveband into one array
dat_notnormal = combine_bands(objects, bands_inlc)

# Normalize the combinde array by maximum of brightness in a waveband after clipping outliers:
dat = normalize_clipmax_objects(dat_notnormal, maxarray, band=1)

# Normalize the combinde array by mean brightness in a waveband after clipping outliers:
datm = normalize_clipmax_objects(dat_notnormal, meanarray, band=1)

# shuffle data incase the ML routines are sensitive to order
data, fzr, p = shuffle_datalabel(dat, flabels)
fvar_arr, maximum_arr, average_arr = fvar[:, p], maxarray[:, p], meanarray[:, p]

# Initialize labc to hold indices of each unique label
labc = {}
for index, f in enumerate(fzr):
    lab = translate_bitwise_sum_to_labels(int(f))
    for label in lab:
        if label not in labc:
            # Initialize the list for this label if it&#x27;s not already in labc
            labc[label] = []
        # Append the current index to the list of indices for this label
        labc[label].append(index)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="sxqcqlQ7JogYgU88TfuFC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/ba4aa3c1e18265db5e8d93c1b1f0e5a2.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/0440a7d0fd4b012799f9b78b91b32d15.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/c5a838866d6b69aa15b1377d32c5e65c.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/6f9116f88eeda6353dd3092644fddd18.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/08461971302ef20edd1cec1589958b7f.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/code_src/AGNzoo_functions.py:290: RuntimeWarning: invalid value encountered in sqrt
  fvar = (np.sqrt(varf - deltaf)) / meanf
</span></code></pre></div></div></div></div><p>The combination of the tree bands into one longer arrays in order of increasing wavelength, can be seen as providing both the SED shape as well as variability in each from the light curve. Figure below demonstrates this as well as our normalization choice. We normalize the data in ZTF R band as it has a higher average numbe of visits compared to G and I band. We remove outliers before measuring the mean and max of the light curve and normalizing by it. This normalization can be skipped if one is mearly interested in comparing brightnesses of the data in this sample, but as dependence on flux is strong to look for variability and compare shapes of light curves a normalization helps.</p><div id="wAzjwJ3fKS" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">r = np.random.randint(np.shape(dat)[1])

_, axs = plt.subplots(1, 3, figsize=(18, 4))
ztf_data = [dat_notnormal, dat, datm]
ylabels = [r&#x27;Flux ($\mu Jy$)&#x27;, r&#x27;Normalized Flux (max r band)&#x27;, r&#x27;Normalized Flux (mean r band)&#x27;]
fig_contents = list(zip(axs, ztf_data, ylabels))

for i, l in enumerate(bands_inlc):
    s = int(np.shape(dat)[1]/len(bands_inlc))
    first = int(i*s)
    last = first+s
    for ax, ydata, ylabel in fig_contents:
        ax.plot(np.linspace(first, last, s), ydata[r, first:last], &#x27;o&#x27;, linestyle=&#x27;--&#x27;, label=l)
        ax.set_xlabel(r&#x27;Time_[w1, w2, w3]&#x27;, size=15)
        ax.set_ylabel(ylabel, size=15)
_ = axs[0].legend(loc=2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="iILphDA4Gsuhq3rX_nRQx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/1818d99f744a8463d7bf4d7cf3955a5e.png" alt="&lt;Figure size 1800x400 with 3 Axes&gt;"/></div></div></div><h2 id="id-3-learn-the-manifold" class="relative group"><span class="heading-text">3. Learn the Manifold</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-learn-the-manifold" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Now we can train a UMAP with the processed data vectors above. Different choices for the number of neighbors, minimum distance and metric can be made and a parameter space can be explored. We show here our preferred combination given this data. We choose manhattan distance (also called <a href="https://en.wikipedia.org/wiki/Taxicab_geometry" class="italic" target="_blank" rel="noreferrer" data-state="closed">the L1 distance</a>) as it is optimal for the kind of grid we interpolated on, for instance we want the distance to not change if there are observations missing. Another metric appropriate for our purpose in time domain analysis is Dynamic Time Warping (<a href="https://en.wikipedia.org/wiki/Dynamic_time_warping" class="italic" target="_blank" rel="noreferrer" data-state="closed">DTW</a>), which is insensitive to a shift in time. This is helpful as we interpolate the observations onto a grid starting from time 0 and when discussing variability we care less about when it happens and more about whether and how strong it happened. As the measurement of the DTW distance takes longer compared to the other metrics we show examples here with manhattan and only show one example exploring the parameter space including a DTW metric in the last cell of this notebook.</p><div id="zKr0FGWsVX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.figure(figsize=(18, 6))
markersize=200
mapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=&#x27;manhattan&#x27;, random_state=20).fit(data)


ax1 = plt.subplot(1, 3, 2)
ax1.set_title(r&#x27;mean brightness&#x27;, size=20)
cf = ax1.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,
                 c=np.log10(np.nansum(meanarray, axis=0)), edgecolor=&#x27;gray&#x27;)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(ax1)
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)


ax0 = plt.subplot(1, 3, 3)
ax0.set_title(r&#x27;mean fractional variation&#x27;, size=20)
cf = ax0.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,
                 c=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=3),
                 edgecolor=&#x27;gray&#x27;)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(ax0)
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)

ax2 = plt.subplot(1, 3, 1)
ax2.set_title(&#x27;sample origin&#x27;, size=20)
counts = 1
for label, indices in labc.items():
    cf = ax2.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=markersize,
                     c=colors[counts], alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
    counts += 1
plt.legend(fontsize=12)
#plt.colorbar(cf)
plt.axis(&#x27;off&#x27;)

plt.tight_layout()
#plt.savefig(&#x27;umap-ztf.png&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="L7FM0UwrknfO2lQPtHu3P" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/32897f1024d1adc147c17e1038b73494.png" alt="&lt;Figure size 1800x600 with 5 Axes&gt;"/></div></div></div><p>The left panel is colorcoded by the origin of the sample. The middle panel shows the sum of mean brightnesses in three bands (arbitrary unit) demonstrating that after normalization we see no correlation with brightness. The panel on the right is color coded by a statistical measure of variability (i.e. the fractional variation <a target="_blank" rel="noreferrer" href="https://ned.ipac.caltech.edu/level5/Sept01/Peterson2/Peter2_1.html" class="">see here</a>). As with the plotting above it is not easy to see all the data points and correlations in the next two cells measure probability of belonging to each original sample as well as the mean statistical property on an interpolated grid on this reduced 2D projected surface.</p><div id="ed4xH8rDwi" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define a grid
grid_resolution = 15# Number of cells in the grid
x_min, x_max = mapper.embedding_[:, 0].min(), mapper.embedding_[:, 0].max()
y_min, y_max = mapper.embedding_[:, 1].min(), mapper.embedding_[:, 1].max()
x_grid = np.linspace(x_min, x_max, grid_resolution)
y_grid = np.linspace(y_min, y_max, grid_resolution)
x_centers, y_centers = np.meshgrid(x_grid, y_grid)

# Calculate mean property in each grid cell
mean_property1, mean_property2 = np.zeros_like(x_centers), np.zeros_like(x_centers)
propmean=stretch_small_values_arctan(np.nansum(meanarray, axis=0), factor=2)
propfvar=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=2)
for i in range(grid_resolution - 1):
    for j in range(grid_resolution - 1):
        mask = (
            (mapper.embedding_[:, 0] &gt;= x_grid[i]) &amp;
            (mapper.embedding_[:, 0] &lt; x_grid[i + 1]) &amp;
            (mapper.embedding_[:, 1] &gt;= y_grid[j]) &amp;
            (mapper.embedding_[:, 1] &lt; y_grid[j + 1])
        )
        if np.sum(mask) &gt; 0:
            mean_property1[j, i] = np.mean(propmean[mask])
            mean_property2[j, i] = np.mean(propfvar[mask])


plt.figure(figsize=(12, 4))
plt.subplot(1, 2, 1)
plt.title(&#x27;mean brightness&#x27;)
cf = plt.contourf(x_centers, y_centers, mean_property1, cmap=&#x27;viridis&#x27;, alpha=0.9)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(plt.gca())
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)

plt.subplot(1, 2, 2)
plt.title(&#x27;mean fractional variation&#x27;)
cf = plt.contourf(x_centers, y_centers, mean_property2, cmap=&#x27;viridis&#x27;, alpha=0.9)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(plt.gca())
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xtiprvu0IkGKRftRLhd13" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/df884bfebcc06d2637a996695ec64315.png" alt="&lt;Figure size 1200x400 with 4 Axes&gt;"/></div></div></div><h3 id="id-3-1-sample-comparison-on-the-umap" class="relative group"><span class="heading-text">3.1 Sample comparison on the UMAP</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-sample-comparison-on-the-umap" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="HWw4uDTcgc" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Calculate 2D histogram
hist, x_edges, y_edges = np.histogram2d(mapper.embedding_[:, 0], mapper.embedding_[:, 1], bins=12)
plt.figure(figsize=(15, 12))
i=1
ax0 = plt.subplot(4, 4, 12)
for label, indices in sorted(labc.items()):
    hist_per_cluster, _, _ = np.histogram2d(mapper.embedding_[indices, 0],
                                            mapper.embedding_[indices, 1],
                                            bins=(x_edges, y_edges))
    prob = hist_per_cluster / hist
    plt.subplot(4, 4, i)
    plt.title(label)
    plt.contourf(x_edges[:-1], y_edges[:-1], prob.T, levels=20, alpha=0.8, cmap=custom_cmap)
    plt.colorbar()
    plt.axis(&#x27;off&#x27;)
    cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,
                     alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label, c=colors[i-1])
    i += 1
ax0.legend(loc=4, fontsize=7)
ax0.axis(&#x27;off&#x27;)
plt.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="5s6gNQlmWLBr3830Pstny" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3476/3793995111.py:10: RuntimeWarning: invalid value encountered in divide
  prob = hist_per_cluster / hist
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/5c21af46449629da52214dd34330ea3d.png" alt="&lt;Figure size 1500x1200 with 23 Axes&gt;"/></div></div></div><p>Figure above shows how with ZTF light curves alone we can separate some of these AGN samples, where they have overlaps. We can do a similar exercise with other dimensionality reduction techniques. Below we show two SOMs one with normalized and another with no normalization. The advantage of Umaps to SOMs is that in practice you may change the parameters to separate classes of vastly different data points, as distance is preserved on a umap. On a SOM however only topology of higher dimensions is preserved and not distance hence, the change on the 2d grid does not need to be smooth and from one cell to next there might be larg jumps. On the other hand, an advantage of the SOM is that by definition it has a grid and no need for a posterior interpolation (as we did above) is needed to map more data or to measure probabilities, etc.</p><h3 id="id-3-2-reduced-dimensions-on-a-som-grid" class="relative group"><span class="heading-text">3.2 Reduced dimensions on a SOM grid</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-2-reduced-dimensions-on-a-som-grid" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="k5ytuUk6zw" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Initialization and training
msz0, msz1 = 15, 15
som = MiniSom(msz0, msz1, data.shape[1], sigma=1.5, learning_rate=.5,
              neighborhood_function=&#x27;gaussian&#x27;, random_seed=0, topology=&#x27;rectangular&#x27;)

som.pca_weights_init(data)
som.train(data, 100000, verbose=False)  # random training</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="sYo9GRUbCXwxhXI18mQ7-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/minisom.py:447: ComplexWarning: Casting complex values to real discards the imaginary part
  self._weights[i, j] = c1*pc[pc_order[0]] + \
</span></code></pre></div></div></div></div><div id="ahKuQPiRel" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">laborder = [&#x27;SDSS_QSO&#x27;, &#x27;SPIDER_AGN&#x27;, &#x27;SPIDER_BL&#x27;, &#x27;SPIDER_QSOBL&#x27;, &#x27;SPIDER_AGNBL&#x27;,
            &#x27;WISE_Variable&#x27;, &#x27;Optical_Variable&#x27;, &#x27;Galex_Variable&#x27;, &#x27;Turn-on&#x27;, &#x27;Turn-off&#x27;, &#x27;TDE&#x27;]


# Create grid to hold mean fvar per SOM node
mean_fvar_map = np.full((msz0, msz1), np.nan)

# Create helper to accumulate fvar values in each cell
cell_fvar = defaultdict(list)

# First, map each data point to its BMU and store its fvar
propfvar=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=2)
for i in range(len(data)):
    bmu = som.winner(data[i])  # returns (x, y)
    fvar_value = fvar_arr[i] if np.ndim(fvar_arr) == 1 else np.mean(propfvar[i])
    cell_fvar[bmu].append(fvar_value)

# Now compute mean per cell
for (x, y), values in cell_fvar.items():
    mean_fvar_map[x, y] = np.nanmean(values)

# apply stretching for visualization
heatmap = stretch_small_values_arctan(mean_fvar_map)
ncols = 4
nrows = int(np.ceil(len(laborder) / ncols))
fig, axs = plt.subplots(nrows, ncols, figsize=(3*ncols, 3*nrows))
axs = axs.flatten()

for i, label in enumerate(laborder):
    ax = axs[i]
    im = ax.imshow(heatmap.T, origin=&#x27;lower&#x27;, cmap=&#x27;plasma&#x27;)

    if label in labc:
        for idx in labc[label]:
            x, y = som.winner(data[idx])
            ax.plot(x, y, &#x27;x&#x27;, color=&#x27;white&#x27;, markersize=8, markeredgewidth=2)

    ax.set_title(label)
    ax.set_xticks([])
    ax.set_yticks([])

# Hide the extra subplot if laborder &lt; nrows * ncols
if len(laborder) &lt; len(axs):
    axs[len(laborder)].axis(&#x27;off&#x27;)

# Colorbar outside the plot grid
# Adjust position as needed (here it&#x27;s to the right)
cbar_ax = fig.add_axes([0.99, 0.05, 0.02, 0.9])  # [left, bottom, width, height]
cbar = fig.colorbar(im, cax=cbar_ax)
cbar.set_label(&#x27;Mean Fractional Variability&#x27;)

plt.subplots_adjust(right=0.9)  # Leave space for colorbar
plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qaHc46W4A2mw0Rf_Tp0es" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3476/2599028209.py:53: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout()
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/4bf0ff423cb2c0edc23af3ede136c4d4.png" alt="&lt;Figure size 1200x900 with 13 Axes&gt;"/></div></div></div><p>The above SOMs are colored by the mean fractional variation of the lightcurves in all bands (a measure of AGN variability). The crosses are different samples mapped to the trained SOM to see if they are distinguishable on a normalized lightcurve som.</p><div id="B4UKT3obLE" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># shuffle data in case the ML routines are sensitive to order
data, fzr, p = shuffle_datalabel(dat_notnormal, flabels)
fvar_arr, maximum_arr, average_arr = fvar[:, p], maxarray[:, p], meanarray[:, p]
# Initialize labc to hold indices of each unique label
labc = {}
for index, f in enumerate(fzr):
    lab = translate_bitwise_sum_to_labels(int(f))
    for label in lab:
        if label not in labc:
            # Initialize the list for this label if it&#x27;s not already in labc
            labc[label] = []
        # Append the current index to the list of indices for this label
        labc[label].append(index)

som = MiniSom(msz0, msz1, data.shape[1], sigma=1.5, learning_rate=.5,
              neighborhood_function=&#x27;gaussian&#x27;, random_seed=0, topology=&#x27;rectangular&#x27;)

som.pca_weights_init(data)
som.train(data, 100000, verbose=False)  # random training</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="o6Hifs5FaY-po7qfv0c6V" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="YCVRIYjxoZ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Create grid to hold mean fvar per SOM node
mean_fvar_map = np.full((msz0, msz1), np.nan)

# Create helper to accumulate fvar values in each cell
cell_fvar = defaultdict(list)

# First, map each data point to its BMU and store its fvar
propfvar=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=2)
for i in range(len(data)):
    bmu = som.winner(data[i])  # returns (x, y)
    fvar_value = fvar_arr[i] if np.ndim(fvar_arr) == 1 else np.mean(propfvar[i])
    cell_fvar[bmu].append(fvar_value)

# Now compute mean per cell
for (x, y), values in cell_fvar.items():
    mean_fvar_map[x, y] = np.nanmean(values)

# apply stretching for visualization
heatmap = stretch_small_values_arctan(mean_fvar_map)
ncols = 4
nrows = int(np.ceil(len(laborder) / ncols))
fig, axs = plt.subplots(nrows, ncols, figsize=(3*ncols, 3*nrows))
axs = axs.flatten()

for i, label in enumerate(laborder):
    ax = axs[i]
    im = ax.imshow(heatmap.T, origin=&#x27;lower&#x27;, cmap=&#x27;plasma&#x27;)

    if label in labc:
        for idx in labc[label]:
            x, y = som.winner(data[idx])
            ax.plot(x, y, &#x27;x&#x27;, color=&#x27;white&#x27;, markersize=8, markeredgewidth=2)

    ax.set_title(label)
    ax.set_xticks([])
    ax.set_yticks([])

# Hide the extra subplot if laborder &lt; nrows * ncols
if len(laborder) &lt; len(axs):
    axs[len(laborder)].axis(&#x27;off&#x27;)

# Colorbar outside the plot grid
# Adjust position as needed (here it&#x27;s to the right)
cbar_ax = fig.add_axes([0.99, 0.05, 0.02, 0.9])  # [left, bottom, width, height]
cbar = fig.colorbar(im, cax=cbar_ax)
cbar.set_label(&#x27;Mean Fractional Variability&#x27;)

plt.subplots_adjust(right=0.9)  # Leave space for colorbar
plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="fugebdUlGmQTZfk92igIZ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3476/1301010532.py:49: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout()
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/68cc5971b15db442365741505cd13052.png" alt="&lt;Figure size 1200x900 with 13 Axes&gt;"/></div></div></div><div id="Dvj3FOmJrm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">labels = [None] * len(data)
for label in laborder:
    if label in labc:
        for idx in labc[label]:
            labels[idx] = label

labels_map = defaultdict(Counter)

for x, label in zip(data, labels):
    if label is not None:
        w = som.winner(x)
        labels_map[w][label] += 1

fig = plt.figure(figsize=(12, 12))
the_grid = gridspec.GridSpec(msz0, msz1, fig)

for position in labels_map.keys():
    label_counts = labels_map[position]
    total = sum(label_counts.values())

    # Use consistent order from laborder
    fracs = [label_counts.get(label, 0) / total for label in laborder]

    ax = plt.subplot(the_grid[msz1 - 1 - position[1], position[0]], aspect=1)
    patches, _ = ax.pie(fracs)
    #ax.set_title(f&quot;{position}&quot;, fontsize=6)
    ax.axis(&#x27;equal&#x27;)

# Legend outside
plt.legend(patches, laborder, bbox_to_anchor=(1.05, 1), loc=&#x27;upper left&#x27;, fontsize=8)
plt.tight_layout()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OX6y5IQtvCliAEUbR67At" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3476/2695913503.py:31: UserWarning: Tight layout not applied. tight_layout cannot make Axes width small enough to accommodate all Axes decorations
  plt.tight_layout()
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/263ac0382aa0fac67636b1880a900893.png" alt="&lt;Figure size 1200x1200 with 225 Axes&gt;"/></div></div></div><p>skipping the normalization of lightcurves, further separates turn on/off CLAGNs when looking at ZTF lightcurves only.</p><h2 id="id-4-repeating-the-above-this-time-with-ztf-wise-manifold" class="relative group"><span class="heading-text">4. Repeating the above, this time with ZTF + WISE manifold</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-repeating-the-above-this-time-with-ztf-wise-manifold" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="UfRmjTmSPj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bands_inlc = [&#x27;zg&#x27;, &#x27;zr&#x27;, &#x27;zi&#x27;, &#x27;W1&#x27;, &#x27;W2&#x27;]
objects, dobjects, flabels, keeps = unify_lc(df_lc, bands_inlc, xres=30, numplots=3)
# calculate some basic statistics
fvar, maxarray, meanarray = stat_bands(objects, dobjects, bands_inlc)
dat_notnormal = combine_bands(objects, bands_inlc)
dat = normalize_clipmax_objects(dat_notnormal, maxarray, band=-1)
data, fzr, p = shuffle_datalabel(dat, flabels)
fvar_arr, maximum_arr, average_arr = fvar[:, p], maxarray[:, p], meanarray[:, p]

# Initialize labc to hold indices of each unique label
labc = {}
for index, f in enumerate(fzr):
    lab = translate_bitwise_sum_to_labels(int(f))
    for label in lab:
        if label not in labc:
            # Initialize the list for this label if it&#x27;s not already in labc
            labc[label] = []
        # Append the current index to the list of indices for this label
        labc[label].append(index)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="znlE0BYrgSNZfb8GZ3YeS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/11e2da55b1dfd85bfe9afc083af8ff5f.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/7700dd82955ddf9e6fe61e5f71b2c93a.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/037ced06bbb84ea6dbc5a7f2ac39e9b6.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/code_src/AGNzoo_functions.py:290: RuntimeWarning: invalid value encountered in sqrt
  fvar = (np.sqrt(varf - deltaf)) / meanf
</span></code></pre></div></div></div></div><div id="zlbtDSspwV" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.figure(figsize=(18, 6))
markersize=200
mapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=&#x27;manhattan&#x27;, random_state=4).fit(data)
# using dtw distance takes a long time
# mapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=dtw_distance, random_state=20).fit(data)


ax1 = plt.subplot(1, 3, 2)
ax1.set_title(r&#x27;mean brightness&#x27;, size=20)
cf = ax1.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,
                 c=np.log10(np.nansum(meanarray, axis=0)), edgecolor=&#x27;gray&#x27;)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(ax1)
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)


ax0 = plt.subplot(1, 3, 3)
ax0.set_title(r&#x27;mean fractional variation&#x27;, size=20)
cf = ax0.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,
                 c=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=3),
                 edgecolor=&#x27;gray&#x27;)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(ax0)
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)

ax2 = plt.subplot(1, 3, 1)
ax2.set_title(&#x27;sample origin&#x27;, size=20)
counts = 1
for label, indices in labc.items():
    cf = ax2.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=markersize,
                     c=colors[counts], alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
    counts += 1
plt.legend(fontsize=12)
#plt.colorbar(cf)
plt.axis(&#x27;off&#x27;)

plt.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="8qFBvVg8MgpVM6pOTEilr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/91a6065bece5ce3056481beeb97f7d4c.png" alt="&lt;Figure size 1800x600 with 5 Axes&gt;"/></div></div></div><div id="Kv5Egh0liz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Calculate 2D histogram
hist, x_edges, y_edges = np.histogram2d(mapper.embedding_[:, 0], mapper.embedding_[:, 1], bins=12)
plt.figure(figsize=(15, 12))
i=1
ax0 = plt.subplot(4, 4, 12)
for label, indices in sorted(labc.items()):
    hist_per_cluster, _, _ = np.histogram2d(mapper.embedding_[indices, 0],
                                            mapper.embedding_[indices, 1],
                                            bins=(x_edges, y_edges))
    prob = hist_per_cluster / hist
    plt.subplot(4, 4, i)
    plt.title(label)
    plt.contourf(x_edges[:-1], y_edges[:-1], prob.T, levels=20, alpha=0.8, cmap=custom_cmap)
    plt.colorbar()
    plt.axis(&#x27;off&#x27;)
    cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,
                     alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label, c=colors[i-1])
    i += 1
ax0.legend(loc=4, fontsize=7)
ax0.axis(&#x27;off&#x27;)
plt.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="53Rq3ZUxn6OrU8TmfeWCq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3476/3793995111.py:10: RuntimeWarning: invalid value encountered in divide
  prob = hist_per_cluster / hist
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/0610caa0fe1e8cc935cdef54889ecaf2.png" alt="&lt;Figure size 1500x1200 with 23 Axes&gt;"/></div></div></div><h2 id="id-5-wise-bands-alone" class="relative group"><span class="heading-text">5. Wise bands alone</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-wise-bands-alone" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="d5JagCMjCp" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bands_inlcw = [&#x27;W1&#x27;, &#x27;W2&#x27;]
objectsw, dobjectsw, flabelsw, keepsw = unify_lc(df_lc, bands_inlc, xres=30)
# calculate some basic statistics
fvarw, maxarrayw, meanarrayw = stat_bands(objectsw, dobjectsw, bands_inlcw)
dat_notnormalw = combine_bands(objects, bands_inlcw)
datw = normalize_clipmax_objects(dat_notnormalw, maxarrayw, band=-1)
dataw, fzrw, pw = shuffle_datalabel(datw, flabelsw)
fvar_arrw, maximum_arrw, average_arrw = fvarw[:, pw], maxarrayw[:, pw], meanarrayw[:, pw]

# Initialize labc to hold indices of each unique label
labcw = {}
for index, f in enumerate(fzrw):
    lab = translate_bitwise_sum_to_labels(int(f))
    for label in lab:
        if label not in labcw:
            # Initialize the list for this label if it&#x27;s not already in labc
            labcw[label] = []
        # Append the current index to the list of indices for this label
        labcw[label].append(index)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="VcyY6XEOLOqrEufaKOLSn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/11e2da55b1dfd85bfe9afc083af8ff5f.png" alt="&lt;Figure size 1500x500 with 1 Axes&gt;"/></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/code_src/AGNzoo_functions.py:290: RuntimeWarning: invalid value encountered in sqrt
  fvar = (np.sqrt(varf - deltaf)) / meanf
</span></code></pre></div></div></div></div><div id="DUCsB5iaWI" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.figure(figsize=(18, 6))
markersize=200
mapp = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=&#x27;manhattan&#x27;, random_state=20).fit(dataw)


ax1 = plt.subplot(1, 3, 2)
ax1.set_title(r&#x27;mean brightness&#x27;, size=20)
cf = ax1.scatter(mapp.embedding_[:, 0], mapp.embedding_[:, 1], s=markersize,
                 c=np.log10(np.nansum(meanarrayw, axis=0)), edgecolor=&#x27;gray&#x27;)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(ax1)
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)


ax0 = plt.subplot(1, 3, 3)
ax0.set_title(r&#x27;mean fractional variation&#x27;, size=20)
cf = ax0.scatter(mapp.embedding_[:, 0], mapp.embedding_[:, 1], s=markersize,
                 c=stretch_small_values_arctan(np.nansum(fvar_arrw, axis=0), factor=3),
                 edgecolor=&#x27;gray&#x27;)
plt.axis(&#x27;off&#x27;)
divider = make_axes_locatable(ax0)
cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.05)
plt.colorbar(cf, cax=cax)

ax2 = plt.subplot(1, 3, 1)
ax2.set_title(&#x27;sample origin&#x27;, size=20)
counts = 1
for label, indices in labcw.items():
    cf = ax2.scatter(mapp.embedding_[indices, 0], mapp.embedding_[indices, 1], s=markersize,
                     c=colors[counts], alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
    counts += 1
plt.legend(fontsize=12)
#plt.colorbar(cf)
plt.axis(&#x27;off&#x27;)

plt.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="aklLGmnWHhCzPI5BU_lWK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/abb12f17f637e7dd755395ed156637d6.png" alt="&lt;Figure size 1800x600 with 5 Axes&gt;"/></div></div></div><div id="c1CRFtWf06" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Calculate 2D histogram
hist, x_edges, y_edges = np.histogram2d(mapp.embedding_[:, 0], mapp.embedding_[:, 1], bins=12)
plt.figure(figsize=(15, 12))
i=1
ax0 = plt.subplot(4, 4, 12)
for label, indices in sorted(labcw.items()):
    hist_per_cluster, _, _ = np.histogram2d(mapp.embedding_[indices, 0],
                                            mapp.embedding_[indices, 1],
                                            bins=(x_edges, y_edges))
    prob = hist_per_cluster / hist
    plt.subplot(4, 4, i)
    plt.title(label)
    plt.contourf(x_edges[:-1], y_edges[:-1], prob.T, levels=20, alpha=0.8, cmap=custom_cmap)
    plt.colorbar()
    plt.axis(&#x27;off&#x27;)
    cf = ax0.scatter(mapp.embedding_[indices, 0], mapp.embedding_[indices, 1], s=80,
                     alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label, c=colors[i-1])
    i += 1
ax0.legend(loc=4, fontsize=7)
ax0.axis(&#x27;off&#x27;)
plt.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="h19MiviLBJd1wGkputfKX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/tmp/ipykernel_3476/3463858432.py:10: RuntimeWarning: invalid value encountered in divide
  prob = hist_per_cluster / hist
</span></code></pre></div></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/81e1ddb4e03cfe8c2d8e653750df7052.png" alt="&lt;Figure size 1500x1200 with 23 Axes&gt;"/></div></div></div><h2 id="id-6-umap-with-different-metrics-distances-on-ztf-wise" class="relative group"><span class="heading-text">6. UMAP with different metrics/distances on ZTF+WISE</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6-umap-with-different-metrics-distances-on-ztf-wise" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>DTW takes a bit longer compared to other metrics, so it is commented out in the cell below.</p><div id="anaMrc3n6F" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plt.figure(figsize=(12, 10))
markersize=200

mapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=&#x27;euclidean&#x27;, random_state=20).fit(data)
ax0 = plt.subplot(2, 2, 1)
ax0.set_title(r&#x27;Euclidean Distance, min_d=0.9, n_neighbors=50&#x27;, size=12)
for label, indices in (labc.items()):
     cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,
                      alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
plt.axis(&#x27;off&#x27;)

mapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=&#x27;manhattan&#x27;, random_state=20).fit(data)
ax0 = plt.subplot(2, 2, 2)
ax0.set_title(r&#x27;Manhattan Distance, min_d=0.9, n_neighbors=50&#x27;, size=12)
for label, indices in (labc.items()):
     cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,
                      alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
plt.axis(&#x27;off&#x27;)


# This distance takes long
# mapperg = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=dtw_distance, random_state=20).fit(data)
# ax2 = plt.subplot(2, 2, 3)
# ax2.set_title(r&#x27;DTW Distance, min_d=0.9, n_neighbors=50&#x27;, size=12)
# for label, indices in (labc.items()):
#      cf = ax2.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,
#                       alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
# plt.axis(&#x27;off&#x27;)


mapper = umap.UMAP(n_neighbors=50, min_dist=0.1, metric=&#x27;manhattan&#x27;, random_state=20).fit(data)
ax0 = plt.subplot(2, 2, 4)
ax0.set_title(r&#x27;Manhattan Distance, min_d=0.1, n_neighbors=50&#x27;, size=12)
for label, indices in (labc.items()):
     cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,
                      alpha=0.5, edgecolor=&#x27;gray&#x27;, label=label)
plt.legend(fontsize=12)
plt.axis(&#x27;off&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="XIhvd-_Xb0hEnzLGWUtb6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
</span></code></pre></div></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
</span></code></pre></div></div><div data-name="safe-output-text" class="font-mono text-sm whitespace-pre-wrap myst-jp-safe-output-text"><code><span>(np.float64(-55.54381122589111),
 np.float64(-44.33795986175537),
 np.float64(-8.878481245040893),
 np.float64(7.507222509384155))</span></code></div><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/2ed660a522ceec3497773796a39ee123.png" alt="&lt;Figure size 1200x1000 with 3 Axes&gt;"/></div></div></div><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p><strong>Authors:</strong> Shoubaneh Hemmati (IRSA Research Scientist) and the Fornax team</p></li><li><p><strong>Contact:</strong> For help with this notebook, please open a topic in the <a target="_blank" rel="noreferrer" href="https://discourse.fornax.sciencecloud.nasa.gov/" class="">Fornax Community Forum</a> “Support” category.</p></li></ul><h3 id="acknowledgements" class="relative group"><span class="heading-text">Acknowledgements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acknowledgements" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Parts of this notebook will be presented in Hemmati et al. (in prep)</p></li></ul><h3 id="references" class="relative group"><span class="heading-text">References</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p><a target="_blank" rel="noreferrer" href="https://github.com/JustGlowing/minisom" class=""><code>minisom</code></a></p></li><li><p><a target="_blank" rel="noreferrer" href="https://github.com/lmcinnes/umap" class=""><code>umap</code></a></p></li></ul><div class="myst-backmatter-parts"></div><section id="references" class="myst-bibliography article-grid subgrid-gap col-screen"><div><header class="myst-bibliography-header text-lg font-semibold text-stone-900 dark:text-white group">References<a class="no-underline text-inherit hover:text-inherit ml-2 select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to References" aria-label="Link to References">¶</a></header></div><div class="myst-bibliography-list pl-3 mb-8 text-xs text-stone-500 dark:text-stone-300"><ol><li class="myst-bibliography-item break-words" id="cite-Hammerstein_2022">Hammerstein, E., van Velzen, S., Gezari, S., Cenko, S. B., Yao, Y., Ward, C., Frederick, S., Villanueva, N., Somalwar, J. J., Graham, M. J., Kulkarni, S. R., Stern, D., Andreoni, I., Bellm, E. C., Dekany, R., Dhawan, S., Drake, A. J., Fremling, C., Gatkine, P., … Yan, L. (2022). The Final Season Reimagined: 30 Tidal Disruption Events from the ZTF-I Survey. <i>The Astrophysical Journal</i>, <i>942</i>(1), 9. <a target="_blank" rel="noreferrer" href="https://doi.org/10.3847/1538-4357/aca283">10.3847/1538-4357/aca283</a></li></ol></div></section><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/fornax-demo-notebooks/light-curve-classifier"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Light Curve Classifier</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/fornax-demo-notebooks/spectroscopy"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Spectroscopy</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OYMW4E3D.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/root-CXYA7X5D.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-DATP5P2X.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/routes/$-JRBPULBO.js"/><script>window.__remixContext = {"url":"/ml-agnzoo","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-614971062518da91156f17a119f519ca.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-4cc31726eadc04c560c90703184b963a.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/fornax-demo-notebooks"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-614971062518da91156f17a119f519ca.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-4cc31726eadc04c560c90703184b963a.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"385a2cc6d22589041a5323e91e6791c4b1e87a5fd801af0b228c876e6345c350","slug":"ml-agnzoo","location":"/light_curves/ML_AGNzoo.md","dependencies":[],"frontmatter":{"title":"AGN Zoo: Comparison of AGN selected with different metrics","kernelspec":{"name":"python3","display_name":"py-ml_agnzoo","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.4"}},"content_includes_title":false,"authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","subject":"Fornax Demo Notebooks","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/light_curves/ML_AGNzoo.md","edit_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/light_curves/ML_AGNzoo.md","exports":[{"format":"md","filename":"ML_AGNzoo.md","url":"/fornax-demo-notebooks/build/ML_AGNzoo-f27b8271acd5d33593a7d457a64e7f4a.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"xh1ZHM8TNn"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"OyWhsZLlj6"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"xzN8SzpHdP"}],"key":"gdGLqLUrft"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Work with multi-band lightcurve data","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"tBrdub0PAJ"}],"key":"TLt3ZlHAWJ"}],"key":"H3n9S5Exe7"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Learn high dimensional manifold of light curves with UMAPs and SOMs","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"bIyMjzB7Tk"}],"key":"DJHQ2706ka"}],"key":"l1LwLLuPev"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualize and compare different samples on reduced dimension projections/grids","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ZYdDBKGefN"}],"key":"CQzLuoYqC7"}],"key":"ov2BhvVzft"}],"key":"TTQAlhprFY"},{"type":"heading","depth":2,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"nIaaIByL9I"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"cbDTEV7lLc"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Active Galactic Nuclei (AGNs), some of the most powerful sources in the universe, emit a broad range of electromagnetic radiation, from radio waves to gamma rays. Consequently, there is a wide variety of AGN labels depending on the identification/selection scheme and the presence or absence of certain emissions (e.g., Radio loud/quiet, Quasars, Blazars, Seiferts, Changing looks). According to the unified model, this zoo of labels we see depend on a limited number of parameters, namely the viewing angle, the accretion rate, presence or lack of jets, and perhaps the properties of the host/environment (e.g., ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Mnr8v4bPw7"},{"type":"link","url":"https://arxiv.org/pdf/1707.07134.pdf","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Padovani et al. 2017","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"NNqcMyRlfX"}],"urlSource":"https://arxiv.org/pdf/1707.07134.pdf","key":"xsCogxNkTb"},{"type":"text","value":"). Here, we collect archival photometry and labels from the literature to compare how some of these different labels/selection schemes compare.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"KU1rKPDzsw"}],"key":"onJ1HcTELW"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"We use manifold learning and dimensionality reduction to learn the distribution of AGN lightcurves observed with different facilities. We mostly focus on UMAP (","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"uYWz7BHGLO"},{"type":"link","url":"https://arxiv.org/pdf/1802.03426.pdf","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Uniform Manifold Approximation and Projection, McInnes 2020","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Ws0NSf3avL"}],"urlSource":"https://arxiv.org/pdf/1802.03426.pdf","key":"sshUQbpAK2"},{"type":"text","value":") but also show SOM (","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"K0X9Xr69QC"},{"type":"link","url":"https://ieeexplore.ieee.org/document/58325","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Self organizing Map, Kohonen 1990","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"TKfJIff9ck"}],"urlSource":"https://ieeexplore.ieee.org/document/58325","key":"mrYdrWgSu2"},{"type":"text","value":") examples. The reduced 2D projections from these two unsupervised ML techniques reveal similarities and overlaps of different selection techniques. Coloring the projections with various statistical physical properties (e.g., mean brightness, fractional lightcurve variation) is informative of correlations of the selections technique with physics such as AGN variability. Using different parts of the EM in training (or in building the initial higher dimensional manifold) demonstrates how much information if any is in that part of the data for each labeling scheme, for example whether with ZTF optical light curves alone, we can identify sources with variability in WISE near IR bands. These techniques also have a potential for identifying targets of a specific class or characteristic for future follow up observations.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"PnalRKPQAr"}],"key":"htIKnIvcJ1"},{"type":"heading","depth":3,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Runtime","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"STdLTWPyqA"}],"identifier":"runtime","label":"Runtime","html_id":"runtime","implicit":true,"key":"AsDnSF2u0g"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"As of 2024 September, this notebook takes ~160s to run to completion (after installs and imports) on Fornax using the ‘Astrophysics Default Image’ environment and the ‘Large’ server with 16GB RAM/ 4CPU.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"uIUtXLdLmo"}],"key":"D670FCnG5W"},{"type":"heading","depth":2,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"rpCdvDutlW"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"e6HycX4vSD"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Here are the libraries used in this network. They are also mostly mentioned in the requirements in case you don’t have them installed.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"p2Dciyg181"}],"key":"I3T5pgMKXC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":37,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"sys","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"zFlCVzmtuh"}],"key":"gaPgcpry5Y"},{"type":"text","value":" and ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"GQp5YZtEZj"},{"type":"emphasis","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"os","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"j5Dl7iBU22"}],"key":"wnGTy0IeCx"},{"type":"text","value":" to handle file names, paths, and directories","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"gIIMOkYuTU"}],"key":"aJ1EeNRHlv"}],"key":"jXyqsIhDHL"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"numpy","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"gRTHjpywfb"}],"key":"e9CxkRcZVw"},{"type":"text","value":"  and ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"h1l23IiQiL"},{"type":"emphasis","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"pandas","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"UH3pO2vwsI"}],"key":"T8YXTJdAn5"},{"type":"text","value":" to handle array functions","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"nB2nCKVC1W"}],"key":"n82bISg6Jw"}],"key":"A4EDMVyz0y"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"matplotlib","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"zBptgTXB8O"}],"key":"Cq2DcIUuYD"},{"type":"text","value":" ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"h85zuXuJme"},{"type":"emphasis","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"pyplot","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"Wz7Unqmmp2"}],"key":"MCJURLQvO1"},{"type":"text","value":" and ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"DqZ7s1PAvm"},{"type":"emphasis","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"cm","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"HH7WRw70gW"}],"key":"BgGATC3WGE"},{"type":"text","value":" for plotting data","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"ithVslUyoH"}],"key":"z1sTEFrySy"}],"key":"WyPMHdeitn"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"link","url":"http://astropy.io","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"astropy.io","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"f3ExmwqOQo"}],"urlSource":"http://astropy.io","key":"OiFBPf4ZEr"},{"type":"text","value":" fits","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"Sdn9HBh4m3"}],"key":"KdhPjEplIX"},{"type":"text","value":" for accessing FITS files","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"fOyq1IncGS"}],"key":"NtEeUWa0dW"}],"key":"um09zXCZi9"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"astropy.table Table","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"e2nq32GblT"}],"key":"oPAx4BJuqb"},{"type":"text","value":" for creating tidy tables of the data","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"zgcOrJZRE6"}],"key":"K8HgWuLNG1"}],"key":"VkJ7g6iaji"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"AGNzoo_functions","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"nMglK6DoxB"}],"key":"p9gkfaB0ev"},{"type":"text","value":" for reading in and prepreocessing of lightcurve data","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"ZTTiv8gUeo"}],"key":"nVbTfxgM4O"}],"key":"w8oBLLcrTu"},{"type":"listItem","spread":true,"position":{"start":{"line":43,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"umap","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"lOhxY8pn5v"}],"key":"xPWVTWbXW5"},{"type":"text","value":" and ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"rWdCfIBQyJ"},{"type":"emphasis","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"minisom","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"QjCQhJBlXH"}],"key":"J8WduB4xQn"},{"type":"text","value":" for manifold learning, dimensionality reduction, and visualization","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"LIiHV5ieHP"}],"key":"a6qwEf7jx5"}],"key":"l6bJXgDmWM"}],"key":"R1MR746PZN"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"This cell will install them if needed:","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"vREToct1Dc"}],"key":"z3kXIQPQzr"}],"key":"zUDCFht96r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# %pip install -r requirements_ML_AGNzoo.txt","key":"gs0aK6AIhH"},{"type":"outputs","id":"iXyc6JvSJO7kjFrAJfBfq","children":[],"key":"G1PCiXIccG"}],"key":"FATzrTliq7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import sys\n\nimport astropy.units as u\nfrom astropy.table import Table\nimport matplotlib.pyplot as plt\nfrom matplotlib.colors import LinearSegmentedColormap\nimport matplotlib.gridspec as gridspec\n\nfrom mpl_toolkits.axes_grid1 import make_axes_locatable\n\nimport numpy as np\nimport pandas as pd\nsys.path.append('code_src/')\nfrom AGNzoo_functions import (unify_lc, unify_lc_gp, stat_bands, autopct_format, combine_bands,\n                      normalize_clipmax_objects, shuffle_datalabel, dtw_distance,\n                      stretch_small_values_arctan, translate_bitwise_sum_to_labels, update_bitsums)\nfrom collections import Counter, defaultdict\n\nimport umap\nfrom minisom import MiniSom\n\nimport logging\n\n# Get the root logger\nlogger = logging.getLogger()\nlogger.setLevel(logging.WARNING)\n\nplt.style.use('bmh')\ncolors = [\n    \"#3F51B5\",  # Ultramarine Blue\n    \"#003153\",  # Prussian Blue\n    \"#0047AB\",  # Cobalt Blue\n    \"#40826D\",  # Viridian Green\n    \"#50C878\",  # Emerald Green\n    \"#FFEA00\",  # Chrome Yellow\n    \"#CC7722\",  # Yellow Ochre\n    \"#E34234\",  # Vermilion\n    \"#E30022\",  # Cadmium Red\n    \"#D68A59\",  # Raw Sienna\n    \"#8A360F\",  # Burnt Sienna\n    \"#826644\",  # Raw Umber\n]\n\ncustom_cmap = LinearSegmentedColormap.from_list(\"custom_theme\", colors[1:])","key":"JwKhrrN1UY"},{"type":"outputs","id":"VqN_smHrP86zRINxs-_bZ","children":[],"key":"M8YCrMZOBo"}],"key":"TY5GHC2bTY"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"1. Loading data","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"aGxU0cHvKT"}],"identifier":"id-1-loading-data","label":"1. Loading data","html_id":"id-1-loading-data","implicit":true,"key":"Wt2YwdtTJP"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"Here we load a parquet file of light curves generated using the light_curve_collector notebook in this same GitHub repo. With that light_curve_collector notebook, you can build your favorite sample from different sources in the literature and grab the data from archives of interest. This sample contains both spatial coordinates and categorical labels for each AGN. The labels are generated by a bitwise addition of a set of binary indicators. Each binary indicator corresponds to the AGN’s membership in various categories, such as being an SDSS_QSO or a WISE_Variable. For example, an AGN that is both an SDSS_QSO, a WISE_Variable, and also shows ‘Turn_on’ characteristics, would have a label calculated by combining these specific binary indicators using bitwise addition.","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"e36XlF9w64"}],"key":"GQpCTJULli"}],"key":"LfyTxlo7Ny"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%bash\n\n# To download the data file containing the light curves from Googledrive\ngdown 1gb2vWn0V2unstElGTTrHIIWIftHbXJvz -O ./data/df_lc_020724.parquet.gzip","key":"efwnPgQhMF"},{"type":"outputs","id":"yDNMV1MrcNiB50bTCIMoW","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"Downloading...\nFrom (original): https://drive.google.com/uc?id=1gb2vWn0V2unstElGTTrHIIWIftHbXJvz\nFro"},"key":"YKH83WXt1a"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"m (redirected): https://drive.google.com/uc?id=1gb2vWn0V2unstElGTTrHIIWIftHbXJvz\u0026confirm=t\u0026uuid=3643"},"key":"VQ9i4mRSXl"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"1fa1-762c-4772-9ccd-7172ce64bd1e\nTo: /home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/l"},"key":"j3q9vGRWqX"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"ight_curves/data/df_lc_020724.parquet.gzip\n"},"key":"uQtvZI77j2"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r  0%|          | 0.00/243M [00:00\u003c?, ?B/s]"},"key":"gqHxaGTDuo"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r  2%|▏         | 5.24M/243M [00:00\u003c00:04, 50.1MB/s]"},"key":"DlH27SFLq9"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r  5%|▌         | 13.1M/243M [00:00\u003c00:03, 65.7MB/s]"},"key":"zGYp2SXjDv"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 12%|█▏        | 28.3M/243M [00:00\u003c00:02, 104MB/s] "},"key":"K5pGcAADpr"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 19%|█▊        | 45.6M/243M [00:00\u003c00:01, 127MB/s]"},"key":"eA6lvWoIym"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 27%|██▋       | 65.0M/243M [00:00\u003c00:01, 150MB/s]"},"key":"HnQPLOXFb5"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 33%|███▎      | 80.2M/243M [00:00\u003c00:01, 119MB/s]"},"key":"IOgdtHWW6S"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 40%|████      | 98.0M/243M [00:00\u003c00:01, 135MB/s]"},"key":"F3ndU596Iy"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 47%|████▋     | 114M/243M [00:00\u003c00:00, 137MB/s] "},"key":"szZSCkZDhU"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 54%|█████▍    | 133M/243M [00:01\u003c00:00, 151MB/s]"},"key":"OOv1Ns4rs0"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 62%|██████▏   | 152M/243M [00:01\u003c00:00, 161MB/s]"},"key":"GSsZq2pw48"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 70%|███████   | 171M/243M [00:01\u003c00:00, 168MB/s]"},"key":"XXQXADE5Mr"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 77%|███████▋  | 188M/243M [00:01\u003c00:00, 167MB/s]"},"key":"Od8l7PURBk"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 84%|████████▍ | 206M/243M [00:01\u003c00:00, 93.1MB/s]"},"key":"Ta4jmweGTj"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 90%|█████████ | 219M/243M [00:01\u003c00:00, 98.3MB/s]"},"key":"FCJFGooAXi"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r 95%|█████████▌| 232M/243M [00:02\u003c00:00, 69.4MB/s]"},"key":"HIXHIqSoX5"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r100%|█████████▉| 243M/243M [00:02\u003c00:00, 65.5MB/s]"},"key":"gFKJefBhWp"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\r100%|██████████| 243M/243M [00:02\u003c00:00, 103MB/s] "},"key":"x3K7ZjgJtG"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"\n"},"key":"AgZNFiVJWh"}],"key":"BVGi9vwvEK"}],"key":"oAXgZcdyrf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_lc = pd.read_parquet('data/df_lc_020724.parquet.gzip')\n\n# remove 64 for SPIDER only as its too large compared to the rest of the labels\ndf_lc = df_lc[df_lc.index.get_level_values('label') != '64']\n# remove all bitwise sums that had 64 in them\ndf_lc = update_bitsums(df_lc)","key":"tGNTRYsnv0"},{"type":"outputs","id":"G6SBxTpl-0iVz--L0KZnU","children":[],"key":"zM1uCE8y33"}],"key":"EL5zKIXLrB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_lc","key":"XbeHmgdmCP"},{"type":"outputs","id":"c64-_1VN3qMDkl3jbO5AG","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"                                        flux  err\nobjectid label band       time                   \n133      1     FERMIGTRIG 57818.586891  0.10  0.1\n661      1     FERMIGTRIG 57701.261458  0.10  0.1\n8238     16    SAXGRBMGRB 50953.800208  0.10  0.1\n8137     32    SAXGRBMGRB 50335.861597  0.10  0.1\n507      1     SAXGRBMGRB 50335.861597  0.10  0.1\n...                                      ...  ...\n8305     2048  IceCube    57324.871275  3.64  0.0\n                          56387.615469  3.58  0.0\n8306     2048  IceCube    55202.077308  4.52  0.0\n                          55047.819638  4.06  0.0\n                          54908.220026  3.87  0.0\n\n[2036242 rows x 2 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eflux\u003c/th\u003e\n      \u003cth\u003eerr\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eobjectid\u003c/th\u003e\n      \u003cth\u003elabel\u003c/th\u003e\n      \u003cth\u003eband\u003c/th\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e133\u003c/th\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003cth\u003eFERMIGTRIG\u003c/th\u003e\n      \u003cth\u003e57818.586891\u003c/th\u003e\n      \u003ctd\u003e0.10\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e661\u003c/th\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003cth\u003eFERMIGTRIG\u003c/th\u003e\n      \u003cth\u003e57701.261458\u003c/th\u003e\n      \u003ctd\u003e0.10\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e8238\u003c/th\u003e\n      \u003cth\u003e16\u003c/th\u003e\n      \u003cth\u003eSAXGRBMGRB\u003c/th\u003e\n      \u003cth\u003e50953.800208\u003c/th\u003e\n      \u003ctd\u003e0.10\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e8137\u003c/th\u003e\n      \u003cth\u003e32\u003c/th\u003e\n      \u003cth\u003eSAXGRBMGRB\u003c/th\u003e\n      \u003cth\u003e50335.861597\u003c/th\u003e\n      \u003ctd\u003e0.10\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e507\u003c/th\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003cth\u003eSAXGRBMGRB\u003c/th\u003e\n      \u003cth\u003e50335.861597\u003c/th\u003e\n      \u003ctd\u003e0.10\u003c/td\u003e\n      \u003ctd\u003e0.1\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e8305\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e2048\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003eIceCube\u003c/th\u003e\n      \u003cth\u003e57324.871275\u003c/th\u003e\n      \u003ctd\u003e3.64\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e56387.615469\u003c/th\u003e\n      \u003ctd\u003e3.58\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"3\" valign=\"top\"\u003e8306\u003c/th\u003e\n      \u003cth rowspan=\"3\" valign=\"top\"\u003e2048\u003c/th\u003e\n      \u003cth rowspan=\"3\" valign=\"top\"\u003eIceCube\u003c/th\u003e\n      \u003cth\u003e55202.077308\u003c/th\u003e\n      \u003ctd\u003e4.52\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e55047.819638\u003c/th\u003e\n      \u003ctd\u003e4.06\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e54908.220026\u003c/th\u003e\n      \u003ctd\u003e3.87\u003c/td\u003e\n      \u003ctd\u003e0.0\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e2036242 rows × 2 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}},"key":"tSX99sFGry"}],"key":"xjbTVV2Zf3"}],"key":"RGJD6ACWyS"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"1.1 What is in this sample","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"MuWO5dKtlF"}],"identifier":"id-1-1-what-is-in-this-sample","label":"1.1 What is in this sample","html_id":"id-1-1-what-is-in-this-sample","implicit":true,"key":"kVgkrRDvvf"},{"type":"paragraph","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"To effectively undertake machine learning (ML) in addressing a specific question, it’s imperative to have a clear understanding of the data we’ll be utilizing. This understanding aids in selecting the appropriate ML approach and, critically, allows for informed and necessary data preprocessing. For example whether a normalization is needed, and what band to choose for normalization.","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"OHORiKkN3J"}],"key":"rM55bvRuLa"}],"key":"UZzSLj2cH1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"objid = df_lc.index.get_level_values('objectid')[:].unique()\nseen = Counter()\n\nfor (objectid, label), singleobj in df_lc.groupby(level=[\"objectid\", \"label\"]):\n    bitwise_sum = int(label)\n    active_labels = translate_bitwise_sum_to_labels(bitwise_sum)\n    seen.update(active_labels)\n# changing order of labels in dictionary only for text to be readable on the plot\nkey_order = ('SDSS_QSO', 'SPIDER_AGN', 'SPIDER_BL', 'SPIDER_QSOBL', 'SPIDER_AGNBL',\n             'WISE_Variable', 'Optical_Variable', 'Galex_Variable', 'Turn-on', 'Turn-off', 'TDE')\nnew_queue = {}\nfor k in key_order:\n    new_queue[k] = seen[k]\n\nplt.figure(figsize=(8, 8))\nplt.title(r'Sample consists of:', size=15)\nh = plt.pie(new_queue.values(), labels=new_queue.keys(), autopct=autopct_format(new_queue.values()),\n            textprops={'fontsize': 15}, startangle=30, labeldistance=1.1,\n            wedgeprops={'linewidth': 3, 'edgecolor': 'white'}, colors=colors)","key":"cERDJfotDU"},{"type":"outputs","id":"JOdQ5uH2wTvd7kWUnqjlM","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 800x800 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c5fa3835d9e556b755a95847cda014f0","path":"/fornax-demo-notebooks/build/c5fa3835d9e556b755a95847cda014f0.png"}}},"key":"vk28sHfmBM"}],"key":"urCYIEIGNu"}],"key":"dgsPVz0YwY"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":149,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"In this particular example, the largest subsamples of AGNs, all with a criteria on redshift (z\u003c1), are from the optical spectra by the ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"SQ0vZgqd6T"},{"type":"link","url":"https://www.sdss4.org/dr17/algorithms/qso_catalog/","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"SDSS quasar sample DR16Q","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"rJqiHXwvlj"}],"urlSource":"https://www.sdss4.org/dr17/algorithms/qso_catalog/","key":"veKifTyVt5"},{"type":"text","value":", the value added SDSS spectra from ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"pqGD3jGXoa"},{"type":"link","url":"https://www.sdss.org/dr18/bhm/programs/spiders/","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"SPIDERS","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"tRZh10ir8C"}],"urlSource":"https://www.sdss.org/dr18/bhm/programs/spiders/","key":"TeSCccSass"},{"type":"text","value":", and a subset of AGNs selected in MIR WISE bands based on their variability (","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"lTFdyhacd9"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2019AAS...23333004P/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"csv in data folder credit RChary","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"XD6lbZbua4"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2019AAS...23333004P/abstract","key":"RadTmPwNLi"},{"type":"text","value":").\nWe also include some smaller samples from the literature to see where they sit compared to the rest of the population and if they are localized on the 2D projection.\nThese include the Changing Look AGNs from the literature (e.g., ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"W4urt1xfIC"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2015ApJ...800..144L/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"LaMassa et al. 2015","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"HObft5Lfjr"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2015ApJ...800..144L/abstract","key":"arJ2v0s2Cc"},{"type":"text","value":", ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"oyIjiLERqT"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2022ApJ...927..227L/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"Lyu et al. 2022","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"wfaLbIlLe1"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2022ApJ...927..227L/abstract","key":"AnWQTv8zGF"},{"type":"text","value":", ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"kkgzPxBOkT"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2022MNRAS.511...54H/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"Hon et al. 2022","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"VWfXtQCNgz"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2022MNRAS.511...54H/abstract","key":"kyxdzFfFsk"},{"type":"text","value":"), a sample which showed variability in Galex UV images (","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"TssaMde6qd"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2022ApJ...933...37W/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"Wasleske et al. 2022","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"b2VWfepo82"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2022ApJ...933...37W/abstract","key":"bz0defWunc"},{"type":"text","value":"), a sample of variable sources identified in optical Palomar observations (","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"bahaZB5Ypl"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2020ApJ...896...10B/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"Baldassare et al. 2020","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"KvNGyOjVHo"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2020ApJ...896...10B/abstract","key":"J7SEgJ7Gsn"},{"type":"text","value":"), and the optically variable AGNs in the COSMOS field from a three year program on the VLT(","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"xunevNCGBj"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2019A%26A...627A..33D/abstract","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"De Cicco et al. 2019","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"mfw96r1mh4"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2019A%26A...627A..33D/abstract","key":"iRSaHq3XW3"},{"type":"text","value":").\nWe also include 30 Tidal Disruption Event coordinates identified from ZTF light curves ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"EoQKjJ7Q3S"},{"type":"cite","kind":"narrative","label":"Hammerstein_2022","identifier":"doi.org/10.3847/1538-4357/aca283","children":[{"type":"text","value":"Hammerstein ","key":"iblYLa3ySS"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"dYjgCh8mQB"}],"key":"uSEmY64k2h"},{"type":"text","value":" (2022)","key":"bIP4eRReWH"}],"enumerator":"1","key":"lF0pZEbNA8"},{"type":"text","value":".","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"mzhM3BA3fi"}],"key":"wdaWs9FAtc"}],"key":"IWFPiDIoc4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"seen = Counter()\nseen = df_lc.reset_index().groupby('band').objectid.nunique().to_dict()\n\nplt.figure(figsize=(20, 4))\nplt.title(r'Number of lightcurves in each waveband in this sample:', size=20)\nh = plt.bar(seen.keys(), seen.values())\nplt.ylabel(r'#', size=20)","key":"CxryZnjzdc"},{"type":"outputs","id":"D9TWYbFPfNqhHCqZUdD-k","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 2000x400 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7b64d5ebd782debf2a8d38e42ac9b755","path":"/fornax-demo-notebooks/build/7b64d5ebd782debf2a8d38e42ac9b755.png"}}},"key":"iUVCeh9uqK"}],"key":"SEUjNAj5yp"}],"key":"gmQycU47EJ"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"The histogram shows the number of lightcurves which ended up in the multi-index data frame from each of the archive calls in different wavebands/filters.","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"gp8RoFOF4j"}],"key":"a1MgIMmqAd"}],"key":"XHlPnApg90"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cadence = dict((el, []) for el in seen.keys())\ntimerange = dict((el, []) for el in seen.keys())\n\nfor (_, band), times in df_lc.reset_index().groupby([\"objectid\", \"band\"]).time:\n    cadence[band].append(len(times))\n    if times.max() - times.min() \u003e 0:\n        timerange[band].append(np.round(times.max() - times.min(), 1))\n\nplt.figure(figsize=(20, 4))\nplt.title(r'Time range and cadence covered in each in each waveband averaged over this sample:')\nfor el in cadence.keys():\n    plt.scatter(np.mean(timerange[el]), np.mean(cadence[el]), label=el, s=len(timerange[el]))\n    plt.errorbar(np.mean(timerange[el]), np.mean(cadence[el]),\n                 xerr=np.std(timerange[el]), yerr=np.std(cadence[el]), alpha=0.2)\n    plt.annotate(el, (np.mean(timerange[el]), np.mean(cadence[el])+2), size=12, rotation=40)\nplt.ylabel(r'Average number of visits', size=20)\nplt.xlabel(r'Average baseline (days)', size=20)\nplt.xlim([0, 4000])\nplt.yscale('log')","key":"KTW5F14Fni"},{"type":"outputs","id":"_N-QccM338tFJLmPBV-K6","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/fromnumeric.py:3860: RuntimeWarning: Mean of empty slice.\n  return _methods._mean(a, axis=axis, dtype=dtype,\n/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:145: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\n/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:223: RuntimeWarning: Degrees of freedom \u003c= 0 for slice\n  ret = _var(a, axis=axis, dtype=dtype, out=out, ddof=ddof,\n/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:181: RuntimeWarning: invalid value encountered in divide\n  arrmean = um.true_divide(arrmean, div, out=arrmean,\n/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/numpy/_core/_methods.py:215: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\n"},"key":"PlFrdAhpxr"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 2000x400 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d828b068b9a678864f4f535b5c2273e4","path":"/fornax-demo-notebooks/build/d828b068b9a678864f4f535b5c2273e4.png"}}},"key":"yFv1TCZtrd"}],"key":"DlfTvcrgn9"}],"key":"gryzFcghJJ"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"While from the histogram plot we see which bands have the highest number of observed lightcurves, what might matter more in finding/selecting variability or changing look in lightcurves is the cadence and the average baseline of observations. For instance, Panstarrs has a large number of lightcurve detections in our sample, but from the figure above we see that the average number of visits and the baseline for those observations are considerably less than ZTF. WISE also shows the longest baseline of observations which is suitable to finding longer term variability in objects.","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"OpYZCYODtH"}],"key":"unk7mzr0Fp"},{"type":"heading","depth":2,"position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"children":[{"type":"text","value":"2. Preprocess data for ML (ZTF bands)","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"z9izaIf7Gk"}],"identifier":"id-2-preprocess-data-for-ml-ztf-bands","label":"2. Preprocess data for ML (ZTF bands)","html_id":"id-2-preprocess-data-for-ml-ztf-bands","implicit":true,"key":"iFlNNuIwaD"},{"type":"paragraph","position":{"start":{"line":193,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"We first look at this sample only in ZTF bands which have the largest number of visits. We start by unifying the time grid of the light curves so oobjects with different start time or number of observations can be compared. We do this by interpolation to a new grid. The choice of the grid resolution and baseline is strictly dependent on the input data, in this case ZTF, to preserve as much as possible all the information from the observations.\nThe unify_lc, or unify_lc_gp functions do the unification of the lightcurve arrays. For details please see the codes. The time arrays are chosen based on the average duration of observations, with ZTF and WISE covering 1600, 4000 days respectively. We note that we disregard the time of observation of each source, by subtracting the initial time from the array and bringing all lightcurves to the same footing. This has to be taken into account if it influences the science of interest. We then interoplate the time arrays with linear or Gaussian Process regression (unift_lc/ unify_lc_gp respectively). We also remove from the sample objects with less than 5 datapoints in their light curve. We measure basic statistics and combine the tree observed ZTF bands into one longer array as input to dimensionailty reduction after deciding on normalization. We also do a shuffling of the sample to be sure that the separations of different classes by ML are not simply due to the order they are seen in training (in case it is not done by the ML routine itself).","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"GNtAvUaoZM"}],"key":"rVrK9enmqq"}],"key":"cZxfWGTKsO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bands_inlc = ['zg', 'zr', 'zi']\n\n# nearest neighbor linear interpolation:\nobjects, dobjects, flabels, keeps = unify_lc(df_lc, bands_inlc, xres=60, numplots=5,\n                                             low_limit_size=5)\n\n# Gaussian process unification\n# objects, dobjects, flabels, keeps = unify_lc_gp(df_lc, bands_inlc, xres=60, numplots=5,\n#                                                 low_limit_size=5)\n\n# keeps can be used as index of objects that are kept in \"objects\" from the initial \"df_lc\",\n# in case information about some properties of sample (e.g., redshifts) is of interest\n# this array of indecies would be helpful\n\n# calculate some basic statistics with a sigmaclipping with width 5sigma\nfvar, maxarray, meanarray = stat_bands(objects, dobjects, bands_inlc, sigmacl=5)\n\n# combine different waveband into one array\ndat_notnormal = combine_bands(objects, bands_inlc)\n\n# Normalize the combinde array by maximum of brightness in a waveband after clipping outliers:\ndat = normalize_clipmax_objects(dat_notnormal, maxarray, band=1)\n\n# Normalize the combinde array by mean brightness in a waveband after clipping outliers:\ndatm = normalize_clipmax_objects(dat_notnormal, meanarray, band=1)\n\n# shuffle data incase the ML routines are sensitive to order\ndata, fzr, p = shuffle_datalabel(dat, flabels)\nfvar_arr, maximum_arr, average_arr = fvar[:, p], maxarray[:, p], meanarray[:, p]\n\n# Initialize labc to hold indices of each unique label\nlabc = {}\nfor index, f in enumerate(fzr):\n    lab = translate_bitwise_sum_to_labels(int(f))\n    for label in lab:\n        if label not in labc:\n            # Initialize the list for this label if it's not already in labc\n            labc[label] = []\n        # Append the current index to the list of indices for this label\n        labc[label].append(index)","key":"qJTN5seokj"},{"type":"outputs","id":"sxqcqlQ7JogYgU88TfuFC","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"0it [00:00, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"f55e2175a82a4fa3a9ca6ebfed5f2b0e\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"CRE73VgF7l"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ba4aa3c1e18265db5e8d93c1b1f0e5a2","path":"/fornax-demo-notebooks/build/ba4aa3c1e18265db5e8d93c1b1f0e5a2.png"}}},"key":"jA5BLedxFG"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0440a7d0fd4b012799f9b78b91b32d15","path":"/fornax-demo-notebooks/build/0440a7d0fd4b012799f9b78b91b32d15.png"}}},"key":"TRchMiXC0i"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c5a838866d6b69aa15b1377d32c5e65c","path":"/fornax-demo-notebooks/build/c5a838866d6b69aa15b1377d32c5e65c.png"}}},"key":"LAhQK8frR7"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6f9116f88eeda6353dd3092644fddd18","path":"/fornax-demo-notebooks/build/6f9116f88eeda6353dd3092644fddd18.png"}}},"key":"ZyxlF6H4Yk"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"08461971302ef20edd1cec1589958b7f","path":"/fornax-demo-notebooks/build/08461971302ef20edd1cec1589958b7f.png"}}},"key":"ZHBV0xcmux"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/code_src/AGNzoo_functions.py:290: RuntimeWarning: invalid value encountered in sqrt\n  fvar = (np.sqrt(varf - deltaf)) / meanf\n"},"key":"qH7IUPshmG"}],"key":"drouVkDX1p"}],"key":"Q0sRaKY1rt"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"The combination of the tree bands into one longer arrays in order of increasing wavelength, can be seen as providing both the SED shape as well as variability in each from the light curve. Figure below demonstrates this as well as our normalization choice. We normalize the data in ZTF R band as it has a higher average numbe of visits compared to G and I band. We remove outliers before measuring the mean and max of the light curve and normalizing by it. This normalization can be skipped if one is mearly interested in comparing brightnesses of the data in this sample, but as dependence on flux is strong to look for variability and compare shapes of light curves a normalization helps.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"FKSCkHjvBF"}],"key":"R94w5J7aEh"}],"key":"k8QkQvWBCP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"r = np.random.randint(np.shape(dat)[1])\n\n_, axs = plt.subplots(1, 3, figsize=(18, 4))\nztf_data = [dat_notnormal, dat, datm]\nylabels = [r'Flux ($\\mu Jy$)', r'Normalized Flux (max r band)', r'Normalized Flux (mean r band)']\nfig_contents = list(zip(axs, ztf_data, ylabels))\n\nfor i, l in enumerate(bands_inlc):\n    s = int(np.shape(dat)[1]/len(bands_inlc))\n    first = int(i*s)\n    last = first+s\n    for ax, ydata, ylabel in fig_contents:\n        ax.plot(np.linspace(first, last, s), ydata[r, first:last], 'o', linestyle='--', label=l)\n        ax.set_xlabel(r'Time_[w1, w2, w3]', size=15)\n        ax.set_ylabel(ylabel, size=15)\n_ = axs[0].legend(loc=2)","key":"IggPNCDVCN"},{"type":"outputs","id":"iILphDA4Gsuhq3rX_nRQx","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1800x400 with 3 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1818d99f744a8463d7bf4d7cf3955a5e","path":"/fornax-demo-notebooks/build/1818d99f744a8463d7bf4d7cf3955a5e.png"}}},"key":"zsKqVFjNiv"}],"key":"rgWApMsP60"}],"key":"wAzjwJ3fKS"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"3. Learn the Manifold","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"QNCTUK17PN"}],"identifier":"id-3-learn-the-manifold","label":"3. Learn the Manifold","html_id":"id-3-learn-the-manifold","implicit":true,"key":"QrbunxuFOb"},{"type":"paragraph","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"Now we can train a UMAP with the processed data vectors above. Different choices for the number of neighbors, minimum distance and metric can be made and a parameter space can be explored. We show here our preferred combination given this data. We choose manhattan distance (also called ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"m2ckYaaQVh"},{"type":"link","url":"https://en.wikipedia.org/wiki/Taxicab_geometry","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"the L1 distance","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"HxLMsWnYzn"}],"urlSource":"https://en.wikipedia.org/wiki/Taxicab_geometry","data":{"page":"Taxicab_geometry","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"DZT0qCpyQR"},{"type":"text","value":") as it is optimal for the kind of grid we interpolated on, for instance we want the distance to not change if there are observations missing. Another metric appropriate for our purpose in time domain analysis is Dynamic Time Warping (","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"HLNwA8C8Tn"},{"type":"link","url":"https://en.wikipedia.org/wiki/Dynamic_time_warping","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"DTW","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"o9ie9b1Y1D"}],"urlSource":"https://en.wikipedia.org/wiki/Dynamic_time_warping","data":{"page":"Dynamic_time_warping","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"vzAue151r3"},{"type":"text","value":"), which is insensitive to a shift in time. This is helpful as we interpolate the observations onto a grid starting from time 0 and when discussing variability we care less about when it happens and more about whether and how strong it happened. As the measurement of the DTW distance takes longer compared to the other metrics we show examples here with manhattan and only show one example exploring the parameter space including a DTW metric in the last cell of this notebook.","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"bryKm1pltV"}],"key":"zqZMnA2IP9"}],"key":"RC5KYlOgfc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(18, 6))\nmarkersize=200\nmapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric='manhattan', random_state=20).fit(data)\n\n\nax1 = plt.subplot(1, 3, 2)\nax1.set_title(r'mean brightness', size=20)\ncf = ax1.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,\n                 c=np.log10(np.nansum(meanarray, axis=0)), edgecolor='gray')\nplt.axis('off')\ndivider = make_axes_locatable(ax1)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\n\nax0 = plt.subplot(1, 3, 3)\nax0.set_title(r'mean fractional variation', size=20)\ncf = ax0.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,\n                 c=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=3),\n                 edgecolor='gray')\nplt.axis('off')\ndivider = make_axes_locatable(ax0)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\nax2 = plt.subplot(1, 3, 1)\nax2.set_title('sample origin', size=20)\ncounts = 1\nfor label, indices in labc.items():\n    cf = ax2.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=markersize,\n                     c=colors[counts], alpha=0.5, edgecolor='gray', label=label)\n    counts += 1\nplt.legend(fontsize=12)\n#plt.colorbar(cf)\nplt.axis('off')\n\nplt.tight_layout()\n#plt.savefig('umap-ztf.png')","key":"oOqBpqTBWE"},{"type":"outputs","id":"L7FM0UwrknfO2lQPtHu3P","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n  warn(\n"},"key":"mt9atun69Q"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1800x600 with 5 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"32897f1024d1adc147c17e1038b73494","path":"/fornax-demo-notebooks/build/32897f1024d1adc147c17e1038b73494.png"}}},"key":"rYTxcllMgj"}],"key":"Qt1pXYy3Su"}],"key":"zKr0FGWsVX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"The left panel is colorcoded by the origin of the sample. The middle panel shows the sum of mean brightnesses in three bands (arbitrary unit) demonstrating that after normalization we see no correlation with brightness. The panel on the right is color coded by a statistical measure of variability (i.e. the fractional variation ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"Mg2yeq5uw0"},{"type":"link","url":"https://ned.ipac.caltech.edu/level5/Sept01/Peterson2/Peter2_1.html","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"see here","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"ZFb88z2R7y"}],"urlSource":"https://ned.ipac.caltech.edu/level5/Sept01/Peterson2/Peter2_1.html","key":"Qkf78hx64D"},{"type":"text","value":"). As with the plotting above it is not easy to see all the data points and correlations in the next two cells measure probability of belonging to each original sample as well as the mean statistical property on an interpolated grid on this reduced 2D projected surface.","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"s0nTG6vIjl"}],"key":"Cy5TxfQFMf"}],"key":"XYvvCxSKTf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define a grid\ngrid_resolution = 15# Number of cells in the grid\nx_min, x_max = mapper.embedding_[:, 0].min(), mapper.embedding_[:, 0].max()\ny_min, y_max = mapper.embedding_[:, 1].min(), mapper.embedding_[:, 1].max()\nx_grid = np.linspace(x_min, x_max, grid_resolution)\ny_grid = np.linspace(y_min, y_max, grid_resolution)\nx_centers, y_centers = np.meshgrid(x_grid, y_grid)\n\n# Calculate mean property in each grid cell\nmean_property1, mean_property2 = np.zeros_like(x_centers), np.zeros_like(x_centers)\npropmean=stretch_small_values_arctan(np.nansum(meanarray, axis=0), factor=2)\npropfvar=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=2)\nfor i in range(grid_resolution - 1):\n    for j in range(grid_resolution - 1):\n        mask = (\n            (mapper.embedding_[:, 0] \u003e= x_grid[i]) \u0026\n            (mapper.embedding_[:, 0] \u003c x_grid[i + 1]) \u0026\n            (mapper.embedding_[:, 1] \u003e= y_grid[j]) \u0026\n            (mapper.embedding_[:, 1] \u003c y_grid[j + 1])\n        )\n        if np.sum(mask) \u003e 0:\n            mean_property1[j, i] = np.mean(propmean[mask])\n            mean_property2[j, i] = np.mean(propfvar[mask])\n\n\nplt.figure(figsize=(12, 4))\nplt.subplot(1, 2, 1)\nplt.title('mean brightness')\ncf = plt.contourf(x_centers, y_centers, mean_property1, cmap='viridis', alpha=0.9)\nplt.axis('off')\ndivider = make_axes_locatable(plt.gca())\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\nplt.subplot(1, 2, 2)\nplt.title('mean fractional variation')\ncf = plt.contourf(x_centers, y_centers, mean_property2, cmap='viridis', alpha=0.9)\nplt.axis('off')\ndivider = make_axes_locatable(plt.gca())\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)","key":"Y9LIV3YAa7"},{"type":"outputs","id":"xtiprvu0IkGKRftRLhd13","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x400 with 4 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"df884bfebcc06d2637a996695ec64315","path":"/fornax-demo-notebooks/build/df884bfebcc06d2637a996695ec64315.png"}}},"key":"MkWoSYAgGT"}],"key":"zD8ijwkKC0"}],"key":"ed4xH8rDwi"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"3.1 Sample comparison on the UMAP","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"ifUnjWDK27"}],"identifier":"id-3-1-sample-comparison-on-the-umap","label":"3.1 Sample comparison on the UMAP","html_id":"id-3-1-sample-comparison-on-the-umap","implicit":true,"key":"JYwuptb6Tr"}],"key":"Am8pUH4If5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate 2D histogram\nhist, x_edges, y_edges = np.histogram2d(mapper.embedding_[:, 0], mapper.embedding_[:, 1], bins=12)\nplt.figure(figsize=(15, 12))\ni=1\nax0 = plt.subplot(4, 4, 12)\nfor label, indices in sorted(labc.items()):\n    hist_per_cluster, _, _ = np.histogram2d(mapper.embedding_[indices, 0],\n                                            mapper.embedding_[indices, 1],\n                                            bins=(x_edges, y_edges))\n    prob = hist_per_cluster / hist\n    plt.subplot(4, 4, i)\n    plt.title(label)\n    plt.contourf(x_edges[:-1], y_edges[:-1], prob.T, levels=20, alpha=0.8, cmap=custom_cmap)\n    plt.colorbar()\n    plt.axis('off')\n    cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,\n                     alpha=0.5, edgecolor='gray', label=label, c=colors[i-1])\n    i += 1\nax0.legend(loc=4, fontsize=7)\nax0.axis('off')\nplt.tight_layout()","key":"T8CvNmXmXK"},{"type":"outputs","id":"5s6gNQlmWLBr3830Pstny","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3476/3793995111.py:10: RuntimeWarning: invalid value encountered in divide\n  prob = hist_per_cluster / hist\n"},"key":"JKViFLxPki"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x1200 with 23 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5c21af46449629da52214dd34330ea3d","path":"/fornax-demo-notebooks/build/5c21af46449629da52214dd34330ea3d.png"}}},"key":"cd6aGo0YmU"}],"key":"aJqyAss9gQ"}],"key":"HWw4uDTcgc"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"children":[{"type":"text","value":"Figure above shows how with ZTF light curves alone we can separate some of these AGN samples, where they have overlaps. We can do a similar exercise with other dimensionality reduction techniques. Below we show two SOMs one with normalized and another with no normalization. The advantage of Umaps to SOMs is that in practice you may change the parameters to separate classes of vastly different data points, as distance is preserved on a umap. On a SOM however only topology of higher dimensions is preserved and not distance hence, the change on the 2d grid does not need to be smooth and from one cell to next there might be larg jumps. On the other hand, an advantage of the SOM is that by definition it has a grid and no need for a posterior interpolation (as we did above) is needed to map more data or to measure probabilities, etc.","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"EhYgBT8yTp"}],"key":"gmXMwwPgQQ"},{"type":"heading","depth":3,"position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"3.2 Reduced dimensions on a SOM grid","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"IAFbIBTv58"}],"identifier":"id-3-2-reduced-dimensions-on-a-som-grid","label":"3.2 Reduced dimensions on a SOM grid","html_id":"id-3-2-reduced-dimensions-on-a-som-grid","implicit":true,"key":"O14ibACvQB"}],"key":"XWprED2k85"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initialization and training\nmsz0, msz1 = 15, 15\nsom = MiniSom(msz0, msz1, data.shape[1], sigma=1.5, learning_rate=.5,\n              neighborhood_function='gaussian', random_seed=0, topology='rectangular')\n\nsom.pca_weights_init(data)\nsom.train(data, 100000, verbose=False)  # random training","key":"wshahgmQz8"},{"type":"outputs","id":"sYo9GRUbCXwxhXI18mQ7-","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/minisom.py:447: ComplexWarning: Casting complex values to real discards the imaginary part\n  self._weights[i, j] = c1*pc[pc_order[0]] + \\\n"},"key":"Q7S7imRB3S"}],"key":"yMOpRHNlyJ"}],"key":"k5ytuUk6zw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"laborder = ['SDSS_QSO', 'SPIDER_AGN', 'SPIDER_BL', 'SPIDER_QSOBL', 'SPIDER_AGNBL',\n            'WISE_Variable', 'Optical_Variable', 'Galex_Variable', 'Turn-on', 'Turn-off', 'TDE']\n\n\n# Create grid to hold mean fvar per SOM node\nmean_fvar_map = np.full((msz0, msz1), np.nan)\n\n# Create helper to accumulate fvar values in each cell\ncell_fvar = defaultdict(list)\n\n# First, map each data point to its BMU and store its fvar\npropfvar=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=2)\nfor i in range(len(data)):\n    bmu = som.winner(data[i])  # returns (x, y)\n    fvar_value = fvar_arr[i] if np.ndim(fvar_arr) == 1 else np.mean(propfvar[i])\n    cell_fvar[bmu].append(fvar_value)\n\n# Now compute mean per cell\nfor (x, y), values in cell_fvar.items():\n    mean_fvar_map[x, y] = np.nanmean(values)\n\n# apply stretching for visualization\nheatmap = stretch_small_values_arctan(mean_fvar_map)\nncols = 4\nnrows = int(np.ceil(len(laborder) / ncols))\nfig, axs = plt.subplots(nrows, ncols, figsize=(3*ncols, 3*nrows))\naxs = axs.flatten()\n\nfor i, label in enumerate(laborder):\n    ax = axs[i]\n    im = ax.imshow(heatmap.T, origin='lower', cmap='plasma')\n\n    if label in labc:\n        for idx in labc[label]:\n            x, y = som.winner(data[idx])\n            ax.plot(x, y, 'x', color='white', markersize=8, markeredgewidth=2)\n\n    ax.set_title(label)\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n# Hide the extra subplot if laborder \u003c nrows * ncols\nif len(laborder) \u003c len(axs):\n    axs[len(laborder)].axis('off')\n\n# Colorbar outside the plot grid\n# Adjust position as needed (here it's to the right)\ncbar_ax = fig.add_axes([0.99, 0.05, 0.02, 0.9])  # [left, bottom, width, height]\ncbar = fig.colorbar(im, cax=cbar_ax)\ncbar.set_label('Mean Fractional Variability')\n\nplt.subplots_adjust(right=0.9)  # Leave space for colorbar\nplt.tight_layout()\nplt.show()","key":"QjwbFsnXCj"},{"type":"outputs","id":"qaHc46W4A2mw0Rf_Tp0es","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3476/2599028209.py:53: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  plt.tight_layout()\n"},"key":"DdssT9PRAG"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x900 with 13 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4bf0ff423cb2c0edc23af3ede136c4d4","path":"/fornax-demo-notebooks/build/4bf0ff423cb2c0edc23af3ede136c4d4.png"}}},"key":"Vxld76xXIk"}],"key":"CNLz9t2KX7"}],"key":"ahKuQPiRel"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"children":[{"type":"text","value":"The above SOMs are colored by the mean fractional variation of the lightcurves in all bands (a measure of AGN variability). The crosses are different samples mapped to the trained SOM to see if they are distinguishable on a normalized lightcurve som.","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"key":"bJXnTpvhBj"}],"key":"YMrZClNPPs"}],"key":"LDsOvjj9jk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# shuffle data in case the ML routines are sensitive to order\ndata, fzr, p = shuffle_datalabel(dat_notnormal, flabels)\nfvar_arr, maximum_arr, average_arr = fvar[:, p], maxarray[:, p], meanarray[:, p]\n# Initialize labc to hold indices of each unique label\nlabc = {}\nfor index, f in enumerate(fzr):\n    lab = translate_bitwise_sum_to_labels(int(f))\n    for label in lab:\n        if label not in labc:\n            # Initialize the list for this label if it's not already in labc\n            labc[label] = []\n        # Append the current index to the list of indices for this label\n        labc[label].append(index)\n\nsom = MiniSom(msz0, msz1, data.shape[1], sigma=1.5, learning_rate=.5,\n              neighborhood_function='gaussian', random_seed=0, topology='rectangular')\n\nsom.pca_weights_init(data)\nsom.train(data, 100000, verbose=False)  # random training","key":"lpnU43KCBQ"},{"type":"outputs","id":"o6Hifs5FaY-po7qfv0c6V","children":[],"key":"XK8BtTiaKU"}],"key":"B4UKT3obLE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create grid to hold mean fvar per SOM node\nmean_fvar_map = np.full((msz0, msz1), np.nan)\n\n# Create helper to accumulate fvar values in each cell\ncell_fvar = defaultdict(list)\n\n# First, map each data point to its BMU and store its fvar\npropfvar=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=2)\nfor i in range(len(data)):\n    bmu = som.winner(data[i])  # returns (x, y)\n    fvar_value = fvar_arr[i] if np.ndim(fvar_arr) == 1 else np.mean(propfvar[i])\n    cell_fvar[bmu].append(fvar_value)\n\n# Now compute mean per cell\nfor (x, y), values in cell_fvar.items():\n    mean_fvar_map[x, y] = np.nanmean(values)\n\n# apply stretching for visualization\nheatmap = stretch_small_values_arctan(mean_fvar_map)\nncols = 4\nnrows = int(np.ceil(len(laborder) / ncols))\nfig, axs = plt.subplots(nrows, ncols, figsize=(3*ncols, 3*nrows))\naxs = axs.flatten()\n\nfor i, label in enumerate(laborder):\n    ax = axs[i]\n    im = ax.imshow(heatmap.T, origin='lower', cmap='plasma')\n\n    if label in labc:\n        for idx in labc[label]:\n            x, y = som.winner(data[idx])\n            ax.plot(x, y, 'x', color='white', markersize=8, markeredgewidth=2)\n\n    ax.set_title(label)\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n# Hide the extra subplot if laborder \u003c nrows * ncols\nif len(laborder) \u003c len(axs):\n    axs[len(laborder)].axis('off')\n\n# Colorbar outside the plot grid\n# Adjust position as needed (here it's to the right)\ncbar_ax = fig.add_axes([0.99, 0.05, 0.02, 0.9])  # [left, bottom, width, height]\ncbar = fig.colorbar(im, cax=cbar_ax)\ncbar.set_label('Mean Fractional Variability')\n\nplt.subplots_adjust(right=0.9)  # Leave space for colorbar\nplt.tight_layout()\nplt.show()","key":"iXbwpNS9fx"},{"type":"outputs","id":"fugebdUlGmQTZfk92igIZ","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3476/1301010532.py:49: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  plt.tight_layout()\n"},"key":"Rgt75W6ifH"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x900 with 13 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"68cc5971b15db442365741505cd13052","path":"/fornax-demo-notebooks/build/68cc5971b15db442365741505cd13052.png"}}},"key":"U512KE5Pjz"}],"key":"cXTnRR3cau"}],"key":"YCVRIYjxoZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"labels = [None] * len(data)\nfor label in laborder:\n    if label in labc:\n        for idx in labc[label]:\n            labels[idx] = label\n\nlabels_map = defaultdict(Counter)\n\nfor x, label in zip(data, labels):\n    if label is not None:\n        w = som.winner(x)\n        labels_map[w][label] += 1\n\nfig = plt.figure(figsize=(12, 12))\nthe_grid = gridspec.GridSpec(msz0, msz1, fig)\n\nfor position in labels_map.keys():\n    label_counts = labels_map[position]\n    total = sum(label_counts.values())\n\n    # Use consistent order from laborder\n    fracs = [label_counts.get(label, 0) / total for label in laborder]\n\n    ax = plt.subplot(the_grid[msz1 - 1 - position[1], position[0]], aspect=1)\n    patches, _ = ax.pie(fracs)\n    #ax.set_title(f\"{position}\", fontsize=6)\n    ax.axis('equal')\n\n# Legend outside\nplt.legend(patches, laborder, bbox_to_anchor=(1.05, 1), loc='upper left', fontsize=8)\nplt.tight_layout()\nplt.show()","key":"CEBKVG2WYt"},{"type":"outputs","id":"OX6y5IQtvCliAEUbR67At","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3476/2695913503.py:31: UserWarning: Tight layout not applied. tight_layout cannot make Axes width small enough to accommodate all Axes decorations\n  plt.tight_layout()\n"},"key":"ESXUpGu1io"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x1200 with 225 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"263ac0382aa0fac67636b1880a900893","path":"/fornax-demo-notebooks/build/263ac0382aa0fac67636b1880a900893.png"}}},"key":"i4DoDVgbuV"}],"key":"C68rsn1zpV"}],"key":"Dvj3FOmJrm"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"skipping the normalization of lightcurves, further separates turn on/off CLAGNs when looking at ZTF lightcurves only.","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"b8F08Qvbce"}],"key":"QyIxfEwsqL"},{"type":"heading","depth":2,"position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"4. Repeating the above, this time with ZTF + WISE manifold","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"OgvMxGXz9b"}],"identifier":"id-4-repeating-the-above-this-time-with-ztf-wise-manifold","label":"4. Repeating the above, this time with ZTF + WISE manifold","html_id":"id-4-repeating-the-above-this-time-with-ztf-wise-manifold","implicit":true,"key":"KTTjLb7Vbz"}],"key":"o6hLjpG6SR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bands_inlc = ['zg', 'zr', 'zi', 'W1', 'W2']\nobjects, dobjects, flabels, keeps = unify_lc(df_lc, bands_inlc, xres=30, numplots=3)\n# calculate some basic statistics\nfvar, maxarray, meanarray = stat_bands(objects, dobjects, bands_inlc)\ndat_notnormal = combine_bands(objects, bands_inlc)\ndat = normalize_clipmax_objects(dat_notnormal, maxarray, band=-1)\ndata, fzr, p = shuffle_datalabel(dat, flabels)\nfvar_arr, maximum_arr, average_arr = fvar[:, p], maxarray[:, p], meanarray[:, p]\n\n# Initialize labc to hold indices of each unique label\nlabc = {}\nfor index, f in enumerate(fzr):\n    lab = translate_bitwise_sum_to_labels(int(f))\n    for label in lab:\n        if label not in labc:\n            # Initialize the list for this label if it's not already in labc\n            labc[label] = []\n        # Append the current index to the list of indices for this label\n        labc[label].append(index)","key":"gXgS2Z30kB"},{"type":"outputs","id":"znlE0BYrgSNZfb8GZ3YeS","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"0it [00:00, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"11b58f729c584464906ef71505dc1bb7\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"N908KD1VT5"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"11e2da55b1dfd85bfe9afc083af8ff5f","path":"/fornax-demo-notebooks/build/11e2da55b1dfd85bfe9afc083af8ff5f.png"}}},"key":"PeZgeuSy43"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7700dd82955ddf9e6fe61e5f71b2c93a","path":"/fornax-demo-notebooks/build/7700dd82955ddf9e6fe61e5f71b2c93a.png"}}},"key":"JMQQmz6VhB"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"037ced06bbb84ea6dbc5a7f2ac39e9b6","path":"/fornax-demo-notebooks/build/037ced06bbb84ea6dbc5a7f2ac39e9b6.png"}}},"key":"Sueukeg1mn"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/code_src/AGNzoo_functions.py:290: RuntimeWarning: invalid value encountered in sqrt\n  fvar = (np.sqrt(varf - deltaf)) / meanf\n"},"key":"YeRGY0dn4A"}],"key":"L5GK1nzY4Q"}],"key":"UfRmjTmSPj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(18, 6))\nmarkersize=200\nmapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric='manhattan', random_state=4).fit(data)\n# using dtw distance takes a long time\n# mapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=dtw_distance, random_state=20).fit(data)\n\n\nax1 = plt.subplot(1, 3, 2)\nax1.set_title(r'mean brightness', size=20)\ncf = ax1.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,\n                 c=np.log10(np.nansum(meanarray, axis=0)), edgecolor='gray')\nplt.axis('off')\ndivider = make_axes_locatable(ax1)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\n\nax0 = plt.subplot(1, 3, 3)\nax0.set_title(r'mean fractional variation', size=20)\ncf = ax0.scatter(mapper.embedding_[:, 0], mapper.embedding_[:, 1], s=markersize,\n                 c=stretch_small_values_arctan(np.nansum(fvar_arr, axis=0), factor=3),\n                 edgecolor='gray')\nplt.axis('off')\ndivider = make_axes_locatable(ax0)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\nax2 = plt.subplot(1, 3, 1)\nax2.set_title('sample origin', size=20)\ncounts = 1\nfor label, indices in labc.items():\n    cf = ax2.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=markersize,\n                     c=colors[counts], alpha=0.5, edgecolor='gray', label=label)\n    counts += 1\nplt.legend(fontsize=12)\n#plt.colorbar(cf)\nplt.axis('off')\n\nplt.tight_layout()","key":"v2Pb2UxF35"},{"type":"outputs","id":"8qFBvVg8MgpVM6pOTEilr","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n  warn(\n"},"key":"CVWTnRagWN"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1800x600 with 5 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"91a6065bece5ce3056481beeb97f7d4c","path":"/fornax-demo-notebooks/build/91a6065bece5ce3056481beeb97f7d4c.png"}}},"key":"VtTcU5WAaS"}],"key":"tLXYotRE2u"}],"key":"zlbtDSspwV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate 2D histogram\nhist, x_edges, y_edges = np.histogram2d(mapper.embedding_[:, 0], mapper.embedding_[:, 1], bins=12)\nplt.figure(figsize=(15, 12))\ni=1\nax0 = plt.subplot(4, 4, 12)\nfor label, indices in sorted(labc.items()):\n    hist_per_cluster, _, _ = np.histogram2d(mapper.embedding_[indices, 0],\n                                            mapper.embedding_[indices, 1],\n                                            bins=(x_edges, y_edges))\n    prob = hist_per_cluster / hist\n    plt.subplot(4, 4, i)\n    plt.title(label)\n    plt.contourf(x_edges[:-1], y_edges[:-1], prob.T, levels=20, alpha=0.8, cmap=custom_cmap)\n    plt.colorbar()\n    plt.axis('off')\n    cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,\n                     alpha=0.5, edgecolor='gray', label=label, c=colors[i-1])\n    i += 1\nax0.legend(loc=4, fontsize=7)\nax0.axis('off')\nplt.tight_layout()","key":"ykqI2pXdM7"},{"type":"outputs","id":"53Rq3ZUxn6OrU8TmfeWCq","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3476/3793995111.py:10: RuntimeWarning: invalid value encountered in divide\n  prob = hist_per_cluster / hist\n"},"key":"n2fdmYcFzD"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x1200 with 23 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0610caa0fe1e8cc935cdef54889ecaf2","path":"/fornax-demo-notebooks/build/0610caa0fe1e8cc935cdef54889ecaf2.png"}}},"key":"fd73p3Kgvi"}],"key":"nT2vcmRQMg"}],"key":"Kv5Egh0liz"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":652,"column":1},"end":{"line":652,"column":1}},"children":[{"type":"text","value":"5. Wise bands alone","position":{"start":{"line":652,"column":1},"end":{"line":652,"column":1}},"key":"Lu2HwTYtGy"}],"identifier":"id-5-wise-bands-alone","label":"5. Wise bands alone","html_id":"id-5-wise-bands-alone","implicit":true,"key":"KUU8YiInnV"}],"key":"UCTHybcVTw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bands_inlcw = ['W1', 'W2']\nobjectsw, dobjectsw, flabelsw, keepsw = unify_lc(df_lc, bands_inlc, xres=30)\n# calculate some basic statistics\nfvarw, maxarrayw, meanarrayw = stat_bands(objectsw, dobjectsw, bands_inlcw)\ndat_notnormalw = combine_bands(objects, bands_inlcw)\ndatw = normalize_clipmax_objects(dat_notnormalw, maxarrayw, band=-1)\ndataw, fzrw, pw = shuffle_datalabel(datw, flabelsw)\nfvar_arrw, maximum_arrw, average_arrw = fvarw[:, pw], maxarrayw[:, pw], meanarrayw[:, pw]\n\n# Initialize labc to hold indices of each unique label\nlabcw = {}\nfor index, f in enumerate(fzrw):\n    lab = translate_bitwise_sum_to_labels(int(f))\n    for label in lab:\n        if label not in labcw:\n            # Initialize the list for this label if it's not already in labc\n            labcw[label] = []\n        # Append the current index to the list of indices for this label\n        labcw[label].append(index)","key":"AF90jJ0i19"},{"type":"outputs","id":"VcyY6XEOLOqrEufaKOLSn","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"0it [00:00, ?it/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"5671165f55104392b19fcf61beb5fbd2\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},"key":"D1KtQSPvBH"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"11e2da55b1dfd85bfe9afc083af8ff5f","path":"/fornax-demo-notebooks/build/11e2da55b1dfd85bfe9afc083af8ff5f.png"}}},"key":"lgWAqz3OB4"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/light_curves/code_src/AGNzoo_functions.py:290: RuntimeWarning: invalid value encountered in sqrt\n  fvar = (np.sqrt(varf - deltaf)) / meanf\n"},"key":"Hb6JlBBTuG"}],"key":"fa1JPqIAqt"}],"key":"d5JagCMjCp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(18, 6))\nmarkersize=200\nmapp = umap.UMAP(n_neighbors=50, min_dist=0.9, metric='manhattan', random_state=20).fit(dataw)\n\n\nax1 = plt.subplot(1, 3, 2)\nax1.set_title(r'mean brightness', size=20)\ncf = ax1.scatter(mapp.embedding_[:, 0], mapp.embedding_[:, 1], s=markersize,\n                 c=np.log10(np.nansum(meanarrayw, axis=0)), edgecolor='gray')\nplt.axis('off')\ndivider = make_axes_locatable(ax1)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\n\nax0 = plt.subplot(1, 3, 3)\nax0.set_title(r'mean fractional variation', size=20)\ncf = ax0.scatter(mapp.embedding_[:, 0], mapp.embedding_[:, 1], s=markersize,\n                 c=stretch_small_values_arctan(np.nansum(fvar_arrw, axis=0), factor=3),\n                 edgecolor='gray')\nplt.axis('off')\ndivider = make_axes_locatable(ax0)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.05)\nplt.colorbar(cf, cax=cax)\n\nax2 = plt.subplot(1, 3, 1)\nax2.set_title('sample origin', size=20)\ncounts = 1\nfor label, indices in labcw.items():\n    cf = ax2.scatter(mapp.embedding_[indices, 0], mapp.embedding_[indices, 1], s=markersize,\n                     c=colors[counts], alpha=0.5, edgecolor='gray', label=label)\n    counts += 1\nplt.legend(fontsize=12)\n#plt.colorbar(cf)\nplt.axis('off')\n\nplt.tight_layout()","key":"W7BYxoSFH2"},{"type":"outputs","id":"aklLGmnWHhCzPI5BU_lWK","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n  warn(\n"},"key":"vwQpQcDjqI"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1800x600 with 5 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"abb12f17f637e7dd755395ed156637d6","path":"/fornax-demo-notebooks/build/abb12f17f637e7dd755395ed156637d6.png"}}},"key":"rjvMnad1O9"}],"key":"Aom3GRTs0x"}],"key":"DUCsB5iaWI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Calculate 2D histogram\nhist, x_edges, y_edges = np.histogram2d(mapp.embedding_[:, 0], mapp.embedding_[:, 1], bins=12)\nplt.figure(figsize=(15, 12))\ni=1\nax0 = plt.subplot(4, 4, 12)\nfor label, indices in sorted(labcw.items()):\n    hist_per_cluster, _, _ = np.histogram2d(mapp.embedding_[indices, 0],\n                                            mapp.embedding_[indices, 1],\n                                            bins=(x_edges, y_edges))\n    prob = hist_per_cluster / hist\n    plt.subplot(4, 4, i)\n    plt.title(label)\n    plt.contourf(x_edges[:-1], y_edges[:-1], prob.T, levels=20, alpha=0.8, cmap=custom_cmap)\n    plt.colorbar()\n    plt.axis('off')\n    cf = ax0.scatter(mapp.embedding_[indices, 0], mapp.embedding_[indices, 1], s=80,\n                     alpha=0.5, edgecolor='gray', label=label, c=colors[i-1])\n    i += 1\nax0.legend(loc=4, fontsize=7)\nax0.axis('off')\nplt.tight_layout()","key":"T9jQcL1thn"},{"type":"outputs","id":"h19MiviLBJd1wGkputfKX","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3476/3463858432.py:10: RuntimeWarning: invalid value encountered in divide\n  prob = hist_per_cluster / hist\n"},"key":"crTl0ATS05"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1500x1200 with 23 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"81e1ddb4e03cfe8c2d8e653750df7052","path":"/fornax-demo-notebooks/build/81e1ddb4e03cfe8c2d8e653750df7052.png"}}},"key":"xbYHmdqEPO"}],"key":"LCfEvjw8UM"}],"key":"c1CRFtWf06"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":740,"column":1},"end":{"line":740,"column":1}},"children":[{"type":"text","value":"6. UMAP with different metrics/distances on ZTF+WISE","position":{"start":{"line":740,"column":1},"end":{"line":740,"column":1}},"key":"j6KcxmKLFm"}],"identifier":"id-6-umap-with-different-metrics-distances-on-ztf-wise","label":"6. UMAP with different metrics/distances on ZTF+WISE","html_id":"id-6-umap-with-different-metrics-distances-on-ztf-wise","implicit":true,"key":"hUqCFj0Lgt"},{"type":"paragraph","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"children":[{"type":"text","value":"DTW takes a bit longer compared to other metrics, so it is commented out in the cell below.","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"key":"Hp42ITyaAn"}],"key":"syySe4xSTt"}],"key":"GlGzpal1zW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.figure(figsize=(12, 10))\nmarkersize=200\n\nmapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric='euclidean', random_state=20).fit(data)\nax0 = plt.subplot(2, 2, 1)\nax0.set_title(r'Euclidean Distance, min_d=0.9, n_neighbors=50', size=12)\nfor label, indices in (labc.items()):\n     cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,\n                      alpha=0.5, edgecolor='gray', label=label)\nplt.axis('off')\n\nmapper = umap.UMAP(n_neighbors=50, min_dist=0.9, metric='manhattan', random_state=20).fit(data)\nax0 = plt.subplot(2, 2, 2)\nax0.set_title(r'Manhattan Distance, min_d=0.9, n_neighbors=50', size=12)\nfor label, indices in (labc.items()):\n     cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,\n                      alpha=0.5, edgecolor='gray', label=label)\nplt.axis('off')\n\n\n# This distance takes long\n# mapperg = umap.UMAP(n_neighbors=50, min_dist=0.9, metric=dtw_distance, random_state=20).fit(data)\n# ax2 = plt.subplot(2, 2, 3)\n# ax2.set_title(r'DTW Distance, min_d=0.9, n_neighbors=50', size=12)\n# for label, indices in (labc.items()):\n#      cf = ax2.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,\n#                       alpha=0.5, edgecolor='gray', label=label)\n# plt.axis('off')\n\n\nmapper = umap.UMAP(n_neighbors=50, min_dist=0.1, metric='manhattan', random_state=20).fit(data)\nax0 = plt.subplot(2, 2, 4)\nax0.set_title(r'Manhattan Distance, min_d=0.1, n_neighbors=50', size=12)\nfor label, indices in (labc.items()):\n     cf = ax0.scatter(mapper.embedding_[indices, 0], mapper.embedding_[indices, 1], s=80,\n                      alpha=0.5, edgecolor='gray', label=label)\nplt.legend(fontsize=12)\nplt.axis('off')","key":"mkRs2pnvW0"},{"type":"outputs","id":"XIhvd-_Xb0hEnzLGWUtb6","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n  warn(\n"},"key":"z7Z8491Lo6"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n  warn(\n"},"key":"Ae7x2jaK5M"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n  warn(\n"},"key":"ZrgsMkwb6o"},{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"(np.float64(-55.54381122589111),\n np.float64(-44.33795986175537),\n np.float64(-8.878481245040893),\n np.float64(7.507222509384155))","content_type":"text/plain"}}},"key":"scCpY44kOS"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1200x1000 with 3 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2ed660a522ceec3497773796a39ee123","path":"/fornax-demo-notebooks/build/2ed660a522ceec3497773796a39ee123.png"}}},"key":"IY5LLwtKBF"}],"key":"asL0BJI258"}],"key":"anaMrc3n6F"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":785,"column":1},"end":{"line":785,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":785,"column":1},"end":{"line":785,"column":1}},"key":"n6NRfECIfS"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"ShMEmQDNRl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":787,"column":1},"end":{"line":789,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"key":"vBcngiaeT1"}],"key":"Y8yACmSXFe"},{"type":"text","value":" Shoubaneh Hemmati (IRSA Research Scientist) and the Fornax team","position":{"start":{"line":787,"column":1},"end":{"line":787,"column":1}},"key":"pZlN523jwu"}],"key":"eVe0U9PW63"}],"key":"mH6CoTzdBT"},{"type":"listItem","spread":true,"position":{"start":{"line":788,"column":1},"end":{"line":789,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"UsOitkeknz"}],"key":"Qw893EMJDK"},{"type":"text","value":" For help with this notebook, please open a topic in the ","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"jOK5e7S2X6"},{"type":"link","url":"https://discourse.fornax.sciencecloud.nasa.gov/","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"children":[{"type":"text","value":"Fornax Community Forum","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"MqoFN8IYw7"}],"urlSource":"https://discourse.fornax.sciencecloud.nasa.gov/","key":"DWSHVfKW9X"},{"type":"text","value":" “Support” category.","position":{"start":{"line":788,"column":1},"end":{"line":788,"column":1}},"key":"EozCjwtUS3"}],"key":"bjHIlEj0Lj"}],"key":"lyTRCsyebn"}],"key":"l62XA8K7Ct"},{"type":"heading","depth":3,"position":{"start":{"line":790,"column":1},"end":{"line":790,"column":1}},"children":[{"type":"text","value":"Acknowledgements","position":{"start":{"line":790,"column":1},"end":{"line":790,"column":1}},"key":"Dbo3HRCU93"}],"identifier":"acknowledgements","label":"Acknowledgements","html_id":"acknowledgements","implicit":true,"key":"n10MdIQwEt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":792,"column":1},"end":{"line":793,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":792,"column":1},"end":{"line":793,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Parts of this notebook will be presented in Hemmati et al. (in prep)","position":{"start":{"line":792,"column":1},"end":{"line":792,"column":1}},"key":"Km0q7Fmn3h"}],"key":"VhIp31HLNs"}],"key":"rxGyZq9i8w"}],"key":"rXpS8vpuai"},{"type":"heading","depth":3,"position":{"start":{"line":794,"column":1},"end":{"line":794,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":794,"column":1},"end":{"line":794,"column":1}},"key":"H0RP1I9Tmd"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"T7KdHHGPCL"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":796,"column":1},"end":{"line":797,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://github.com/JustGlowing/minisom","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"inlineCode","value":"minisom","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"eYrmzA7iqP"}],"urlSource":"https://github.com/JustGlowing/minisom","error":true,"key":"txv0qLeIwt"}],"key":"shHVY3do44"}],"key":"YzGh19q5bq"},{"type":"listItem","spread":true,"position":{"start":{"line":797,"column":1},"end":{"line":797,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://github.com/lmcinnes/umap","position":{"start":{"line":797,"column":1},"end":{"line":797,"column":1}},"children":[{"type":"inlineCode","value":"umap","position":{"start":{"line":797,"column":1},"end":{"line":797,"column":1}},"key":"y8SqN6A349"}],"urlSource":"https://github.com/lmcinnes/umap","error":true,"key":"bzoiLEQLae"}],"key":"s2fMOVNUMX"}],"key":"jFMQ3wklyp"}],"key":"oMxYYwNj9c"}],"key":"XM18uGIuIP"}],"key":"aZTNQZM3cx"},"references":{"cite":{"order":["Hammerstein_2022"],"data":{"Hammerstein_2022":{"label":"Hammerstein_2022","enumerator":"1","doi":"10.3847/1538-4357/aca283","html":"Hammerstein, E., van Velzen, S., Gezari, S., Cenko, S. B., Yao, Y., Ward, C., Frederick, S., Villanueva, N., Somalwar, J. J., Graham, M. J., Kulkarni, S. R., Stern, D., Andreoni, I., Bellm, E. C., Dekany, R., Dhawan, S., Drake, A. J., Fremling, C., Gatkine, P., … Yan, L. (2022). The Final Season Reimagined: 30 Tidal Disruption Events from the ZTF-I Survey. \u003ci\u003eThe Astrophysical Journal\u003c/i\u003e, \u003ci\u003e942\u003c/i\u003e(1), 9. \u003ca target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.3847/1538-4357/aca283\"\u003e10.3847/1538-4357/aca283\u003c/a\u003e","url":"https://doi.org/10.3847/1538-4357/aca283"}}}},"footer":{"navigation":{"prev":{"title":"Light Curve Classifier","url":"/light-curve-classifier","group":"The Fornax Initiative"},"next":{"title":"Spectroscopy","url":"/spectroscopy","group":"The Fornax Initiative"}}},"domain":"http://localhost:3000"},"project":{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/fornax-demo-notebooks/build/manifest-86A905A4.js";
import * as route0 from "/fornax-demo-notebooks/build/root-CXYA7X5D.js";
import * as route1 from "/fornax-demo-notebooks/build/routes/$-JRBPULBO.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js");</script></body></html>