<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Make Multi-Wavelength Light Curves Using Archival Data - The Fornax Initiative</title><meta property="og:title" content="Make Multi-Wavelength Light Curves Using Archival Data - The Fornax Initiative"/><meta name="generator" content="mystmd"/><meta name="description" content="Tutorial notebooks for example Fornax use cases"/><meta property="og:description" content="Tutorial notebooks for example Fornax use cases"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/app-IZWEOBHI.css"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/fornax-demo-notebooks/favicon.ico"/><link rel="stylesheet" href="/fornax-demo-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/fornax-demo-notebooks/"><div class="p-1 mr-3 dark:bg-white dark:rounded"><img src="/fornax-demo-notebooks/build/fornax_logo-2f549f30f2622a092c47c887989a7af0.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="The Fornax Initiative" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/fornax-demo-notebooks/">The Fornax Initiative</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time Domain" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme">Time Domain</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Spectroscopy" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-1">Spectroscopy</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rup8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rup8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Multi-band forced photometry" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-2">Multi-band forced photometry</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Cross Matching" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/readme-3">Cross Matching</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center mb-5 h-6 text-sm font-light"><div class="flex-none pr-2 smallcaps">Fornax Demo Notebooks</div><div class="flex-grow"></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks" title="GitHub Repository: nasa-fornax/fornax-demo-notebooks" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><a href="https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/light_curves/light_curve_collector.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Make Multi-Wavelength Light Curves Using Archival Data</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78top:" data-state="closed">Fornax developers and scientists</button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this tutorial, you will be able to:</p><ul><li><p>Automatically load a catalog of target sources</p></li><li><p>Automatically &amp; efficiently search NASA and non-NASA resources for the light curves of up to ~500 targets</p></li><li><p>Store &amp; manipulate light curves in a Pandas MultiIndex dataframe</p></li><li><p>Plot all light curves on the same plot</p></li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p>A user has a sample of interesting targets for which they would like to see a plot of available archival light curves.  We start with a small set of changing look AGN from Yang et al., 2018, which are automatically downloaded. Changing look AGN are cases where the broad emission lines appear or disappear (and not just that the flux is variable).</p></li><li><p>We model light curve plots after van Velzen et al. 2021.  We search through a curated list of time-domain NASA holdings as well as non-NASA sources.  HEASARC catalogs used are Fermi and Beppo-Sax, IRSA catalogs used are ZTF and WISE, and MAST catalogs used are Pan-STARRS, TESS, Kepler, and K2.  Non-NASA sources are Gaia and IceCube. This list is generalized enough to include many types of targets to make this notebook interesting for many types of science.  All of these time-domain archives are searched in an automated and efficient fashion using astroquery, pyvo, pyarrow or APIs.</p></li><li><p>Light curve data storage is a tricky problem.  Currently we are using a MultiIndex Pandas dataframe, as the best existing choice for right now.  One downside is that we need to manually track the units of flux and time instead of relying on an astropy storage scheme which would be able to do some of the units worrying for us (even astropy can’t do all magnitude to flux conversions).  Astropy does not currently have a good option for multi-band light curve storage.</p></li><li><p>This notebook walks through the individual steps required to collect the targets and their light curves and create figures. It also shows how to speed up the collection of light curves using python’s <code>multiprocessing</code>. This is expected to be sufficient for up to ~500 targets. For a larger number of targets, consider using the bash script demonstrated in the neighboring notebook <a class="" href="/fornax-demo-notebooks/scale-up">scale_up</a>.</p></li><li><p>ML work using these time-series light curves is in two neighboring notebooks: <a class="" href="/fornax-demo-notebooks/ml-agnzoo">ML_AGNzoo</a> and <a class="" href="/fornax-demo-notebooks/light-curve-classifier">light<wbr/>_curve<wbr/>_classifier</a>.</p></li></ul><h3 id="input" class="relative group"><span class="heading-text">Input</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#input" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>choose from a list of known changing look AGN from the literature
OR -</p></li><li><p>input your own sample</p></li></ul><h3 id="output" class="relative group"><span class="heading-text">Output</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#output" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>an archival optical + IR + neutrino light curve</p></li></ul><h3 id="runtime" class="relative group"><span class="heading-text">Runtime</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#runtime" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>As of 2025 May, this notebook takes ~1000s (17 min.) to run to completion on Fornax using the ‘Astrophysics Default Image’ and the ‘Large’ server with 64GB RAM/ 16CPU.</p></li></ul><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p><code>acstools</code> to work with HST magnitude to flux conversion</p></li><li><p><code>astropy</code> to work with coordinates/units and data structures</p></li><li><p><code>astroquery</code> to interface with archives APIs</p></li><li><p><code>hpgeom</code> to locate coordinates in HEALPix space</p></li><li><p><code>lightkurve</code> to search TESS, Kepler, and K2 archives</p></li><li><p><code>matplotlib</code> for plotting</p></li><li><p><code>multiprocessing</code> to use the power of multiple CPUs to get work done faster</p></li><li><p><code>numpy</code> for numerical processing</p></li><li><p><code>pandas</code> with their <code>[aws]</code> extras for their data structure DataFrame and all the accompanying functions</p></li><li><p><code>pyarrow</code> to work with Parquet files for WISE and ZTF</p></li><li><p><code>pyvo</code> for accessing Virtual Observatory(VO) standard data</p></li><li><p><code>requests</code> to get information from URLs</p></li><li><p><code>scipy</code> to do statistics</p></li><li><p><code>tqdm</code> to track progress on long running jobs</p></li><li><p><code>urllib</code> to handle archive searches with website interface</p></li></ul><p>This cell will install them if needed:</p><div id="X2LdAlnhRZ" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# %pip install -r requirements_light_curve_collector.txt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GQ34VRqoy4DGUsRZTvUvM" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="NOSmKbTiAn" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import multiprocessing as mp
import sys
import time

import astropy.units as u
import pandas as pd
from astropy.table import Table

# local code imports
sys.path.append(&#x27;code_src/&#x27;)
from data_structures import MultiIndexDFObject
from gaia_functions import gaia_get_lightcurves
from hcv_functions import hcv_get_lightcurves
from heasarc_functions import heasarc_get_lightcurves
from icecube_functions import icecube_get_lightcurves
from panstarrs_functions import panstarrs_get_lightcurves
from plot_functions import create_figures
from sample_selection import (clean_sample, get_green_sample, get_hon_sample, get_lamassa_sample, get_lopeznavas_sample,
    get_lyu_sample, get_macleod16_sample, get_macleod19_sample, get_ruan_sample, get_sdss_sample, get_sheng_sample, get_yang_sample)
from tess_kepler_functions import tess_kepler_get_lightcurves
from wise_functions import wise_get_lightcurves
from rubin_functions import rubin_get_lightcurves
from ztf_functions import ztf_get_lightcurves</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="f8gGLHF8qyxMWnV709S5r" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h2 id="id-1-define-the-sample" class="relative group"><span class="heading-text">1. Define the sample</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-define-the-sample" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We define here a “gold” sample of spectroscopically confirmed changing look AGN and quasars. This sample includes both objects which change from type 1 to type 2 and also the opposite.  Future studies may want to treat these as separate objects or separate QSOs from AGN.  Bibcodes for the samples used are listed next to their functions for reference.</p><p>Significant work went into the functions which grab the samples from the papers.  They use Astroquery, NED, SIMBAD, Vizier, and in a few cases grab the tables from the html versions of the paper.  There are trickeries involved in accessing coordinates from tables in the literature. Not every literature table is stored in its entirety in all of these resources, so be sure to check that your chosen method is actually getting the information that you see in the paper table.  Warning: You will get false results if using NED or SIMBAD on a table that has more rows than are printed in the journal.</p><div id="RBtUtYPYJi" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Build up the sample
# Initially set up lists to hold the coordinates and their reference paper name as a label
coords =[]
labels = []

# Choose your own adventure:

#get_lamassa_sample(coords, labels)  #2015ApJ...800..144L
#get_macleod16_sample(coords, labels) #2016MNRAS.457..389M
#get_ruan_sample(coords, labels) #2016ApJ...826..188R
#get_macleod19_sample(coords, labels)  #2019ApJ...874....8M
#get_sheng_sample(coords, labels)  #2020ApJ...889...46S
#get_green_sample(coords, labels)  #2022ApJ...933..180G
#get_lyu_sample(coords, labels)  #z32022ApJ...927..227L
#get_lopeznavas_sample(coords, labels)  #2022MNRAS.513L..57L
#get_hon_sample(coords, labels)  #2022MNRAS.511...54H
get_yang_sample(coords, labels)   #2018ApJ...862..109Y

# Get some &quot;normal&quot; QSOs
# there are ~500K of these, so choose the number based on
# a balance between speed of running the light curves and whatever
# the ML algorithms would like to have

# num_normal_QSO = 5000
# zmin, zmax = 0, 10
# randomize_z = False
#get_sdss_sample(coords, labels, num=num_normal_QSO, zmin=zmin, zmax=zmax, randomize_z=randomize_z)

# Remove duplicates, attach an objectid to the coords,
# convert to astropy table to keep all relevant info together
sample_table = clean_sample(coords, labels)

#give this sample a name for use in saving files
sample_name = &quot;yang_CLAGN&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="PB2T6osBTBSdQ-qgKPbcG" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="XLIuhaOCdy" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">sample_table</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3J5imnkbwi80iREckR-Za" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-1-1-build-your-own-sample" class="relative group"><span class="heading-text">1.1 Build your own sample</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-1-build-your-own-sample" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To build your own sample, you can follow the examples of functions above to grab coordinates from your favorite literature resource,</p><p>or</p><p>You can use <a target="_blank" rel="noreferrer" href="https://docs.astropy.org/en/stable/io/ascii/read.html" class="">astropy’s read</a> function to read in an input table
to an <a target="_blank" rel="noreferrer" href="https://docs.astropy.org/en/stable/table/" class="">astropy table</a></p><h3 id="id-1-2-write-out-your-sample-to-disk" class="relative group"><span class="heading-text">1.2 Write out your sample to disk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-2-write-out-your-sample-to-disk" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>At this point you may wish to write out your sample to disk and reuse that in future work sessions, instead of creating it from scratch again.</p><p>For the format of the save file, we would suggest to choose from various formats that fully support astropy objects(eg., SkyCoord).  One example that works is Enhanced Character-Separated Values or <a target="_blank" rel="noreferrer" href="https://docs.astropy.org/en/stable/io/ascii/ecsv.html" class="">‘ecsv’</a></p><div id="K8c6gk3m9W" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">savename_sample = f&quot;output/{sample_name}_sample.ecsv&quot;
sample_table.write(savename_sample, format=&#x27;ascii.ecsv&#x27;, overwrite = True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="RXqtewLG-zenBF3y7QH9-" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-1-3-load-the-sample-table-from-disk" class="relative group"><span class="heading-text">1.3 Load the sample table from disk</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-3-load-the-sample-table-from-disk" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Do only this step from this section when you have a previously generated sample table</p><div id="XrxRH0bTjO" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#sample_table = Table.read(savename_sample, format=&#x27;ascii.ecsv&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gLeXcMNHUw5yVQg5Or5N7" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-1-4-initialize-data-structure-to-hold-the-light-curves" class="relative group"><span class="heading-text">1.4 Initialize data structure to hold the light curves</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-4-initialize-data-structure-to-hold-the-light-curves" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="zK0eKQzDhQ" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># We wrote our own class for a Pandas MultiIndex [DataFrame](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html) for storing the light curves
# This class helps simplify coding of common uses for the DataFrame.
df_lc = MultiIndexDFObject()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xLHmBHSBlvS9L1ABRLe14" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h2 id="id-2-find-light-curves-for-these-targets-in-nasa-catalogs" class="relative group"><span class="heading-text">2. Find light curves for these targets in NASA catalogs</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-find-light-curves-for-these-targets-in-nasa-catalogs" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We search a curated list of time-domain catalogs from NASA astrophysics archives.  Because each archive is different, and in many cases each catalog is different, each function to access a catalog is necessarily specialized to the location and format of that particular catalog.</p><h3 id="id-2-1-heasarc-fermi-beppo-sax" class="relative group"><span class="heading-text">2.1 HEASARC: FERMI &amp; Beppo SAX</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-1-heasarc-fermi-beppo-sax" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The function to retrieve HEASARC data accesses the HEASARC archive using a pyvo search with a table upload.  This is the fastest way to access data from HEASARC catalogs at scale.</p><p>While these aren’t strictly light curves, we would like to track if there are gamma rays detected in advance of any change in the CLAGN light curves. We store these gamma ray detections as single data points.  Because gamma ray detections typically have very large error radii, our current technique is to keep matches in the catalogs within some manually selected error radius, currently defaulting to 1 degree for Fermi and 3 degrees for Beppo SAX.  These values are chosen based on a histogram of all values for those catalogs.</p><div id="jy5JZPdtcZ" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">start_serial = time.time()  #keep track of all serial archive calls to compare later with parallel archive call time
heasarcstarttime = time.time()

# What is the size of error_radius for the catalogs that we will accept for our cross-matching?
# in degrees; chosen based on histogram of all values for these catalogs
max_fermi_error_radius = str(1.0)
max_sax_error_radius = str(3.0)

# catalogs to query and their corresponding max error radii
heasarc_catalogs = {&quot;FERMIGTRIG&quot;: max_fermi_error_radius, &quot;SAXGRBMGRB&quot;: max_sax_error_radius}

# get heasarc light curves in the above curated list of catalogs
df_lc_HEASARC = heasarc_get_lightcurves(sample_table, catalog_error_radii=heasarc_catalogs)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_HEASARC)

print(&#x27;heasarc search took:&#x27;, time.time() - heasarcstarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5T_WGanuIRlXxJpBwIpjG" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-2-2-irsa-wise" class="relative group"><span class="heading-text">2.2 IRSA: WISE</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-2-irsa-wise" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We use the unWISE light curves catalog (<a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2023AJ....165...36M/abstract" class="">Meisner et al., 2023</a>) which ties together all WISE &amp; NEOWISE 2010 - 2020 epochs.  Specifically it combines all observations at a single epoch to achieve deeper mag limits than individual observations alone.</p><p>The function to retrieve WISE light curves accesses an IRSA generated version of the catalog in parquet format being stored in the AWS cloud <a target="_blank" rel="noreferrer" href="https://registry.opendata.aws/collab/nasa/" class="">Open Data Repository</a></p><div id="FKn2kr0Npn" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">WISEstarttime = time.time()

bandlist = [&#x27;W1&#x27;, &#x27;W2&#x27;]  #list of the WISE band names
WISE_radius = 1.0  # arcsec
# get WISE light curves
df_lc_WISE = wise_get_lightcurves(sample_table, radius=WISE_radius, bandlist=bandlist)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_WISE)

print(&#x27;WISE search took:&#x27;, time.time() - WISEstarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="tVpkCswJJt8mYx_QcFPcc" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-2-3-mast-pan-starrs" class="relative group"><span class="heading-text">2.3 MAST: Pan-STARRS</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-3-mast-pan-starrs" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The function to retrieve lightcurves from Pan-STARRS uses <a target="_blank" rel="noreferrer" href="https://docs.lsdb.io/" class="">LSDB</a> to access versions of the object and light curve catalogs that are stored in the cloud.  This function is efficient at large scale (sample sizes &gt; ~1000).</p><p>Some warnings are expected.</p><div id="RYEYflmrrb" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">panstarrsstarttime = time.time()

panstarrs_search_radius = 1.0 # search radius = 1 arcsec
# get panstarrs light curves
df_lc_panstarrs = panstarrs_get_lightcurves(sample_table, radius=panstarrs_search_radius)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_panstarrs)

print(&#x27;Panstarrs search took:&#x27;, time.time() - panstarrsstarttime, &#x27;s&#x27;)

# Warnings from the panstarrs query about both NESTED and margins are known issues</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7plyKs4GGxoJYkgGHxDHc" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-2-4-mast-tess-kepler-and-k2" class="relative group"><span class="heading-text">2.4 MAST: TESS, Kepler and K2</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-4-mast-tess-kepler-and-k2" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The function to retrieve lightcurves from these three missions currently uses the open source package <a target="_blank" rel="noreferrer" href="https://docs.lightkurve.org/index.html" class=""><code>lightKurve</code></a>.  This search is not efficient at scale and we expect it to be replaced in the future.</p><div id="lHlkWvBI22" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">lightkurvestarttime = time.time()

TESS_search_radius = 1.0  #arcseconds
# get TESS/Kepler/K2 light curves
df_lc_TESS = tess_kepler_get_lightcurves(sample_table, radius=TESS_search_radius)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_TESS)

print(&#x27;TESS/Kepler/K2 search took:&#x27;, time.time() - lightkurvestarttime, &#x27;s&#x27;)

# LightKurve will return an &quot;Error&quot; when it doesn&#x27;t find a match for a target
# These are not real errors and can be safely ignored.</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ruBabwzelZs5b9kezamhQ" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-2-5-mast-hubble-catalog-of-variables" class="relative group"><span class="heading-text">2.5 MAST: Hubble Catalog of Variables</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-5-mast-hubble-catalog-of-variables" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The function to retrieve lightcurves from <a target="_blank" rel="noreferrer" href="https://archive.stsci.edu/hlsp/hcv" class="">HCV</a> currently uses their API; based on this <a target="_blank" rel="noreferrer" href="https://archive.stsci.edu/hst/hsc/help/HCV/HCV_API_demo.html" class="">example</a>. This search is not efficient at scale and we expect it to be replaced in the future.</p><div id="MDC5kAOncq" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">HCVstarttime = time.time()

HCV_radius = 1.0/3600.0 # radius = 1 arcsec
# get HCV light curves
df_lc_HCV = hcv_get_lightcurves(sample_table, radius=HCV_radius)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_HCV)

print(&#x27;HCV search took:&#x27;, time.time() - HCVstarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="XP7MKD7tMf3dXc4RrmZap" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h2 id="id-3-find-light-curves-for-these-targets-in-relevant-non-nasa-catalogs" class="relative group"><span class="heading-text">3. Find light curves for these targets in relevant, non-NASA catalogs</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-find-light-curves-for-these-targets-in-relevant-non-nasa-catalogs" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="id-3-1-irsa-ztf" class="relative group"><span class="heading-text">3.1 IRSA: ZTF</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-irsa-ztf" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The function to retrieve ZTF light curves accesses a <a target="_blank" rel="noreferrer" href="https://hats.readthedocs.io/en/stable/" class="">HATS</a> parquet version of the ZTF catalog stored in the cloud using <a target="_blank" rel="noreferrer" href="https://docs.lsdb.io/en/stable/" class="">LSDB</a>. This is the simplest way to access this dataset at scale.  The ZTF <a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/docs/program_interface/ztf_lightcurve_api.html" class="">API</a> is available for small sample searches.  One unique thing about this function is that it has parallelization built in to the function itself because lsdb uses dask under the hood.</p><p>Expect to see many <code>INFO</code> messages from dask. These are normal.
The traceback for <code>CommClosedErrors</code> is also expected and is just a dask housekeeping issue, the function is still running to completion and returning light curves.</p><div id="jnVMpgzTG4" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ZTFstarttime = time.time()

# get ZTF lightcurves
ztf_search_radius = 1.0 #  arcsec  (Graham et al., 2024 use 1&quot; with good results)
df_lc_ZTF = ztf_get_lightcurves(sample_table, radius = ztf_search_radius)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_ZTF)

print(&#x27;ZTF search took:&#x27;, time.time() - ZTFstarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gTNYVj1saRatJGT3O6oOh" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-3-2-gaia" class="relative group"><span class="heading-text">3.2 Gaia</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-2-gaia" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The function to retrieve Gaia light curves accesses the Gaia DR3 “source lite” catalog using an astroquery search with a table upload to do the join with the Gaia photometry. This is currently the fastest way to access light curves from Gaia at scale.</p><div id="JA5ghv8LNH" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">gaiastarttime = time.time()

# get Gaia light curves
df_lc_gaia = gaia_get_lightcurves(sample_table, search_radius=1/3600, verbose=0)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_gaia)

print(&#x27;gaia search took:&#x27;, time.time() - gaiastarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="1W27QyME3_QHev5G09K76" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-3-3-icecube-neutrinos" class="relative group"><span class="heading-text">3.3 IceCube neutrinos</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-3-icecube-neutrinos" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>There are several <a target="_blank" rel="noreferrer" href="https://icecube.wisc.edu/data-releases/2021/01/all-sky-point-source-icecube-data-years-2008-2018" class="">catalogs</a> (basically one for each year of IceCube data from 2008 - 2018). The following code creates a large catalog by combining
all the yearly catalogs.
The IceCube catalog contains Neutrino detections with associated energy and time and approximate direction (which is uncertain by half-degree scales....). Usually, for active events only one or two Neutrinos are detected, which makes matching quite different compared to “photons”. For our purpose, we will list the top 3 events in energy that are within a given distance to the target.</p><p>This time series (time vs. neutrino energy) information is similar to photometry. We choose to storing time and energy in our data structure, leaving error = 0. What is <strong>not</strong> stored in this format is the distance or angular uncertainty of the event direction.</p><div id="gOqmw9jvx3" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">icecubestarttime = time.time()

# get icecube data points
df_lc_icecube = icecube_get_lightcurves(sample_table, icecube_select_topN=3)

# add the resulting dataframe to all other archives
df_lc.append(df_lc_icecube)

print(&#x27;icecube search took:&#x27;, time.time() - icecubestarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="4OYw3f4u-OiJYD5ko4Ejn" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h3 id="id-3-4-rubin" class="relative group"><span class="heading-text">3.4 Rubin</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-4-rubin" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Before running this section, you need to have both 1) a login to the Rubin Science Platform (RSP) and 2) an authenticating token setup in your Fornax home directory.</p><ol start="1"><li><p>To see if you have Rubin data rights, and if you do, to get that login setup, follow these <a target="_blank" rel="noreferrer" href="https://rsp.lsst.io/guides/getting-started/get-an-account.html" class="">instructions</a></p></li><li><p>After logging in to RSP, follow these <a target="_blank" rel="noreferrer" href="/fornax-demo-notebooks/build/rsp_token_instructio-036feb8368405e2b626969e8054e62e0.txt" class="">instructions</a> to get a token and store it in your home directory.</p></li></ol><p>This code will not work without the above information, so we have commented it out for now.  Uncomment when you are ready to proceed.</p><p>Once that setup is complete, this code access Rubin data from the Rubin Science Platform which is hosting their catalogs in Google Cloud.  Specifically, the code uses <code>pyvo</code> and <code>adql</code> to access a TAP server.</p><div id="lrLVl02J4H" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#uncomment the next 5 lines if you have RSP login and authentication setup

#rspstarttime = time.time()
#rsp_search_radius = 0.001  # degrees

#df_lc_rsp = rubin_get_lightcurves(sample_table, rsp_search_radius)
#df_lc.append(df_lc_rsp) # add the resulting dataframe to all other archives

#print(&#x27;RSP search took:&#x27;, time.time() - rspstarttime, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="mi9z7mS81SKd4dIXSlX2L" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="F7RhAIqSly" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># benchmarking
end_serial = time.time()
print(&#x27;total time for serial archive calls is &#x27;, end_serial - start_serial, &#x27;s&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="zlsXbWj4AvKALbkwgZFh0" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h2 id="id-4-parallel-processing-the-archive-calls" class="relative group"><span class="heading-text">4. Parallel processing the archive calls</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-parallel-processing-the-archive-calls" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This section shows how to increase the speed of the multi-archive search by running the calls in parallel using python’s <code>multiprocessing</code> library.
This can be a convenient and efficient method for small to medium sample sizes.
One drawback is that error messages tend to get lost in the background and never displayed for the user.
Running this on very large samples may fail because of the way the platform is setup to cull sessions which appear to be inactive.
For sample sizes &gt;~500 and/or improved logging and monitoring options, consider using the bash script demonstrated in the related tutorial notebook <a class="" href="/fornax-demo-notebooks/scale-up">scale_up</a>.</p><div id="HdrOL1SZJt" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># number of workers to use in the parallel processing pool
# this should equal the total number of archives called
n_workers = 6

# keyword arguments for the archive calls
heasarc_kwargs = dict(catalog_error_radii={&quot;FERMIGTRIG&quot;: &quot;1.0&quot;, &quot;SAXGRBMGRB&quot;: &quot;3.0&quot;})
ztf_search_radius = 1.0 #  arcsec
wise_kwargs = dict(radius=1.0, bandlist=[&#x27;W1&#x27;, &#x27;W2&#x27;])
panstarrs_search_radius = 1.0 # arcsec
tess_kepler_kwargs = dict(radius=1.0)
hcv_kwargs = dict(radius=1.0/3600.0)
gaia_kwargs = dict(search_radius=1/3600, verbose=0)
icecube_kwargs = dict(icecube_select_topN=3)
rsp_search_radius = 0.001
rsp_kwargs = dict(search_radius=rsp_search_radius)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="stKx0TY20HoppnP7N98Qj" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="rrUHd3tslm" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">parallel_starttime = time.time()

# start a multiprocessing pool and run all the archive queries
parallel_df_lc = MultiIndexDFObject()  # to collect the results
callback = parallel_df_lc.append  # will be called once on the result returned by each archive
with mp.Pool(processes=n_workers) as pool:

    # start the processes that call the archives
    pool.apply_async(heasarc_get_lightcurves, args=(sample_table,), kwds=heasarc_kwargs, callback=callback)
    pool.apply_async(wise_get_lightcurves, args=(sample_table,), kwds=wise_kwargs, callback=callback)
    pool.apply_async(tess_kepler_get_lightcurves, args=(sample_table,), kwds=tess_kepler_kwargs, callback=callback)
    pool.apply_async(hcv_get_lightcurves, args=(sample_table,), kwds=hcv_kwargs, callback=callback)
    pool.apply_async(gaia_get_lightcurves, args=(sample_table,), kwds=gaia_kwargs, callback=callback)
    pool.apply_async(icecube_get_lightcurves, args=(sample_table,), kwds=icecube_kwargs, callback=callback)
#    pool.apply_async(rubin_get_lightcurves, args=(sample_table,), kwds=rsp_kwargs, callback=callback)

    pool.close()  # signal that no more jobs will be submitted to the pool
    pool.join()  # wait for all jobs to complete, including the callback

# run ZTF and panstarrs queries outside of multiprocessing since they
# are using dask distributed under the hood,
# which doesn&#x27;t work with multiprocessing, and dask is already parallelized

df_lc_ZTF = ztf_get_lightcurves(sample_table, radius = ztf_search_radius)
parallel_df_lc.append(df_lc_ZTF)# add the resulting dataframe to all other archives

df_lc_panstarrs = panstarrs_get_lightcurves(sample_table, radius=panstarrs_search_radius)
parallel_df_lc.append(df_lc_panstarrs) # add the panstarrs dataframe to all other archives

parallel_endtime = time.time()

# LightKurve will return an &quot;Error&quot; when it doesn&#x27;t find a match for a target
# These are not real errors and can be safely ignored.

# Warnings from the panstarrs query about both NESTED and margins are known issues</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="POne73yICdkgUPPm-9d21" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="TmruGYvVKW" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># How long did parallel processing take?
# and look at the results
print(&#x27;parallel processing took&#x27;, parallel_endtime - parallel_starttime, &#x27;s&#x27;)
parallel_df_lc.data</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="uA0kBHSqmFhDYoenAEjCI" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="TnJKqYmwGo" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Save the data for future use with ML notebook
#parquet_filename = f&quot;output/{sample_name}_df_lc.parquet&quot;
#parallel_df_lc.data.to_parquet(parquet_savename)
#print(&quot;file saved!&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="n1m3JblrQ5YhKLA2ucEkm" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><div id="Qg06sfJlFf" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Could load a previously saved file in order to plot
#parallel_df_lc = MultiIndexDFObject()
#parallel_df_lc.data = pd.read_parquet(parquet_filename)
#print(&quot;file loaded!&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="J2WhMHT6J7udOQlPXnD9o" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h2 id="id-5-make-plots-of-luminosity-as-a-function-of-time" class="relative group"><span class="heading-text">5. Make plots of luminosity as a function of time</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-make-plots-of-luminosity-as-a-function-of-time" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>These plots are modelled after <a target="_blank" rel="noreferrer" href="https://arxiv.org/pdf/2111.09391.pdf" class="">van Velzen et al., 2021</a>. We show flux in mJy as a function of time for all available bands for each object. <code>show_nbr_figures</code> controls how many plots are actually generated and returned to the screen.  If you choose to save the plots with <code>save_output</code>, they will be put in the output directory and labelled by sample number.</p><p><strong>Note</strong> that in the following, we can either plot the results from <code>df_lc</code> (from the serial call) or <code>parallel_df_lc</code> (from the parallel call). By default (see next cell) the output of the parallel call is used.</p><div id="fOgd9PwHbq" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">_ = create_figures(df_lc = parallel_df_lc, # either df_lc (serial call) or parallel_df_lc (parallel call)
                   show_nbr_figures = 5,  # how many plots do you actually want to see?
                   save_output = False ,  # should the resulting plots be saved?
                  )</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="IVOXozqDLVwR25CHXQ1Vt" class="max-w-full overflow-x-auto m-0 group not-prose relative overflow-y-visible text-left"></div></div><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p><strong>Authors:</strong> Jessica Krick, Shoubaneh Hemmati, Andreas Faisst, Troy Raen, Brigitta Sipőcz, David Shupe, and the Fornax team</p></li><li><p><strong>Contact:</strong> For help with this notebook, please open a topic in the <a target="_blank" rel="noreferrer" href="https://discourse.fornax.sciencecloud.nasa.gov/" class="">Fornax Community Forum</a> “Support” category.</p></li></ul><h3 id="acknowledgements" class="relative group"><span class="heading-text">Acknowledgements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acknowledgements" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Suvi Gezari, Antara Basu-zych, Stephanie LaMassa</p></li><li><p>MAST, HEASARC, &amp; IRSA Fornax teams</p></li></ul><h3 id="references" class="relative group"><span class="heading-text">References</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>This work made use of:</p><ul><li><p>Astroquery; Ginsburg et al., 2019, 2019AJ....157...98G</p></li><li><p>Astropy; Astropy Collaboration 2022, Astropy Collaboration 2018, Astropy Collaboration 2013,    2022ApJ...935..167A, 2018AJ....156..123A, 2013A&amp;A...558A..33A</p></li><li><p>Lightkurve; Lightkurve Collaboration 2018, 2018ascl.soft12013L</p></li><li><p>acstools; <cite class="" data-state="closed"><a href="https://doi.org/10.5281/ZENODO.7406933" target="_blank" rel="noreferrer" class="hover-link">P. L. Lim <em>et al.</em> (2022)</a></cite></p></li><li><p>unWISE light curves; Meisner et al., 2023, 2023AJ....165...36M</p></li></ul><div></div><section id="references" class="article-grid subgrid-gap col-screen"><div><header class="text-lg font-semibold text-stone-900 dark:text-white group">References<a class="no-underline text-inherit hover:text-inherit ml-2 select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to References" aria-label="Link to References">¶</a></header></div><div class="pl-3 mb-8 text-xs text-stone-500 dark:text-stone-300"><ol><li class="break-words" id="cite-https://doi.org/10.5281/zenodo.7406933">P. L. Lim, Hack, W. J., E. M. Bray, Ryon, J., Miles, N., Cara, M., Sienkiewicz, M., Rendina, M., Hunkeler, J., Simon, B., Noss, J., Gagandeep Anand, Desjardins, T., Burnett, Z., Ogaz, S., Geiger, Z., Dencheva, N., & Molaes-Stsci. (2022). <i>spacetelescope/acstools: 3.5.0 Release Notes</i>. Zenodo. <a target="_blank" rel="noreferrer" href="https://doi.org/10.5281/ZENODO.7406933">10.5281/ZENODO.7406933</a></li></ol></div></section><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/fornax-demo-notebooks/readme"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Time Domain</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/fornax-demo-notebooks/scale-up"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Make Multi-Wavelength Light Curves for Large Samples</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/fornax-demo-notebooks/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-F7G67JTZ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/root-7TUVC4ZT.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-INOWNUZ6.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/routes/$-P6PGXPYX.js"/><script>window.__remixContext = {"url":"/light-curve-collector","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.4","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-51910ac30ff807f482a47e3ea6b9f1cd.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-2f549f30f2622a092c47c887989a7af0.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/fornax-demo-notebooks"},"routes/$":{"config":{"version":2,"myst":"1.6.4","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-51910ac30ff807f482a47e3ea6b9f1cd.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-2f549f30f2622a092c47c887989a7af0.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Notebook","sha256":"287909df1b7a0cdf5008f1b0df5757e0f6e208962510ca4b2e27e7ea0ff28f7c","slug":"light-curve-collector","location":"/light_curves/light_curve_collector.md","dependencies":[],"frontmatter":{"title":"Make Multi-Wavelength Light Curves Using Archival Data","kernelspec":{"name":"python3","display_name":"py-light_curve_collector","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.1"}},"skip_execution":true,"content_includes_title":false,"authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","subject":"Fornax Demo Notebooks","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/light_curves/light_curve_collector.md","edit_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/light_curves/light_curve_collector.md","exports":[{"format":"md","filename":"light_curve_collector.md","url":"/fornax-demo-notebooks/build/light_curve_collecto-7047aeb6d3cd3c43979d718f462fcafc.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NPuuN8Vt6o"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"pDxq8OKNP0"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will be able to:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"jZI3IvOMY7"}],"key":"lgBgMyE9eM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Automatically load a catalog of target sources","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"XFfWuRlVNg"}],"key":"etRP4CWvta"}],"key":"tCaNm7fwVl"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Automatically \u0026 efficiently search NASA and non-NASA resources for the light curves of up to ~500 targets","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"c9phX8H3T3"}],"key":"h0o6AcNVYy"}],"key":"S8EeYNV2bU"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Store \u0026 manipulate light curves in a Pandas MultiIndex dataframe","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"wV1LBOwUye"}],"key":"qPvyuqukVZ"}],"key":"JuMeb3tMDH"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Plot all light curves on the same plot","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"TxaZvEcZWz"}],"key":"SXJb1iJO01"}],"key":"Vu0jMfPyls"}],"key":"YKtEuws7So"},{"type":"heading","depth":2,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"khFbU5jKEz"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"DKzqwPxYmy"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":27,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"A user has a sample of interesting targets for which they would like to see a plot of available archival light curves.  We start with a small set of changing look AGN from Yang et al., 2018, which are automatically downloaded. Changing look AGN are cases where the broad emission lines appear or disappear (and not just that the flux is variable).","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"zdYGY2csos"}],"key":"mRRyRXDeUN"}],"key":"y0UjEWh4pe"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"We model light curve plots after van Velzen et al. 2021.  We search through a curated list of time-domain NASA holdings as well as non-NASA sources.  HEASARC catalogs used are Fermi and Beppo-Sax, IRSA catalogs used are ZTF and WISE, and MAST catalogs used are Pan-STARRS, TESS, Kepler, and K2.  Non-NASA sources are Gaia and IceCube. This list is generalized enough to include many types of targets to make this notebook interesting for many types of science.  All of these time-domain archives are searched in an automated and efficient fashion using astroquery, pyvo, pyarrow or APIs.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"tG0Z83wa8F"}],"key":"ehrIuSgCuo"}],"key":"DEKlARv0uV"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Light curve data storage is a tricky problem.  Currently we are using a MultiIndex Pandas dataframe, as the best existing choice for right now.  One downside is that we need to manually track the units of flux and time instead of relying on an astropy storage scheme which would be able to do some of the units worrying for us (even astropy can’t do all magnitude to flux conversions).  Astropy does not currently have a good option for multi-band light curve storage.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"mtvaOb6I7a"}],"key":"eePe2ifh3e"}],"key":"UtWrd7ZMHI"},{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"This notebook walks through the individual steps required to collect the targets and their light curves and create figures. It also shows how to speed up the collection of light curves using python’s ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"i2hZV1qUeJ"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"mv3MOIRK28"},{"type":"text","value":". This is expected to be sufficient for up to ~500 targets. For a larger number of targets, consider using the bash script demonstrated in the neighboring notebook ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"XAU7dj5ChT"},{"type":"link","url":"/scale-up","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"scale_up","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"AZWHV4HG9Y"}],"urlSource":"scale_up.md","dataUrl":"/scale-up.json","internal":true,"protocol":"file","key":"ClHHEZF45m"},{"type":"text","value":".","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"jZjz4Z8OYm"}],"key":"HY5Lc5R7eI"}],"key":"Rk5BTr99Mo"},{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"ML work using these time-series light curves is in two neighboring notebooks: ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"ixy43usWUw"},{"type":"link","url":"/ml-agnzoo","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"ML_AGNzoo","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"ax1paBlOBU"}],"urlSource":"ML_AGNzoo.md","dataUrl":"/ml-agnzoo.json","internal":true,"protocol":"file","key":"rFqTIghkKP"},{"type":"text","value":" and ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"vVgychg8aE"},{"type":"link","url":"/light-curve-classifier","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"light​_curve​_classifier","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"wnG1IZEaZj"}],"urlSource":"light_curve_classifier.md","dataUrl":"/light-curve-classifier.json","internal":true,"protocol":"file","key":"foFuzUceoj"},{"type":"text","value":".","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"iIjTTogxUg"}],"key":"x43Jlz6e0H"}],"key":"tfvlkKTVL4"}],"key":"bsm9tB3i5w"},{"type":"heading","depth":3,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Input","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"CTR0YXES3k"}],"identifier":"input","label":"Input","html_id":"input","implicit":true,"key":"JUsh7441BH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":39,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"choose from a list of known changing look AGN from the literature\nOR -","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"xUes2VAoIe"}],"key":"ODlq8DDoBx"}],"key":"Wf5CGOtUlI"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"input your own sample","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"XqUbB0qkPa"}],"key":"LlCyv3Aptf"}],"key":"doqZHBmHTl"}],"key":"uH4EHV3Qwm"},{"type":"heading","depth":3,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"XxNl8etPyG"}],"identifier":"output","label":"Output","html_id":"output","implicit":true,"key":"KphyB5eQaI"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":45,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"an archival optical + IR + neutrino light curve","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"dEIgjrdiG4"}],"key":"kh9nbHr5yk"}],"key":"nqLJcoDDJ7"}],"key":"u9sDI1iNn7"},{"type":"heading","depth":3,"position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"Runtime","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"Jd4EXg1iUV"}],"identifier":"runtime","label":"Runtime","html_id":"runtime","implicit":true,"key":"wuN0yyopLJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":49,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":49,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"As of 2025 May, this notebook takes ~1000s (17 min.) to run to completion on Fornax using the ‘Astrophysics Default Image’ and the ‘Large’ server with 64GB RAM/ 16CPU.","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"cEWzcGgeZh"}],"key":"qfnkL99t1A"}],"key":"J5yFJnKg5q"}],"key":"Qt5tVUxs2M"},{"type":"heading","depth":2,"position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"hVc31nhkOm"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"EPVqxxKxsG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":53,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"acstools","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"GW6BRkdLiu"},{"type":"text","value":" to work with HST magnitude to flux conversion","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"Wlh6gJHqbd"}],"key":"ReN7InkK1R"}],"key":"X5tJEBlFtW"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"astropy","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"wyRipWXjRj"},{"type":"text","value":" to work with coordinates/units and data structures","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"SxzjiJgheo"}],"key":"nWUT7rQH2t"}],"key":"ZLf9Uq5ok1"},{"type":"listItem","spread":true,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"astroquery","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"D6ti67MctK"},{"type":"text","value":" to interface with archives APIs","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"YNtEiHEgNk"}],"key":"X3trZaOF1z"}],"key":"VfJpLPvlgj"},{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"hpgeom","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"rAxs4WKuiO"},{"type":"text","value":" to locate coordinates in HEALPix space","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"Aa95oiTT2U"}],"key":"wNUZabJd5P"}],"key":"CQMG5HETOp"},{"type":"listItem","spread":true,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"lightkurve","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"TjNG6EN5S8"},{"type":"text","value":" to search TESS, Kepler, and K2 archives","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"WVFPsGbd31"}],"key":"vHNtf8aNHq"}],"key":"ARqTR6KArp"},{"type":"listItem","spread":true,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"matplotlib","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"gqB1ReyluZ"},{"type":"text","value":" for plotting","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"LP3kl5HBLu"}],"key":"UB3PhXX5iK"}],"key":"JPSjpfb16b"},{"type":"listItem","spread":true,"position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"Jpmm4o7wIP"},{"type":"text","value":" to use the power of multiple CPUs to get work done faster","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"pr2CMwxIsR"}],"key":"m4M6WWkAq5"}],"key":"yPiZZHsdM6"},{"type":"listItem","spread":true,"position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"numpy","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"NYlvpUCLoY"},{"type":"text","value":" for numerical processing","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"hfiq5EeQN5"}],"key":"pded42NUbt"}],"key":"a3HYBtx2Zx"},{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"pandas","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"yXmd6oXlZq"},{"type":"text","value":" with their ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"I1fjg9Mdpa"},{"type":"inlineCode","value":"[aws]","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"r0Z5yzE967"},{"type":"text","value":" extras for their data structure DataFrame and all the accompanying functions","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"dnSWRjkGWW"}],"key":"JGulxo0fYp"}],"key":"TQQJATE2un"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"pyarrow","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"DD3QQRCHu5"},{"type":"text","value":" to work with Parquet files for WISE and ZTF","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"vkm0Ct085V"}],"key":"AEsMcO2gPn"}],"key":"PQuEjvwEWP"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"pyvo","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"cpJ0cM5SnX"},{"type":"text","value":" for accessing Virtual Observatory(VO) standard data","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"Gd9zlVqoak"}],"key":"yBck4DfbpI"}],"key":"KsG0xdas2i"},{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"requests","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"uMjPQsDAqn"},{"type":"text","value":" to get information from URLs","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"NkSXsnhpJZ"}],"key":"wB8uzvq5I8"}],"key":"QpYwRtAMm4"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"scipy","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"VLd2Sf2orm"},{"type":"text","value":" to do statistics","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"jeeDJUV0m0"}],"key":"JBh4TPHiVi"}],"key":"K6uK5kVKtN"},{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"tqdm","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"lOhh5uio67"},{"type":"text","value":" to track progress on long running jobs","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"tpNuUtdDOl"}],"key":"VS3ONBgVYG"}],"key":"HTpPoUy7Gr"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"urllib","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"FW4f80pXQq"},{"type":"text","value":" to handle archive searches with website interface","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"pxOCTxUUi6"}],"key":"PuIwwT2LFu"}],"key":"DdJ99oTOdE"}],"key":"dJGypGbLQG"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"This cell will install them if needed:","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"SzVMuRbgYb"}],"key":"eBQGedAPH4"}],"key":"fNlDBh3eq9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# %pip install -r requirements_light_curve_collector.txt","key":"ZFiCHleKdM"},{"type":"output","id":"GQ34VRqoy4DGUsRZTvUvM","data":[],"key":"ylm2eaKgfd"}],"key":"X2LdAlnhRZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import multiprocessing as mp\nimport sys\nimport time\n\nimport astropy.units as u\nimport pandas as pd\nfrom astropy.table import Table\n\n# local code imports\nsys.path.append('code_src/')\nfrom data_structures import MultiIndexDFObject\nfrom gaia_functions import gaia_get_lightcurves\nfrom hcv_functions import hcv_get_lightcurves\nfrom heasarc_functions import heasarc_get_lightcurves\nfrom icecube_functions import icecube_get_lightcurves\nfrom panstarrs_functions import panstarrs_get_lightcurves\nfrom plot_functions import create_figures\nfrom sample_selection import (clean_sample, get_green_sample, get_hon_sample, get_lamassa_sample, get_lopeznavas_sample,\n    get_lyu_sample, get_macleod16_sample, get_macleod19_sample, get_ruan_sample, get_sdss_sample, get_sheng_sample, get_yang_sample)\nfrom tess_kepler_functions import tess_kepler_get_lightcurves\nfrom wise_functions import wise_get_lightcurves\nfrom rubin_functions import rubin_get_lightcurves\nfrom ztf_functions import ztf_get_lightcurves","key":"nwUhmdjccT"},{"type":"output","id":"f8gGLHF8qyxMWnV709S5r","data":[],"key":"aAwR7EDw3a"}],"key":"NOSmKbTiAn"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"1. Define the sample","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"eF2oqkhbD4"}],"identifier":"id-1-define-the-sample","label":"1. Define the sample","html_id":"id-1-define-the-sample","implicit":true,"key":"zEvDdfSsNW"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"We define here a “gold” sample of spectroscopically confirmed changing look AGN and quasars. This sample includes both objects which change from type 1 to type 2 and also the opposite.  Future studies may want to treat these as separate objects or separate QSOs from AGN.  Bibcodes for the samples used are listed next to their functions for reference.","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"viBWPmYpYa"}],"key":"kDdodaIj8C"},{"type":"paragraph","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"Significant work went into the functions which grab the samples from the papers.  They use Astroquery, NED, SIMBAD, Vizier, and in a few cases grab the tables from the html versions of the paper.  There are trickeries involved in accessing coordinates from tables in the literature. Not every literature table is stored in its entirety in all of these resources, so be sure to check that your chosen method is actually getting the information that you see in the paper table.  Warning: You will get false results if using NED or SIMBAD on a table that has more rows than are printed in the journal.","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"LaZHXlyYw8"}],"key":"NpRqvVTCJJ"}],"key":"a2Invk7Mu4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Build up the sample\n# Initially set up lists to hold the coordinates and their reference paper name as a label\ncoords =[]\nlabels = []\n\n# Choose your own adventure:\n\n#get_lamassa_sample(coords, labels)  #2015ApJ...800..144L\n#get_macleod16_sample(coords, labels) #2016MNRAS.457..389M\n#get_ruan_sample(coords, labels) #2016ApJ...826..188R\n#get_macleod19_sample(coords, labels)  #2019ApJ...874....8M\n#get_sheng_sample(coords, labels)  #2020ApJ...889...46S\n#get_green_sample(coords, labels)  #2022ApJ...933..180G\n#get_lyu_sample(coords, labels)  #z32022ApJ...927..227L\n#get_lopeznavas_sample(coords, labels)  #2022MNRAS.513L..57L\n#get_hon_sample(coords, labels)  #2022MNRAS.511...54H\nget_yang_sample(coords, labels)   #2018ApJ...862..109Y\n\n# Get some \"normal\" QSOs\n# there are ~500K of these, so choose the number based on\n# a balance between speed of running the light curves and whatever\n# the ML algorithms would like to have\n\n# num_normal_QSO = 5000\n# zmin, zmax = 0, 10\n# randomize_z = False\n#get_sdss_sample(coords, labels, num=num_normal_QSO, zmin=zmin, zmax=zmax, randomize_z=randomize_z)\n\n# Remove duplicates, attach an objectid to the coords,\n# convert to astropy table to keep all relevant info together\nsample_table = clean_sample(coords, labels)\n\n#give this sample a name for use in saving files\nsample_name = \"yang_CLAGN\"","key":"YFWR3OUCrM"},{"type":"output","id":"PB2T6osBTBSdQ-qgKPbcG","data":[],"key":"AWCnwI7BNW"}],"key":"RBtUtYPYJi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sample_table","key":"UMIb4WwTqb"},{"type":"output","id":"3J5imnkbwi80iREckR-Za","data":[],"key":"FhIdDly4aP"}],"key":"XLIuhaOCdy"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"1.1 Build your own sample","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"lwxgov9VCK"}],"identifier":"id-1-1-build-your-own-sample","label":"1.1 Build your own sample","html_id":"id-1-1-build-your-own-sample","implicit":true,"key":"dGqcN6oqbG"},{"type":"paragraph","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"To build your own sample, you can follow the examples of functions above to grab coordinates from your favorite literature resource,","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"x9t2VZLFjB"}],"key":"AOyloCr1Gy"},{"type":"paragraph","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"or","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"M75PVjq6Qu"}],"key":"Agq5xEQnel"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"text","value":"You can use ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"G2BGP0nuIn"},{"type":"link","url":"https://docs.astropy.org/en/stable/io/ascii/read.html","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"astropy’s read","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"VbenhjcMoE"}],"urlSource":"https://docs.astropy.org/en/stable/io/ascii/read.html","key":"Ojde8EtXnB"},{"type":"text","value":" function to read in an input table\nto an ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"nX3RYR9O9u"},{"type":"link","url":"https://docs.astropy.org/en/stable/table/","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"astropy table","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"MgPnkMMLm7"}],"urlSource":"https://docs.astropy.org/en/stable/table/","key":"BOfRkRDDnf"}],"key":"vfBkHlbApq"}],"key":"UxoucaYjru"},{"type":"block","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"children":[{"type":"text","value":"1.2 Write out your sample to disk","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"key":"d66NymOkz3"}],"identifier":"id-1-2-write-out-your-sample-to-disk","label":"1.2 Write out your sample to disk","html_id":"id-1-2-write-out-your-sample-to-disk","implicit":true,"key":"G0tujh3d4t"},{"type":"paragraph","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"children":[{"type":"text","value":"At this point you may wish to write out your sample to disk and reuse that in future work sessions, instead of creating it from scratch again.","position":{"start":{"line":163,"column":1},"end":{"line":163,"column":1}},"key":"GWd4njbFmJ"}],"key":"JrPgMjV9oY"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"For the format of the save file, we would suggest to choose from various formats that fully support astropy objects(eg., SkyCoord).  One example that works is Enhanced Character-Separated Values or ","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"Lj6hMAivOa"},{"type":"link","url":"https://docs.astropy.org/en/stable/io/ascii/ecsv.html","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"‘ecsv’","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"eI2MrpVDAz"}],"urlSource":"https://docs.astropy.org/en/stable/io/ascii/ecsv.html","key":"kHFcBAXgrg"}],"key":"HydeyC3HUP"}],"key":"hDg73jVTw2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"savename_sample = f\"output/{sample_name}_sample.ecsv\"\nsample_table.write(savename_sample, format='ascii.ecsv', overwrite = True)","key":"XtWJxtYZp5"},{"type":"output","id":"RXqtewLG-zenBF3y7QH9-","data":[],"key":"lDQ6AAFW7H"}],"key":"K8c6gk3m9W"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"1.3 Load the sample table from disk","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"CV4gaFrzGF"}],"identifier":"id-1-3-load-the-sample-table-from-disk","label":"1.3 Load the sample table from disk","html_id":"id-1-3-load-the-sample-table-from-disk","implicit":true,"key":"Tjko05nZX8"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"Do only this step from this section when you have a previously generated sample table","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"CNxbNeBGVL"}],"key":"AI3fs09kzg"}],"key":"fXCgWfJRmX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#sample_table = Table.read(savename_sample, format='ascii.ecsv')","key":"mxlvWxTpQZ"},{"type":"output","id":"gLeXcMNHUw5yVQg5Or5N7","data":[],"key":"ujDKwXPFqO"}],"key":"XrxRH0bTjO"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"1.4 Initialize data structure to hold the light curves","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"H46455wKVH"}],"identifier":"id-1-4-initialize-data-structure-to-hold-the-light-curves","label":"1.4 Initialize data structure to hold the light curves","html_id":"id-1-4-initialize-data-structure-to-hold-the-light-curves","implicit":true,"key":"ZKU8gK4CpB"}],"key":"uMPnCbit7H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# We wrote our own class for a Pandas MultiIndex [DataFrame](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html) for storing the light curves\n# This class helps simplify coding of common uses for the DataFrame.\ndf_lc = MultiIndexDFObject()","key":"TSyuSmJxdJ"},{"type":"output","id":"xLHmBHSBlvS9L1ABRLe14","data":[],"key":"c0kR69Fbtv"}],"key":"zK0eKQzDhQ"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"2. Find light curves for these targets in NASA catalogs","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"hrZaEjApIQ"}],"identifier":"id-2-find-light-curves-for-these-targets-in-nasa-catalogs","label":"2. Find light curves for these targets in NASA catalogs","html_id":"id-2-find-light-curves-for-these-targets-in-nasa-catalogs","implicit":true,"key":"NTdGpepYsR"},{"type":"paragraph","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"We search a curated list of time-domain catalogs from NASA astrophysics archives.  Because each archive is different, and in many cases each catalog is different, each function to access a catalog is necessarily specialized to the location and format of that particular catalog.","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"PvQvnw2YqW"}],"key":"A499x3NY7L"}],"key":"MfR4dyImJS"},{"type":"block","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"2.1 HEASARC: FERMI \u0026 Beppo SAX","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"XxFwuvvYtv"}],"identifier":"id-2-1-heasarc-fermi-beppo-sax","label":"2.1 HEASARC: FERMI \u0026 Beppo SAX","html_id":"id-2-1-heasarc-fermi-beppo-sax","implicit":true,"key":"Rnk2AyUL6q"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"The function to retrieve HEASARC data accesses the HEASARC archive using a pyvo search with a table upload.  This is the fastest way to access data from HEASARC catalogs at scale.","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"D6B5b7xRV2"}],"key":"k0lXqCtmbD"},{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"While these aren’t strictly light curves, we would like to track if there are gamma rays detected in advance of any change in the CLAGN light curves. We store these gamma ray detections as single data points.  Because gamma ray detections typically have very large error radii, our current technique is to keep matches in the catalogs within some manually selected error radius, currently defaulting to 1 degree for Fermi and 3 degrees for Beppo SAX.  These values are chosen based on a histogram of all values for those catalogs.","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"AUvbDYVXZQ"}],"key":"NnrYOOODrC"}],"key":"QUlVF1oVcy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start_serial = time.time()  #keep track of all serial archive calls to compare later with parallel archive call time\nheasarcstarttime = time.time()\n\n# What is the size of error_radius for the catalogs that we will accept for our cross-matching?\n# in degrees; chosen based on histogram of all values for these catalogs\nmax_fermi_error_radius = str(1.0)\nmax_sax_error_radius = str(3.0)\n\n# catalogs to query and their corresponding max error radii\nheasarc_catalogs = {\"FERMIGTRIG\": max_fermi_error_radius, \"SAXGRBMGRB\": max_sax_error_radius}\n\n# get heasarc light curves in the above curated list of catalogs\ndf_lc_HEASARC = heasarc_get_lightcurves(sample_table, catalog_error_radii=heasarc_catalogs)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_HEASARC)\n\nprint('heasarc search took:', time.time() - heasarcstarttime, 's')","key":"ZAvzWDhfFc"},{"type":"output","id":"5T_WGanuIRlXxJpBwIpjG","data":[],"key":"y1Pv58wcOB"}],"key":"jy5JZPdtcZ"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"children":[{"type":"text","value":"2.2 IRSA: WISE","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"HSDpRoltvz"}],"identifier":"id-2-2-irsa-wise","label":"2.2 IRSA: WISE","html_id":"id-2-2-irsa-wise","implicit":true,"key":"hlbeIBF6nh"},{"type":"paragraph","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"We use the unWISE light curves catalog (","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"QAjzsY1sMz"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2023AJ....165...36M/abstract","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"Meisner et al., 2023","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"RPycPdc0bj"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2023AJ....165...36M/abstract","key":"lG2dCv12EW"},{"type":"text","value":") which ties together all WISE \u0026 NEOWISE 2010 - 2020 epochs.  Specifically it combines all observations at a single epoch to achieve deeper mag limits than individual observations alone.","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"s3s3qYr4HF"}],"key":"z2eBUqhNfB"},{"type":"paragraph","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"The function to retrieve WISE light curves accesses an IRSA generated version of the catalog in parquet format being stored in the AWS cloud ","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"OEMCs1NJRR"},{"type":"link","url":"https://registry.opendata.aws/collab/nasa/","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"Open Data Repository","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"XrOaepDACk"}],"urlSource":"https://registry.opendata.aws/collab/nasa/","key":"dM8DSebS0Y"}],"key":"oNEmu8A157"}],"key":"DIgkxmbGM0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"WISEstarttime = time.time()\n\nbandlist = ['W1', 'W2']  #list of the WISE band names\nWISE_radius = 1.0  # arcsec\n# get WISE light curves\ndf_lc_WISE = wise_get_lightcurves(sample_table, radius=WISE_radius, bandlist=bandlist)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_WISE)\n\nprint('WISE search took:', time.time() - WISEstarttime, 's')","key":"EREiMAYsBS"},{"type":"output","id":"tVpkCswJJt8mYx_QcFPcc","data":[],"key":"yzHVbUnXZ1"}],"key":"FKn2kr0Npn"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"2.3 MAST: Pan-STARRS","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"yqxs3yNK79"}],"identifier":"id-2-3-mast-pan-starrs","label":"2.3 MAST: Pan-STARRS","html_id":"id-2-3-mast-pan-starrs","implicit":true,"key":"iRPAi2h98X"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"The function to retrieve lightcurves from Pan-STARRS uses ","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"WEweffXUeP"},{"type":"link","url":"https://docs.lsdb.io/","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"LSDB","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"KAjy35JSX3"}],"urlSource":"https://docs.lsdb.io/","key":"bz3fD0cpYz"},{"type":"text","value":" to access versions of the object and light curve catalogs that are stored in the cloud.  This function is efficient at large scale (sample sizes \u003e ~1000).","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"xzp6P0uT08"}],"key":"lVXQOBK8Cf"},{"type":"paragraph","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"Some warnings are expected.","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"P0f3ENPHSV"}],"key":"VhuPwG9Hek"}],"key":"cNFZeaze4B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"panstarrsstarttime = time.time()\n\npanstarrs_search_radius = 1.0 # search radius = 1 arcsec\n# get panstarrs light curves\ndf_lc_panstarrs = panstarrs_get_lightcurves(sample_table, radius=panstarrs_search_radius)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_panstarrs)\n\nprint('Panstarrs search took:', time.time() - panstarrsstarttime, 's')\n\n# Warnings from the panstarrs query about both NESTED and margins are known issues","key":"cRqnWIg6WJ"},{"type":"output","id":"7plyKs4GGxoJYkgGHxDHc","data":[],"key":"qQl4RHklmO"}],"key":"RYEYflmrrb"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"2.4 MAST: TESS, Kepler and K2","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"Oz0kGMqUcs"}],"identifier":"id-2-4-mast-tess-kepler-and-k2","label":"2.4 MAST: TESS, Kepler and K2","html_id":"id-2-4-mast-tess-kepler-and-k2","implicit":true,"key":"ekkJaeOKq7"},{"type":"paragraph","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"The function to retrieve lightcurves from these three missions currently uses the open source package ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"bsTBRHHNab"},{"type":"link","url":"https://docs.lightkurve.org/index.html","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"inlineCode","value":"lightKurve","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"Bv1D0vfhX6"}],"urlSource":"https://docs.lightkurve.org/index.html","key":"u7s2TXDibw"},{"type":"text","value":".  This search is not efficient at scale and we expect it to be replaced in the future.","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"r1I1Oh8p2B"}],"key":"Dia1OmquTm"}],"key":"XCI46ApSbC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lightkurvestarttime = time.time()\n\nTESS_search_radius = 1.0  #arcseconds\n# get TESS/Kepler/K2 light curves\ndf_lc_TESS = tess_kepler_get_lightcurves(sample_table, radius=TESS_search_radius)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_TESS)\n\nprint('TESS/Kepler/K2 search took:', time.time() - lightkurvestarttime, 's')\n\n# LightKurve will return an \"Error\" when it doesn't find a match for a target\n# These are not real errors and can be safely ignored.","key":"dlKfmbctnB"},{"type":"output","id":"ruBabwzelZs5b9kezamhQ","data":[],"key":"z7QsspgYMI"}],"key":"lHlkWvBI22"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"children":[{"type":"text","value":"2.5 MAST: Hubble Catalog of Variables","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"key":"t3nQ1AZ9qp"}],"identifier":"id-2-5-mast-hubble-catalog-of-variables","label":"2.5 MAST: Hubble Catalog of Variables","html_id":"id-2-5-mast-hubble-catalog-of-variables","implicit":true,"key":"OBfF4CZZZC"},{"type":"paragraph","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"The function to retrieve lightcurves from ","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"WXL8LUVb1d"},{"type":"link","url":"https://archive.stsci.edu/hlsp/hcv","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"HCV","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"hrLk5HBHp5"}],"urlSource":"https://archive.stsci.edu/hlsp/hcv","key":"n0XVC7ghNB"},{"type":"text","value":" currently uses their API; based on this ","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"Ptc1Mt6FZz"},{"type":"link","url":"https://archive.stsci.edu/hst/hsc/help/HCV/HCV_API_demo.html","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"example","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"onhFxTsj1z"}],"urlSource":"https://archive.stsci.edu/hst/hsc/help/HCV/HCV_API_demo.html","key":"aBWZ0982LF"},{"type":"text","value":". This search is not efficient at scale and we expect it to be replaced in the future.","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"Ptcw3kYI9N"}],"key":"Xr3FlbnUvq"}],"key":"PgLtUH7ROZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"HCVstarttime = time.time()\n\nHCV_radius = 1.0/3600.0 # radius = 1 arcsec\n# get HCV light curves\ndf_lc_HCV = hcv_get_lightcurves(sample_table, radius=HCV_radius)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_HCV)\n\nprint('HCV search took:', time.time() - HCVstarttime, 's')","key":"Ue3slZGCQZ"},{"type":"output","id":"XP7MKD7tMf3dXc4RrmZap","data":[],"key":"pdlbaxeAsP"}],"key":"MDC5kAOncq"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"3. Find light curves for these targets in relevant, non-NASA catalogs","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"wM88nubotX"}],"identifier":"id-3-find-light-curves-for-these-targets-in-relevant-non-nasa-catalogs","label":"3. Find light curves for these targets in relevant, non-NASA catalogs","html_id":"id-3-find-light-curves-for-these-targets-in-relevant-non-nasa-catalogs","implicit":true,"key":"Q9lFJ47iGC"}],"key":"RF6XaqVPNG"},{"type":"block","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"3.1 IRSA: ZTF","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"Tp0s45U5IE"}],"identifier":"id-3-1-irsa-ztf","label":"3.1 IRSA: ZTF","html_id":"id-3-1-irsa-ztf","implicit":true,"key":"UI3gnsnMjw"},{"type":"paragraph","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"The function to retrieve ZTF light curves accesses a ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"QlSZMTuit8"},{"type":"link","url":"https://hats.readthedocs.io/en/stable/","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"HATS","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"n5l1qWiHLT"}],"urlSource":"https://hats.readthedocs.io/en/stable/","key":"KBpmc1MKld"},{"type":"text","value":" parquet version of the ZTF catalog stored in the cloud using ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"PqZRVEfgZ5"},{"type":"link","url":"https://docs.lsdb.io/en/stable/","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"LSDB","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"Pwa7g8sAsl"}],"urlSource":"https://docs.lsdb.io/en/stable/","key":"oGWA6Tes8A"},{"type":"text","value":". This is the simplest way to access this dataset at scale.  The ZTF ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"L9FMpx8jxe"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/program_interface/ztf_lightcurve_api.html","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"API","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"A29zZxnnDE"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/program_interface/ztf_lightcurve_api.html","key":"nAoYpBfWLr"},{"type":"text","value":" is available for small sample searches.  One unique thing about this function is that it has parallelization built in to the function itself because lsdb uses dask under the hood.","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"felnfZLeY4"}],"key":"p7KmjXq83X"},{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"text","value":"Expect to see many ","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"z5cjMH2ta6"},{"type":"inlineCode","value":"INFO","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"RIluEQ1u5p"},{"type":"text","value":" messages from dask. These are normal.\nThe traceback for ","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"EC3g9bC22e"},{"type":"inlineCode","value":"CommClosedErrors","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"QAzMJu4QdK"},{"type":"text","value":" is also expected and is just a dask housekeeping issue, the function is still running to completion and returning light curves.","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"ZvIqbK6pFX"}],"key":"l6qhnNsIgd"}],"key":"kd31cLLu0j"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ZTFstarttime = time.time()\n\n# get ZTF lightcurves\nztf_search_radius = 1.0 #  arcsec  (Graham et al., 2024 use 1\" with good results)\ndf_lc_ZTF = ztf_get_lightcurves(sample_table, radius = ztf_search_radius)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_ZTF)\n\nprint('ZTF search took:', time.time() - ZTFstarttime, 's')","key":"ODfbwfIxH8"},{"type":"output","id":"gTNYVj1saRatJGT3O6oOh","data":[],"key":"e0Dm0NiW1j"}],"key":"jnVMpgzTG4"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"children":[{"type":"text","value":"3.2 Gaia","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"key":"UGDU8Gw3Id"}],"identifier":"id-3-2-gaia","label":"3.2 Gaia","html_id":"id-3-2-gaia","implicit":true,"key":"Dj25A1VkAY"},{"type":"paragraph","position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"children":[{"type":"text","value":"The function to retrieve Gaia light curves accesses the Gaia DR3 “source lite” catalog using an astroquery search with a table upload to do the join with the Gaia photometry. This is currently the fastest way to access light curves from Gaia at scale.","position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"key":"Co49aUabN7"}],"key":"rGRthmI2aH"}],"key":"RNBw0gLaw5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gaiastarttime = time.time()\n\n# get Gaia light curves\ndf_lc_gaia = gaia_get_lightcurves(sample_table, search_radius=1/3600, verbose=0)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_gaia)\n\nprint('gaia search took:', time.time() - gaiastarttime, 's')","key":"bMvFjeM4SW"},{"type":"output","id":"1W27QyME3_QHev5G09K76","data":[],"key":"iPg4pYrSm1"}],"key":"JA5ghv8LNH"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":339,"column":1},"end":{"line":339,"column":1}},"children":[{"type":"text","value":"3.3 IceCube neutrinos","position":{"start":{"line":339,"column":1},"end":{"line":339,"column":1}},"key":"dWvzBjGHUK"}],"identifier":"id-3-3-icecube-neutrinos","label":"3.3 IceCube neutrinos","html_id":"id-3-3-icecube-neutrinos","implicit":true,"key":"LBzfqYn3yj"},{"type":"paragraph","position":{"start":{"line":341,"column":1},"end":{"line":343,"column":1}},"children":[{"type":"text","value":"There are several ","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"key":"cSUsFAo3hp"},{"type":"link","url":"https://icecube.wisc.edu/data-releases/2021/01/all-sky-point-source-icecube-data-years-2008-2018","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"children":[{"type":"text","value":"catalogs","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"key":"kk6zgT9Zqm"}],"urlSource":"https://icecube.wisc.edu/data-releases/2021/01/all-sky-point-source-icecube-data-years-2008-2018","key":"uteOJsy47S"},{"type":"text","value":" (basically one for each year of IceCube data from 2008 - 2018). The following code creates a large catalog by combining\nall the yearly catalogs.\nThe IceCube catalog contains Neutrino detections with associated energy and time and approximate direction (which is uncertain by half-degree scales....). Usually, for active events only one or two Neutrinos are detected, which makes matching quite different compared to “photons”. For our purpose, we will list the top 3 events in energy that are within a given distance to the target.","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"key":"BpwLeffr4T"}],"key":"qCpqZXiRoq"},{"type":"paragraph","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"children":[{"type":"text","value":"This time series (time vs. neutrino energy) information is similar to photometry. We choose to storing time and energy in our data structure, leaving error = 0. What is ","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"TaOMIDug9I"},{"type":"strong","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"children":[{"type":"text","value":"not","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"Kc1S3qwoOd"}],"key":"JRlWEEVqDm"},{"type":"text","value":" stored in this format is the distance or angular uncertainty of the event direction.","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"DJCEeSg16g"}],"key":"QtFG0yLpaA"}],"key":"hCPv5n9o4j"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"icecubestarttime = time.time()\n\n# get icecube data points\ndf_lc_icecube = icecube_get_lightcurves(sample_table, icecube_select_topN=3)\n\n# add the resulting dataframe to all other archives\ndf_lc.append(df_lc_icecube)\n\nprint('icecube search took:', time.time() - icecubestarttime, 's')","key":"cczhiF9dNt"},{"type":"output","id":"4OYw3f4u-OiJYD5ko4Ejn","data":[],"key":"yy5FqZr0QT"}],"key":"gOqmw9jvx3"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"children":[{"type":"text","value":"3.4 Rubin","position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"key":"qUlXPqecTQ"}],"identifier":"id-3-4-rubin","label":"3.4 Rubin","html_id":"id-3-4-rubin","implicit":true,"key":"vT06K5JnIi"},{"type":"paragraph","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"children":[{"type":"text","value":"Before running this section, you need to have both 1) a login to the Rubin Science Platform (RSP) and 2) an authenticating token setup in your Fornax home directory.","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"sBVpP3Jnk4"}],"key":"X1C880dzfx"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":363,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":363,"column":1},"end":{"line":364,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"To see if you have Rubin data rights, and if you do, to get that login setup, follow these ","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"qJ59d7xAry"},{"type":"link","url":"https://rsp.lsst.io/guides/getting-started/get-an-account.html","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"instructions","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"NpWDp4JrhS"}],"urlSource":"https://rsp.lsst.io/guides/getting-started/get-an-account.html","key":"kO4Ehet6Sm"}],"key":"HLP6bzQ87k"}],"key":"grMWQOWlCL"},{"type":"listItem","spread":true,"position":{"start":{"line":365,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"After logging in to RSP, follow these ","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"DUUgFbVRBj"},{"type":"link","url":"/fornax-demo-notebooks/build/rsp_token_instructio-036feb8368405e2b626969e8054e62e0.txt","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"instructions","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"K3OJd3SpRP"}],"urlSource":"code_src/rsp_token_instructions.txt","static":true,"protocol":"file","key":"iJSAyG1HX1"},{"type":"text","value":" to get a token and store it in your home directory.","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"lbD57zFOz1"}],"key":"VmFluSERnn"}],"key":"NPATYvrWd9"}],"key":"bCzegAwitG"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"This code will not work without the above information, so we have commented it out for now.  Uncomment when you are ready to proceed.","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Iwt0UQeOHh"}],"key":"FSXm6aAFxU"},{"type":"paragraph","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"Once that setup is complete, this code access Rubin data from the Rubin Science Platform which is hosting their catalogs in Google Cloud.  Specifically, the code uses ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"vUJm4qLBy7"},{"type":"inlineCode","value":"pyvo","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"m5ev6a6Tf0"},{"type":"text","value":" and ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"ufG1FkcXYQ"},{"type":"inlineCode","value":"adql","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"q5EKsAGEpq"},{"type":"text","value":" to access a TAP server.","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"Q16Krx2w00"}],"key":"KEmPVy1Em4"}],"key":"Z7eqlt6VaR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#uncomment the next 5 lines if you have RSP login and authentication setup\n\n#rspstarttime = time.time()\n#rsp_search_radius = 0.001  # degrees\n\n#df_lc_rsp = rubin_get_lightcurves(sample_table, rsp_search_radius)\n#df_lc.append(df_lc_rsp) # add the resulting dataframe to all other archives\n\n#print('RSP search took:', time.time() - rspstarttime, 's')","key":"ZubMagPFYP"},{"type":"output","id":"mi9z7mS81SKd4dIXSlX2L","data":[],"key":"vRxeSRbNkV"}],"key":"lrLVl02J4H"},{"type":"block","children":[],"key":"ELxmGLD3QK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# benchmarking\nend_serial = time.time()\nprint('total time for serial archive calls is ', end_serial - start_serial, 's')","key":"b1dtPqJ8Ev"},{"type":"output","id":"zlsXbWj4AvKALbkwgZFh0","data":[],"key":"VYOOKA7l63"}],"key":"F7RhAIqSly"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":391,"column":1},"end":{"line":391,"column":1}},"children":[{"type":"text","value":"4. Parallel processing the archive calls","position":{"start":{"line":391,"column":1},"end":{"line":391,"column":1}},"key":"SFttIvTY7S"}],"identifier":"id-4-parallel-processing-the-archive-calls","label":"4. Parallel processing the archive calls","html_id":"id-4-parallel-processing-the-archive-calls","implicit":true,"key":"zcCGMF9m5u"},{"type":"paragraph","position":{"start":{"line":393,"column":1},"end":{"line":397,"column":1}},"children":[{"type":"text","value":"This section shows how to increase the speed of the multi-archive search by running the calls in parallel using python’s ","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"key":"AFiBjdqMqY"},{"type":"inlineCode","value":"multiprocessing","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"key":"YVpYAeVoGc"},{"type":"text","value":" library.\nThis can be a convenient and efficient method for small to medium sample sizes.\nOne drawback is that error messages tend to get lost in the background and never displayed for the user.\nRunning this on very large samples may fail because of the way the platform is setup to cull sessions which appear to be inactive.\nFor sample sizes \u003e~500 and/or improved logging and monitoring options, consider using the bash script demonstrated in the related tutorial notebook ","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"key":"ELX0ozNVOa"},{"type":"link","url":"/scale-up","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"children":[{"type":"text","value":"scale_up","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"key":"CQ1HyHLWZK"}],"urlSource":"scale_up.md","dataUrl":"/scale-up.json","internal":true,"protocol":"file","key":"ZI91meu4ey"},{"type":"text","value":".","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"key":"LicQH001Jw"}],"key":"ctgzTOJi1i"}],"key":"MhUXfdWlig"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# number of workers to use in the parallel processing pool\n# this should equal the total number of archives called\nn_workers = 6\n\n# keyword arguments for the archive calls\nheasarc_kwargs = dict(catalog_error_radii={\"FERMIGTRIG\": \"1.0\", \"SAXGRBMGRB\": \"3.0\"})\nztf_search_radius = 1.0 #  arcsec\nwise_kwargs = dict(radius=1.0, bandlist=['W1', 'W2'])\npanstarrs_search_radius = 1.0 # arcsec\ntess_kepler_kwargs = dict(radius=1.0)\nhcv_kwargs = dict(radius=1.0/3600.0)\ngaia_kwargs = dict(search_radius=1/3600, verbose=0)\nicecube_kwargs = dict(icecube_select_topN=3)\nrsp_search_radius = 0.001\nrsp_kwargs = dict(search_radius=rsp_search_radius)","key":"ZXVVS2S0Jc"},{"type":"output","id":"stKx0TY20HoppnP7N98Qj","data":[],"key":"NQZs5qxlMA"}],"key":"HdrOL1SZJt"},{"type":"block","children":[],"key":"rmWR2aJFdY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"parallel_starttime = time.time()\n\n# start a multiprocessing pool and run all the archive queries\nparallel_df_lc = MultiIndexDFObject()  # to collect the results\ncallback = parallel_df_lc.append  # will be called once on the result returned by each archive\nwith mp.Pool(processes=n_workers) as pool:\n\n    # start the processes that call the archives\n    pool.apply_async(heasarc_get_lightcurves, args=(sample_table,), kwds=heasarc_kwargs, callback=callback)\n    pool.apply_async(wise_get_lightcurves, args=(sample_table,), kwds=wise_kwargs, callback=callback)\n    pool.apply_async(tess_kepler_get_lightcurves, args=(sample_table,), kwds=tess_kepler_kwargs, callback=callback)\n    pool.apply_async(hcv_get_lightcurves, args=(sample_table,), kwds=hcv_kwargs, callback=callback)\n    pool.apply_async(gaia_get_lightcurves, args=(sample_table,), kwds=gaia_kwargs, callback=callback)\n    pool.apply_async(icecube_get_lightcurves, args=(sample_table,), kwds=icecube_kwargs, callback=callback)\n#    pool.apply_async(rubin_get_lightcurves, args=(sample_table,), kwds=rsp_kwargs, callback=callback)\n\n    pool.close()  # signal that no more jobs will be submitted to the pool\n    pool.join()  # wait for all jobs to complete, including the callback\n\n# run ZTF and panstarrs queries outside of multiprocessing since they\n# are using dask distributed under the hood,\n# which doesn't work with multiprocessing, and dask is already parallelized\n\ndf_lc_ZTF = ztf_get_lightcurves(sample_table, radius = ztf_search_radius)\nparallel_df_lc.append(df_lc_ZTF)# add the resulting dataframe to all other archives\n\ndf_lc_panstarrs = panstarrs_get_lightcurves(sample_table, radius=panstarrs_search_radius)\nparallel_df_lc.append(df_lc_panstarrs) # add the panstarrs dataframe to all other archives\n\nparallel_endtime = time.time()\n\n# LightKurve will return an \"Error\" when it doesn't find a match for a target\n# These are not real errors and can be safely ignored.\n\n# Warnings from the panstarrs query about both NESTED and margins are known issues","key":"XyKh0KJoyZ"},{"type":"output","id":"POne73yICdkgUPPm-9d21","data":[],"key":"Y5KYragDsn"}],"key":"rrUHd3tslm"},{"type":"block","children":[],"key":"DQ9O02f46j"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# How long did parallel processing take?\n# and look at the results\nprint('parallel processing took', parallel_endtime - parallel_starttime, 's')\nparallel_df_lc.data","key":"JzVBTqfgB2"},{"type":"output","id":"uA0kBHSqmFhDYoenAEjCI","data":[],"key":"yE7yCqGKO9"}],"key":"TmruGYvVKW"},{"type":"block","children":[],"key":"E8vUbQtT6Q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Save the data for future use with ML notebook\n#parquet_filename = f\"output/{sample_name}_df_lc.parquet\"\n#parallel_df_lc.data.to_parquet(parquet_savename)\n#print(\"file saved!\")","key":"oVWhSzs1UN"},{"type":"output","id":"n1m3JblrQ5YhKLA2ucEkm","data":[],"key":"kIEocYIhVv"}],"key":"TnJKqYmwGo"},{"type":"block","children":[],"key":"gqg2Gf3Ya1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Could load a previously saved file in order to plot\n#parallel_df_lc = MultiIndexDFObject()\n#parallel_df_lc.data = pd.read_parquet(parquet_filename)\n#print(\"file loaded!\")","key":"U7HDKW5ewB"},{"type":"output","id":"J2WhMHT6J7udOQlPXnD9o","data":[],"key":"epFLm8emyd"}],"key":"Qg06sfJlFf"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"children":[{"type":"text","value":"5. Make plots of luminosity as a function of time","position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"key":"Fe2zdnDUZd"}],"identifier":"id-5-make-plots-of-luminosity-as-a-function-of-time","label":"5. Make plots of luminosity as a function of time","html_id":"id-5-make-plots-of-luminosity-as-a-function-of-time","implicit":true,"key":"JLvo49RgEf"},{"type":"paragraph","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"children":[{"type":"text","value":"These plots are modelled after ","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"KAwsFVdQ98"},{"type":"link","url":"https://arxiv.org/pdf/2111.09391.pdf","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"children":[{"type":"text","value":"van Velzen et al., 2021","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"XQZXK2AglR"}],"urlSource":"https://arxiv.org/pdf/2111.09391.pdf","key":"ybMYdUPeGx"},{"type":"text","value":". We show flux in mJy as a function of time for all available bands for each object. ","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"FZGd6XwHtq"},{"type":"inlineCode","value":"show_nbr_figures","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"Ggf4FPGtMQ"},{"type":"text","value":" controls how many plots are actually generated and returned to the screen.  If you choose to save the plots with ","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"mV5ECjhNkZ"},{"type":"inlineCode","value":"save_output","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"vifRSc5Vod"},{"type":"text","value":", they will be put in the output directory and labelled by sample number.","position":{"start":{"line":478,"column":1},"end":{"line":478,"column":1}},"key":"uCwGtzKP6j"}],"key":"d3XaQkvX6p"},{"type":"paragraph","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"children":[{"type":"strong","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"Rh6GvNDD9B"}],"key":"XP9A6fuPQp"},{"type":"text","value":" that in the following, we can either plot the results from ","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"NPJczEJrbt"},{"type":"inlineCode","value":"df_lc","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"A6J3dfCwpv"},{"type":"text","value":" (from the serial call) or ","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"VSFG7QpNym"},{"type":"inlineCode","value":"parallel_df_lc","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"p0BlH2Hv6s"},{"type":"text","value":" (from the parallel call). By default (see next cell) the output of the parallel call is used.","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"HGlshqdmka"}],"key":"xli8V02oht"}],"key":"GjusbO0sv7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"_ = create_figures(df_lc = parallel_df_lc, # either df_lc (serial call) or parallel_df_lc (parallel call)\n                   show_nbr_figures = 5,  # how many plots do you actually want to see?\n                   save_output = False ,  # should the resulting plots be saved?\n                  )","key":"vpaJcZu8Ad"},{"type":"output","id":"IVOXozqDLVwR25CHXQ1Vt","data":[],"key":"djkP4sEsTR"}],"key":"fOgd9PwHbq"},{"type":"block","position":{"start":{"line":489,"column":1},"end":{"line":489,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":491,"column":1},"end":{"line":491,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":491,"column":1},"end":{"line":491,"column":1}},"key":"loYOkJzn97"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"rXP8KiwOrU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":493,"column":1},"end":{"line":495,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"key":"QuTLfo10Br"}],"key":"xJFgKN2yHu"},{"type":"text","value":" Jessica Krick, Shoubaneh Hemmati, Andreas Faisst, Troy Raen, Brigitta Sipőcz, David Shupe, and the Fornax team","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"key":"ztbwXlctVX"}],"key":"loZqpzZH19"}],"key":"p9aqXlekUw"},{"type":"listItem","spread":true,"position":{"start":{"line":494,"column":1},"end":{"line":495,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"lsYSSFSl0C"}],"key":"xOuxqG5dSb"},{"type":"text","value":" For help with this notebook, please open a topic in the ","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"VEIHrHmELq"},{"type":"link","url":"https://discourse.fornax.sciencecloud.nasa.gov/","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"Fornax Community Forum","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"hKPm05YLUo"}],"urlSource":"https://discourse.fornax.sciencecloud.nasa.gov/","key":"CtdiJKEMUD"},{"type":"text","value":" “Support” category.","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"pUKIFkbvA2"}],"key":"mJztuR4zqU"}],"key":"FELu9MavpR"}],"key":"WQwTcQWb2h"},{"type":"heading","depth":3,"position":{"start":{"line":496,"column":1},"end":{"line":496,"column":1}},"children":[{"type":"text","value":"Acknowledgements","position":{"start":{"line":496,"column":1},"end":{"line":496,"column":1}},"key":"tAIyziTf1Q"}],"identifier":"acknowledgements","label":"Acknowledgements","html_id":"acknowledgements","implicit":true,"key":"oqgwrDeA0C"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":498,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Suvi Gezari, Antara Basu-zych, Stephanie LaMassa","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"wYhCCMn78Q"}],"key":"f8699NscyS"}],"key":"cTnjcY5hSi"},{"type":"listItem","spread":true,"position":{"start":{"line":499,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"MAST, HEASARC, \u0026 IRSA Fornax teams","position":{"start":{"line":499,"column":1},"end":{"line":499,"column":1}},"key":"rnhtjIiqk0"}],"key":"lKGwwZ2ASM"}],"key":"lctlHfehZE"}],"key":"mHoNSwerIY"},{"type":"heading","depth":3,"position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"key":"RoPAmFKQqd"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"f7uciKcFjT"},{"type":"paragraph","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"children":[{"type":"text","value":"This work made use of:","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"rfpF71io0L"}],"key":"NT2icnP0eE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":505,"column":1},"end":{"line":509,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Astroquery; Ginsburg et al., 2019, 2019AJ....157...98G","position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"key":"JM4Ai78RrC"}],"key":"uy3Ox1vLSP"}],"key":"KzZ0SKmcc4"},{"type":"listItem","spread":true,"position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Astropy; Astropy Collaboration 2022, Astropy Collaboration 2018, Astropy Collaboration 2013,    2022ApJ...935..167A, 2018AJ....156..123A, 2013A\u0026A...558A..33A","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"EtZj75OugH"}],"key":"IEhYxFaCvM"}],"key":"safpXQc3AK"},{"type":"listItem","spread":true,"position":{"start":{"line":507,"column":1},"end":{"line":507,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Lightkurve; Lightkurve Collaboration 2018, 2018ascl.soft12013L","position":{"start":{"line":507,"column":1},"end":{"line":507,"column":1}},"key":"yMTL9sscQZ"}],"key":"umuwE2D7w1"}],"key":"p6wd6Kt7NM"},{"type":"listItem","spread":true,"position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"acstools; ","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"key":"uHlqmzKrRS"},{"type":"cite","url":"https://zenodo.org/record/7406933#.ZBH1HS-B0eY","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"children":[{"type":"text","value":"P. L. Lim ","key":"goOmeRmfLW"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"krA8anV58v"}],"key":"nDnU9VU7tk"},{"type":"text","value":" (2022)","key":"xdVcb8azPs"}],"kind":"narrative","label":"https://doi.org/10.5281/zenodo.7406933","identifier":"https://zenodo.org/record/7406933#.ZBH1HS-B0eY","enumerator":"1","key":"RPI0rzydUT"}],"key":"kUjLu3iucH"}],"key":"BPmwxaWQR4"},{"type":"listItem","spread":true,"position":{"start":{"line":509,"column":1},"end":{"line":509,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"unWISE light curves; Meisner et al., 2023, 2023AJ....165...36M","position":{"start":{"line":509,"column":1},"end":{"line":509,"column":1}},"key":"fyvFGbaCQR"}],"key":"kGkS2fXuSf"}],"key":"a4iifzmsDM"}],"key":"VAlYZHHUav"}],"key":"rFd1Qm6nMP"}],"key":"mMpY60mjGP"},"references":{"cite":{"order":["https://doi.org/10.5281/zenodo.7406933"],"data":{"https://doi.org/10.5281/zenodo.7406933":{"label":"https://doi.org/10.5281/zenodo.7406933","enumerator":"1","doi":"10.5281/ZENODO.7406933","html":"P. L. Lim, Hack, W. J., E. M. Bray, Ryon, J., Miles, N., Cara, M., Sienkiewicz, M., Rendina, M., Hunkeler, J., Simon, B., Noss, J., Gagandeep Anand, Desjardins, T., Burnett, Z., Ogaz, S., Geiger, Z., Dencheva, N., \u0026 Molaes-Stsci. (2022). \u003ci\u003espacetelescope/acstools: 3.5.0 Release Notes\u003c/i\u003e. Zenodo. \u003ca target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.5281/ZENODO.7406933\"\u003e10.5281/ZENODO.7406933\u003c/a\u003e","url":"https://doi.org/10.5281/ZENODO.7406933"}}}},"footer":{"navigation":{"prev":{"title":"Time Domain","url":"/readme","group":"The Fornax Initiative"},"next":{"title":"Make Multi-Wavelength Light Curves for Large Samples","url":"/scale-up","group":"The Fornax Initiative"}}},"domain":"http://localhost:3000"},"project":{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/README.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/README.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/README.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/README.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"readme","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-1","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-2","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"readme-3","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/fornax-demo-notebooks/build/manifest-3481E987.js";
import * as route0 from "/fornax-demo-notebooks/build/root-7TUVC4ZT.js";
import * as route1 from "/fornax-demo-notebooks/build/routes/$-P6PGXPYX.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/fornax-demo-notebooks/build/entry.client-UNPC4GT3.js");</script></body></html>