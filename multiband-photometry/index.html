<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Automated Multiband Forced Photometry on Large Datasets - The Fornax Initiative</title><meta property="og:title" content="Automated Multiband Forced Photometry on Large Datasets - The Fornax Initiative"/><meta name="generator" content="mystmd"/><meta name="description" content="Tutorial notebooks for example Fornax use cases"/><meta property="og:description" content="Tutorial notebooks for example Fornax use cases"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/app-AIT5GAEP.css"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/fornax-demo-notebooks/favicon.ico"/><link rel="stylesheet" href="/fornax-demo-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/fornax-demo-notebooks/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/fornax-demo-notebooks/build/fornax_logo-5441a878dc5bd43c0ee191321434622d.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="The Fornax Initiative" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/fornax-demo-notebooks/">The Fornax Initiative</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time Domain" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/time-domain">Time Domain</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Spectroscopy" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/spectroscopy">Spectroscopy</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Multi-band forced photometry" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/forced-photometry">Multi-band forced photometry</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Cross Matching" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/crossmatch">Cross Matching</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Fornax Demo Notebooks</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/nasa-fornax/fornax-demo-notebooks" title="GitHub Repository: nasa-fornax/fornax-demo-notebooks" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/forced_photometry/multiband_photometry.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Automated Multiband Forced Photometry on Large Datasets</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">Fornax developers and scientists</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this tutorial, you will be able to:</p><ul><li><p>get catalogs and images from NASA archives in the cloud where possible</p></li><li><p>measure fluxes at any location by running forced photometry using “The Tractor”</p></li><li><p>employ parallel processing to make this as fast as possible</p></li><li><p>cross match large catalogs</p></li><li><p>plot results</p></li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This code performs photometry in an automated fashion at all locations in an input catalog on 4 bands of IRAC data from IRSA and 2 bands of GALEX data from MAST.  The resulting catalog is then cross-matched with a Chandra catalog from HEASARC to generate a multiband catalog to facilitate galaxy evolution studies.</p><p>If you run this code as is, it will only look at a small region of the COSMOS survey, and as a result, the plots near the end will not be so very informative.  We do this for faster runtimes and to show proof of concept as to how to do this work.  Please change the radius in section 1. to be something larger if you want to work with more data, but expect longer runtimes associated with larger areas.</p><p>The code makes full use of multiple processors to optimize run time on large datasets.</p><h3 id="input" class="relative group"><span class="heading-text">Input</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#input" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>RA and DEC within COSMOS catalog</p></li><li><p>desired catalog radius in arcminutes</p></li></ul><h3 id="output" class="relative group"><span class="heading-text">Output</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#output" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>merged, multiband, science ready pandas dataframe</p></li><li><p>IRAC color color plot for identifying interesting populations</p></li></ul><h3 id="runtime" class="relative group"><span class="heading-text">Runtime</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#runtime" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As of 2025 September, this notebook takes about 13 minutes to run to completion on Fornax using a server with 8GB RAM/2 CPU’ and Environment: ‘Default Astrophysics’ (image).</p><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Non-standard Dependencies:</p><ul><li><p><code>tractor</code> code which does the forced photometry from Lang et al., 2016</p></li><li><p><code>astroquery</code> to interface with archives APIs</p></li><li><p><code>astropy</code> to work with coordinates/units and data structures</p></li><li><p><code>skimage</code> to work with the images</p></li></ul><p>This cell will install the Python ones if needed:</p><div id="o70Nv7eVqJ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# %pip install -r requirements_multiband_photometry.txt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3nrg8bcL3kNLIqIkwzR1I" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="P7irZsf3b9" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># standard lib imports
import time
import sys
import os
import shutil

# Third party imports
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns

from astropy.io import fits
from astropy.table import Table
from astropy.coordinates import SkyCoord
import astropy.units as u
from astroquery.heasarc import Heasarc
import pyvo

# Local code imports
sys.path.append(&#x27;code_src/&#x27;)

import cutout
import photometry
from nway_write_header import nway_write_header
from photometry import Band
from photometry import lookup_img_pair
from galex_functions import galex_get_images

# This code is to parse cloud access information; currently in `code_src`, eventually will be part of pyvo
import fornax

# temporarily let the notebook start without tractor as a dependency
try:
    from find_nconfsources import find_nconfsources
except ImportError:
    print(&quot;tractor is missing&quot;)
    pass


%matplotlib inline</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="u_RXbxLP0dLTAUp0FGUZ-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-1-retrieve-initial-catalog-from-irsa" class="relative group"><span class="heading-text">1. Retrieve Initial Catalog from IRSA</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-retrieve-initial-catalog-from-irsa" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section we query the COSMOS2015 catalog (Laigle et al. 2016) from the IRSA archive using the Table Access Protocol (TAP). We specify the sky position and search radius, select a curated subset of columns needed for forced photometry, validation, and later multiwavelength analysis, and download only those rows that fall within the requested region of the COSMOS field. The result is a compact catalog containing positions, photometric redshifts, optical and infrared fluxes, UV measurements, and existing X-ray associations, which forms the starting point for the remainder of the workflow.</p><p>We access the COSMOS2015 catalog using the Table Access Protocol (TAP), an IVOA standard that allows SQL-like queries across astronomical databases. For more about TAP, see the IVOA <a target="_blank" rel="noreferrer" href="https://www.ivoa.net/documents/TAP/" class="">documentation</a> or <a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/docs/program_interface/astropy_TAP.html" class="">suggestions</a> on its usage from IRSA.</p><div id="Ued1dPxHFD" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Pull a COSMOS catalog from IRSA using pyVO

# Central RA/Dec of the COSMOS field (from SIMBAD).
# Used as the center of the TAP cone search.
coords = SkyCoord(&#x27;150.01d 2.2d&#x27;, frame=&#x27;icrs&#x27;)

# Search radius (in arcminutes).
# Full COSMOS radius is ~48&#x27;, but querying that area is extremely slow
# (∼24 hours on 128 cores). We start with a small radius for speed.
radius = 0.5 * u.arcmin


# The COSMOS2015 catalog has several thousand columns. Requesting all of
# them is unnecessary and makes the TAP query more memory intensive
# and slower than required.
# We select only the columns needed for:
#   • forced-photometry inputs (Ks and SPLASH fluxes)
#   • validation of Tractor photometry (SPLASH fluxes → Section 3.6)
#   • UV/X-ray diagnostics (GALEX + Chandra fluxes)
#   • source classification (PHOTOZ, type)
#   • optical context (r-band mags)

# These columns allow us to *extend* COSMOS2015 with new IRAC+GALEX
# forced photometry and improved X-ray associations (via nway).

cols = [
    # Astrometry + unique ID
    &#x27;ra&#x27;, &#x27;dec&#x27;, &#x27;id&#x27;,

    # Ks-band photometry (used by Tractor for contamination modeling)
    &#x27;Ks_FLUX_APER2&#x27;, &#x27;Ks_FLUXERR_APER2&#x27;,

    # Photometric redshift
    &#x27;PHOTOZ&#x27;,

    # SPLASH (IRAC) magnitudes and fluxes — used to validate Tractor outputs
    &#x27;SPLASH_1_MAG&#x27;, &#x27;SPLASH_1_MAGERR&#x27;,
    &#x27;SPLASH_1_FLUX&#x27;, &#x27;SPLASH_1_FLUX_ERR&#x27;,
    &#x27;SPLASH_2_FLUX&#x27;, &#x27;SPLASH_2_FLUX_ERR&#x27;,
    &#x27;SPLASH_3_FLUX&#x27;, &#x27;SPLASH_3_FLUX_ERR&#x27;,
    &#x27;SPLASH_4_FLUX&#x27;, &#x27;SPLASH_4_FLUX_ERR&#x27;,

    # GALEX UV fluxes
    &#x27;FLUX_GALEX_NUV&#x27;, &#x27;FLUX_GALEX_FUV&#x27;,

    # Chandra X-ray fluxes + identifier
    &#x27;FLUX_CHANDRA_05_2&#x27;, &#x27;FLUX_CHANDRA_2_10&#x27;, &#x27;FLUX_CHANDRA_05_10&#x27;, &#x27;ID_CHANDRA09 &#x27;,

    # Morphology / source type (0=galaxy, 1=star, etc.)
    &#x27;type&#x27;,

    # Optical r-band photometry
    &#x27;r_MAG_AUTO&#x27;, &#x27;r_MAGERR_AUTO&#x27;,

    # 24 μm photometry (used for additional diagnostics)
    &#x27;FLUX_24&#x27;, &#x27;FLUXERR_24&#x27;,

    # GALEX UV magnitudes (for color–color diagrams in Section 5)
    &#x27;MAG_GALEX_NUV&#x27;, &#x27;MAGERR_GALEX_NUV&#x27;,
    &#x27;MAG_GALEX_FUV&#x27;, &#x27;MAGERR_GALEX_FUV&#x27;
]

# Create TAP service object and submit the cone-search query.
# The WHERE clause selects only sources within the requested radius.
tap = pyvo.dal.TAPService(&#x27;https://irsa.ipac.caltech.edu/TAP&#x27;)
result = tap.run_sync(&quot;&quot;&quot;
           SELECT {}
           FROM cosmos2015
           WHERE CONTAINS(POINT(&#x27;ICRS&#x27;,ra, dec), CIRCLE(&#x27;ICRS&#x27;,{}, {}, {}))=1
    &quot;&quot;&quot;.format(&#x27;,&#x27;.join(cols), coords.ra.value, coords.dec.value, radius.to(u.deg).value))

# Convert the TAP result into an astropy Table for further processing.
cosmos_table = result.to_table()


print(&quot;Number of objects: &quot;, len(cosmos_table))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="zsY2GBN1QLPF-Ozh39q0v" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-1-1-filter-catalog" class="relative group"><span class="heading-text">1.1 Filter Catalog</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-1-filter-catalog" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>If desired, you can filter the initial catalog to include only sources that meet specific criteria.</p><div id="dQJZfaxJNP" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Here is an example of how to filter the catalog to
# select those rows with either chandra fluxes or GALEX NUV fluxes

# example_table = cosmos_table[(cosmos_table[&#x27;flux_chandra_05_10&#x27;]&gt; 0) | (cosmos_table[&#x27;flux_galex_fuv&#x27;] &gt; 0)]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Lc6_3_AzmkiOTaauS_tA_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-2-retrieve-image-datasets-from-the-cloud" class="relative group"><span class="heading-text">2. Retrieve Image Datasets from the Cloud</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-retrieve-image-datasets-from-the-cloud" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="id-2-1-use-the-fornax-cloud-access-api-to-obtain-the-irac-data-from-the-irsa-s3-bucket" class="relative group"><span class="heading-text">2.1 Use the Fornax cloud access API to obtain the IRAC data from the IRSA S3 bucket</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-1-use-the-fornax-cloud-access-api-to-obtain-the-irac-data-from-the-irsa-s3-bucket" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Details in this section may change over time.</p><div id="fudLLTiIEC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Retrieve the COSMOS service entry from the VO registry using the standard PyVO workflow.
# This avoids hard-coding the service URL and ensures the query follows VO best practices.
image_services = pyvo.regsearch(servicetype=&#x27;sia&#x27;)
irsa_cosmos = [s for s in image_services if &#x27;irsa&#x27; in s.ivoid and &#x27;cosmos&#x27; in s.ivoid][0]

# The search returns 11191 entries, but unfortunately we cannot really filter efficiently in the query
# itself (https://irsa.ipac.caltech.edu/applications/Atlas/AtlasProgramInterface.html#inputparam)
# to get only the Spitzer IRAC results from COSMOS as a mission. We will do the filtering in a next step before download.
cosmos_results = irsa_cosmos.search(coords).to_table()

spitzer = cosmos_results[cosmos_results[&#x27;dataset&#x27;] == &#x27;IRAC&#x27;]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="KIp3kCa4SZn3GbgJXY6_H" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="klPTThW6bU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># This dataset has limited access, thus &#x27;region&#x27; should be used instead of &#x27;open&#x27;.
# S3 access should be available from the Fornax Science Console.

fname = spitzer[&#x27;fname&#x27;]
spitzer[&#x27;cloud_access&#x27;] = [(f&#x27;{{&quot;aws&quot;: {{ &quot;bucket_name&quot;: &quot;irsa-fornax-testdata&quot;,&#x27;
                            f&#x27;              &quot;region&quot;: &quot;us-east-1&quot;,&#x27;
                            f&#x27;              &quot;access&quot;: &quot;restricted&quot;,&#x27;
                            f&#x27;              &quot;key&quot;: &quot;COSMOS/{fn}&quot; }} }}&#x27;) for fn in fname]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GJsp55gTMOYroQYTtMWqG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="mrcLZpTbAv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Requires https://github.com/nasa-fornax/fornax-cloud-access-API/pull/4

def fornax_download(data_table, data_subdirectory, access_url_column=&#x27;access_url&#x27;,
                    fname_filter=None, verbose=False):
    &quot;&quot;&quot;
    Downloads data files if they do not already exist in the specified directory.

    Parameters
    ----------
    data_table : iterable
        An iterable containing metadata for files to be downloaded. Each element
        should be a dictionary-like object with at least a &#x27;fname&#x27; key.
    data_subdirectory : str
        Name of the subdirectory where the downloaded files will be stored.
    access_url_column : str, optional
        Column name containing the access URLs for downloading the files.
        Default is &#x27;access_url&#x27;.
    fname_filter : str, optional
        If provided, only files whose names contain this substring will be downloaded.
    verbose : bool, optional
        If True, print status messages. Default is False.

    Raises
    ------
    ValueError
        If neither &#x27;fname&#x27; nor &#x27;name&#x27; columns are found in `data_table`.

    Notes
    -----
    - The function checks if a file already exists before downloading it.
    - It creates the target directory if it does not exist.
    - Uses `fornax.get_data_product()` to retrieve the data handler.

    Examples
    --------
    &gt;&gt;&gt; data_table = [{&#x27;fname&#x27;: &#x27;file1.fits&#x27;, &#x27;access_url&#x27;: &#x27;https://example.com/file1.fits&#x27;},
    ...               {&#x27;fname&#x27;: &#x27;file2.fits&#x27;, &#x27;access_url&#x27;: &#x27;https://example.com/file2.fits&#x27;}]
    &gt;&gt;&gt; fornax_download(data_table, &#x27;my_data&#x27;, verbose=True)
    Skipping file1.fits: already exists.
    Downloaded and saved file2.fits to data/my_data
    Download process complete.
    &quot;&quot;&quot;
    # Define the absolute path of the target directory
    data_directory = os.path.join(&quot;data&quot;, data_subdirectory)
    os.makedirs(data_directory, exist_ok=True)  # Ensure the directory exists

    # Check which filename column exists
    filename_column = None
    for col in [&#x27;fname&#x27;, &#x27;name&#x27;]:
        if col in data_table.colnames:
            filename_column = col
            break  # Use the first found column

    if not filename_column:
        raise ValueError(&quot;Error: Neither &#x27;fname&#x27; nor &#x27;name&#x27; columns found in the data table.&quot;)

    for row in data_table:
        filename = os.path.basename(row[filename_column])  # Extract filename
        file_path = os.path.join(data_directory, filename)  # Full file path

        # Skip download if file already exists
        if os.path.exists(file_path):
            if verbose:
                print(f&quot;Skipping {filename}: already exists.&quot;)
            continue

        # Apply filename filter, if provided
        if fname_filter is not None and fname_filter not in filename:
            continue

        # Download the file
        handler = fornax.get_data_product(row, &#x27;aws&#x27;, access_url_column=access_url_column, verbose=verbose)
        temp_file = handler.download()

        # Move the downloaded file if a local file path is returned
        if temp_file:
            shutil.move(temp_file, file_path)
            if verbose:
                print(f&quot;Downloaded and saved {filename} to {data_directory}&quot;)

    if verbose:
        print(&quot;Download process complete.&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="hZDNzbIipU6weDQGutmsC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="gpFD2llmZU" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fornax_download(spitzer, access_url_column=&#x27;sia_url&#x27;, fname_filter=&#x27;go2_sci&#x27;,
                data_subdirectory=&#x27;IRAC&#x27;, verbose=False)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="b_iRUiFmTyhTaJjrdhcaU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-2-2-obtain-galex-from-the-mast-archive" class="relative group"><span class="heading-text">2.2 Obtain GALEX from the MAST archive</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-2-obtain-galex-from-the-mast-archive" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="NwF5K9rYP6" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># The GALEX COSMOS mosaic is split into four separate tiles, each with its own
# central pointing. To determine which tile each catalog source belongs to,
# we compute the angular distance from every source to the center of each tile.

# Coordinates for the four GALEX tile centers (in degrees)
ra_center=[150.369,150.369,149.869,149.869]
dec_center=[2.45583,1.95583,2.45583,1.95583]

# Build SkyCoord objects for the tile centers and for all catalog sources
galex = SkyCoord(ra = ra_center*u.degree, dec = dec_center*u.degree)
catalog = SkyCoord(ra = cosmos_table[&#x27;ra&#x27;], dec = cosmos_table[&#x27;dec&#x27;])

# For each of the four tiles, compute the angular separation (in degrees)
# between the tile center and every source in the catalog. These columns will
# allow us to identify which tile each source falls into.
cosmos_table[&#x27;COSMOS_01&#x27;] = galex[0].separation(catalog)
cosmos_table[&#x27;COSMOS_02&#x27;] = galex[1].separation(catalog)
cosmos_table[&#x27;COSMOS_03&#x27;] = galex[2].separation(catalog)
cosmos_table[&#x27;COSMOS_04&#x27;] = galex[3].separation(catalog)

# Convert to pandas for easier column operations and downstream merging
df = cosmos_table.to_pandas()

# For each source, identify the GALEX tile with the *minimum* separation.
# The result is a label (&#x27;COSMOS_01&#x27; ... &#x27;COSMOS_04&#x27;) indicating which of the
# four GALEX mosaics should be used when extracting UV cutouts.
df[&#x27;galex_image&#x27;] = df[[&#x27;COSMOS_01&#x27;,&#x27;COSMOS_02&#x27;,&#x27;COSMOS_03&#x27;,&#x27;COSMOS_04&#x27;]].idxmin(axis = 1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="dHAIraZQ0bHbqVfWiUwo_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ABDRNDxIxQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># We expect 76k rows with 15arcmin diameter IRAC images
df.describe()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3m0GwHPi-pEF1wPjindWV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="mV1DRfPCkT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Download both the images and the skybg files using astroquery.mast
galex_images = galex_get_images(coords, verbose=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="jc7RVXOd0ETLQ3jOS7Afk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SkvBvgf8UW" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Check the catalog for missing or invalid values to ensure the data are usable.
df.isna().sum()

# It is acceptable for some flux columns to contain missing values;
# the remaining columns are complete.</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="0dOj3PAOykU5LIEVzz8iP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KV7lqbCufa" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># As an exploratory check, examine how many sources of each
# classification type appear in the catalog.
#Type: 0 = galaxy, 1 = star, 2 = X-ray source, -9 is failure to fit
df.type.value_counts()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="TYSy1MK0BRDfK5EPY45J8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-3-run-forced-photometry" class="relative group"><span class="heading-text">3. Run Forced Photometry</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-run-forced-photometry" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This section performs forced photometry at the positions of all COSMOS2015 sources using The Tractor. We prepare the inputs required for Tractor by first collecting the IRAC and GALEX images and then supplying the corresponding point response functions (PRFs), which describe how a point source is spread across the detector. The PRFs are included with the notebook rather than downloaded at runtime because they are stable, calibrated instrument files that do not change across observations; if they were not provided, users could obtain them from the Spitzer IRAC Instrument Handbook or the GALEX calibration database. Next, we identify nearby contaminating sources for each target, estimate the local sky background, and define the parameters needed to extract a cutout around each object. The following two code cells create Band objects — small data structures that bundle together the PRF, pixel scale, cutout size, flux-conversion factor, and band index — so that each IRAC and GALEX image can be handled consistently during the photometry. Once these inputs are assembled, Tractor is run to measure instrumental fluxes and uncertainties in each band. These measurements form the foundation of the multiband catalog constructed later in the workflow.</p><h3 id="id-3-1-setup" class="relative group"><span class="heading-text">3.1 Setup</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-setup" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In this step we initialize the DataFrame columns that will hold the Tractor-derived fluxes and uncertainties. We then assemble the configuration for each IRAC and GALEX band, including the PRFs, pixel scales, and cutout sizes, and load the corresponding science and background images needed for the photometry. This setup ensures that all band-specific parameters are ready for the main photometry loop.</p><div id="TQOFVAE0ih" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># initialize columns in data frame for photometry results
cols = [&quot;ch1flux&quot;, &quot;ch1flux_unc&quot;, &quot;ch2flux&quot;, &quot;ch2flux_unc&quot;, &quot;ch3flux&quot;, &quot;ch3flux_unc&quot;,
        &quot;ch4flux&quot;, &quot;ch4flux_unc&quot;, &quot;ch5flux&quot;, &quot;ch5flux_unc&quot;, &quot;ch6flux&quot;, &quot;ch6flux_unc&quot;]
df[cols] = 0.0

# list to collect all the bands
all_bands = []</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ZRhQgTR4ity6MrNzoIaDB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="WKAHnO93c4" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># IRAC channels
irac_band_indexes = [
    0,  # ch1
    1,  # ch2
    2,  # ch3
    3,  # ch4
]

irac_fluxconversion = (1E12) / (4.254517E10) * (0.6) *(0.6)

irac_mosaic_pix_scale = 0.6

irac_cutout_width = 10 # in arcseconds, taken from Nyland et al. 2017

irac_prfs = [
    fits.open(&#x27;data/IRAC/PRF_IRAC_ch1.fits&#x27;)[0].data,
    fits.open(&#x27;data/IRAC/PRF_IRAC_ch2.fits&#x27;)[0].data,
    fits.open(&#x27;data/IRAC/PRF_IRAC_ch3.fits&#x27;)[0].data,
    fits.open(&#x27;data/IRAC/PRF_IRAC_ch4.fits&#x27;)[0].data,
]

# zip parameters for each band into a container and append to the master list
irac_bands = [
    Band(
        idx, prf, irac_cutout_width, irac_fluxconversion, irac_mosaic_pix_scale
    )
    for idx, prf in zip(irac_band_indexes, irac_prfs)
]
all_bands += irac_bands</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Yn6V8glBL1YCbL141EA-v" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="coVBuh2HXw" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># GALEX bands
galex_band_indexes = [
    4,  # nuv
    5,  # fuv
]

galex_cutout_width = 40

galex_fluxconversions = [
    3.373E1,  # uJy. fudging this to make the numbers bigger for plotting later
    1.076E2,  # uJy. fudging this to make the numbers bigger for plotting later
]

galex_mosaic_pix_scale = 1.5

prf_nuv = fits.open(&quot;data/Galex/PSFnuv_faint.fits&quot;)[0].data
prf_fuv = fits.open(&quot;data/Galex/PSFfuv.fits&quot;)[0].data
prf_nuv = prf_nuv[0:119, 0:119]
prf_fuv = prf_fuv[0:119, 0:119]

# These are much larger than the cutouts we are using, so only keep the central
# region which is the size of our cutouts
ngalex_pix = galex_cutout_width / galex_mosaic_pix_scale
prf_cen = int(60)
prf_nuv = prf_nuv[(prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2)),
                  (prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2))]
prf_fuv = prf_fuv[(prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2)),
                  (prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2))]
galex_prfs = [prf_nuv, prf_fuv]

# Zip parameters for each band into a container and append to the master list
galex_bands = [
    Band(
        idx, prf, galex_cutout_width, flux_conv, galex_mosaic_pix_scale
    )
    for idx, prf, flux_conv in zip(galex_band_indexes, galex_prfs, galex_fluxconversions)
]
all_bands += galex_bands</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="zqXm5PFFKbsLQTGJ2frSb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="pauWuMumF3" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#Collect input images
# collect the files in pairs: (science image, sky-background image)
# if the same file should be used for both, just send it once
sci_bkg_pairs = [
    # IRAC. use the science image to calculate the background
    (&#x27;data/IRAC/irac_ch1_go2_sci_10.fits&#x27;, ),
    (&#x27;data/IRAC/irac_ch2_go2_sci_10.fits&#x27;, ),
    (&#x27;data/IRAC/irac_ch3_go2_sci_10.fits&#x27;, ),
    (&#x27;data/IRAC/irac_ch4_go2_sci_10.fits&#x27;, ),
    # GALEX. calculate the background from a dedicated file
    (&#x27;data/Galex/COSMOS_01-nd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_01-nd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_01-fd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_01-fd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_02-nd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_02-nd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_02-fd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_02-fd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_03-nd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_03-nd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_03-fd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_03-fd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_04-nd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_04-nd-skybg.fits.gz&#x27;),
    (&#x27;data/Galex/COSMOS_04-fd-int.fits.gz&#x27;, &#x27;data/Galex/COSMOS_04-fd-skybg.fits.gz&#x27;),
]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="C7wC2jO1hsmRbOOPiqTpl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-3-2-main-function-to-do-the-forced-photometry" class="relative group"><span class="heading-text">3.2 Main Function to do the Forced Photometry</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-2-main-function-to-do-the-forced-photometry" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="HGbAgDzqeD" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def calc_instrflux(band, ra, dec, stype, ks_flux_aper2, img_pair, df):
    &quot;&quot;&quot;
    Calculate single-band instrumental fluxes and uncertainties at the given RA, Dec
    using tractor.

    Parameters:
    -----------
    band : `Band`
        Collection of parameters for a single band.
        A `Band` is a named tuple with the following attributes:
            idx : int
                Identifier for the band/channel.
                (integer in [0, 1, 2, 3, 4, 5] for the four IRAC bands and two GALEX bands)
            prf : np.ndarray
                Point spread function for the band/channel.
            cutout_width : int
                width of desired cutout in arcseconds
            flux_conv : float
                factor used to convert tractor result to microjanskies
            mosaic_pix_scale : float
                Pixel scale of the image
    ra, dec : float
        celestial coordinates for measuring photometry
    stype : int
        0, 1, 2, -9 for star, galaxy, x-ray source
    ks_flux_aper_2 : float
        flux in aperture 2
    img_pair : tuple
        Pair of images for science and background respectively.
        If the tuple only contains one element it will serve double duty.
        A tuple element can be a `fits.ImageHDU` or the path to a FITS file as a `str`.
    df : pd.DataFrame
        Source catalog.
        Previous arguments (ra, dec, stype, ks_flux_aper_2) come from a single row of this df.
        However, we must also pass the entire dataframe in order to find nearby sources which are possible contaminates.

    Returns:
    --------
    outband : int
        reflects the input band index for identification purposes
    flux : float
        Measured flux in microJansky.
        NaN if the forced photometery failed.
    flux_unc : float
        Flux uncertainty in microJansky, calculated from the tractor results.
        NaN if the forced photometery failed or if tractor didn&#x27;t report a flux variance.
    &quot;&quot;&quot;

    # Extract a cutout centered on the target object.
    # This returns:
    #   - subimage:    the science cutout
    #   - bkgsubimage: small background region used for sky estimation
    #   - x1, y1:      pixel coordinates of the target within the cutout
    #   - subimage_wcs: WCS for converting RA/Dec of neighbors into pixel coords
    subimage, bkgsubimage, x1, y1, subimage_wcs = cutout.extract_pair(
        ra, dec, img_pair=img_pair, cutout_width=band.cutout_width, mosaic_pix_scale=band.mosaic_pix_scale
    )

    # Identify all nearby sources that fall inside the cutout.
    # These “confusing sources” are modeled alongside the target so that Tractor
    # can correctly account for blending and crowding. `objsrc` is a list of
    # Tractor-ready source objects (target first, then neighbors).
    objsrc, nconfsrcs = find_nconfsources(
        ra, dec, stype, ks_flux_aper2, x1, y1, band.cutout_width, subimage_wcs, df
    )

    # Estimate the local sky background and noise from the background cutout.
    # Tractor needs this information for likelihood evaluation.
    skymean, skynoise = photometry.calc_background(bkgsubimage=bkgsubimage)

    # Run Tractor to fit the model PRF + sky + neighbors to the science cutout.
    flux_var = photometry.run_tractor(
        subimage=subimage, prf=band.prf, objsrc=objsrc, skymean=skymean, skynoise=skynoise
    )

    # If Tractor cannot converge (common when sources are faint or blended),
    # return NaNs to signal failure for this band.
    if flux_var is None:
        return (band.idx, np.nan, np.nan)

    # Convert Tractor’s instrumental flux and variance into physical units
    # (microJanskys) using the band-specific flux conversion factor.
    # The uncertainty is derived from the reported flux variance.
    microJy_flux, microJy_unc = photometry.interpret_tractor_results(
        flux_var=flux_var, flux_conv=band.flux_conv, objsrc=objsrc, nconfsrcs=nconfsrcs
    )

    return (band.idx, microJy_flux, microJy_unc)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GfgDVpgN2crL4cwSkwH8G" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-3-3-calculate-forced-photometry-with-straightforward-but-slow-method" class="relative group"><span class="heading-text">3.3 Calculate Forced Photometry with Straightforward but Slow Method</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-3-calculate-forced-photometry-with-straightforward-but-slow-method" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here we demonstrate a baseline implementation of forced photometry that processes each source sequentially and computes fluxes for all bands. Although this approach is simple and instructive, it is computationally inefficient for large catalogs, and we therefore do not use it.</p><div id="Du2ObR5LFb" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Do the calculation without multiprocessing for benchmarking

## Make a copy for parallel computation
#pl_df = df.copy(deep=True)

#t0 = time.time()
## For each object
#for row in df.itertuples():
#    # For each band
#    for band in range(6):
#        # Measure the flux with tractor
#        outband, flux, unc = calc_instrflux(band, row.ra, row.dec, row.type, row.ks_flux_aper2)

#        # Put the results back into the dataframe
#        df.loc[row.Index, &#x27;ch{:d}flux&#x27;.format(outband+1)] = flux
#        df.loc[row.Index, &#x27;ch{:d}flux_unc&#x27;.format(outband+1)] = unc

#t1 = time.time()

##10,000 sources took 1.5 hours with this code on a medium sized machine</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OvVC-gfDeF-aWTpVHxLVm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-3-4-calculate-forced-photometry-parallelization" class="relative group"><span class="heading-text">3.4 Calculate Forced Photometry - Parallelization</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-4-calculate-forced-photometry-parallelization" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To improve performance, we parallelize the forced photometry computation across multiple CPU cores. We construct a parameter list containing the source coordinates and band configurations, distribute the workload to worker processes, and combine the results into the main DataFrame. This parallel implementation drastically reduces runtime and enables practical processing of large areas of the COSMOS field.</p><div id="v9adpAmOts" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Setup:

# list of parameter sets to pass to the parallel photometry function
paramlist = []

for row in df.itertuples():
    for band in all_bands:
         # Select the appropriate science/background image pair for this band and GALEX tile
        img_pair = lookup_img_pair(sci_bkg_pairs, band.idx, row.galex_image)

        # Append the full set of parameters needed by calc_instrflux()
        paramlist.append(
            [row.Index, band, row.ra, row.dec, row.type, row.ks_flux_aper2, img_pair, df]
        )
print(&#x27;paramlist: &#x27;, len(paramlist)) # total number of photometry jobs to run</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="hSjee7kePM_FtYXRFEpid" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GDDOV1u8Fg" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Here we show how the calc_instrflux function works on a single source
calc_instrflux(*paramlist[0][1:])

# Another way to run calc_instrflux with different syntax than the line above:
# calc_instrflux(paramlist[0][1], paramlist[0][2], paramlist[0][3], paramlist[0][4], paramlist[0][5], paramlist[0][6])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="vF480zJXmBztX0tqDkIj4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="k0z4BdKDpA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#wrapper to measure the photometry on a single object, single band
def calculate_flux(args):
    &quot;&quot;&quot;
    Wrapper function for parallel photometry that computes fluxes for a
    single (source, band) combination.

    This function unpacks the argument list expected by ``calc_instrflux()``,
    calls that function to perform the forced photometry, and returns both
    the job index and the photometry result. It also performs lightweight
    logging by writing progress updates to a log file every 100 iterations.

    Parameters
    ----------
    args : list or tuple
        A structured argument list of the form
        ``[index, band, ra, dec, stype, ks_flux_aper2, img_pair, df]``
        where:
            index : int
                Row index of the source in the input catalog.
            band : Band
                Band configuration object used by Tractor.
            ra, dec : float
                Celestial coordinates of the source (degrees).
            stype : int
                Source type code for Tractor (0 = star, 1 = galaxy, etc.).
            ks_flux_aper2 : float
                Ks-band flux used as an initial flux estimate.
            img_pair : tuple
                Science/background image pair for the band.
            df : pandas.DataFrame
                Full catalog used to identify neighboring contaminants.

    Returns
    -------
    index : int
        The original job index corresponding to this source–band combination.
    val : tuple
        Output from ``calc_instrflux()``, containing
        ``(band_index, flux_microJy, flux_unc_microJy)``.

    Notes
    -----
    This function is designed to be executed inside a multiprocessing pool,
    which requires functions to accept a single argument. It serves as a
    thin wrapper around ``calc_instrflux()`` and adds optional logging
    of long-running jobs for monitoring purposes.
    &quot;&quot;&quot;

    val = calc_instrflux(*args[1:])
    # add simple logging
    if (args[0] % 100) == 0 and val[0] == 0:
        with open(&#x27;output/output.log&#x27;, &#x27;a&#x27;) as fp: fp.write(f&#x27;{args[0]}\n&#x27;)
    return(args[0], val)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ak4QDojTslSaL_u0FnJVP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="wuqUGrMW5V" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># if results were previously saved to this location, load them
# else start a pool of workers to calculate results in parallel, and save them here


# File where parallel photometry results are stored (one file per search radius)
fname = f&#x27;output/results_{radius.value}.npz&#x27;

# If cached results exist, load them to avoid re-running the computation
if os.path.exists(fname):
    results = np.load(fname, allow_pickle=True)[&#x27;results&#x27;]

# Otherwise, compute all fluxes in parallel and save the output
else:
    from  multiprocessing import Pool
    t0 = time.time()
    # Reset the lightweight progress log
    with open(&#x27;output/output.log&#x27;, &#x27;w&#x27;) as fp: fp.write(&#x27;&#x27;)

    # Launch a multiprocessing pool to compute fluxes for all parameter sets
    with Pool() as pool:
        results = pool.map(calculate_flux, paramlist)

    # Save execution time and final results
    dtime = time.time() - t0
    np.savez(fname, results=np.array(results, dtype=object))
    print(f&#x27;Parallel calculation took {dtime} seconds&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YQgzE7Vd9r5NKmbfTXYcU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Wx3sY6VIN8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Put the results into the main daraframe
for res in results:
    idx,(ich, val, err) = res
    df.loc[idx, f&#x27;ch{ich+1}flux&#x27;] = val
    df.loc[idx, f&#x27;ch{ich+1}flux_unc&#x27;] = err</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="bzcUfM2oYDaAgOmqJvr48" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GnN1q2HwQg" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Count the number of non-zero ch1 fluxes
print(&#x27;Parallel calculation: number of ch1 fluxes filled in =&#x27;,
      np.sum(df.ch1flux &gt; 0))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="acDD9eKpDMVuINr0f_JFd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-3-5-cleanup" class="relative group"><span class="heading-text">3.5 Cleanup</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-5-cleanup" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="FDJPxnSTDO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Had to call the GALEX flux columns ch5 and ch6
# Fix that by renaming them now
cols = {&#x27;ch5flux&#x27;:&#x27;nuvflux&#x27;, &#x27;ch5flux_unc&#x27;:&#x27;nuvflux_unc&#x27;,&#x27;ch6flux&#x27;:&#x27;fuvflux&#x27;, &#x27;ch6flux_unc&#x27;:&#x27;fuvflux_unc&#x27;}
df.rename(columns=cols, inplace = True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="uAILkQRme-gkPDmSJvJRF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Usds2v3drq" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># When doing a large run of a large area, save the dataframe with the forced photometry
# so we don&#x27;t have to do the forced photometry every time

df.to_pickle(f&#x27;output/COSMOS_{radius.value}arcmin.pkl&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="J2RQbE9Jyd7No-Ji89dWp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hhecVKIGQS" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#If you are not runnig the forced photometry, then read in the catalog from a previous run

#df = pd.read_pickle(&#x27;output/COSMOS_48.0arcmin.pkl&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Q0dELfGB_ff_qufA49GY4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-3-6-plot-to-confirm-our-photometry-results" class="relative group"><span class="heading-text">3.6 Plot to Confirm our Photometry Results</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-6-plot-to-confirm-our-photometry-results" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In this step we evaluate the quality of the Tractor-derived fluxes by comparing them to the corresponding SPLASH IRAC fluxes from the COSMOS2015 catalog. Scatter plots with reference lines allow us to check for consistency and ensure that the forced photometry behaves as expected across all four IRAC channels. These diagnostic figures serve as an important validation of the method.</p><div id="ucfdx5Cl4V" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot tractor fluxes vs. catalog splash fluxes
# Should see a straightline with a slope of 1

# Setup to plot
fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2)
fluxmax = 200
ymax = 80
xmax = 80

# Ch1
# First shrink the dataframe to only those rows where we have tractor photometry
df_tractor = df[(df.splash_1_flux&gt; 0) &amp; (df.splash_1_flux &lt; fluxmax)] #200
#sns.regplot(data = df_tractor, x = &quot;splash_1_flux&quot;, y = &quot;ch1flux&quot;, ax = ax1, robust = True)
sns.scatterplot(data = df_tractor, x = &quot;splash_1_flux&quot;, y = &quot;ch1flux&quot;, ax = ax1)

# Add a diagonal line with y = x
lims = [
    np.min([ax1.get_xlim(), ax1.get_ylim()]),  # min of both axes
    np.max([ax1.get_xlim(), ax1.get_ylim()]),  # max of both axes
]

# Now plot both limits against each other
ax1.plot(lims, lims, &#x27;k-&#x27;, alpha=0.75, zorder=0)
ax1.set(xlabel = r&#x27;COSMOS 2015 flux ($\mu$Jy)&#x27;, ylabel = r&#x27;tractor flux ($\mu$Jy)&#x27;, title = &#x27;IRAC 3.6&#x27;)
ax1.set_ylim([0, ymax])
ax1.set_xlim([0, xmax])

# Ch2
# First shrink the dataframe to only those rows where we have tractor photometry
df_tractor = df[(df.splash_2_flux&gt; 0) &amp; (df.splash_2_flux &lt; fluxmax)]
sns.scatterplot(data = df_tractor, x = &quot;splash_2_flux&quot;, y = &quot;ch2flux&quot;, ax = ax2)

# Add a diagonal line with y = x
lims = [
    np.min([ax2.get_xlim(), ax2.get_ylim()]),  # min of both axes
    np.max([ax2.get_xlim(), ax2.get_ylim()]),  # max of both axes
]

# Now plot both limits against each other
ax2.plot(lims, lims, &#x27;k-&#x27;, alpha=0.75, zorder=0)
ax2.set(xlabel = r&#x27;COSMOS 2015 flux ($\mu$Jy)&#x27;, ylabel = r&#x27;tractor flux ($\mu$Jy)&#x27;, title = &#x27;IRAC 4.5&#x27;)
ax2.set_ylim([0, ymax])
ax2.set_xlim([0, xmax])


# Ch3
# First shrink the dataframe to only those rows where we have tractor photometry
df_tractor = df[(df.splash_3_flux&gt; 0) &amp; (df.splash_3_flux &lt; fluxmax)]

sns.scatterplot(data = df_tractor, x = &quot;splash_3_flux&quot;, y = &quot;ch3flux&quot;, ax = ax3)

# Add a diagonal line with y = x
lims = [
    np.min([ax3.get_xlim(), ax3.get_ylim()]),  # min of both axes
    np.max([ax3.get_xlim(), ax3.get_ylim()]),  # max of both axes
]

# Now plot both limits against each other
ax3.plot(lims, lims, &#x27;k-&#x27;, alpha=0.75, zorder=0)
ax3.set(xlabel = r&#x27;COSMOS 2015 flux ($\mu$Jy)&#x27;, ylabel = r&#x27;tractor flux ($\mu$Jy)&#x27;, title = &#x27;IRAC 5.8&#x27;)
ax3.set_ylim([0, ymax])
ax3.set_xlim([0, xmax])


# Ch4
# First shrink the dataframe to only those rows where we have tractor photometry
df_tractor = df[(df.splash_4_flux&gt; 0) &amp; (df.splash_4_flux &lt; fluxmax)]

sns.scatterplot(data = df_tractor, x = &quot;splash_4_flux&quot;, y = &quot;ch4flux&quot;, ax = ax4)

# Add a diagonal line with y = x
lims = [
    np.min([ax4.get_xlim(), ax4.get_ylim()]),  # min of both axes
    np.max([ax4.get_xlim(), ax4.get_ylim()]),  # max of both axes
]

# Now plot both limits against each other
ax4.plot(lims, lims, &#x27;k-&#x27;, alpha=0.75, zorder=0)
ax4.set(xlabel = r&#x27;COSMOS 2015 flux ($\mu$Jy)&#x27;, ylabel = r&#x27;tractor flux ($\mu$Jy)&#x27;, title = &#x27;IRAC 8.0&#x27;)
ax4.set_ylim([0, ymax])
ax4.set_xlim([0, xmax])


plt.tight_layout()

fig.subplots_adjust( hspace=0.5)
fig.set_size_inches(8, 12)

#plt.savefig(&#x27;output/flux_comparison.png&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="-Ek_NhlvW96DLAjw_kaP1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Tractor performs well for the IRAC bands. The panels above compare the Tractor-derived fluxes with the corresponding COSMOS2015 SPLASH fluxes for all four IRAC channels. Each blue point represents an individual object from the selected subset of the catalog. The black line shows the one-to-one relation (y = x), providing a visual reference for agreement between the two measurements.</p><h2 id="id-4-cross-match-our-new-photometry-catalog-with-an-x-ray-archival-catalog" class="relative group"><span class="heading-text">4. Cross Match our New Photometry Catalog with an X-ray archival Catalog</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-cross-match-our-new-photometry-catalog-with-an-x-ray-archival-catalog" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To identify X-ray counterparts to our IRAC sources, we use the nway algorithm (Salvato et al. 2017), a Bayesian cross-matching tool designed for catalogs with different positional uncertainties, different source densities, and multiple possible counterparts. Unlike a simple cone-based positional match, nway evaluates the full probability that each IRAC source corresponds to each Chandra detection by combining:</p><ul><li><p>the positional uncertainties from both catalogs,</p></li><li><p>the local surface density of background sources, and</p></li><li><p>optional priors such as flux distributions or colors.</p></li></ul><p>This probabilistic approach is essential for Chandra data in particular, where positional uncertainties vary with off-axis angle and where multiple IRAC sources may lie within the Chandra error ellipse. Because of this, a TAP crossmatch alone would return many candidate matches, but nway rejects those that are statistically unlikely and keeps only the high-probability associations.</p><p>The files</p><ul><li><p>data/Chandra/COSMOS_chandra.fits</p></li><li><p>data/multiband_phot.fits</p></li></ul><p>are pre-generated catalogs included with this tutorial to keep the workflow focused on the cross-matching step rather than on catalog construction.</p><p>COSMOS_chandra.fits
contains Chandra source positions and fluxes extracted from the COSMOS Legacy Survey. This file is a cleaned, pre-formatted version of the public catalog (Civano et al.), reduced to the columns needed for nway (RA, Dec, fluxes, positional uncertainties). It is provided so the notebook does not need to repeat the data-reduction steps required to reproduce this catalog.</p><p>multiband_phot.fits
contains the IRAC catalog with Tractor-measured fluxes and basic metadata. This file is generated earlier in the tutorial workflow and serves as the input photometric catalog for the crossmatch. It is pre-saved to avoid recomputing the photometry every time the notebook is run.</p><p>Providing these files keeps the tutorial lightweight and enables readers to run the cross-match step without requiring dedicated compute time to reproduce the upstream photometry or Chandra catalog reduction.</p><h3 id="id-4-1-retrieve-the-heasarc-catalog" class="relative group"><span class="heading-text">4.1 Retrieve the HEASARC Catalog</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-1-retrieve-the-heasarc-catalog" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="yezjyofhps" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Instantiate Heasarc
heasarc = Heasarc()

# List all available catalogs
catalog_list = heasarc.list_catalogs()

# Print names of catalogs that include &quot;ccosmoscat&quot;
# we already know it is there, but just in case we want to be sure, or if you
# want to search for a different catalog and confirm its presence
heasarc.list_catalogs(keywords=&#x27;ccosmoscat&#x27;)

# Query the ccosmoscat catalog around our position
ccosmoscat = heasarc.query_region(
    position=coords,
    catalog=&#x27;ccosmoscat&#x27;,
    radius=1.0 * u.deg,
    maxrec=5000,
    columns=&#x27;*&#x27;  # Use &#x27;*&#x27; for all columns instead of &quot;ALL&quot;
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="SPv9yep2EMWtva49wFS-C" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-4-2-run-nway-to-do-the-cross-match" class="relative group"><span class="heading-text">4.2 Run <code>nway</code> to do the Cross-Match</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-2-run-nway-to-do-the-cross-match" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><div id="n7KRS9olfK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Setup:

# Astropy doesn&#x27;t recognize capitalized units
# so there might be some warnings here on writing out the file, but we can safely ignore those

# Need to make the chandra catalog into a FITS table
# and needs to include area of the survey.
ccosmoscat_rad = 1 #radius of chandra cosmos catalog
nway_write_header(&#x27;data/Chandra/COSMOS_chandra.fits&#x27;, &#x27;CHANDRA&#x27;, float(ccosmoscat_rad**2) )


# Also need to transform the main pandas dataframe into FITS table for nway
# Make an index column for tracking later
df[&#x27;ID&#x27;] = range(1, len(df) + 1)

# Need this to be a FITS table and needs to include area of the survey.
rad_in_arcmin = radius.value  #units attached to this are confusing nway down the line
nway_write_header(&#x27;data/multiband_phot.fits&#x27;, &#x27;OPT&#x27;, float((2*rad_in_arcmin/60)**2) )</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="kNSUWI1Fu8kRBcQ1s4oww" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="gmWrtwZ1ZW" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%bash

# Call nway
nway.py &#x27;data/Chandra/COSMOS_chandra.fits&#x27; :ERROR_RADIUS &#x27;data/multiband_phot.fits&#x27; 0.1 --out=data/Chandra/chandra_multiband.fits --radius 15 --prior-completeness 0.9</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xIJ1lVEWI63R2ohUpWeVB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CysDJcEj6Z" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Clean up the cross match results and merge them back into main pandas dataframe

# Read in the nway matched catalog
xmatch = Table.read(&#x27;data/Chandra/chandra_multiband.fits&#x27;, hdu = 1)
df_xmatch = xmatch.to_pandas()

# The manual suggests that p_i should be greater than 0.1 for a pure catalog.
# The matched catalog has multiple optical associations for some of the XMM detections.
# The simplest thing to do is only keep match_flag = 1
matched = df_xmatch.loc[(df_xmatch[&#x27;p_i&#x27;]&gt;=0.1) &amp; df_xmatch[&#x27;match_flag&#x27;]==1]

# Merge this info back into the df_optical dataframe.
merged = pd.merge(df, matched, &#x27;outer&#x27;,left_on=&#x27;ID&#x27;, right_on = &#x27;OPT_ID&#x27;)

# Remove all the rows which start with &quot;OPT&quot; because they are duplications of the original catalog
merged = merged.loc[:, ~merged.columns.str.startswith(&#x27;OPT&#x27;)]

# Somehow the matching is giving negative fluxes in the band where there is no detection
# if there is a detection in the other band.
# Clean that up to make those negative fluxes = 0.

merged.loc[merged[&#x27;flux_chandra_2_10&#x27;] &lt; 0, &#x27;flux_chandra_2_10&#x27;] = 0
merged.loc[merged[&#x27;flux_chandra_05_2&#x27;] &lt; 0, &#x27;flux_chandra_05_2&#x27;] = 0</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="yP5TQXGfPQDGWyDRRUBzE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="wvQcfhajLK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># How many Chandra sources are there?
# How many GALEX sources are there?

# Make a new column which is a bool of existing chandra measurements
merged[&#x27;cosmos_chandra_detect&#x27;] = 0
merged.loc[merged.flux_chandra_2_10 &gt; 0,&#x27;cosmos_chandra_detect&#x27;]=1

# Make one for GALEX too
merged[&#x27;galex_detect&#x27;] = 0
merged.loc[merged.flux_galex_nuv &gt; 0,&#x27;galex_detect&#x27;]=1

# Make chandra hardness ratio column:
# Hard = &#x27;flux_chandra_2_10&#x27;, soft = flux_chandra_05_2, HR = (H-S)/(H+S)
merged[&#x27;chandra_HR&#x27;] = (merged[&#x27;flux_chandra_2_10&#x27;] - merged[&#x27;flux_chandra_05_2&#x27;]) / (merged[&#x27;flux_chandra_2_10&#x27;] + merged[&#x27;flux_chandra_05_2&#x27;])


print(&#x27;number of Chandra detections =&#x27;,np.sum(merged.cosmos_chandra_detect &gt; 0))
print(&#x27;number of GALEX detections =&#x27;,np.sum(merged.galex_detect &gt; 0))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="8l2BsOtet-UrjSwh_hU0k" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-5-plot-final-results" class="relative group"><span class="heading-text">5. Plot Final Results</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-plot-final-results" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section we visualize the final multiwavelength photometry by examining the color–color distributions of the sources. These plots help reveal how different populations separate in color space and allow us to assess whether the Tractor-derived fluxes produce the expected trends across the IRAC and GALEX bands.</p><div id="heWoOqViYG" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># IRAC color color plots akin to Lacy et al. 2004
# Overplot GALEX sources
# Overplot xray sources

# First select on 24 micron
merged_24 = merged[(merged.flux_24 &gt;= 0)].copy()

# Negative GALEX fluxes are causing problems, so set those to zero
merged_24.loc[merged_24.fuvflux &lt; 0, &#x27;fuvflux&#x27;] = 0
merged_24.loc[merged_24.nuvflux &lt; 0, &#x27;nuvflux&#x27;] = 0

# Make color columns
merged_24[&#x27;F5.8divF3.6&#x27;] = merged_24.ch3flux / merged_24.ch1flux
merged_24[&#x27;F8.0divF4.5&#x27;] = merged_24.ch4flux / merged_24.ch2flux

# Detected in all IRAC bands
merged_allirac = merged_24[(merged_24[&#x27;F8.0divF4.5&#x27;] &gt; 0) &amp; (merged_24[&#x27;F5.8divF3.6&#x27;] &gt; 0)]

# Plot all the points
fig, ax = plt.subplots()
sns.scatterplot(data = merged_allirac, x = &#x27;F5.8divF3.6&#x27;, y = &#x27;F8.0divF4.5&#x27;,
                 ax = ax, alpha = 0.5, label = &#x27;all&#x27;)

# Plot only those points with GALEX detections
galex_detect = merged_allirac[merged_allirac.galex_detect &gt; 0]
sns.scatterplot(data = galex_detect, x = &#x27;F5.8divF3.6&#x27;, y = &#x27;F8.0divF4.5&#x27;,
                 ax = ax, alpha = 0.5, label = &#x27;GALEX detect&#x27;)

# Plot only those points with chandra detections
chandra_detect = merged_allirac[merged_allirac.cosmos_chandra_detect &gt; 0]
sns.scatterplot(data = chandra_detect, x = &#x27;F5.8divF3.6&#x27;, y = &#x27;F8.0divF4.5&#x27;,
                 ax = ax, label = &#x27;Chandra detect&#x27;)



ax.set(xscale=&quot;log&quot;, yscale=&quot;log&quot;)
ax.set_ylim([0.1, 10])
ax.set_xlim([0.1, 10])

ax.set(xlabel = &#x27;log F5.8/F3.6&#x27;, ylabel = &#x27;log F8.0/F4.5&#x27;)
ax.legend(loc=&#x27;lower right&#x27;)
plt.title(&#x27;IRAC Color Color Plot&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="oDG2k2BdkElIQgY_4nxRH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>This figure shows an IRAC color color plot akin to the seminal work by Lacy et al. 2004.  Points are color coded for those with GALEX UV detections and those with Chandra x-ray detections. Note that the different populations are seperating out in this color color space.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>If you are running this notebook with the default very small search radius, you may not see many (or any) points in this color–color diagram. Increasing the search radius will populate this plot with a more statistically meaningful sample, but doing so will significantly increase the runtime of the forced-photometry step.</p><div id="Nj2BG4lwmO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># UV IR color color plot akin to Bouquin et al. 2015
fig, ax = plt.subplots()
merged[&#x27;FUV-NUV&#x27;] = merged.mag_galex_fuv - merged.mag_galex_nuv
merged[&#x27;NUV-3.6&#x27;] = merged.mag_galex_nuv - merged.splash_1_mag

# Plot only those points with Galex detections
galex_detect = merged[merged.galex_detect &gt; 0]
sns.kdeplot(data = galex_detect, x = &#x27;NUV-3.6&#x27;, y = &#x27;FUV-NUV&#x27;,
            ax = ax, fill = True, levels = 15)#scatterplot , alpha = 0.5

# Plot only those points with chandra detections
# We color code Chandra sources by hardness ratio a la Moutard et al. 2020
chandra_detect = merged[merged.cosmos_chandra_detect &gt; 0]
sns.scatterplot(data = chandra_detect, x = &#x27;NUV-3.6&#x27;, y = &#x27;FUV-NUV&#x27;,
                ax = ax, hue= &#x27;chandra_HR&#x27;,palette=&quot;flare&quot;)

# Make the legend for hue into a colorbar outside the plot
norm = plt.Normalize(merged[&#x27;chandra_HR&#x27;].min(), merged[&#x27;chandra_HR&#x27;].max())
sm = plt.cm.ScalarMappable(cmap=&quot;flare&quot;, norm=norm)
sm.set_array([])

# Remove the legend and add a colorbar
legend = ax.get_legend()
if legend is not None:
    legend.remove()

ax.figure.colorbar(sm, ax=ax, label=&#x27;Chandra Hardness Ratio&#x27;)

#ax.set(xscale=&quot;log&quot;, yscale=&quot;log&quot;)
ax.set_ylim([-0.5, 3.5])
ax.set_xlim([-1, 7])

ax.set(xlabel = &#x27;NUV - [3.6]&#x27;, ylabel = &#x27;FUV - NUV&#x27;)
#plt.legend([],[], frameon=False)

#fig.savefig(&quot;output/color_color.png&quot;)
#mpld3.display(fig)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="w3cwiw3NPDevnQodbzFy8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>This UV–IR color–color diagram may also appear sparsely populated when using the notebook’s default small-area selection. Only a fraction of sources in this subset have reliable GALEX detections, and even fewer have accompanying Chandra matches. Expanding the search radius will produce a richer distribution, but the larger area will require longer processing times in the earlier photometry steps.</p><div id="a9iQlA934P" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(chandra_detect[&#x27;chandra_HR&#x27;].describe())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="P1Il0Bo83T74xqpEHao6b" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We extend the works of Bouquin et al. 2015 and Moutard et al. 2020 by showing a GALEX - Spitzer color color diagram over plotted with Chandra detections.  Blue galaxies in these colors are generated by O and B stars and so must currently be forming stars. We find a tight blue cloud in this color space identifying those star forming galaxies.  Galaxies off of the blue cloud have had their star formation quenched, quite possibly by the existence of an AGN through removal of the gas reservoir required for star formation.  Chandra detected galaxies host AGN, and while those are more limited in number, can be shown here to be a hosted by all kinds of galaxies, including quiescent galaxies which would be in the upper right of this plot.  This likely implies that AGN are indeed involved in quenching star formation.  Additionally, we show the Chandra hardness ratio (HR) color coded according to the vertical color bar on the right side of the plot.  Those AGN with higher hardness ratios have their soft x-ray bands heavily obscured and appear to reside preferentially toward the quiescent galaxies.</p><span></span><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p><strong>Authors:</strong> Jessica Krick, David Shupe, Marziye JafariYazani, Brigitta Sipőcz, Vandana Desai, Steve Groom, Troy Raen, and the Fornax team</p></li><li><p><strong>Contact:</strong> For help with this notebook, please open a topic in the <a target="_blank" rel="noreferrer" href="https://discourse.fornax.sciencecloud.nasa.gov/" class="">Fornax Community Forum</a> “Support” category.</p></li></ul><h3 id="acknowledgements" class="relative group"><span class="heading-text">Acknowledgements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acknowledgements" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Kristina Nyland for the workflow of the tractor wrapper.</p></li><li><p>MAST, HEASARC, &amp; IRSA Fornax teams</p></li><li><p>Some content in this notebook was created with the assistance of ChatGPT by OpenAI.  All content has been reviewed and validated by the authors to ensure accuracy.</p></li></ul><h3 id="references" class="relative group"><span class="heading-text">References</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>This work made use of:</p><ul><li><p>Astroquery; Ginsburg et al., 2019, 2019AJ....157...98G</p></li><li><p>Astropy; Astropy Collaboration 2022, Astropy Collaboration 2018, Astropy Collaboration 2013, 2022ApJ...935..167A, 2018AJ....156..123A, 2013A&amp;A...558A..33A</p></li><li><p>The Tractor; Lang et al. 2016, 2016AJ....151...36L</p></li><li><p>Nyland et al. 2017 , 2017ApJS..230....9N</p></li><li><p>Salvato et al. 2018, 2018MNRAS.473.4937S</p></li><li><p>Laigle et al. 2016, 2016ApJS..224...24L</p></li></ul></div></aside></div></aside><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/fornax-demo-notebooks/forced-photometry"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Multi-band forced photometry</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/fornax-demo-notebooks/crossmatch"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Cross Matching</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OYMW4E3D.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/root-CXYA7X5D.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-DATP5P2X.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/routes/$-JRBPULBO.js"/><script>window.__remixContext = {"url":"/multiband-photometry","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-69a6313c4231b122fe6c5671416ab596.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-5441a878dc5bd43c0ee191321434622d.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/fornax-demo-notebooks"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-69a6313c4231b122fe6c5671416ab596.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-5441a878dc5bd43c0ee191321434622d.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"9e99b3555fb72752ec31366b2d8168b555e1240171143f3ebdea18763c4cba0e","slug":"multiband-photometry","location":"/forced_photometry/multiband_photometry.md","dependencies":[],"frontmatter":{"title":"Automated Multiband Forced Photometry on Large Datasets","kernelspec":{"name":"python3","display_name":"py-multiband_photometry","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.18.1"}},"execute":{"skip":true},"content_includes_title":false,"authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","subject":"Fornax Demo Notebooks","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/forced_photometry/multiband_photometry.md","edit_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/forced_photometry/multiband_photometry.md","exports":[{"format":"md","filename":"multiband_photometry.md","url":"/fornax-demo-notebooks/build/multiband_photometry-75e1bb03ebdfed9ef579a9471902643b.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"dGd0s2yU1d"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"cwbpbnb5Xa"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will be able to:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"gZoicJNcT3"}],"key":"bXbogoVZpy"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"get catalogs and images from NASA archives in the cloud where possible","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"dT9NtFWS8K"}],"key":"i9NIOZcXcr"}],"key":"JhzE5JxT34"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"measure fluxes at any location by running forced photometry using “The Tractor”","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vjM2nYMc67"}],"key":"BZVhqJqJ5U"}],"key":"ECF15MObHN"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"employ parallel processing to make this as fast as possible","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"jnOBmwtCvL"}],"key":"QwBtt0al9K"}],"key":"FNuJGc9rnU"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"cross match large catalogs","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"dOpMxmmmKP"}],"key":"stFLfUSOfn"}],"key":"KPTqhRZgAV"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"plot results","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"sSrnGPm2Sp"}],"key":"RzpvHXjyXD"}],"key":"RtHQTrePqr"}],"key":"Yhc03Cu1ZP"},{"type":"heading","depth":2,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"YbjsmSCD1F"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"viZ0DpRWcj"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"This code performs photometry in an automated fashion at all locations in an input catalog on 4 bands of IRAC data from IRSA and 2 bands of GALEX data from MAST.  The resulting catalog is then cross-matched with a Chandra catalog from HEASARC to generate a multiband catalog to facilitate galaxy evolution studies.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"y5AZeCyMp3"}],"key":"tYXzT00okS"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"If you run this code as is, it will only look at a small region of the COSMOS survey, and as a result, the plots near the end will not be so very informative.  We do this for faster runtimes and to show proof of concept as to how to do this work.  Please change the radius in section 1. to be something larger if you want to work with more data, but expect longer runtimes associated with larger areas.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"UyfL8HflEC"}],"key":"e2ZEXj3So8"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"The code makes full use of multiple processors to optimize run time on large datasets.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"qvFb8u0WqG"}],"key":"lWsctTs6AW"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Input","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"EEqER1zGPs"}],"identifier":"input","label":"Input","html_id":"input","implicit":true,"key":"KlYtsNlUgh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"RA and DEC within COSMOS catalog","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"bCbQNX2Krq"}],"key":"WlS8TRK9fq"}],"key":"F7DTWa1hUq"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"desired catalog radius in arcminutes","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"CadY2PHvDT"}],"key":"Ixey6eiEPe"}],"key":"zRfGKBYe7n"}],"key":"E4Du7wbS5a"},{"type":"heading","depth":3,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"DPWIHcIaed"}],"identifier":"output","label":"Output","html_id":"output","implicit":true,"key":"oz5F2L4j2o"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"merged, multiband, science ready pandas dataframe","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"GP2oBFX7lc"}],"key":"cWnQe8kEWC"}],"key":"XxGUspuzPm"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"IRAC color color plot for identifying interesting populations","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"CRqMkdaTJs"}],"key":"lQBPrZMv6x"}],"key":"myjuTGdHOR"}],"key":"j58Nni0uX9"},{"type":"heading","depth":3,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Runtime","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"oyvHAfHJPl"}],"identifier":"runtime","label":"Runtime","html_id":"runtime","implicit":true,"key":"zkgzIZVUXi"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"As of 2025 September, this notebook takes about 13 minutes to run to completion on Fornax using a server with 8GB RAM/2 CPU’ and Environment: ‘Default Astrophysics’ (image).","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"i0LjPUEI7G"}],"key":"fBANFLcqBO"},{"type":"heading","depth":2,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"uQpipLznvT"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"JmZI3IoFGs"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"Non-standard Dependencies:","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"m6PEzip9Ci"}],"key":"W6clpJKdAl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":51,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"tractor","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"dUr3e3p28y"},{"type":"text","value":" code which does the forced photometry from Lang et al., 2016","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"XpV5oaWvRH"}],"key":"xflQd64CNV"}],"key":"UvamqclOpB"},{"type":"listItem","spread":true,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"astroquery","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"jZiuM8sVil"},{"type":"text","value":" to interface with archives APIs","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"HWH6ADVHiw"}],"key":"qLwHjz9Asf"}],"key":"wsFrn5FCyA"},{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"astropy","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"LwOK1FPmx9"},{"type":"text","value":" to work with coordinates/units and data structures","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"nkRjL2xN5C"}],"key":"qWlpyb9wjU"}],"key":"yRglgtCqhx"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"skimage","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"splixT4qmN"},{"type":"text","value":" to work with the images","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"jA68R2skWe"}],"key":"SYwAefuiqs"}],"key":"M5BWV1Vvez"}],"key":"WDVkQRWzcy"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"This cell will install the Python ones if needed:","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"P13UzcDLo3"}],"key":"Ebv2xgYlRe"}],"key":"E8OjIp8cVe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# %pip install -r requirements_multiband_photometry.txt","key":"GIRISv3sQ2"},{"type":"outputs","id":"3nrg8bcL3kNLIqIkwzR1I","children":[],"key":"jt1bUimMCP"}],"key":"o70Nv7eVqJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# standard lib imports\nimport time\nimport sys\nimport os\nimport shutil\n\n# Third party imports\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport pandas as pd\nimport seaborn as sns\n\nfrom astropy.io import fits\nfrom astropy.table import Table\nfrom astropy.coordinates import SkyCoord\nimport astropy.units as u\nfrom astroquery.heasarc import Heasarc\nimport pyvo\n\n# Local code imports\nsys.path.append('code_src/')\n\nimport cutout\nimport photometry\nfrom nway_write_header import nway_write_header\nfrom photometry import Band\nfrom photometry import lookup_img_pair\nfrom galex_functions import galex_get_images\n\n# This code is to parse cloud access information; currently in `code_src`, eventually will be part of pyvo\nimport fornax\n\n# temporarily let the notebook start without tractor as a dependency\ntry:\n    from find_nconfsources import find_nconfsources\nexcept ImportError:\n    print(\"tractor is missing\")\n    pass\n\n\n%matplotlib inline","key":"bxYYgyI0iv"},{"type":"outputs","id":"u_RXbxLP0dLTAUp0FGUZ-","children":[],"key":"YVubhD53bB"}],"key":"P7irZsf3b9"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"1. Retrieve Initial Catalog from IRSA","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"Br1lzau05S"}],"identifier":"id-1-retrieve-initial-catalog-from-irsa","label":"1. Retrieve Initial Catalog from IRSA","html_id":"id-1-retrieve-initial-catalog-from-irsa","implicit":true,"key":"xK1ei4CWv2"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"In this section we query the COSMOS2015 catalog (Laigle et al. 2016) from the IRSA archive using the Table Access Protocol (TAP). We specify the sky position and search radius, select a curated subset of columns needed for forced photometry, validation, and later multiwavelength analysis, and download only those rows that fall within the requested region of the COSMOS field. The result is a compact catalog containing positions, photometric redshifts, optical and infrared fluxes, UV measurements, and existing X-ray associations, which forms the starting point for the remainder of the workflow.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"Gmy6JflEyX"}],"key":"NrCfuD601h"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"We access the COSMOS2015 catalog using the Table Access Protocol (TAP), an IVOA standard that allows SQL-like queries across astronomical databases. For more about TAP, see the IVOA ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"SvuEWDpk7E"},{"type":"link","url":"https://www.ivoa.net/documents/TAP/","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"KIth2do24l"}],"urlSource":"https://www.ivoa.net/documents/TAP/","key":"eUSUEDYbT2"},{"type":"text","value":" or ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"P9TpRMv6VO"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/program_interface/astropy_TAP.html","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"suggestions","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"GMleq7TOyj"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/program_interface/astropy_TAP.html","key":"vd3dTl3vGL"},{"type":"text","value":" on its usage from IRSA.","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"nFTRj7RQ7m"}],"key":"wh3aLFoc3U"}],"key":"L25vzFyCfM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Pull a COSMOS catalog from IRSA using pyVO\n\n# Central RA/Dec of the COSMOS field (from SIMBAD).\n# Used as the center of the TAP cone search.\ncoords = SkyCoord('150.01d 2.2d', frame='icrs')\n\n# Search radius (in arcminutes).\n# Full COSMOS radius is ~48', but querying that area is extremely slow\n# (∼24 hours on 128 cores). We start with a small radius for speed.\nradius = 0.5 * u.arcmin\n\n\n# The COSMOS2015 catalog has several thousand columns. Requesting all of\n# them is unnecessary and makes the TAP query more memory intensive\n# and slower than required.\n# We select only the columns needed for:\n#   • forced-photometry inputs (Ks and SPLASH fluxes)\n#   • validation of Tractor photometry (SPLASH fluxes → Section 3.6)\n#   • UV/X-ray diagnostics (GALEX + Chandra fluxes)\n#   • source classification (PHOTOZ, type)\n#   • optical context (r-band mags)\n\n# These columns allow us to *extend* COSMOS2015 with new IRAC+GALEX\n# forced photometry and improved X-ray associations (via nway).\n\ncols = [\n    # Astrometry + unique ID\n    'ra', 'dec', 'id',\n\n    # Ks-band photometry (used by Tractor for contamination modeling)\n    'Ks_FLUX_APER2', 'Ks_FLUXERR_APER2',\n\n    # Photometric redshift\n    'PHOTOZ',\n\n    # SPLASH (IRAC) magnitudes and fluxes — used to validate Tractor outputs\n    'SPLASH_1_MAG', 'SPLASH_1_MAGERR',\n    'SPLASH_1_FLUX', 'SPLASH_1_FLUX_ERR',\n    'SPLASH_2_FLUX', 'SPLASH_2_FLUX_ERR',\n    'SPLASH_3_FLUX', 'SPLASH_3_FLUX_ERR',\n    'SPLASH_4_FLUX', 'SPLASH_4_FLUX_ERR',\n\n    # GALEX UV fluxes\n    'FLUX_GALEX_NUV', 'FLUX_GALEX_FUV',\n\n    # Chandra X-ray fluxes + identifier\n    'FLUX_CHANDRA_05_2', 'FLUX_CHANDRA_2_10', 'FLUX_CHANDRA_05_10', 'ID_CHANDRA09 ',\n\n    # Morphology / source type (0=galaxy, 1=star, etc.)\n    'type',\n\n    # Optical r-band photometry\n    'r_MAG_AUTO', 'r_MAGERR_AUTO',\n\n    # 24 μm photometry (used for additional diagnostics)\n    'FLUX_24', 'FLUXERR_24',\n\n    # GALEX UV magnitudes (for color–color diagrams in Section 5)\n    'MAG_GALEX_NUV', 'MAGERR_GALEX_NUV',\n    'MAG_GALEX_FUV', 'MAGERR_GALEX_FUV'\n]\n\n# Create TAP service object and submit the cone-search query.\n# The WHERE clause selects only sources within the requested radius.\ntap = pyvo.dal.TAPService('https://irsa.ipac.caltech.edu/TAP')\nresult = tap.run_sync(\"\"\"\n           SELECT {}\n           FROM cosmos2015\n           WHERE CONTAINS(POINT('ICRS',ra, dec), CIRCLE('ICRS',{}, {}, {}))=1\n    \"\"\".format(','.join(cols), coords.ra.value, coords.dec.value, radius.to(u.deg).value))\n\n# Convert the TAP result into an astropy Table for further processing.\ncosmos_table = result.to_table()\n\n\nprint(\"Number of objects: \", len(cosmos_table))","key":"mjz54OXDTR"},{"type":"outputs","id":"zsY2GBN1QLPF-Ozh39q0v","children":[],"key":"qv8FwIjgUv"}],"key":"Ued1dPxHFD"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"children":[{"type":"text","value":"1.1 Filter Catalog","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"vuGVk5BPmw"}],"identifier":"id-1-1-filter-catalog","label":"1.1 Filter Catalog","html_id":"id-1-1-filter-catalog","implicit":true,"key":"PzSrRKaIST"},{"type":"paragraph","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"text","value":"If desired, you can filter the initial catalog to include only sources that meet specific criteria.","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"dzJBvhM0Fu"}],"key":"ECOOwJTnQQ"}],"key":"Y9HZPsFH9f"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Here is an example of how to filter the catalog to\n# select those rows with either chandra fluxes or GALEX NUV fluxes\n\n# example_table = cosmos_table[(cosmos_table['flux_chandra_05_10']\u003e 0) | (cosmos_table['flux_galex_fuv'] \u003e 0)]","key":"GKNwbyWJ2C"},{"type":"outputs","id":"Lc6_3_AzmkiOTaauS_tA_","children":[],"key":"SQRD5XTw7c"}],"key":"dQJZfaxJNP"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"children":[{"type":"text","value":"2. Retrieve Image Datasets from the Cloud","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"xVtjJpK6fE"}],"identifier":"id-2-retrieve-image-datasets-from-the-cloud","label":"2. Retrieve Image Datasets from the Cloud","html_id":"id-2-retrieve-image-datasets-from-the-cloud","implicit":true,"key":"zslXSGgcrP"}],"key":"SIC0d2Dl4z"},{"type":"block","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"children":[{"type":"text","value":"2.1 Use the Fornax cloud access API to obtain the IRAC data from the IRSA S3 bucket","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"YosgdK1lW3"}],"identifier":"id-2-1-use-the-fornax-cloud-access-api-to-obtain-the-irac-data-from-the-irsa-s3-bucket","label":"2.1 Use the Fornax cloud access API to obtain the IRAC data from the IRSA S3 bucket","html_id":"id-2-1-use-the-fornax-cloud-access-api-to-obtain-the-irac-data-from-the-irsa-s3-bucket","implicit":true,"key":"sTT7R4HB0I"},{"type":"paragraph","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"Details in this section may change over time.","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"HOKcRm1Fhx"}],"key":"EjPIIoBiQU"}],"key":"WoFO5xEeL9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Retrieve the COSMOS service entry from the VO registry using the standard PyVO workflow.\n# This avoids hard-coding the service URL and ensures the query follows VO best practices.\nimage_services = pyvo.regsearch(servicetype='sia')\nirsa_cosmos = [s for s in image_services if 'irsa' in s.ivoid and 'cosmos' in s.ivoid][0]\n\n# The search returns 11191 entries, but unfortunately we cannot really filter efficiently in the query\n# itself (https://irsa.ipac.caltech.edu/applications/Atlas/AtlasProgramInterface.html#inputparam)\n# to get only the Spitzer IRAC results from COSMOS as a mission. We will do the filtering in a next step before download.\ncosmos_results = irsa_cosmos.search(coords).to_table()\n\nspitzer = cosmos_results[cosmos_results['dataset'] == 'IRAC']","key":"GC6z3AUZab"},{"type":"outputs","id":"KIp3kCa4SZn3GbgJXY6_H","children":[],"key":"YhHhJxvKPo"}],"key":"fudLLTiIEC"},{"type":"block","children":[],"key":"zqUFN3ozCg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# This dataset has limited access, thus 'region' should be used instead of 'open'.\n# S3 access should be available from the Fornax Science Console.\n\nfname = spitzer['fname']\nspitzer['cloud_access'] = [(f'{{\"aws\": {{ \"bucket_name\": \"irsa-fornax-testdata\",'\n                            f'              \"region\": \"us-east-1\",'\n                            f'              \"access\": \"restricted\",'\n                            f'              \"key\": \"COSMOS/{fn}\" }} }}') for fn in fname]","key":"qCvtB73EHw"},{"type":"outputs","id":"GJsp55gTMOYroQYTtMWqG","children":[],"key":"lE6cUt3jDC"}],"key":"klPTThW6bU"},{"type":"block","children":[],"key":"QN7JeJgrTH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Requires https://github.com/nasa-fornax/fornax-cloud-access-API/pull/4\n\ndef fornax_download(data_table, data_subdirectory, access_url_column='access_url',\n                    fname_filter=None, verbose=False):\n    \"\"\"\n    Downloads data files if they do not already exist in the specified directory.\n\n    Parameters\n    ----------\n    data_table : iterable\n        An iterable containing metadata for files to be downloaded. Each element\n        should be a dictionary-like object with at least a 'fname' key.\n    data_subdirectory : str\n        Name of the subdirectory where the downloaded files will be stored.\n    access_url_column : str, optional\n        Column name containing the access URLs for downloading the files.\n        Default is 'access_url'.\n    fname_filter : str, optional\n        If provided, only files whose names contain this substring will be downloaded.\n    verbose : bool, optional\n        If True, print status messages. Default is False.\n\n    Raises\n    ------\n    ValueError\n        If neither 'fname' nor 'name' columns are found in `data_table`.\n\n    Notes\n    -----\n    - The function checks if a file already exists before downloading it.\n    - It creates the target directory if it does not exist.\n    - Uses `fornax.get_data_product()` to retrieve the data handler.\n\n    Examples\n    --------\n    \u003e\u003e\u003e data_table = [{'fname': 'file1.fits', 'access_url': 'https://example.com/file1.fits'},\n    ...               {'fname': 'file2.fits', 'access_url': 'https://example.com/file2.fits'}]\n    \u003e\u003e\u003e fornax_download(data_table, 'my_data', verbose=True)\n    Skipping file1.fits: already exists.\n    Downloaded and saved file2.fits to data/my_data\n    Download process complete.\n    \"\"\"\n    # Define the absolute path of the target directory\n    data_directory = os.path.join(\"data\", data_subdirectory)\n    os.makedirs(data_directory, exist_ok=True)  # Ensure the directory exists\n\n    # Check which filename column exists\n    filename_column = None\n    for col in ['fname', 'name']:\n        if col in data_table.colnames:\n            filename_column = col\n            break  # Use the first found column\n\n    if not filename_column:\n        raise ValueError(\"Error: Neither 'fname' nor 'name' columns found in the data table.\")\n\n    for row in data_table:\n        filename = os.path.basename(row[filename_column])  # Extract filename\n        file_path = os.path.join(data_directory, filename)  # Full file path\n\n        # Skip download if file already exists\n        if os.path.exists(file_path):\n            if verbose:\n                print(f\"Skipping {filename}: already exists.\")\n            continue\n\n        # Apply filename filter, if provided\n        if fname_filter is not None and fname_filter not in filename:\n            continue\n\n        # Download the file\n        handler = fornax.get_data_product(row, 'aws', access_url_column=access_url_column, verbose=verbose)\n        temp_file = handler.download()\n\n        # Move the downloaded file if a local file path is returned\n        if temp_file:\n            shutil.move(temp_file, file_path)\n            if verbose:\n                print(f\"Downloaded and saved {filename} to {data_directory}\")\n\n    if verbose:\n        print(\"Download process complete.\")","key":"JANBiPBRi9"},{"type":"outputs","id":"hZDNzbIipU6weDQGutmsC","children":[],"key":"qCTKq5oGJG"}],"key":"mrcLZpTbAv"},{"type":"block","children":[],"key":"X07RtGzKt4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fornax_download(spitzer, access_url_column='sia_url', fname_filter='go2_sci',\n                data_subdirectory='IRAC', verbose=False)","key":"OnNof8yfGp"},{"type":"outputs","id":"b_iRUiFmTyhTaJjrdhcaU","children":[],"key":"HzvZEuzJUL"}],"key":"gpFD2llmZU"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"children":[{"type":"text","value":"2.2 Obtain GALEX from the MAST archive","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"oqe3lHveyZ"}],"identifier":"id-2-2-obtain-galex-from-the-mast-archive","label":"2.2 Obtain GALEX from the MAST archive","html_id":"id-2-2-obtain-galex-from-the-mast-archive","implicit":true,"key":"qNZRbBRCWU"}],"key":"x9V2H7Hp53"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# The GALEX COSMOS mosaic is split into four separate tiles, each with its own\n# central pointing. To determine which tile each catalog source belongs to,\n# we compute the angular distance from every source to the center of each tile.\n\n# Coordinates for the four GALEX tile centers (in degrees)\nra_center=[150.369,150.369,149.869,149.869]\ndec_center=[2.45583,1.95583,2.45583,1.95583]\n\n# Build SkyCoord objects for the tile centers and for all catalog sources\ngalex = SkyCoord(ra = ra_center*u.degree, dec = dec_center*u.degree)\ncatalog = SkyCoord(ra = cosmos_table['ra'], dec = cosmos_table['dec'])\n\n# For each of the four tiles, compute the angular separation (in degrees)\n# between the tile center and every source in the catalog. These columns will\n# allow us to identify which tile each source falls into.\ncosmos_table['COSMOS_01'] = galex[0].separation(catalog)\ncosmos_table['COSMOS_02'] = galex[1].separation(catalog)\ncosmos_table['COSMOS_03'] = galex[2].separation(catalog)\ncosmos_table['COSMOS_04'] = galex[3].separation(catalog)\n\n# Convert to pandas for easier column operations and downstream merging\ndf = cosmos_table.to_pandas()\n\n# For each source, identify the GALEX tile with the *minimum* separation.\n# The result is a label ('COSMOS_01' ... 'COSMOS_04') indicating which of the\n# four GALEX mosaics should be used when extracting UV cutouts.\ndf['galex_image'] = df[['COSMOS_01','COSMOS_02','COSMOS_03','COSMOS_04']].idxmin(axis = 1)","key":"F1Bzy3rRCw"},{"type":"outputs","id":"dHAIraZQ0bHbqVfWiUwo_","children":[],"key":"LyWxjmsAE9"}],"key":"NwF5K9rYP6"},{"type":"block","children":[],"key":"vhuqN6iSho"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# We expect 76k rows with 15arcmin diameter IRAC images\ndf.describe()","key":"XCPW7Iq3Am"},{"type":"outputs","id":"3m0GwHPi-pEF1wPjindWV","children":[],"key":"fWB0olbpiN"}],"key":"ABDRNDxIxQ"},{"type":"block","children":[],"key":"g4dDjd1iGS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Download both the images and the skybg files using astroquery.mast\ngalex_images = galex_get_images(coords, verbose=True)","key":"jn6G2asxbn"},{"type":"outputs","id":"jc7RVXOd0ETLQ3jOS7Afk","children":[],"key":"JIv51fFqq9"}],"key":"mV1DRfPCkT"},{"type":"block","children":[],"key":"GlJmWcr4uc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Check the catalog for missing or invalid values to ensure the data are usable.\ndf.isna().sum()\n\n# It is acceptable for some flux columns to contain missing values;\n# the remaining columns are complete.","key":"ObrwK72SdN"},{"type":"outputs","id":"0dOj3PAOykU5LIEVzz8iP","children":[],"key":"LpcvEysRyj"}],"key":"SkvBvgf8UW"},{"type":"block","children":[],"key":"YEsaALMssq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# As an exploratory check, examine how many sources of each\n# classification type appear in the catalog.\n#Type: 0 = galaxy, 1 = star, 2 = X-ray source, -9 is failure to fit\ndf.type.value_counts()","key":"Wb2L8sLv1e"},{"type":"outputs","id":"TYSy1MK0BRDfK5EPY45J8","children":[],"key":"ZljkyocXAm"}],"key":"KV7lqbCufa"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":386,"column":1},"end":{"line":386,"column":1}},"children":[{"type":"text","value":"3. Run Forced Photometry","position":{"start":{"line":386,"column":1},"end":{"line":386,"column":1}},"key":"dP7Nr2SSAo"}],"identifier":"id-3-run-forced-photometry","label":"3. Run Forced Photometry","html_id":"id-3-run-forced-photometry","implicit":true,"key":"wDAwX0r4ak"},{"type":"paragraph","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"children":[{"type":"text","value":"This section performs forced photometry at the positions of all COSMOS2015 sources using The Tractor. We prepare the inputs required for Tractor by first collecting the IRAC and GALEX images and then supplying the corresponding point response functions (PRFs), which describe how a point source is spread across the detector. The PRFs are included with the notebook rather than downloaded at runtime because they are stable, calibrated instrument files that do not change across observations; if they were not provided, users could obtain them from the Spitzer IRAC Instrument Handbook or the GALEX calibration database. Next, we identify nearby contaminating sources for each target, estimate the local sky background, and define the parameters needed to extract a cutout around each object. The following two code cells create Band objects — small data structures that bundle together the PRF, pixel scale, cutout size, flux-conversion factor, and band index — so that each IRAC and GALEX image can be handled consistently during the photometry. Once these inputs are assembled, Tractor is run to measure instrumental fluxes and uncertainties in each band. These measurements form the foundation of the multiband catalog constructed later in the workflow.","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"key":"CunsSiKkE8"}],"key":"KuO88dUfMb"}],"key":"VXwpkco2YS"},{"type":"block","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"3.1 Setup","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"PQ37YBV4qL"}],"identifier":"id-3-1-setup","label":"3.1 Setup","html_id":"id-3-1-setup","implicit":true,"key":"K8DUZlE9Aq"},{"type":"paragraph","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"children":[{"type":"text","value":"In this step we initialize the DataFrame columns that will hold the Tractor-derived fluxes and uncertainties. We then assemble the configuration for each IRAC and GALEX band, including the PRFs, pixel scales, and cutout sizes, and load the corresponding science and background images needed for the photometry. This setup ensures that all band-specific parameters are ready for the main photometry loop.","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"jSXhzrMQ6R"}],"key":"eIrKfx45UQ"}],"key":"vPppze3JkJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# initialize columns in data frame for photometry results\ncols = [\"ch1flux\", \"ch1flux_unc\", \"ch2flux\", \"ch2flux_unc\", \"ch3flux\", \"ch3flux_unc\",\n        \"ch4flux\", \"ch4flux_unc\", \"ch5flux\", \"ch5flux_unc\", \"ch6flux\", \"ch6flux_unc\"]\ndf[cols] = 0.0\n\n# list to collect all the bands\nall_bands = []","key":"I94xOCFvlG"},{"type":"outputs","id":"ZRhQgTR4ity6MrNzoIaDB","children":[],"key":"juEQ9HxM8S"}],"key":"TQOFVAE0ih"},{"type":"block","children":[],"key":"mMXWw6258K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# IRAC channels\nirac_band_indexes = [\n    0,  # ch1\n    1,  # ch2\n    2,  # ch3\n    3,  # ch4\n]\n\nirac_fluxconversion = (1E12) / (4.254517E10) * (0.6) *(0.6)\n\nirac_mosaic_pix_scale = 0.6\n\nirac_cutout_width = 10 # in arcseconds, taken from Nyland et al. 2017\n\nirac_prfs = [\n    fits.open('data/IRAC/PRF_IRAC_ch1.fits')[0].data,\n    fits.open('data/IRAC/PRF_IRAC_ch2.fits')[0].data,\n    fits.open('data/IRAC/PRF_IRAC_ch3.fits')[0].data,\n    fits.open('data/IRAC/PRF_IRAC_ch4.fits')[0].data,\n]\n\n# zip parameters for each band into a container and append to the master list\nirac_bands = [\n    Band(\n        idx, prf, irac_cutout_width, irac_fluxconversion, irac_mosaic_pix_scale\n    )\n    for idx, prf in zip(irac_band_indexes, irac_prfs)\n]\nall_bands += irac_bands","key":"pnHFnaF2D7"},{"type":"outputs","id":"Yn6V8glBL1YCbL141EA-v","children":[],"key":"NcrDIRL9WQ"}],"key":"WKAHnO93c4"},{"type":"block","children":[],"key":"KZZCsxhzRV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# GALEX bands\ngalex_band_indexes = [\n    4,  # nuv\n    5,  # fuv\n]\n\ngalex_cutout_width = 40\n\ngalex_fluxconversions = [\n    3.373E1,  # uJy. fudging this to make the numbers bigger for plotting later\n    1.076E2,  # uJy. fudging this to make the numbers bigger for plotting later\n]\n\ngalex_mosaic_pix_scale = 1.5\n\nprf_nuv = fits.open(\"data/Galex/PSFnuv_faint.fits\")[0].data\nprf_fuv = fits.open(\"data/Galex/PSFfuv.fits\")[0].data\nprf_nuv = prf_nuv[0:119, 0:119]\nprf_fuv = prf_fuv[0:119, 0:119]\n\n# These are much larger than the cutouts we are using, so only keep the central\n# region which is the size of our cutouts\nngalex_pix = galex_cutout_width / galex_mosaic_pix_scale\nprf_cen = int(60)\nprf_nuv = prf_nuv[(prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2)),\n                  (prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2))]\nprf_fuv = prf_fuv[(prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2)),\n                  (prf_cen - int(ngalex_pix / 2) - 1) : (prf_cen + int(ngalex_pix / 2))]\ngalex_prfs = [prf_nuv, prf_fuv]\n\n# Zip parameters for each band into a container and append to the master list\ngalex_bands = [\n    Band(\n        idx, prf, galex_cutout_width, flux_conv, galex_mosaic_pix_scale\n    )\n    for idx, prf, flux_conv in zip(galex_band_indexes, galex_prfs, galex_fluxconversions)\n]\nall_bands += galex_bands","key":"Ur6bwPgX8B"},{"type":"outputs","id":"zqXm5PFFKbsLQTGJ2frSb","children":[],"key":"yQiARPV1EV"}],"key":"coVBuh2HXw"},{"type":"block","children":[],"key":"JaBZO6jNeR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Collect input images\n# collect the files in pairs: (science image, sky-background image)\n# if the same file should be used for both, just send it once\nsci_bkg_pairs = [\n    # IRAC. use the science image to calculate the background\n    ('data/IRAC/irac_ch1_go2_sci_10.fits', ),\n    ('data/IRAC/irac_ch2_go2_sci_10.fits', ),\n    ('data/IRAC/irac_ch3_go2_sci_10.fits', ),\n    ('data/IRAC/irac_ch4_go2_sci_10.fits', ),\n    # GALEX. calculate the background from a dedicated file\n    ('data/Galex/COSMOS_01-nd-int.fits.gz', 'data/Galex/COSMOS_01-nd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_01-fd-int.fits.gz', 'data/Galex/COSMOS_01-fd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_02-nd-int.fits.gz', 'data/Galex/COSMOS_02-nd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_02-fd-int.fits.gz', 'data/Galex/COSMOS_02-fd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_03-nd-int.fits.gz', 'data/Galex/COSMOS_03-nd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_03-fd-int.fits.gz', 'data/Galex/COSMOS_03-fd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_04-nd-int.fits.gz', 'data/Galex/COSMOS_04-nd-skybg.fits.gz'),\n    ('data/Galex/COSMOS_04-fd-int.fits.gz', 'data/Galex/COSMOS_04-fd-skybg.fits.gz'),\n]","key":"kAWs4nuPNr"},{"type":"outputs","id":"C7wC2jO1hsmRbOOPiqTpl","children":[],"key":"r0uQAy2E7K"}],"key":"pauWuMumF3"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"children":[{"type":"text","value":"3.2 Main Function to do the Forced Photometry","position":{"start":{"line":501,"column":1},"end":{"line":501,"column":1}},"key":"WwWK8t14v5"}],"identifier":"id-3-2-main-function-to-do-the-forced-photometry","label":"3.2 Main Function to do the Forced Photometry","html_id":"id-3-2-main-function-to-do-the-forced-photometry","implicit":true,"key":"gXejODodwM"}],"key":"uYCgU0y9O9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calc_instrflux(band, ra, dec, stype, ks_flux_aper2, img_pair, df):\n    \"\"\"\n    Calculate single-band instrumental fluxes and uncertainties at the given RA, Dec\n    using tractor.\n\n    Parameters:\n    -----------\n    band : `Band`\n        Collection of parameters for a single band.\n        A `Band` is a named tuple with the following attributes:\n            idx : int\n                Identifier for the band/channel.\n                (integer in [0, 1, 2, 3, 4, 5] for the four IRAC bands and two GALEX bands)\n            prf : np.ndarray\n                Point spread function for the band/channel.\n            cutout_width : int\n                width of desired cutout in arcseconds\n            flux_conv : float\n                factor used to convert tractor result to microjanskies\n            mosaic_pix_scale : float\n                Pixel scale of the image\n    ra, dec : float\n        celestial coordinates for measuring photometry\n    stype : int\n        0, 1, 2, -9 for star, galaxy, x-ray source\n    ks_flux_aper_2 : float\n        flux in aperture 2\n    img_pair : tuple\n        Pair of images for science and background respectively.\n        If the tuple only contains one element it will serve double duty.\n        A tuple element can be a `fits.ImageHDU` or the path to a FITS file as a `str`.\n    df : pd.DataFrame\n        Source catalog.\n        Previous arguments (ra, dec, stype, ks_flux_aper_2) come from a single row of this df.\n        However, we must also pass the entire dataframe in order to find nearby sources which are possible contaminates.\n\n    Returns:\n    --------\n    outband : int\n        reflects the input band index for identification purposes\n    flux : float\n        Measured flux in microJansky.\n        NaN if the forced photometery failed.\n    flux_unc : float\n        Flux uncertainty in microJansky, calculated from the tractor results.\n        NaN if the forced photometery failed or if tractor didn't report a flux variance.\n    \"\"\"\n\n    # Extract a cutout centered on the target object.\n    # This returns:\n    #   - subimage:    the science cutout\n    #   - bkgsubimage: small background region used for sky estimation\n    #   - x1, y1:      pixel coordinates of the target within the cutout\n    #   - subimage_wcs: WCS for converting RA/Dec of neighbors into pixel coords\n    subimage, bkgsubimage, x1, y1, subimage_wcs = cutout.extract_pair(\n        ra, dec, img_pair=img_pair, cutout_width=band.cutout_width, mosaic_pix_scale=band.mosaic_pix_scale\n    )\n\n    # Identify all nearby sources that fall inside the cutout.\n    # These “confusing sources” are modeled alongside the target so that Tractor\n    # can correctly account for blending and crowding. `objsrc` is a list of\n    # Tractor-ready source objects (target first, then neighbors).\n    objsrc, nconfsrcs = find_nconfsources(\n        ra, dec, stype, ks_flux_aper2, x1, y1, band.cutout_width, subimage_wcs, df\n    )\n\n    # Estimate the local sky background and noise from the background cutout.\n    # Tractor needs this information for likelihood evaluation.\n    skymean, skynoise = photometry.calc_background(bkgsubimage=bkgsubimage)\n\n    # Run Tractor to fit the model PRF + sky + neighbors to the science cutout.\n    flux_var = photometry.run_tractor(\n        subimage=subimage, prf=band.prf, objsrc=objsrc, skymean=skymean, skynoise=skynoise\n    )\n\n    # If Tractor cannot converge (common when sources are faint or blended),\n    # return NaNs to signal failure for this band.\n    if flux_var is None:\n        return (band.idx, np.nan, np.nan)\n\n    # Convert Tractor’s instrumental flux and variance into physical units\n    # (microJanskys) using the band-specific flux conversion factor.\n    # The uncertainty is derived from the reported flux variance.\n    microJy_flux, microJy_unc = photometry.interpret_tractor_results(\n        flux_var=flux_var, flux_conv=band.flux_conv, objsrc=objsrc, nconfsrcs=nconfsrcs\n    )\n\n    return (band.idx, microJy_flux, microJy_unc)","key":"ADqKR00ZJ6"},{"type":"outputs","id":"GfgDVpgN2crL4cwSkwH8G","children":[],"key":"JN9SXOf80m"}],"key":"HGbAgDzqeD"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":598,"column":1},"end":{"line":598,"column":1}},"children":[{"type":"text","value":"3.3 Calculate Forced Photometry with Straightforward but Slow Method","position":{"start":{"line":598,"column":1},"end":{"line":598,"column":1}},"key":"gjbVcrZXf9"}],"identifier":"id-3-3-calculate-forced-photometry-with-straightforward-but-slow-method","label":"3.3 Calculate Forced Photometry with Straightforward but Slow Method","html_id":"id-3-3-calculate-forced-photometry-with-straightforward-but-slow-method","implicit":true,"key":"iswSkO3mLA"},{"type":"paragraph","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"children":[{"type":"text","value":"Here we demonstrate a baseline implementation of forced photometry that processes each source sequentially and computes fluxes for all bands. Although this approach is simple and instructive, it is computationally inefficient for large catalogs, and we therefore do not use it.","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"qYFlA4Nr46"}],"key":"U9iepMDX6q"}],"key":"BBdNbHFgHn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Do the calculation without multiprocessing for benchmarking\n\n## Make a copy for parallel computation\n#pl_df = df.copy(deep=True)\n\n#t0 = time.time()\n## For each object\n#for row in df.itertuples():\n#    # For each band\n#    for band in range(6):\n#        # Measure the flux with tractor\n#        outband, flux, unc = calc_instrflux(band, row.ra, row.dec, row.type, row.ks_flux_aper2)\n\n#        # Put the results back into the dataframe\n#        df.loc[row.Index, 'ch{:d}flux'.format(outband+1)] = flux\n#        df.loc[row.Index, 'ch{:d}flux_unc'.format(outband+1)] = unc\n\n#t1 = time.time()\n\n##10,000 sources took 1.5 hours with this code on a medium sized machine","key":"iqRybRpNN0"},{"type":"outputs","id":"OvVC-gfDeF-aWTpVHxLVm","children":[],"key":"g5NApAR6ii"}],"key":"Du2ObR5LFb"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":625,"column":1},"end":{"line":625,"column":1}},"children":[{"type":"text","value":"3.4 Calculate Forced Photometry - Parallelization","position":{"start":{"line":625,"column":1},"end":{"line":625,"column":1}},"key":"aw8hCZbvkc"}],"identifier":"id-3-4-calculate-forced-photometry-parallelization","label":"3.4 Calculate Forced Photometry - Parallelization","html_id":"id-3-4-calculate-forced-photometry-parallelization","implicit":true,"key":"FGi8wSTozy"},{"type":"paragraph","position":{"start":{"line":627,"column":1},"end":{"line":627,"column":1}},"children":[{"type":"text","value":"To improve performance, we parallelize the forced photometry computation across multiple CPU cores. We construct a parameter list containing the source coordinates and band configurations, distribute the workload to worker processes, and combine the results into the main DataFrame. This parallel implementation drastically reduces runtime and enables practical processing of large areas of the COSMOS field.","position":{"start":{"line":627,"column":1},"end":{"line":627,"column":1}},"key":"GtV0WISTgb"}],"key":"oC4Fl7fuMR"}],"key":"aSAgmDVAZ5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Setup:\n\n# list of parameter sets to pass to the parallel photometry function\nparamlist = []\n\nfor row in df.itertuples():\n    for band in all_bands:\n         # Select the appropriate science/background image pair for this band and GALEX tile\n        img_pair = lookup_img_pair(sci_bkg_pairs, band.idx, row.galex_image)\n\n        # Append the full set of parameters needed by calc_instrflux()\n        paramlist.append(\n            [row.Index, band, row.ra, row.dec, row.type, row.ks_flux_aper2, img_pair, df]\n        )\nprint('paramlist: ', len(paramlist)) # total number of photometry jobs to run","key":"d1UFNjQ5Kr"},{"type":"outputs","id":"hSjee7kePM_FtYXRFEpid","children":[],"key":"VDulGPfRLK"}],"key":"v9adpAmOts"},{"type":"block","children":[],"key":"uj2QiXUMjU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Here we show how the calc_instrflux function works on a single source\ncalc_instrflux(*paramlist[0][1:])\n\n# Another way to run calc_instrflux with different syntax than the line above:\n# calc_instrflux(paramlist[0][1], paramlist[0][2], paramlist[0][3], paramlist[0][4], paramlist[0][5], paramlist[0][6])","key":"D8XxKCTyDu"},{"type":"outputs","id":"vF480zJXmBztX0tqDkIj4","children":[],"key":"Isiq1Zrstj"}],"key":"GDDOV1u8Fg"},{"type":"block","children":[],"key":"ixhMD1niSY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#wrapper to measure the photometry on a single object, single band\ndef calculate_flux(args):\n    \"\"\"\n    Wrapper function for parallel photometry that computes fluxes for a\n    single (source, band) combination.\n\n    This function unpacks the argument list expected by ``calc_instrflux()``,\n    calls that function to perform the forced photometry, and returns both\n    the job index and the photometry result. It also performs lightweight\n    logging by writing progress updates to a log file every 100 iterations.\n\n    Parameters\n    ----------\n    args : list or tuple\n        A structured argument list of the form\n        ``[index, band, ra, dec, stype, ks_flux_aper2, img_pair, df]``\n        where:\n            index : int\n                Row index of the source in the input catalog.\n            band : Band\n                Band configuration object used by Tractor.\n            ra, dec : float\n                Celestial coordinates of the source (degrees).\n            stype : int\n                Source type code for Tractor (0 = star, 1 = galaxy, etc.).\n            ks_flux_aper2 : float\n                Ks-band flux used as an initial flux estimate.\n            img_pair : tuple\n                Science/background image pair for the band.\n            df : pandas.DataFrame\n                Full catalog used to identify neighboring contaminants.\n\n    Returns\n    -------\n    index : int\n        The original job index corresponding to this source–band combination.\n    val : tuple\n        Output from ``calc_instrflux()``, containing\n        ``(band_index, flux_microJy, flux_unc_microJy)``.\n\n    Notes\n    -----\n    This function is designed to be executed inside a multiprocessing pool,\n    which requires functions to accept a single argument. It serves as a\n    thin wrapper around ``calc_instrflux()`` and adds optional logging\n    of long-running jobs for monitoring purposes.\n    \"\"\"\n\n    val = calc_instrflux(*args[1:])\n    # add simple logging\n    if (args[0] % 100) == 0 and val[0] == 0:\n        with open('output/output.log', 'a') as fp: fp.write(f'{args[0]}\\n')\n    return(args[0], val)","key":"IQK097vrbd"},{"type":"outputs","id":"ak4QDojTslSaL_u0FnJVP","children":[],"key":"TNR2EuoJdA"}],"key":"k0z4BdKDpA"},{"type":"block","children":[],"key":"paCLtTISZa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# if results were previously saved to this location, load them\n# else start a pool of workers to calculate results in parallel, and save them here\n\n\n# File where parallel photometry results are stored (one file per search radius)\nfname = f'output/results_{radius.value}.npz'\n\n# If cached results exist, load them to avoid re-running the computation\nif os.path.exists(fname):\n    results = np.load(fname, allow_pickle=True)['results']\n\n# Otherwise, compute all fluxes in parallel and save the output\nelse:\n    from  multiprocessing import Pool\n    t0 = time.time()\n    # Reset the lightweight progress log\n    with open('output/output.log', 'w') as fp: fp.write('')\n\n    # Launch a multiprocessing pool to compute fluxes for all parameter sets\n    with Pool() as pool:\n        results = pool.map(calculate_flux, paramlist)\n\n    # Save execution time and final results\n    dtime = time.time() - t0\n    np.savez(fname, results=np.array(results, dtype=object))\n    print(f'Parallel calculation took {dtime} seconds')","key":"j4vkJgTTK4"},{"type":"outputs","id":"YQgzE7Vd9r5NKmbfTXYcU","children":[],"key":"kWgjXeizEi"}],"key":"wuqUGrMW5V"},{"type":"block","children":[],"key":"bEsRlIwHki"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Put the results into the main daraframe\nfor res in results:\n    idx,(ich, val, err) = res\n    df.loc[idx, f'ch{ich+1}flux'] = val\n    df.loc[idx, f'ch{ich+1}flux_unc'] = err","key":"jQXPHTAnyW"},{"type":"outputs","id":"bzcUfM2oYDaAgOmqJvr48","children":[],"key":"qERkEuPFDz"}],"key":"Wx3sY6VIN8"},{"type":"block","children":[],"key":"VLvtShVnS1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Count the number of non-zero ch1 fluxes\nprint('Parallel calculation: number of ch1 fluxes filled in =',\n      np.sum(df.ch1flux \u003e 0))","key":"CE2O7DKzmz"},{"type":"outputs","id":"acDD9eKpDMVuINr0f_JFd","children":[],"key":"iwX0WymrsS"}],"key":"GnN1q2HwQg"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":758,"column":1},"end":{"line":758,"column":1}},"children":[{"type":"text","value":"3.5 Cleanup","position":{"start":{"line":758,"column":1},"end":{"line":758,"column":1}},"key":"kjgTfRodeq"}],"identifier":"id-3-5-cleanup","label":"3.5 Cleanup","html_id":"id-3-5-cleanup","implicit":true,"key":"dXRUAOqmdD"}],"key":"jCHfDUi1XG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Had to call the GALEX flux columns ch5 and ch6\n# Fix that by renaming them now\ncols = {'ch5flux':'nuvflux', 'ch5flux_unc':'nuvflux_unc','ch6flux':'fuvflux', 'ch6flux_unc':'fuvflux_unc'}\ndf.rename(columns=cols, inplace = True)","key":"h09IXdjyR6"},{"type":"outputs","id":"uAILkQRme-gkPDmSJvJRF","children":[],"key":"rNEhFQYDCd"}],"key":"FDJPxnSTDO"},{"type":"block","children":[],"key":"wzhF35Qlgx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# When doing a large run of a large area, save the dataframe with the forced photometry\n# so we don't have to do the forced photometry every time\n\ndf.to_pickle(f'output/COSMOS_{radius.value}arcmin.pkl')","key":"A35iIhKrzP"},{"type":"outputs","id":"J2RQbE9Jyd7No-Ji89dWp","children":[],"key":"qsULpQCh22"}],"key":"Usds2v3drq"},{"type":"block","children":[],"key":"DFM0XXBQgR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#If you are not runnig the forced photometry, then read in the catalog from a previous run\n\n#df = pd.read_pickle('output/COSMOS_48.0arcmin.pkl')","key":"q1XAr9plEc"},{"type":"outputs","id":"Q0dELfGB_ff_qufA49GY4","children":[],"key":"GH98yTuyua"}],"key":"hhecVKIGQS"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":780,"column":1},"end":{"line":780,"column":1}},"children":[{"type":"text","value":"3.6 Plot to Confirm our Photometry Results","position":{"start":{"line":780,"column":1},"end":{"line":780,"column":1}},"key":"kbIZcOToze"}],"identifier":"id-3-6-plot-to-confirm-our-photometry-results","label":"3.6 Plot to Confirm our Photometry Results","html_id":"id-3-6-plot-to-confirm-our-photometry-results","implicit":true,"key":"Ye4niI4tkX"},{"type":"paragraph","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"children":[{"type":"text","value":"In this step we evaluate the quality of the Tractor-derived fluxes by comparing them to the corresponding SPLASH IRAC fluxes from the COSMOS2015 catalog. Scatter plots with reference lines allow us to check for consistency and ensure that the forced photometry behaves as expected across all four IRAC channels. These diagnostic figures serve as an important validation of the method.","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"CmdJtYt0nk"}],"key":"Lk4cMmAHos"}],"key":"f21gzJCwyh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Plot tractor fluxes vs. catalog splash fluxes\n# Should see a straightline with a slope of 1\n\n# Setup to plot\nfig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2)\nfluxmax = 200\nymax = 80\nxmax = 80\n\n# Ch1\n# First shrink the dataframe to only those rows where we have tractor photometry\ndf_tractor = df[(df.splash_1_flux\u003e 0) \u0026 (df.splash_1_flux \u003c fluxmax)] #200\n#sns.regplot(data = df_tractor, x = \"splash_1_flux\", y = \"ch1flux\", ax = ax1, robust = True)\nsns.scatterplot(data = df_tractor, x = \"splash_1_flux\", y = \"ch1flux\", ax = ax1)\n\n# Add a diagonal line with y = x\nlims = [\n    np.min([ax1.get_xlim(), ax1.get_ylim()]),  # min of both axes\n    np.max([ax1.get_xlim(), ax1.get_ylim()]),  # max of both axes\n]\n\n# Now plot both limits against each other\nax1.plot(lims, lims, 'k-', alpha=0.75, zorder=0)\nax1.set(xlabel = r'COSMOS 2015 flux ($\\mu$Jy)', ylabel = r'tractor flux ($\\mu$Jy)', title = 'IRAC 3.6')\nax1.set_ylim([0, ymax])\nax1.set_xlim([0, xmax])\n\n# Ch2\n# First shrink the dataframe to only those rows where we have tractor photometry\ndf_tractor = df[(df.splash_2_flux\u003e 0) \u0026 (df.splash_2_flux \u003c fluxmax)]\nsns.scatterplot(data = df_tractor, x = \"splash_2_flux\", y = \"ch2flux\", ax = ax2)\n\n# Add a diagonal line with y = x\nlims = [\n    np.min([ax2.get_xlim(), ax2.get_ylim()]),  # min of both axes\n    np.max([ax2.get_xlim(), ax2.get_ylim()]),  # max of both axes\n]\n\n# Now plot both limits against each other\nax2.plot(lims, lims, 'k-', alpha=0.75, zorder=0)\nax2.set(xlabel = r'COSMOS 2015 flux ($\\mu$Jy)', ylabel = r'tractor flux ($\\mu$Jy)', title = 'IRAC 4.5')\nax2.set_ylim([0, ymax])\nax2.set_xlim([0, xmax])\n\n\n# Ch3\n# First shrink the dataframe to only those rows where we have tractor photometry\ndf_tractor = df[(df.splash_3_flux\u003e 0) \u0026 (df.splash_3_flux \u003c fluxmax)]\n\nsns.scatterplot(data = df_tractor, x = \"splash_3_flux\", y = \"ch3flux\", ax = ax3)\n\n# Add a diagonal line with y = x\nlims = [\n    np.min([ax3.get_xlim(), ax3.get_ylim()]),  # min of both axes\n    np.max([ax3.get_xlim(), ax3.get_ylim()]),  # max of both axes\n]\n\n# Now plot both limits against each other\nax3.plot(lims, lims, 'k-', alpha=0.75, zorder=0)\nax3.set(xlabel = r'COSMOS 2015 flux ($\\mu$Jy)', ylabel = r'tractor flux ($\\mu$Jy)', title = 'IRAC 5.8')\nax3.set_ylim([0, ymax])\nax3.set_xlim([0, xmax])\n\n\n# Ch4\n# First shrink the dataframe to only those rows where we have tractor photometry\ndf_tractor = df[(df.splash_4_flux\u003e 0) \u0026 (df.splash_4_flux \u003c fluxmax)]\n\nsns.scatterplot(data = df_tractor, x = \"splash_4_flux\", y = \"ch4flux\", ax = ax4)\n\n# Add a diagonal line with y = x\nlims = [\n    np.min([ax4.get_xlim(), ax4.get_ylim()]),  # min of both axes\n    np.max([ax4.get_xlim(), ax4.get_ylim()]),  # max of both axes\n]\n\n# Now plot both limits against each other\nax4.plot(lims, lims, 'k-', alpha=0.75, zorder=0)\nax4.set(xlabel = r'COSMOS 2015 flux ($\\mu$Jy)', ylabel = r'tractor flux ($\\mu$Jy)', title = 'IRAC 8.0')\nax4.set_ylim([0, ymax])\nax4.set_xlim([0, xmax])\n\n\nplt.tight_layout()\n\nfig.subplots_adjust( hspace=0.5)\nfig.set_size_inches(8, 12)\n\n#plt.savefig('output/flux_comparison.png')","key":"u8xYAwYVXT"},{"type":"outputs","id":"-Ek_NhlvW96DLAjw_kaP1","children":[],"key":"RjrVeqYbJa"}],"key":"ucfdx5Cl4V"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":876,"column":1},"end":{"line":876,"column":1}},"children":[{"type":"text","value":"Tractor performs well for the IRAC bands. The panels above compare the Tractor-derived fluxes with the corresponding COSMOS2015 SPLASH fluxes for all four IRAC channels. Each blue point represents an individual object from the selected subset of the catalog. The black line shows the one-to-one relation (y = x), providing a visual reference for agreement between the two measurements.","position":{"start":{"line":876,"column":1},"end":{"line":876,"column":1}},"key":"axqapJ0TXO"}],"key":"ttZCpCLzTA"}],"key":"kI9uKR1yvG"},{"type":"block","position":{"start":{"line":878,"column":1},"end":{"line":878,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"children":[{"type":"text","value":"4. Cross Match our New Photometry Catalog with an X-ray archival Catalog","position":{"start":{"line":880,"column":1},"end":{"line":880,"column":1}},"key":"QywlRpxc8r"}],"identifier":"id-4-cross-match-our-new-photometry-catalog-with-an-x-ray-archival-catalog","label":"4. Cross Match our New Photometry Catalog with an X-ray archival Catalog","html_id":"id-4-cross-match-our-new-photometry-catalog-with-an-x-ray-archival-catalog","implicit":true,"key":"TZHDJW06hf"},{"type":"paragraph","position":{"start":{"line":882,"column":1},"end":{"line":882,"column":1}},"children":[{"type":"text","value":"To identify X-ray counterparts to our IRAC sources, we use the nway algorithm (Salvato et al. 2017), a Bayesian cross-matching tool designed for catalogs with different positional uncertainties, different source densities, and multiple possible counterparts. Unlike a simple cone-based positional match, nway evaluates the full probability that each IRAC source corresponds to each Chandra detection by combining:","position":{"start":{"line":882,"column":1},"end":{"line":882,"column":1}},"key":"I2n7MkkE5T"}],"key":"iymxHdcjJ0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":884,"column":1},"end":{"line":887,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the positional uncertainties from both catalogs,","position":{"start":{"line":884,"column":1},"end":{"line":884,"column":1}},"key":"qdJ0a5SmRg"}],"key":"p0u2FvqnP4"}],"key":"T9UPCqToU6"},{"type":"listItem","spread":true,"position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the local surface density of background sources, and","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"U5Sbohde3C"}],"key":"e3pxP0mtMv"}],"key":"pWHE7rXgz7"},{"type":"listItem","spread":true,"position":{"start":{"line":886,"column":1},"end":{"line":887,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"optional priors such as flux distributions or colors.","position":{"start":{"line":886,"column":1},"end":{"line":886,"column":1}},"key":"KgL2P130SP"}],"key":"EAGFPZAbQk"}],"key":"mrko31pacF"}],"key":"heMinmfwGS"},{"type":"paragraph","position":{"start":{"line":888,"column":1},"end":{"line":888,"column":1}},"children":[{"type":"text","value":"This probabilistic approach is essential for Chandra data in particular, where positional uncertainties vary with off-axis angle and where multiple IRAC sources may lie within the Chandra error ellipse. Because of this, a TAP crossmatch alone would return many candidate matches, but nway rejects those that are statistically unlikely and keeps only the high-probability associations.","position":{"start":{"line":888,"column":1},"end":{"line":888,"column":1}},"key":"KAF4cgxtSP"}],"key":"iZebDUmpPg"},{"type":"paragraph","position":{"start":{"line":890,"column":1},"end":{"line":890,"column":1}},"children":[{"type":"text","value":"The files","position":{"start":{"line":890,"column":1},"end":{"line":890,"column":1}},"key":"t05Th5tm2u"}],"key":"RWKU9qVFuU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":891,"column":1},"end":{"line":893,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":891,"column":1},"end":{"line":891,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"data/Chandra/COSMOS_chandra.fits","position":{"start":{"line":891,"column":1},"end":{"line":891,"column":1}},"key":"iMkR6EXgKX"}],"key":"vsecFKvoAF"}],"key":"QTbr04ZLDr"},{"type":"listItem","spread":true,"position":{"start":{"line":892,"column":1},"end":{"line":893,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"data/multiband_phot.fits","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"key":"Na2fMc8bgE"}],"key":"Xj6DG6bt4t"}],"key":"QtOOPdwxII"}],"key":"RMSMCx73bB"},{"type":"paragraph","position":{"start":{"line":894,"column":1},"end":{"line":894,"column":1}},"children":[{"type":"text","value":"are pre-generated catalogs included with this tutorial to keep the workflow focused on the cross-matching step rather than on catalog construction.","position":{"start":{"line":894,"column":1},"end":{"line":894,"column":1}},"key":"vvrOtpKyf2"}],"key":"QNovqjUJSa"},{"type":"paragraph","position":{"start":{"line":896,"column":1},"end":{"line":897,"column":1}},"children":[{"type":"text","value":"COSMOS_chandra.fits\ncontains Chandra source positions and fluxes extracted from the COSMOS Legacy Survey. This file is a cleaned, pre-formatted version of the public catalog (Civano et al.), reduced to the columns needed for nway (RA, Dec, fluxes, positional uncertainties). It is provided so the notebook does not need to repeat the data-reduction steps required to reproduce this catalog.","position":{"start":{"line":896,"column":1},"end":{"line":896,"column":1}},"key":"RdGI48zUbe"}],"key":"OoLzNuiO7g"},{"type":"paragraph","position":{"start":{"line":899,"column":1},"end":{"line":900,"column":1}},"children":[{"type":"text","value":"multiband_phot.fits\ncontains the IRAC catalog with Tractor-measured fluxes and basic metadata. This file is generated earlier in the tutorial workflow and serves as the input photometric catalog for the crossmatch. It is pre-saved to avoid recomputing the photometry every time the notebook is run.","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"rlEJ2I3NLo"}],"key":"TSYjgd3igm"},{"type":"paragraph","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"children":[{"type":"text","value":"Providing these files keeps the tutorial lightweight and enables readers to run the cross-match step without requiring dedicated compute time to reproduce the upstream photometry or Chandra catalog reduction.","position":{"start":{"line":902,"column":1},"end":{"line":902,"column":1}},"key":"MOk6nCgfWm"}],"key":"AhYr3bHSKf"}],"key":"Et6CAqORJS"},{"type":"block","position":{"start":{"line":904,"column":1},"end":{"line":904,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"children":[{"type":"text","value":"4.1 Retrieve the HEASARC Catalog","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"aDysCaigdG"}],"identifier":"id-4-1-retrieve-the-heasarc-catalog","label":"4.1 Retrieve the HEASARC Catalog","html_id":"id-4-1-retrieve-the-heasarc-catalog","implicit":true,"key":"Lnjxz4KhTH"}],"key":"FQ2ZZLlymy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Instantiate Heasarc\nheasarc = Heasarc()\n\n# List all available catalogs\ncatalog_list = heasarc.list_catalogs()\n\n# Print names of catalogs that include \"ccosmoscat\"\n# we already know it is there, but just in case we want to be sure, or if you\n# want to search for a different catalog and confirm its presence\nheasarc.list_catalogs(keywords='ccosmoscat')\n\n# Query the ccosmoscat catalog around our position\nccosmoscat = heasarc.query_region(\n    position=coords,\n    catalog='ccosmoscat',\n    radius=1.0 * u.deg,\n    maxrec=5000,\n    columns='*'  # Use '*' for all columns instead of \"ALL\"\n)","key":"n8KVb0ufuG"},{"type":"outputs","id":"SPv9yep2EMWtva49wFS-C","children":[],"key":"pdVkAvF1vR"}],"key":"yezjyofhps"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":930,"column":1},"end":{"line":930,"column":1}},"children":[{"type":"text","value":"4.2 Run ","position":{"start":{"line":930,"column":1},"end":{"line":930,"column":1}},"key":"x0wO3BQ3Iv"},{"type":"inlineCode","value":"nway","position":{"start":{"line":930,"column":1},"end":{"line":930,"column":1}},"key":"uvwyajCMRW"},{"type":"text","value":" to do the Cross-Match","position":{"start":{"line":930,"column":1},"end":{"line":930,"column":1}},"key":"XGfvyozn4O"}],"identifier":"id-4-2-run-nway-to-do-the-cross-match","label":"4.2 Run nway to do the Cross-Match","html_id":"id-4-2-run-nway-to-do-the-cross-match","implicit":true,"key":"vT9YmdExju"}],"key":"ZDX2r0M0yi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Setup:\n\n# Astropy doesn't recognize capitalized units\n# so there might be some warnings here on writing out the file, but we can safely ignore those\n\n# Need to make the chandra catalog into a FITS table\n# and needs to include area of the survey.\nccosmoscat_rad = 1 #radius of chandra cosmos catalog\nnway_write_header('data/Chandra/COSMOS_chandra.fits', 'CHANDRA', float(ccosmoscat_rad**2) )\n\n\n# Also need to transform the main pandas dataframe into FITS table for nway\n# Make an index column for tracking later\ndf['ID'] = range(1, len(df) + 1)\n\n# Need this to be a FITS table and needs to include area of the survey.\nrad_in_arcmin = radius.value  #units attached to this are confusing nway down the line\nnway_write_header('data/multiband_phot.fits', 'OPT', float((2*rad_in_arcmin/60)**2) )","key":"T2woKVSgai"},{"type":"outputs","id":"kNSUWI1Fu8kRBcQ1s4oww","children":[],"key":"odgIXTt5VR"}],"key":"n7KRS9olfK"},{"type":"block","children":[],"key":"unWwhtZfYL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%bash\n\n# Call nway\nnway.py 'data/Chandra/COSMOS_chandra.fits' :ERROR_RADIUS 'data/multiband_phot.fits' 0.1 --out=data/Chandra/chandra_multiband.fits --radius 15 --prior-completeness 0.9","key":"M5ZO5p1FID"},{"type":"outputs","id":"xIJ1lVEWI63R2ohUpWeVB","children":[],"key":"tgnPDIXHPZ"}],"key":"gmWrtwZ1ZW"},{"type":"block","children":[],"key":"JfG93lyWQb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Clean up the cross match results and merge them back into main pandas dataframe\n\n# Read in the nway matched catalog\nxmatch = Table.read('data/Chandra/chandra_multiband.fits', hdu = 1)\ndf_xmatch = xmatch.to_pandas()\n\n# The manual suggests that p_i should be greater than 0.1 for a pure catalog.\n# The matched catalog has multiple optical associations for some of the XMM detections.\n# The simplest thing to do is only keep match_flag = 1\nmatched = df_xmatch.loc[(df_xmatch['p_i']\u003e=0.1) \u0026 df_xmatch['match_flag']==1]\n\n# Merge this info back into the df_optical dataframe.\nmerged = pd.merge(df, matched, 'outer',left_on='ID', right_on = 'OPT_ID')\n\n# Remove all the rows which start with \"OPT\" because they are duplications of the original catalog\nmerged = merged.loc[:, ~merged.columns.str.startswith('OPT')]\n\n# Somehow the matching is giving negative fluxes in the band where there is no detection\n# if there is a detection in the other band.\n# Clean that up to make those negative fluxes = 0.\n\nmerged.loc[merged['flux_chandra_2_10'] \u003c 0, 'flux_chandra_2_10'] = 0\nmerged.loc[merged['flux_chandra_05_2'] \u003c 0, 'flux_chandra_05_2'] = 0","key":"XGD63ooHO1"},{"type":"outputs","id":"yP5TQXGfPQDGWyDRRUBzE","children":[],"key":"kVQo2bMYiG"}],"key":"CysDJcEj6Z"},{"type":"block","children":[],"key":"pEdiwUNYVR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# How many Chandra sources are there?\n# How many GALEX sources are there?\n\n# Make a new column which is a bool of existing chandra measurements\nmerged['cosmos_chandra_detect'] = 0\nmerged.loc[merged.flux_chandra_2_10 \u003e 0,'cosmos_chandra_detect']=1\n\n# Make one for GALEX too\nmerged['galex_detect'] = 0\nmerged.loc[merged.flux_galex_nuv \u003e 0,'galex_detect']=1\n\n# Make chandra hardness ratio column:\n# Hard = 'flux_chandra_2_10', soft = flux_chandra_05_2, HR = (H-S)/(H+S)\nmerged['chandra_HR'] = (merged['flux_chandra_2_10'] - merged['flux_chandra_05_2']) / (merged['flux_chandra_2_10'] + merged['flux_chandra_05_2'])\n\n\nprint('number of Chandra detections =',np.sum(merged.cosmos_chandra_detect \u003e 0))\nprint('number of GALEX detections =',np.sum(merged.galex_detect \u003e 0))","key":"vCnqfSlERb"},{"type":"outputs","id":"8l2BsOtet-UrjSwh_hU0k","children":[],"key":"BbGNkww0W0"}],"key":"wvQcfhajLK"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":1007,"column":1},"end":{"line":1007,"column":1}},"children":[{"type":"text","value":"5. Plot Final Results","position":{"start":{"line":1007,"column":1},"end":{"line":1007,"column":1}},"key":"Lxw2Hg6t3I"}],"identifier":"id-5-plot-final-results","label":"5. Plot Final Results","html_id":"id-5-plot-final-results","implicit":true,"key":"Tc2CtcqGpV"},{"type":"paragraph","position":{"start":{"line":1009,"column":1},"end":{"line":1009,"column":1}},"children":[{"type":"text","value":"In this section we visualize the final multiwavelength photometry by examining the color–color distributions of the sources. These plots help reveal how different populations separate in color space and allow us to assess whether the Tractor-derived fluxes produce the expected trends across the IRAC and GALEX bands.","position":{"start":{"line":1009,"column":1},"end":{"line":1009,"column":1}},"key":"uVMb6XBJBe"}],"key":"nK4yNnom5y"}],"key":"Ecu0XW9xUA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# IRAC color color plots akin to Lacy et al. 2004\n# Overplot GALEX sources\n# Overplot xray sources\n\n# First select on 24 micron\nmerged_24 = merged[(merged.flux_24 \u003e= 0)].copy()\n\n# Negative GALEX fluxes are causing problems, so set those to zero\nmerged_24.loc[merged_24.fuvflux \u003c 0, 'fuvflux'] = 0\nmerged_24.loc[merged_24.nuvflux \u003c 0, 'nuvflux'] = 0\n\n# Make color columns\nmerged_24['F5.8divF3.6'] = merged_24.ch3flux / merged_24.ch1flux\nmerged_24['F8.0divF4.5'] = merged_24.ch4flux / merged_24.ch2flux\n\n# Detected in all IRAC bands\nmerged_allirac = merged_24[(merged_24['F8.0divF4.5'] \u003e 0) \u0026 (merged_24['F5.8divF3.6'] \u003e 0)]\n\n# Plot all the points\nfig, ax = plt.subplots()\nsns.scatterplot(data = merged_allirac, x = 'F5.8divF3.6', y = 'F8.0divF4.5',\n                 ax = ax, alpha = 0.5, label = 'all')\n\n# Plot only those points with GALEX detections\ngalex_detect = merged_allirac[merged_allirac.galex_detect \u003e 0]\nsns.scatterplot(data = galex_detect, x = 'F5.8divF3.6', y = 'F8.0divF4.5',\n                 ax = ax, alpha = 0.5, label = 'GALEX detect')\n\n# Plot only those points with chandra detections\nchandra_detect = merged_allirac[merged_allirac.cosmos_chandra_detect \u003e 0]\nsns.scatterplot(data = chandra_detect, x = 'F5.8divF3.6', y = 'F8.0divF4.5',\n                 ax = ax, label = 'Chandra detect')\n\n\n\nax.set(xscale=\"log\", yscale=\"log\")\nax.set_ylim([0.1, 10])\nax.set_xlim([0.1, 10])\n\nax.set(xlabel = 'log F5.8/F3.6', ylabel = 'log F8.0/F4.5')\nax.legend(loc='lower right')\nplt.title('IRAC Color Color Plot')","key":"zQjtK5JGku"},{"type":"outputs","id":"oDG2k2BdkElIQgY_4nxRH","children":[],"key":"FYRqe89iMl"}],"key":"heWoOqViYG"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"children":[{"type":"text","value":"This figure shows an IRAC color color plot akin to the seminal work by Lacy et al. 2004.  Points are color coded for those with GALEX UV detections and those with Chandra x-ray detections. Note that the different populations are seperating out in this color color space.","position":{"start":{"line":1056,"column":1},"end":{"line":1056,"column":1}},"key":"IrSYsQ1ghM"}],"key":"mLvRQC9bVu"}],"key":"kadjf7BKU1"},{"type":"block","position":{"start":{"line":1058,"column":1},"end":{"line":1058,"column":1}},"children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"PUR0qIhVfw"}],"key":"womIIpnJZ6"},{"type":"paragraph","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"children":[{"type":"text","value":"If you are running this notebook with the default very small search radius, you may not see many (or any) points in this color–color diagram. Increasing the search radius will populate this plot with a more statistically meaningful sample, but doing so will significantly increase the runtime of the forced-photometry step.","position":{"start":{"line":1061,"column":1},"end":{"line":1061,"column":1}},"key":"qKbFiUBC3f"}],"key":"rRnt2VyFUK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# UV IR color color plot akin to Bouquin et al. 2015\nfig, ax = plt.subplots()\nmerged['FUV-NUV'] = merged.mag_galex_fuv - merged.mag_galex_nuv\nmerged['NUV-3.6'] = merged.mag_galex_nuv - merged.splash_1_mag\n\n# Plot only those points with Galex detections\ngalex_detect = merged[merged.galex_detect \u003e 0]\nsns.kdeplot(data = galex_detect, x = 'NUV-3.6', y = 'FUV-NUV',\n            ax = ax, fill = True, levels = 15)#scatterplot , alpha = 0.5\n\n# Plot only those points with chandra detections\n# We color code Chandra sources by hardness ratio a la Moutard et al. 2020\nchandra_detect = merged[merged.cosmos_chandra_detect \u003e 0]\nsns.scatterplot(data = chandra_detect, x = 'NUV-3.6', y = 'FUV-NUV',\n                ax = ax, hue= 'chandra_HR',palette=\"flare\")\n\n# Make the legend for hue into a colorbar outside the plot\nnorm = plt.Normalize(merged['chandra_HR'].min(), merged['chandra_HR'].max())\nsm = plt.cm.ScalarMappable(cmap=\"flare\", norm=norm)\nsm.set_array([])\n\n# Remove the legend and add a colorbar\nlegend = ax.get_legend()\nif legend is not None:\n    legend.remove()\n\nax.figure.colorbar(sm, ax=ax, label='Chandra Hardness Ratio')\n\n#ax.set(xscale=\"log\", yscale=\"log\")\nax.set_ylim([-0.5, 3.5])\nax.set_xlim([-1, 7])\n\nax.set(xlabel = 'NUV - [3.6]', ylabel = 'FUV - NUV')\n#plt.legend([],[], frameon=False)\n\n#fig.savefig(\"output/color_color.png\")\n#mpld3.display(fig)","key":"aqbu3dWhWG"},{"type":"outputs","id":"w3cwiw3NPDevnQodbzFy8","children":[],"key":"pH2chVZAVI"}],"key":"Nj2BG4lwmO"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"uFZJs2LHUU"}],"key":"RhQ5viJAzj"},{"type":"paragraph","position":{"start":{"line":1104,"column":1},"end":{"line":1104,"column":1}},"children":[{"type":"text","value":"This UV–IR color–color diagram may also appear sparsely populated when using the notebook’s default small-area selection. Only a fraction of sources in this subset have reliable GALEX detections, and even fewer have accompanying Chandra matches. Expanding the search radius will produce a richer distribution, but the larger area will require longer processing times in the earlier photometry steps.","position":{"start":{"line":1104,"column":1},"end":{"line":1104,"column":1}},"key":"ZyqM7BtElj"}],"key":"OZ8APK7444"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(chandra_detect['chandra_HR'].describe())","key":"j1KMQjw0PW"},{"type":"outputs","id":"P1Il0Bo83T74xqpEHao6b","children":[],"key":"GazMZ7vbJh"}],"key":"a9iQlA934P"},{"type":"paragraph","position":{"start":{"line":1110,"column":1},"end":{"line":1110,"column":1}},"children":[{"type":"text","value":"We extend the works of Bouquin et al. 2015 and Moutard et al. 2020 by showing a GALEX - Spitzer color color diagram over plotted with Chandra detections.  Blue galaxies in these colors are generated by O and B stars and so must currently be forming stars. We find a tight blue cloud in this color space identifying those star forming galaxies.  Galaxies off of the blue cloud have had their star formation quenched, quite possibly by the existence of an AGN through removal of the gas reservoir required for star formation.  Chandra detected galaxies host AGN, and while those are more limited in number, can be shown here to be a hosted by all kinds of galaxies, including quiescent galaxies which would be in the upper right of this plot.  This likely implies that AGN are indeed involved in quenching star formation.  Additionally, we show the Chandra hardness ratio (HR) color coded according to the vertical color bar on the right side of the plot.  Those AGN with higher hardness ratios have their soft x-ray bands heavily obscured and appear to reside preferentially toward the quiescent galaxies.","position":{"start":{"line":1110,"column":1},"end":{"line":1110,"column":1}},"key":"uCIE6RD2CA"}],"key":"Rnwzny3FSR"},{"type":"blockBreak","position":{"start":{"line":1112,"column":1},"end":{"line":1112,"column":1}},"key":"k8FPIm0oXB"},{"type":"heading","depth":2,"position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"aEiKyoAP0D"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"dmtO64xlj8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1116,"column":1},"end":{"line":1118,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1116,"column":1},"end":{"line":1116,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":1116,"column":1},"end":{"line":1116,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":1116,"column":1},"end":{"line":1116,"column":1}},"key":"mP6ZJJV8tQ"}],"key":"RboaSbYmwp"},{"type":"text","value":" Jessica Krick, David Shupe, Marziye JafariYazani, Brigitta Sipőcz, Vandana Desai, Steve Groom, Troy Raen, and the Fornax team","position":{"start":{"line":1116,"column":1},"end":{"line":1116,"column":1}},"key":"oNJQXbvNv4"}],"key":"W8ceDSQQf4"}],"key":"pMQ9oSUGyU"},{"type":"listItem","spread":true,"position":{"start":{"line":1117,"column":1},"end":{"line":1118,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"key":"n6LvBrCGn1"}],"key":"PxzBB7L9Jj"},{"type":"text","value":" For help with this notebook, please open a topic in the ","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"key":"Bep6aI9Mdj"},{"type":"link","url":"https://discourse.fornax.sciencecloud.nasa.gov/","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"children":[{"type":"text","value":"Fornax Community Forum","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"key":"jIjRx6dF32"}],"urlSource":"https://discourse.fornax.sciencecloud.nasa.gov/","key":"ogc16ykQoM"},{"type":"text","value":" “Support” category.","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"key":"ST4pILHMgd"}],"key":"iIj3b0Zpgx"}],"key":"bFEZqOWrMX"}],"key":"M6171dYGUc"},{"type":"heading","depth":3,"position":{"start":{"line":1119,"column":1},"end":{"line":1119,"column":1}},"children":[{"type":"text","value":"Acknowledgements","position":{"start":{"line":1119,"column":1},"end":{"line":1119,"column":1}},"key":"MrdB9syVZm"}],"identifier":"acknowledgements","label":"Acknowledgements","html_id":"acknowledgements","implicit":true,"key":"TZU87K8gGu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1121,"column":1},"end":{"line":1124,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1121,"column":1},"end":{"line":1121,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Kristina Nyland for the workflow of the tractor wrapper.","position":{"start":{"line":1121,"column":1},"end":{"line":1121,"column":1}},"key":"r3lcOWHhTm"}],"key":"MyXY48ufws"}],"key":"gzMvBcbBjT"},{"type":"listItem","spread":true,"position":{"start":{"line":1122,"column":1},"end":{"line":1122,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"MAST, HEASARC, \u0026 IRSA Fornax teams","position":{"start":{"line":1122,"column":1},"end":{"line":1122,"column":1}},"key":"AXicrftYjB"}],"key":"kO8V4cTUEK"}],"key":"LhsGlufb55"},{"type":"listItem","spread":true,"position":{"start":{"line":1123,"column":1},"end":{"line":1124,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Some content in this notebook was created with the assistance of ChatGPT by OpenAI.  All content has been reviewed and validated by the authors to ensure accuracy.","position":{"start":{"line":1123,"column":1},"end":{"line":1123,"column":1}},"key":"q6NrJPP5o9"}],"key":"RPhvfRGShi"}],"key":"J7QOMNAc2k"}],"key":"kSg3jmBqBM"},{"type":"heading","depth":3,"position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":1125,"column":1},"end":{"line":1125,"column":1}},"key":"BDxL7moDSL"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"rCCGI6eXly"},{"type":"paragraph","position":{"start":{"line":1127,"column":1},"end":{"line":1127,"column":1}},"children":[{"type":"text","value":"This work made use of:","position":{"start":{"line":1127,"column":1},"end":{"line":1127,"column":1}},"key":"CAviBeRIug"}],"key":"ToG3Mz8aIm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1129,"column":1},"end":{"line":1134,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1129,"column":1},"end":{"line":1129,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Astroquery; Ginsburg et al., 2019, 2019AJ....157...98G","position":{"start":{"line":1129,"column":1},"end":{"line":1129,"column":1}},"key":"aCAu7OG1q4"}],"key":"E0QHiY3lea"}],"key":"SdjFMJPcWJ"},{"type":"listItem","spread":true,"position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Astropy; Astropy Collaboration 2022, Astropy Collaboration 2018, Astropy Collaboration 2013, 2022ApJ...935..167A, 2018AJ....156..123A, 2013A\u0026A...558A..33A","position":{"start":{"line":1130,"column":1},"end":{"line":1130,"column":1}},"key":"cRohBmdonm"}],"key":"eey5G76M2F"}],"key":"MkK0T5orRS"},{"type":"listItem","spread":true,"position":{"start":{"line":1131,"column":1},"end":{"line":1131,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The Tractor; Lang et al. 2016, 2016AJ....151...36L","position":{"start":{"line":1131,"column":1},"end":{"line":1131,"column":1}},"key":"IAcQHgcH36"}],"key":"CtE3PSVzAs"}],"key":"aVFXg2yEQ6"},{"type":"listItem","spread":true,"position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Nyland et al. 2017 , 2017ApJS..230....9N","position":{"start":{"line":1132,"column":1},"end":{"line":1132,"column":1}},"key":"nnMFhrNSyt"}],"key":"b88068gC1u"}],"key":"Pdc2Cekxi6"},{"type":"listItem","spread":true,"position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Salvato et al. 2018, 2018MNRAS.473.4937S","position":{"start":{"line":1133,"column":1},"end":{"line":1133,"column":1}},"key":"kj4Z8gYtA5"}],"key":"RyMNGRsZ2Q"}],"key":"zYmCihU3Jv"},{"type":"listItem","spread":true,"position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Laigle et al. 2016, 2016ApJS..224...24L","position":{"start":{"line":1134,"column":1},"end":{"line":1134,"column":1}},"key":"TAbjln6FgU"}],"key":"zeax54mo2d"}],"key":"kqaiEjsNop"}],"key":"JeeB74DVvW"}],"key":"b1RZOd6M5j"}],"key":"Ajmk5U6m1a"}],"key":"yLdkVGpRwk"}],"key":"zgVRiEN9WJ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Multi-band forced photometry","url":"/forced-photometry","group":"The Fornax Initiative"},"next":{"title":"Cross Matching","url":"/crossmatch","group":"The Fornax Initiative"}}},"domain":"http://localhost:3000"},"project":{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/fornax-demo-notebooks/build/manifest-86A905A4.js";
import * as route0 from "/fornax-demo-notebooks/build/root-CXYA7X5D.js";
import * as route1 from "/fornax-demo-notebooks/build/routes/$-JRBPULBO.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js");</script></body></html>