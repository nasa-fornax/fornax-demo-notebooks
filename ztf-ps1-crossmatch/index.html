<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Cross-Match ZTF and Pan-STARRS using LSDB - The Fornax Initiative</title><meta property="og:title" content="Cross-Match ZTF and Pan-STARRS using LSDB - The Fornax Initiative"/><meta name="generator" content="mystmd"/><meta name="description" content="Tutorial notebooks for example Fornax use cases"/><meta property="og:description" content="Tutorial notebooks for example Fornax use cases"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/app-AIT5GAEP.css"/><link rel="stylesheet" href="/fornax-demo-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/fornax-demo-notebooks/favicon.ico"/><link rel="stylesheet" href="/fornax-demo-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/fornax-demo-notebooks/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/fornax-demo-notebooks/build/fornax_logo-4cc31726eadc04c560c90703184b963a.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="The Fornax Initiative" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/fornax-demo-notebooks/">The Fornax Initiative</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time Domain" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/time-domain">Time Domain</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Spectroscopy" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/spectroscopy">Spectroscopy</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Multi-band forced photometry" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/forced-photometry">Multi-band forced photometry</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Cross Matching" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/fornax-demo-notebooks/crossmatch">Cross Matching</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Fornax Demo Notebooks</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/nasa-fornax/fornax-demo-notebooks" title="GitHub Repository: nasa-fornax/fornax-demo-notebooks" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/crossmatch/ztf_ps1_crossmatch.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Cross-Match ZTF and Pan-STARRS using LSDB</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">Fornax developers and scientists</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this tutorial, you will:</p><ul><li><p>understand how to cross-match cloud-based catalogs using <code>lsdb</code>.</p></li><li><p>understand how to parallelize <code>lsdb</code> cross-matches using <code>dask</code>.</p></li><li><p>have a feeling for when <code>dask</code> parallelization can be helpful.</p></li><li><p>have a rough idea of the maximum number of objects that can be cross matched on each Fornax Science Console server type.</p></li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In the era of increasingly large astronomical survey missions like TESS, Gaia, ZTF, Pan-STARRS, Roman, and Rubin, catalog operations are becoming less and less practical to complete on a personal computer. Operations such as source cross-matching can require many GB of memory and take many hours to complete using a single CPU. Recognizing these looming obstacles, many catalogs are becoming accessible to cloud computing platforms like the Fornax Science Console, and increasingly high-performance tools are being developed that leverage cloud computing resources to simplify and speed up catalog operations.</p><p><a target="_blank" rel="noreferrer" href="https://lsdb.io" class="">LSDB</a> is a useful package for performing large cross-matches between HATS catalogs. It can leverage the <a target="_blank" rel="noreferrer" href="https://www.dask.org/" class="">Dask</a> library to work with larger-than-memory data sets and distribute computation tasks across multiple cores. Users perform large cross-matches without ever having to download a file.</p><p>In this tutorial, we will use <code>lsdb</code> with <code>dask</code> to perform a cross-match between ZTF and Pan-STARRS HATS catalogs to benchmark the performance. These HATS catalogs are stored on AWS S3 cloud storage. An application might be to collect time-series photometry for 10,000 or more stars in the Kepler field from ZTF and Pan-STARRS. With this in mind, we will begin by cross-matching 10,000 sources from ZTF with the Pan-STARRS mean-object catalog. The user can choose to scale up to a larger number of rows to test the performance. The CSV file provided with this notebook contains the runtime results of tests run on various Fornax Science Console server types for comparison.</p><p>As of August 2025, the Fornax Science Console server types were:</p><ul><li><p>“Small” - 4 GB RAM, 2 CPU</p></li><li><p>“Medium” - 16 GB RAM, 4 CPU</p></li><li><p>“Large” -  64 GB RAM, 16 CPU</p></li><li><p>“XLarge” -  512 GB RAM, 128 CPU</p></li></ul><p>For generality, we will refer to the server type by the number of CPUs. For each server and each number of cross-match rows, we want to know the performance with (1) default <code>dask</code> configuration, (2) minimal <code>dask</code> - 1 worker, (3) bigger <code>dask</code> - as many workers as we can use, and (4) auto-scaling <code>dask</code>.</p><p><strong>Note</strong> that in this notebook, only one configuration (combination of CPU count, number of cross-match rows, and <code>dask</code> configuration) is run at a time. It must be reconfigured and rerun to benchmark each configuration.</p><h3 id="runtime" class="relative group"><span class="heading-text">Runtime</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#runtime" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As of August 2025, as written (10,000 rows with the “default” <code>dask</code> settings), this notebook takes about 45 seconds to run on the “small” Fornax Science Console server type (4 GB RAM and 2 CPUs). Users can modify the configuration for larger cross-matches, which will take more time. E.g., cross-matching 10 million rows on the “large” server type (64 GB RAM and 16 CPUs) can take ~5 minutes.</p><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We require the following packages:</p><ul><li><p><code>os</code> solely for the <code>cpu_count</code> function,</p></li><li><p><code>datetime</code> for measuring the crossmatch time,</p></li><li><p><code>pandas</code> to write and read the CSV of benchmarks</p></li><li><p><code>matplotlib</code> to plot the benchmarks,</p></li><li><p><code>astropy</code> for coordinates and units,</p></li><li><p><code>lsdb</code> to read the catalogs and perform the cross-match, and</p></li><li><p><code>dask</code> for parallelization.</p></li></ul><div id="PnNdpnfhVA" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# %pip install -r requirements_ztf_ps1_crossmatch.txt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="3BnIviVWgxEaLB6KtFmjU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fRCf6UGnrB" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from os import cpu_count
from datetime import datetime

import pandas as pd
import matplotlib.pyplot as plt
from astropy.coordinates import SkyCoord
from astropy import units as u

import lsdb
from dask.distributed import Client, LocalCluster</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="VUz8A6ywblHOOHGjf2ngs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-1-preconfiguring-the-run" class="relative group"><span class="heading-text">1. Preconfiguring the Run</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-preconfiguring-the-run" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>First choose the number of rows we want to cross-match and our <code>dask</code> environment. For tips on using <code>dask</code> with <code>lsdb</code>, see <a target="_blank" rel="noreferrer" href="https://docs.lsdb.io/en/stable/tutorials/dask-cluster-tips.html" class=""><code>lsdb</code>’s Dask Cluster Tips</a>.</p><div id="Dd55Hard7x" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># The left table will have about this many rows. The cross-matched product will have slightly fewer.
# Set Nrows = -1 to cross-match the entire catalog. The full catalog cross-match is
# recommended ONLY on XLarge instance with at least 32 workers.
Nrows = 10_000

# dask_workers can be:
# - &quot;default&quot; (uses the default scheduler which runs all tasks in the main process)
# - an integer, which uses a fixed number of workers
# - &quot;scale&quot; to use an adaptive, auto-scaling cluster.
dask_workers = &quot;default&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="FeNnt13bw67nY4DbpjTLO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Vt6a9kdZrL" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># The code in this cell is automatic setup based on the configuration in the previous cell, so it can be left alone.

# We must pass a radius to lsdb. Here is the mapping between radius and desired number of rows for ZTF.
# The values in this dictionary were determined experimentally, by
# incrementing/decrementing the radius until the desired number of
# catalog rows was returned.
radius = { # Nrows: radius_arcseconds
           10_000:     331,
          100_000:    1047,
        1_000_000:    3318,
       10_000_000:  11_180,
      100_000_000:  33_743,
    1_000_000_000: 102_000,
}

# Set up dask cluster
if dask_workers == &quot;scale&quot;:
    cluster = LocalCluster()
    cluster.adapt(minimum_cores=1, maximum_cores=cpu_count())
    client = Client(cluster)
elif isinstance(dask_workers, int):
    client = Client(
        # Number of Dask workers - Python processes to run
        n_workers=dask_workers,
        # Limits number of Python threads per worker
        threads_per_worker=1,
        # Memory limit per worker
        memory_limit=None,
    )
elif dask_workers == &quot;default&quot;:
    # Either using default configuration or configuring Dask
    # using the built-in DaskHub
    pass
else:
    raise ValueError(&quot;`dask_workers` must be one of &#x27;default&#x27;, &#x27;scale&#x27; or an int.&quot;)

# The performance may depend on the number of CPUs available, so we&#x27;ll track that as well.
num_cpus = cpu_count()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="chE_UTD-UH9ab8CcZ-RnS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-2-read-in-catalogs-and-downselect-ztf-to-nrows" class="relative group"><span class="heading-text">2. Read in catalogs and downselect ZTF to Nrows</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-read-in-catalogs-and-downselect-ztf-to-nrows" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="ggPxLMAbvE" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define sky area. Here we&#x27;re using the Kepler field.
c = SkyCoord(&#x27;19:22:40  +44:30:00&#x27;, unit=(u.hourangle, u.deg))
cone_ra, cone_dec = c.ra.value, c.dec.value

if Nrows &gt; 0:
    radius_arcsec = radius[Nrows]
    search_filter = lsdb.ConeSearch(cone_ra, cone_dec, radius_arcsec)
else:
    # Full cross-match
    # ONLY ON XLARGE ENVIRONMENT USING AT LEAST 32 CPUS
    search_filter = None

# Read ZTF DR23
ztf_path = &quot;s3://ipac-irsa-ztf/contributed/dr23/objects/hats&quot;
ztf_piece = lsdb.open_catalog(
    ztf_path,
    columns=[&quot;oid&quot;, &quot;ra&quot;, &quot;dec&quot;],
    search_filter=search_filter
)

# Read Pan-STARRS DR2
ps1_path = &quot;s3://stpubdata/panstarrs/ps1/public/hats/otmo&quot;
ps1 = lsdb.open_catalog(ps1_path, columns=[&quot;objName&quot;,&quot;objID&quot;,&quot;raMean&quot;,&quot;decMean&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="x6BaFSebW1oGaYBNexusm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-3-initialize-the-crossmatch-and-compute-measuring-the-time-elapsed" class="relative group"><span class="heading-text">3. Initialize the crossmatch and compute, measuring the time elapsed.</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-initialize-the-crossmatch-and-compute-measuring-the-time-elapsed" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="FFQ1nOJkt1" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Setting up the cross-match actually takes very little time
ztf_x_ps1 = ztf_piece.crossmatch(ps1, radius_arcsec=1, n_neighbors=1, suffixes=(&quot;_ztf&quot;, &quot;_ps1&quot;))
ztf_x_ps1</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="nB_0EdQzSZhzEP5bVes8p" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/lsdb/catalog/catalog.py:307: FutureWarning: The default suffix behavior will change from applying suffixes to all columns to only applying suffixes to overlapping columns in a future release.To maintain the current behavior, explicitly set `suffix_method=&#x27;all_columns&#x27;`. To change to the new behavior, set `suffix_method=&#x27;overlapping_columns&#x27;`.
  warnings.warn(
</span></code></pre></div></div><div><div class="p-2.5">Loading...</div></div></div></div><div id="n4kalOyOwI" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Executing the cross-match does take time
t0 = datetime.now()
xmatch = ztf_x_ps1.compute()
t1 = datetime.now() - t0

print(&quot;Time Elapsed:&quot;, t1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="reL4IBw72l8z93NJBwRqO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Time Elapsed: 0:00:11.296410
</span></code></pre></div></div></div></div><div id="jaWCSlrHxC" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Check the length of the resulting table
rows_out = len(xmatch)
print(f&quot;Number of rows out: {rows_out:,d}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="hnQTXZRLMa3tVZUqJ8Zx2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Number of rows out: 8,593
</span></code></pre></div></div></div></div><div id="meWZt7Qdi8" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Close the Dask cluster/client when finished
if dask_workers != &quot;default&quot;:
    if dask_workers == &quot;scale&quot;:
        cluster.close()
    client.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="NWTAJKrT2f_WbbDh-tF3k" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-4-record-and-plot-benchmarks" class="relative group"><span class="heading-text">4. Record and plot benchmarks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-record-and-plot-benchmarks" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Write the recorded benchmark to an output file, then make plots to analyze the benchmarks.</p><div id="nxQfOWdNv4" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">try:
    # read in file if it exists
    benchmarks = pd.read_csv(&quot;output/xmatch_benchmarks.csv&quot;, index_col=[&quot;Ncpus&quot;, &quot;Nrows&quot;, &quot;Nworkers&quot;])
except FileNotFoundError:
    # otherwise create an empty DataFrame
    multi_index = pd.MultiIndex(levels=[[], [], []], codes=[[], [], []], names=[&quot;Ncpus&quot;, &quot;Nrows&quot;, &quot;Nworkers&quot;])
    benchmarks = pd.DataFrame(index=multi_index, columns=[&quot;time&quot;, &quot;Nrows_out&quot;, &quot;updated&quot;])

# assign values
benchmarks.loc[
    (num_cpus, Nrows, dask_workers),
    [&quot;time&quot;, &quot;Nrows_out&quot;, &quot;updated&quot;]
    ] = t1.total_seconds(), int(rows_out), datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)

benchmarks = benchmarks.sort_index()
# benchmarks.to_csv(&quot;output/xmatch_benchmarks.csv&quot;) # Uncomment this to write the new benchmarks to file
benchmarks</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="y8sOrotUHWO8B6OrRiat3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="O3DzdyUCFj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">benchmarks = pd.read_csv(&quot;output/xmatch_benchmarks.csv&quot;, index_col=[&quot;Ncpus&quot;, &quot;Nrows&quot;, &quot;Nworkers&quot;])

nworkers = [1, 2, 4, 8, 16, 32, 64, 128, 256, &quot;default&quot;, &quot;scale&quot;]

def plot_by_nworkers(num_cpus, ax):
    # Plot execution time vs. number of dask workers for each scale job
    b = benchmarks.loc[num_cpus]

    for n in b.index.levels[0]:
        try:
            # get the relevant benchmarks
            b_N = b.xs(n, level=&quot;Nrows&quot;).reset_index()
        except KeyError:
            pass

        # convert Nworkers to categorical with desired order
        b_N[&quot;Nworkers&quot;] = pd.Categorical(b_N[&quot;Nworkers&quot;],
                                            categories=[str(x) for x in nworkers],
                                            ordered=True)
        b_N = b_N.sort_values(&quot;Nworkers&quot;)

        # only plot if there is more than 1 data point
        if len(b_N) &gt; 1:
            ax.plot(&quot;Nworkers&quot;, &quot;time&quot;, marker=&quot;s&quot;, linestyle=&quot;-&quot;, data=b_N, label=f&quot;{n} rows&quot;)

    ax.set(yscale=&quot;log&quot;, xlabel=&quot;Nworkers&quot;, ylabel=&quot;Execution Time (s)&quot;,
           title=f&quot;{num_cpus} CPUs&quot;)
    ax.legend()


fig, axs = plt.subplots(1, 4, figsize=(16, 4))
cpu_counts = benchmarks.index.get_level_values(&quot;Ncpus&quot;).drop_duplicates().sort_values()
for i, ncpu in enumerate(cpu_counts):
    plot_by_nworkers(ncpu, axs[i])
fig.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GMeM-qFD-XtiEKYh2Dq9T" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/fornax-demo-notebooks/build/f1d188a186954b2f0ac1f72c7a731664.png" alt="&lt;Figure size 1600x400 with 4 Axes&gt;"/></div></div></div><p>These plots show how the cross-match execution time depends on the number of workers used. Broadly, increasing the number of workers up to the number of available CPUs improves the performance. The exception is for smaller cross-matches (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo></mrow><annotation encoding="application/x-tex">\le</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≤</span></span></span></span></span> 1 million rows) spread across many (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\ge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span></span> 16) CPUs, when the overhead of managing many workers is significant compared to the cross-match time. Increasing the number of workers past the number of CPUs results in somewhat worse performance. Interestingly, the agnostic approach---not manually specifying any <code>dask</code> parameters, but instead letting <code>lsdb</code> use the default <code>dask</code> behavior---results in the best performance for smaller cross-matches. This indicates that the <code>lsdb</code> cross-match functions are well-optimized and well-configured for use with <code>dask</code> without much user oversight, at least on cross-matches with <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo></mrow><annotation encoding="application/x-tex">\le</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≤</span></span></span></span></span> 1 million rows.</p><p>For the largest jobs (<code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\ge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span></span> 10 million), the default <code>dask</code> configuration performs worse than fixing the number of <code>dask_workers</code> to be the number of available CPUs. Interestingly, on the XLarge server with 128 CPUs, the 64-worker run performed the best on the large cross-matches. For larger cross-matches, we recommend manually setting the number of workers to be <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><msub><mi>N</mi><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi></mrow></msub><mo>≤</mo><msub><mi>N</mi><mrow><mi mathvariant="normal">w</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">k</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">s</mi></mrow></msub><mo>≤</mo><msub><mi>N</mi><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\frac{1}{2} N_\mathrm{CPU} \leq N_\mathrm{workers} \leq N_\mathrm{CPU}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">CPU</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">workers</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">CPU</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>.</p><p>Given the amount of time it takes to perform the largest cross-matches (<code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\ge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span></span> 1 billion), these were run only on the XLarge server using the default <code>dask</code> configuration. The full cross-match of over 7 billion rows took just over 4 hours.</p><p>These graphs also illustrate the approximate maximum number of rows that can be cross matched with a given amount of RAM and CPU. Trying to cross-match more rows or use worker configurations that aren’t shown in the plots can lead to one of the following behaviors:</p><p><strong>Small (4GB RAM, 2 CPU)</strong></p><p>When attempting <code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\ge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span></span> 10 million, the cross-match exhibits long compute times, seeming never to finish.</p><p><strong>Medium (16GB RAM, 4 CPU)</strong></p><p>When attempting <code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\ge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span></span> 100 million, the cross-match exhibits long compute times, seeming never to finish.</p><p><strong>Large (64GB RAM, 16 CPU)</strong></p><p>When attempting <code>Nrows</code> = 100 million with anything but 16 or ‘default’ values for <code>dask_workers</code>, the cross-match exhibits long compute times, seeming never to finish. When attempting <code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\ge</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span></span> 1 billion, the cross-match exhibits long compute times, seeming never to finish.</p><p><strong>XLarge (512GB RAM, 128 CPU)</strong></p><p>The XLarge environment was able to complete all attempted cross-matches, except that setting <code>dask_workers=&#x27;scale&#x27;</code> resulted in the dead worker behavior documented below.</p><p><strong>Autoscaling on any environment</strong></p><p>When using <code>dask_workers=&#x27;scale&#x27;</code> and scaling up the number of rows to cross-match, eventually you will see logging output from the <code>dask</code> cluster indicating that workers have died and are being respawn. This behavior repeats, and the cross-match never finishes (after being allowed to run for, e.g., an hour when it is expected to finish in 5 minutes).</p><h2 id="id-5-summary" class="relative group"><span class="heading-text">5. Summary</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-summary" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The Fornax Science Console is capable of hosting cross-matches between large catalogs using the <code>lsdb</code> package. <code>lsdb</code> leverages <code>dask</code> to efficiently plan cross-match jobs using multiple workers, which results in large performance gains, especially as jobs scale up to millions or tens of millions of catalog rows.</p><p><strong>Recommendations</strong></p><ul><li><p>For small cross-matches (1 million rows or less) it is acceptable and often optimal to use <code>lsdb</code>’s default <code>dask</code> settings to parallelize jobs. In other words, for these jobs you don’t need to configure or even import <code>dask</code> at all to leverage its parallelization power.</p></li><li><p>For large cross-matches (millions of rows or more), we recommend running in an environment with at least tens of CPUs, and setting the number of <code>dask</code> workers to at least half the number of available CPUs, and up to the number of CPUs. E.g., 128 CPUs with 64 <code>dask</code> workers.</p></li><li><p>Cross-matches of 10 million rows or less can, at the time of writing, be completed on the Small Fornax Console using the default <code>dask</code> configuration. However, given the performance, we recommend the following use scaling:</p><ul><li><p><code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">\le 10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span>: Small</p></li><li><p><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">10^6 &lt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8532em;vertical-align:-0.0391em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span></span></span></span></span> <code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding="application/x-tex">&lt; 10^7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span></span>: Medium</p></li><li><p><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">10^7 &lt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8532em;vertical-align:-0.0391em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span></span></span></span></span> <code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup></mrow><annotation encoding="application/x-tex">&lt; 10^8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span></span></span></span>: Large</p></li><li><p><code>Nrows</code> <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup></mrow><annotation encoding="application/x-tex">&gt; 10^8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span></span></span></span>: XLarge</p></li></ul></li></ul><p>In this tutorial we have cross-matched sections of catalogs in a particular region of sky, where most of the stars likely fall in the same or neighboring sky cells. It would be useful in the future to try this using generic samples of stars from across the entire sky. How different is performance when the catalog rows come from many sky cells instead of just a few? We have also generated the cross-match using <code>compute</code>, which loads the full result into memory, but <code>lsdb</code> supports larger-than-memory cross-matches by writing them directly to disk using <code>to_hats</code>. It would also be illustrative to run these benchmarks, and benchmarking a full cross-match between ZTF and Pan-STARRS, by writing the result to disk.</p><p><strong>Other Science Cases</strong></p><p>The example science case used here is an investigation to collect time-series photometry from sources in and around the Kepler field. The time series associated with the ZTF and Pan-STARRS sources might be used to supplement the Kepler light curves, extend their time baseline, examine how stellar light curves change in different photometric filters, and more. But <code>lsdb</code> enables other science cases with other catalogs as well. Some examples might be to</p><ul><li><p>combine photometric spectral energy distributions (SEDs) of distant galaxies with their spectra to build a training set for machine learning to predict photometric redshifts,</p></li><li><p>combine Gaia’s exquisite astrometry with your favorite star survey to obtain 6D kinematic solutions for your sample stars,</p></li><li><p>combine stellar spectroscopic catalogs with light curve rotation period measurements to estimate stellar ages using gyrochronology.</p></li></ul><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this Notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p><strong>Authors:</strong> Zach Claytor (Astronomical Data Scientist at Space Telescope Science Institute) and the Fornax team</p></li><li><p><strong>Contact:</strong> For help with this notebook, please open a topic in the <a target="_blank" rel="noreferrer" href="https://discourse.fornax.sciencecloud.nasa.gov/" class="">Fornax Community Forum</a> “Support” category.</p></li></ul><h3 id="references" class="relative group"><span class="heading-text">References</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>This work uses <a target="_blank" rel="noreferrer" href="https://www.astropy.org/acknowledging.html" class=""><code>astropy</code></a>.</p></li><li><p>This work uses <a target="_blank" rel="noreferrer" href="https://docs.lsdb.io/" class=""><code>lsdb</code></a>.</p></li></ul><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/fornax-demo-notebooks/crossmatch"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">The Fornax Initiative</div>Cross Matching</div></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OYMW4E3D.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/root-CXYA7X5D.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/_shared/chunk-DATP5P2X.js"/><link rel="modulepreload" href="/fornax-demo-notebooks/build/routes/$-JRBPULBO.js"/><script>window.__remixContext = {"url":"/ztf-ps1-crossmatch","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-614971062518da91156f17a119f519ca.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-4cc31726eadc04c560c90703184b963a.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/fornax-demo-notebooks"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"favicon":"/fornax-demo-notebooks/build/fornax_favicon-614971062518da91156f17a119f519ca.ico","logo":"/fornax-demo-notebooks/build/fornax_logo-4cc31726eadc04c560c90703184b963a.png"},"nav":[],"actions":[],"projects":[{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"8b1774093b3d3b6876a3170735d6c2205744692e4df1762794a80e957c496de3","slug":"ztf-ps1-crossmatch","location":"/crossmatch/ztf_ps1_crossmatch.md","dependencies":[],"frontmatter":{"title":"Cross-Match ZTF and Pan-STARRS using LSDB","kernelspec":{"name":"python3","display_name":"py-ztf_ps1_crossmatch","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.2"}},"content_includes_title":false,"authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","subject":"Fornax Demo Notebooks","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/blob/main/crossmatch/ztf_ps1_crossmatch.md","edit_url":"https://github.com/nasa-fornax/fornax-demo-notebooks/edit/main/crossmatch/ztf_ps1_crossmatch.md","exports":[{"format":"md","filename":"ztf_ps1_crossmatch.md","url":"/fornax-demo-notebooks/build/ztf_ps1_crossmatch-6e5678dd50a87baf38e3bfdd3bafa1ea.md"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"RvB93vZPbC"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"pQKOaPq7HF"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will:","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"MtvnmLLOrA"}],"key":"fGphbzRJsd"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"understand how to cross-match cloud-based catalogs using ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"RHtzFugUFM"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"NmBzmFGtyu"},{"type":"text","value":".","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"PBdisNNqAO"}],"key":"T6oCJc8Hdd"}],"key":"Ch1zrt2kni"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"understand how to parallelize ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"GsLjmYTpCi"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"Z0Odkku6bG"},{"type":"text","value":" cross-matches using ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"aDtDlVmSVv"},{"type":"inlineCode","value":"dask","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"T2v70cCLSt"},{"type":"text","value":".","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"bQ96Kdmb9J"}],"key":"P9iIXISUJv"}],"key":"drePHcXKue"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"have a feeling for when ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"VqjPRgWx1b"},{"type":"inlineCode","value":"dask","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"hBJZrtMuKh"},{"type":"text","value":" parallelization can be helpful.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"BnZ0uSzd9T"}],"key":"FwvQoT7fH2"}],"key":"DjMHzp36xG"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"have a rough idea of the maximum number of objects that can be cross matched on each Fornax Science Console server type.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"a3rRNYwwMl"}],"key":"leC2QHDFQ4"}],"key":"Lq4IOoB4CS"}],"key":"xoG3MRTQWp"}],"key":"mLsF3E4n5d"},{"type":"block","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"grxbv9jZww"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"fSGKEHiTzB"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"In the era of increasingly large astronomical survey missions like TESS, Gaia, ZTF, Pan-STARRS, Roman, and Rubin, catalog operations are becoming less and less practical to complete on a personal computer. Operations such as source cross-matching can require many GB of memory and take many hours to complete using a single CPU. Recognizing these looming obstacles, many catalogs are becoming accessible to cloud computing platforms like the Fornax Science Console, and increasingly high-performance tools are being developed that leverage cloud computing resources to simplify and speed up catalog operations.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"ikrAl0ChMJ"}],"key":"HwbDkE61Aj"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"link","url":"https://lsdb.io","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"LSDB","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"HPziZxiomo"}],"urlSource":"https://lsdb.io","key":"ZedsYuu0Pa"},{"type":"text","value":" is a useful package for performing large cross-matches between HATS catalogs. It can leverage the ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"BcNUyoLgnB"},{"type":"link","url":"https://www.dask.org/","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"kxENa7KANa"}],"urlSource":"https://www.dask.org/","key":"OfZWcWqJun"},{"type":"text","value":" library to work with larger-than-memory data sets and distribute computation tasks across multiple cores. Users perform large cross-matches without ever having to download a file.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"bOiLDFwBIt"}],"key":"OGkwfAdbD6"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"In this tutorial, we will use ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"Q4rPhnUqQr"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"We59GqPiU0"},{"type":"text","value":" with ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"b3R7jKu5yS"},{"type":"inlineCode","value":"dask","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"o5ngwJhLvQ"},{"type":"text","value":" to perform a cross-match between ZTF and Pan-STARRS HATS catalogs to benchmark the performance. These HATS catalogs are stored on AWS S3 cloud storage. An application might be to collect time-series photometry for 10,000 or more stars in the Kepler field from ZTF and Pan-STARRS. With this in mind, we will begin by cross-matching 10,000 sources from ZTF with the Pan-STARRS mean-object catalog. The user can choose to scale up to a larger number of rows to test the performance. The CSV file provided with this notebook contains the runtime results of tests run on various Fornax Science Console server types for comparison.","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"dTxN5TVgyy"}],"key":"MwKF8Sw2NH"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"As of August 2025, the Fornax Science Console server types were:","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"AReDjKnpzg"}],"key":"aByMcsrJSM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":37,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“Small” - 4 GB RAM, 2 CPU","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"Xhu7R6P6Yv"}],"key":"HvojYfpftd"}],"key":"E7lXaZxdOF"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“Medium” - 16 GB RAM, 4 CPU","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"QHc8iy7ypq"}],"key":"gJ2clB4XEB"}],"key":"bVFj0DA6Yo"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“Large” -  64 GB RAM, 16 CPU","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"FF3bua02U7"}],"key":"jfOaJUOCH2"}],"key":"BASBh3IcTc"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“XLarge” -  512 GB RAM, 128 CPU","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"gPoBjkFeKo"}],"key":"eFwY4ubznG"}],"key":"s1NiScgYKG"}],"key":"tJpTI3FLbe"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"For generality, we will refer to the server type by the number of CPUs. For each server and each number of cross-match rows, we want to know the performance with (1) default ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"veeHlW1g3P"},{"type":"inlineCode","value":"dask","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"UFLjU6bg2v"},{"type":"text","value":" configuration, (2) minimal ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"RF2nF5At15"},{"type":"inlineCode","value":"dask","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"Nx8Ffmf09H"},{"type":"text","value":" - 1 worker, (3) bigger ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"cnxOdoTmF2"},{"type":"inlineCode","value":"dask","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"BrWUWpRhYq"},{"type":"text","value":" - as many workers as we can use, and (4) auto-scaling ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"kYk8PnYsRY"},{"type":"inlineCode","value":"dask","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"Kq5hDQt0RL"},{"type":"text","value":".","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"YOdpk03WzN"}],"key":"tb3XzpxFAr"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"strong","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"Jm0bR4uGPi"}],"key":"fWrJXEdaWB"},{"type":"text","value":" that in this notebook, only one configuration (combination of CPU count, number of cross-match rows, and ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"nfcLvW2u2x"},{"type":"inlineCode","value":"dask","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"tlFXOZq8yE"},{"type":"text","value":" configuration) is run at a time. It must be reconfigured and rerun to benchmark each configuration.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"PavuuqUUKz"}],"key":"G9CLNKnMnu"}],"key":"Ph8R5usOSi"},{"type":"block","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Runtime","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"lLGLd4KlKi"}],"identifier":"runtime","label":"Runtime","html_id":"runtime","implicit":true,"key":"cEJz12UZzj"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"As of August 2025, as written (10,000 rows with the “default” ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"RBGkF1OvMb"},{"type":"inlineCode","value":"dask","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"KELGfVtwa9"},{"type":"text","value":" settings), this notebook takes about 45 seconds to run on the “small” Fornax Science Console server type (4 GB RAM and 2 CPUs). Users can modify the configuration for larger cross-matches, which will take more time. E.g., cross-matching 10 million rows on the “large” server type (64 GB RAM and 16 CPUs) can take ~5 minutes.","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"PjDsc3ZFyx"}],"key":"TxRwsR2qel"}],"key":"SBbdZglrGW"},{"type":"block","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"pdPzx1Tf5m"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"xLeVbMJ3CV"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"We require the following packages:","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"gRD0teejFi"}],"key":"bg4g9oS5YE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":57,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"os","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"PnSSqL5Jus"},{"type":"text","value":" solely for the ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"Zch6vRmO0p"},{"type":"inlineCode","value":"cpu_count","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"axIbU87oxj"},{"type":"text","value":" function,","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"EVa89BFtwV"}],"key":"HakJKWo5dQ"}],"key":"gn4iV7msR8"},{"type":"listItem","spread":true,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"datetime","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"gNUaqpw3xo"},{"type":"text","value":" for measuring the crossmatch time,","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"ocWNbZpPaM"}],"key":"am3vhA46Lu"}],"key":"Eci0D0zlkO"},{"type":"listItem","spread":true,"position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"pandas","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"pYSPnXBAQ8"},{"type":"text","value":" to write and read the CSV of benchmarks","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"DlXQkcJu1o"}],"key":"cwDteLbwfg"}],"key":"zYWKNkHkSn"},{"type":"listItem","spread":true,"position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"matplotlib","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"uAnJDb33H8"},{"type":"text","value":" to plot the benchmarks,","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"rxtMwcr014"}],"key":"AOiD9zhpkA"}],"key":"jFG193Y0iL"},{"type":"listItem","spread":true,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"astropy","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"p8N2OIvpKC"},{"type":"text","value":" for coordinates and units,","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"aCHvgQHOyF"}],"key":"Q0SYXCSEJV"}],"key":"rZnDgBYgae"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"lsdb","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"XH8KgQMEyo"},{"type":"text","value":" to read the catalogs and perform the cross-match, and","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"H3O3TW6Ja1"}],"key":"achQrvNiLd"}],"key":"uhHNLaLyFh"},{"type":"listItem","spread":true,"position":{"start":{"line":63,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"dask","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"bUCBCntBxm"},{"type":"text","value":" for parallelization.","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"u9ncutK3Vx"}],"key":"TvHp9ZlN2z"}],"key":"lD1SO9xKJ2"}],"key":"i77tlZfNSu"}],"key":"ZmQGeHB39m"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# %pip install -r requirements_ztf_ps1_crossmatch.txt","key":"iDSm6hRmly"},{"type":"outputs","id":"3BnIviVWgxEaLB6KtFmjU","children":[],"key":"joVqjqU0em"}],"key":"PnNdpnfhVA"},{"type":"block","children":[],"key":"iA9WVvyWFS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from os import cpu_count\nfrom datetime import datetime\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom astropy.coordinates import SkyCoord\nfrom astropy import units as u\n\nimport lsdb\nfrom dask.distributed import Client, LocalCluster","key":"zmuXc8z5Kk"},{"type":"outputs","id":"VUz8A6ywblHOOHGjf2ngs","children":[],"key":"dn1mNQimFr"}],"key":"fRCf6UGnrB"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"1. Preconfiguring the Run","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"e5CSqsN8T0"}],"identifier":"id-1-preconfiguring-the-run","label":"1. Preconfiguring the Run","html_id":"id-1-preconfiguring-the-run","implicit":true,"key":"hdEJggPSIm"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"First choose the number of rows we want to cross-match and our ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"OYDyolHlZM"},{"type":"inlineCode","value":"dask","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"InxUm51pBw"},{"type":"text","value":" environment. For tips on using ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"TiIbt46XkB"},{"type":"inlineCode","value":"dask","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"PseFn4acMN"},{"type":"text","value":" with ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"gtWCPcghdp"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"KdRhK7lDtk"},{"type":"text","value":", see ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"LivqUa96uK"},{"type":"link","url":"https://docs.lsdb.io/en/stable/tutorials/dask-cluster-tips.html","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"inlineCode","value":"lsdb","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"b6OoEP33lH"},{"type":"text","value":"’s Dask Cluster Tips","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"ntHEC3yiCc"}],"urlSource":"https://docs.lsdb.io/en/stable/tutorials/dask-cluster-tips.html","key":"QlGJRL6cl0"},{"type":"text","value":".","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"E8dEgTAwfT"}],"key":"Rz8AFI1IEr"}],"key":"SP8zW9Z9Xv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# The left table will have about this many rows. The cross-matched product will have slightly fewer.\n# Set Nrows = -1 to cross-match the entire catalog. The full catalog cross-match is\n# recommended ONLY on XLarge instance with at least 32 workers.\nNrows = 10_000\n\n# dask_workers can be:\n# - \"default\" (uses the default scheduler which runs all tasks in the main process)\n# - an integer, which uses a fixed number of workers\n# - \"scale\" to use an adaptive, auto-scaling cluster.\ndask_workers = \"default\"","key":"u1F637pAw9"},{"type":"outputs","id":"FeNnt13bw67nY4DbpjTLO","children":[],"key":"RzHOs9wQjt"}],"key":"Dd55Hard7x"},{"type":"block","children":[],"key":"hwQaOmfka9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# The code in this cell is automatic setup based on the configuration in the previous cell, so it can be left alone.\n\n# We must pass a radius to lsdb. Here is the mapping between radius and desired number of rows for ZTF.\n# The values in this dictionary were determined experimentally, by\n# incrementing/decrementing the radius until the desired number of\n# catalog rows was returned.\nradius = { # Nrows: radius_arcseconds\n           10_000:     331,\n          100_000:    1047,\n        1_000_000:    3318,\n       10_000_000:  11_180,\n      100_000_000:  33_743,\n    1_000_000_000: 102_000,\n}\n\n# Set up dask cluster\nif dask_workers == \"scale\":\n    cluster = LocalCluster()\n    cluster.adapt(minimum_cores=1, maximum_cores=cpu_count())\n    client = Client(cluster)\nelif isinstance(dask_workers, int):\n    client = Client(\n        # Number of Dask workers - Python processes to run\n        n_workers=dask_workers,\n        # Limits number of Python threads per worker\n        threads_per_worker=1,\n        # Memory limit per worker\n        memory_limit=None,\n    )\nelif dask_workers == \"default\":\n    # Either using default configuration or configuring Dask\n    # using the built-in DaskHub\n    pass\nelse:\n    raise ValueError(\"`dask_workers` must be one of 'default', 'scale' or an int.\")\n\n# The performance may depend on the number of CPUs available, so we'll track that as well.\nnum_cpus = cpu_count()","key":"ejLCPr3VB2"},{"type":"outputs","id":"chE_UTD-UH9ab8CcZ-RnS","children":[],"key":"D1nBsxDJQg"}],"key":"Vt6a9kdZrL"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"text","value":"2. Read in catalogs and downselect ZTF to Nrows","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"key":"LBbqyQtBR0"}],"identifier":"id-2-read-in-catalogs-and-downselect-ztf-to-nrows","label":"2. Read in catalogs and downselect ZTF to Nrows","html_id":"id-2-read-in-catalogs-and-downselect-ztf-to-nrows","implicit":true,"key":"Fwhi8RueuN"}],"key":"zh50ujmmGW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define sky area. Here we're using the Kepler field.\nc = SkyCoord('19:22:40  +44:30:00', unit=(u.hourangle, u.deg))\ncone_ra, cone_dec = c.ra.value, c.dec.value\n\nif Nrows \u003e 0:\n    radius_arcsec = radius[Nrows]\n    search_filter = lsdb.ConeSearch(cone_ra, cone_dec, radius_arcsec)\nelse:\n    # Full cross-match\n    # ONLY ON XLARGE ENVIRONMENT USING AT LEAST 32 CPUS\n    search_filter = None\n\n# Read ZTF DR23\nztf_path = \"s3://ipac-irsa-ztf/contributed/dr23/objects/hats\"\nztf_piece = lsdb.open_catalog(\n    ztf_path,\n    columns=[\"oid\", \"ra\", \"dec\"],\n    search_filter=search_filter\n)\n\n# Read Pan-STARRS DR2\nps1_path = \"s3://stpubdata/panstarrs/ps1/public/hats/otmo\"\nps1 = lsdb.open_catalog(ps1_path, columns=[\"objName\",\"objID\",\"raMean\",\"decMean\"])","key":"wj40mtw0ot"},{"type":"outputs","id":"x6BaFSebW1oGaYBNexusm","children":[],"key":"gTtXia6TGq"}],"key":"ggPxLMAbvE"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"3. Initialize the crossmatch and compute, measuring the time elapsed.","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"PCcXLGV1dJ"}],"identifier":"id-3-initialize-the-crossmatch-and-compute-measuring-the-time-elapsed","label":"3. Initialize the crossmatch and compute, measuring the time elapsed.","html_id":"id-3-initialize-the-crossmatch-and-compute-measuring-the-time-elapsed","implicit":true,"key":"jRQpdtW5iY"}],"key":"bJ3qzIKsuM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Setting up the cross-match actually takes very little time\nztf_x_ps1 = ztf_piece.crossmatch(ps1, radius_arcsec=1, n_neighbors=1, suffixes=(\"_ztf\", \"_ps1\"))\nztf_x_ps1","key":"BwujHPJG5S"},{"type":"outputs","id":"nB_0EdQzSZhzEP5bVes8p","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/fornax-demo-notebooks/fornax-demo-notebooks/.tox/py312-buildhtml/lib/python3.12/site-packages/lsdb/catalog/catalog.py:307: FutureWarning: The default suffix behavior will change from applying suffixes to all columns to only applying suffixes to overlapping columns in a future release.To maintain the current behavior, explicitly set `suffix_method='all_columns'`. To change to the new behavior, set `suffix_method='overlapping_columns'`.\n  warnings.warn(\n"},"key":"KETzmEXGUM"},{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                            oid_ztf           ra_ztf          dec_ztf      objName_ps1       objID_ps1       raMean_ps1      decMean_ps1     _dist_arcsec\nnpartitions=16                                                                                                                                           \n1062849512059437056  int64[pyarrow]  double[pyarrow]  double[pyarrow]  string[pyarrow]  int64[pyarrow]  double[pyarrow]  double[pyarrow]  double[pyarrow]\n1062919880803614720             ...              ...              ...              ...             ...              ...              ...              ...\n...                             ...              ...              ...              ...             ...              ...              ...              ...\n1063905043222102016             ...              ...              ...              ...             ...              ...              ...              ...\n1063975411966279680             ...              ...              ...              ...             ...              ...              ...              ...\nDask Name: nestedframe, 3 expressions\nExpr=MapPartitions(NestedFrame)","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\u003cstrong\u003elsdb Catalog ZTF_DR23_Objects_x_otmo:\u003c/strong\u003e\u003c/div\u003e\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eoid_ztf\u003c/th\u003e\n      \u003cth\u003era_ztf\u003c/th\u003e\n      \u003cth\u003edec_ztf\u003c/th\u003e\n      \u003cth\u003eobjName_ps1\u003c/th\u003e\n      \u003cth\u003eobjID_ps1\u003c/th\u003e\n      \u003cth\u003eraMean_ps1\u003c/th\u003e\n      \u003cth\u003edecMean_ps1\u003c/th\u003e\n      \u003cth\u003e_dist_arcsec\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003enpartitions=16\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003eOrder: 6, Pixel: 15104\u003c/th\u003e\n      \u003ctd\u003eint64[pyarrow]\u003c/td\u003e\n      \u003ctd\u003edouble[pyarrow]\u003c/td\u003e\n      \u003ctd\u003edouble[pyarrow]\u003c/td\u003e\n      \u003ctd\u003estring[pyarrow]\u003c/td\u003e\n      \u003ctd\u003eint64[pyarrow]\u003c/td\u003e\n      \u003ctd\u003edouble[pyarrow]\u003c/td\u003e\n      \u003ctd\u003edouble[pyarrow]\u003c/td\u003e\n      \u003ctd\u003edouble[pyarrow]\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eOrder: 6, Pixel: 15105\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eOrder: 6, Pixel: 15118\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eOrder: 6, Pixel: 15119\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\u003cdiv\u003e8 out of 8 available columns in the catalog have been loaded \u003cstrong\u003elazily\u003c/strong\u003e, meaning no data has been read, only the catalog schema\u003c/div\u003e","content_type":"text/html"}}},"key":"X0UZ4TGy2X"}],"key":"Mas25gENjd"}],"key":"FFQ1nOJkt1"},{"type":"block","children":[],"key":"hF9irQ1HXn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Executing the cross-match does take time\nt0 = datetime.now()\nxmatch = ztf_x_ps1.compute()\nt1 = datetime.now() - t0\n\nprint(\"Time Elapsed:\", t1)","key":"vZ8Plu1A8p"},{"type":"outputs","id":"reL4IBw72l8z93NJBwRqO","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Time Elapsed: 0:00:11.296410\n"},"key":"l7uH8Ubj7d"}],"key":"E1bLqmYYjS"}],"key":"n4kalOyOwI"},{"type":"block","children":[],"key":"SskHflNAi0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Check the length of the resulting table\nrows_out = len(xmatch)\nprint(f\"Number of rows out: {rows_out:,d}\")","key":"HWEgPY0RiS"},{"type":"outputs","id":"hnQTXZRLMa3tVZUqJ8Zx2","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Number of rows out: 8,593\n"},"key":"gRoFU1l6tR"}],"key":"pLU3fhuX4R"}],"key":"jaWCSlrHxC"},{"type":"block","children":[],"key":"nTACmOKwG8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Close the Dask cluster/client when finished\nif dask_workers != \"default\":\n    if dask_workers == \"scale\":\n        cluster.close()\n    client.close()","key":"Baf98sQfpD"},{"type":"outputs","id":"NWTAJKrT2f_WbbDh-tF3k","children":[],"key":"gYQi0vb7dA"}],"key":"meWZt7Qdi8"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"4. Record and plot benchmarks","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"AQ0rULz3wX"}],"identifier":"id-4-record-and-plot-benchmarks","label":"4. Record and plot benchmarks","html_id":"id-4-record-and-plot-benchmarks","implicit":true,"key":"LvNrd4QsLM"},{"type":"paragraph","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"children":[{"type":"text","value":"Write the recorded benchmark to an output file, then make plots to analyze the benchmarks.","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"yLhzK0AwU7"}],"key":"yKGPx12Urq"}],"key":"xdRH3QYHvV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"try:\n    # read in file if it exists\n    benchmarks = pd.read_csv(\"output/xmatch_benchmarks.csv\", index_col=[\"Ncpus\", \"Nrows\", \"Nworkers\"])\nexcept FileNotFoundError:\n    # otherwise create an empty DataFrame\n    multi_index = pd.MultiIndex(levels=[[], [], []], codes=[[], [], []], names=[\"Ncpus\", \"Nrows\", \"Nworkers\"])\n    benchmarks = pd.DataFrame(index=multi_index, columns=[\"time\", \"Nrows_out\", \"updated\"])\n\n# assign values\nbenchmarks.loc[\n    (num_cpus, Nrows, dask_workers),\n    [\"time\", \"Nrows_out\", \"updated\"]\n    ] = t1.total_seconds(), int(rows_out), datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\nbenchmarks = benchmarks.sort_index()\n# benchmarks.to_csv(\"output/xmatch_benchmarks.csv\") # Uncomment this to write the new benchmarks to file\nbenchmarks","key":"e8Wj7rXlLd"},{"type":"outputs","id":"y8sOrotUHWO8B6OrRiat3","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"                                   time    Nrows_out              updated\nNcpus Nrows      Nworkers                                                \n2     10000      1            48.879788       8593.0  2025-08-05 18:13:57\n                 2            30.538154       8593.0  2025-08-05 18:15:26\n...                                 ...          ...                  ...\n128   1000000000 default    1611.382256  874362668.0  2025-08-11 22:16:12\n      7500000000 default   14539.090000          NaN  2025-08-12 21:37:39\n\n[125 rows x 3 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003etime\u003c/th\u003e\n      \u003cth\u003eNrows_out\u003c/th\u003e\n      \u003cth\u003eupdated\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003eNcpus\u003c/th\u003e\n      \u003cth\u003eNrows\u003c/th\u003e\n      \u003cth\u003eNworkers\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e2\u003c/th\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e10000\u003c/th\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e48.879788\u003c/td\u003e\n      \u003ctd\u003e8593.0\u003c/td\u003e\n      \u003ctd\u003e2025-08-05 18:13:57\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e30.538154\u003c/td\u003e\n      \u003ctd\u003e8593.0\u003c/td\u003e\n      \u003ctd\u003e2025-08-05 18:15:26\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth rowspan=\"2\" valign=\"top\"\u003e128\u003c/th\u003e\n      \u003cth\u003e1000000000\u003c/th\u003e\n      \u003cth\u003edefault\u003c/th\u003e\n      \u003ctd\u003e1611.382256\u003c/td\u003e\n      \u003ctd\u003e874362668.0\u003c/td\u003e\n      \u003ctd\u003e2025-08-11 22:16:12\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e7500000000\u003c/th\u003e\n      \u003cth\u003edefault\u003c/th\u003e\n      \u003ctd\u003e14539.090000\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e2025-08-12 21:37:39\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e125 rows × 3 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}},"key":"dgcMaat6rR"}],"key":"NSUArP9cR9"}],"key":"nxQfOWdNv4"},{"type":"block","children":[],"key":"ZcRFPWVgzy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"benchmarks = pd.read_csv(\"output/xmatch_benchmarks.csv\", index_col=[\"Ncpus\", \"Nrows\", \"Nworkers\"])\n\nnworkers = [1, 2, 4, 8, 16, 32, 64, 128, 256, \"default\", \"scale\"]\n\ndef plot_by_nworkers(num_cpus, ax):\n    # Plot execution time vs. number of dask workers for each scale job\n    b = benchmarks.loc[num_cpus]\n\n    for n in b.index.levels[0]:\n        try:\n            # get the relevant benchmarks\n            b_N = b.xs(n, level=\"Nrows\").reset_index()\n        except KeyError:\n            pass\n\n        # convert Nworkers to categorical with desired order\n        b_N[\"Nworkers\"] = pd.Categorical(b_N[\"Nworkers\"],\n                                            categories=[str(x) for x in nworkers],\n                                            ordered=True)\n        b_N = b_N.sort_values(\"Nworkers\")\n\n        # only plot if there is more than 1 data point\n        if len(b_N) \u003e 1:\n            ax.plot(\"Nworkers\", \"time\", marker=\"s\", linestyle=\"-\", data=b_N, label=f\"{n} rows\")\n\n    ax.set(yscale=\"log\", xlabel=\"Nworkers\", ylabel=\"Execution Time (s)\",\n           title=f\"{num_cpus} CPUs\")\n    ax.legend()\n\n\nfig, axs = plt.subplots(1, 4, figsize=(16, 4))\ncpu_counts = benchmarks.index.get_level_values(\"Ncpus\").drop_duplicates().sort_values()\nfor i, ncpu in enumerate(cpu_counts):\n    plot_by_nworkers(ncpu, axs[i])\nfig.tight_layout()","key":"hNBi93ZYRV"},{"type":"outputs","id":"GMeM-qFD-XtiEKYh2Dq9T","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1600x400 with 4 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f1d188a186954b2f0ac1f72c7a731664","path":"/fornax-demo-notebooks/build/f1d188a186954b2f0ac1f72c7a731664.png"}}},"key":"ABNYVIK4Vc"}],"key":"h4RdlGVcD9"}],"key":"O3DzdyUCFj"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"These plots show how the cross-match execution time depends on the number of workers used. Broadly, increasing the number of workers up to the number of available CPUs improves the performance. The exception is for smaller cross-matches (","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"SglL39qPBA"},{"type":"inlineMath","value":"\\le","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\le\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"wk5x43VwTy"},{"type":"text","value":" 1 million rows) spread across many (","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"CA1VI238Ux"},{"type":"inlineMath","value":"\\ge","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≥\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\ge\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"ZPtFSANVPu"},{"type":"text","value":" 16) CPUs, when the overhead of managing many workers is significant compared to the cross-match time. Increasing the number of workers past the number of CPUs results in somewhat worse performance. Interestingly, the agnostic approach---not manually specifying any ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"JtTdtGAHsq"},{"type":"inlineCode","value":"dask","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"wTRuDDfHJS"},{"type":"text","value":" parameters, but instead letting ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"xUTSceEMC5"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"zVBy5o0w2s"},{"type":"text","value":" use the default ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"Bex48FYVzK"},{"type":"inlineCode","value":"dask","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"YEfSts3oNU"},{"type":"text","value":" behavior---results in the best performance for smaller cross-matches. This indicates that the ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"UKfGe6pQPy"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"T38JFZMFyF"},{"type":"text","value":" cross-match functions are well-optimized and well-configured for use with ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"U9MTo0yxHL"},{"type":"inlineCode","value":"dask","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"MYjThlVdMj"},{"type":"text","value":" without much user oversight, at least on cross-matches with ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"qfjcAswtgC"},{"type":"inlineMath","value":"\\le","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\le\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"LrhcdY59A9"},{"type":"text","value":" 1 million rows.","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"YLVXJ6XUdJ"}],"key":"mY8McxJYs1"},{"type":"paragraph","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"For the largest jobs (","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"mus4EZfTN5"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"ocYR72hZqX"},{"type":"text","value":" ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"Tt8dkJUeZx"},{"type":"inlineMath","value":"\\ge","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≥\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\ge\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"eAwcZ3Wok7"},{"type":"text","value":" 10 million), the default ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"kpIPBLZ6YQ"},{"type":"inlineCode","value":"dask","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"xoPWfhtit4"},{"type":"text","value":" configuration performs worse than fixing the number of ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"rYonA7qsmN"},{"type":"inlineCode","value":"dask_workers","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"ZqS44jmFzw"},{"type":"text","value":" to be the number of available CPUs. Interestingly, on the XLarge server with 128 CPUs, the 64-worker run performed the best on the large cross-matches. For larger cross-matches, we recommend manually setting the number of workers to be ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"tR1fm22QDP"},{"type":"inlineMath","value":"\\frac{1}{2} N_\\mathrm{CPU} \\leq N_\\mathrm{workers} \\leq N_\\mathrm{CPU}","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmfrac\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/mfrac\u003e\u003cmsub\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003eC\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eP\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eU\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003ew\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003er\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ek\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ee\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003er\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003es\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003eN\u003c/mi\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003eC\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eP\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eU\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\frac{1}{2} N_\\mathrm{CPU} \\leq N_\\mathrm{workers} \\leq N_\\mathrm{CPU}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8451em;\"\u003e\u003cspan style=\"top:-2.655em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.394em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.345em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eN\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3283em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathrm mtight\"\u003eCPU\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eN\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathrm mtight\"\u003eworkers\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eN\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3283em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathrm mtight\"\u003eCPU\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"ebn0K8NuPc"},{"type":"text","value":".","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"rTDLZP4t9y"}],"key":"TSjnOWD3JD"},{"type":"paragraph","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"children":[{"type":"text","value":"Given the amount of time it takes to perform the largest cross-matches (","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"AioN1sgPmZ"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"qxMvehp0G6"},{"type":"text","value":" ","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"yJHiV7g1oM"},{"type":"inlineMath","value":"\\ge","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≥\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\ge\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"Uay9pxqBC2"},{"type":"text","value":" 1 billion), these were run only on the XLarge server using the default ","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"vyUQUnSvp6"},{"type":"inlineCode","value":"dask","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"bgOUHROUMu"},{"type":"text","value":" configuration. The full cross-match of over 7 billion rows took just over 4 hours.","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"HoYFKhfWep"}],"key":"XdqwjiPUZu"},{"type":"paragraph","position":{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},"children":[{"type":"text","value":"These graphs also illustrate the approximate maximum number of rows that can be cross matched with a given amount of RAM and CPU. Trying to cross-match more rows or use worker configurations that aren’t shown in the plots can lead to one of the following behaviors:","position":{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},"key":"hKOKoAD4Gm"}],"key":"m994gT54be"},{"type":"paragraph","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"strong","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"text","value":"Small (4GB RAM, 2 CPU)","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"key":"YEiuOMwE9s"}],"key":"WlslLHjWp4"}],"key":"Gabrzhhj0V"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"When attempting ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"ZeFIJ19nfO"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"ZkimmCYf3c"},{"type":"text","value":" ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"X7chZHGk1E"},{"type":"inlineMath","value":"\\ge","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≥\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\ge\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"hMjNzS25SC"},{"type":"text","value":" 10 million, the cross-match exhibits long compute times, seeming never to finish.","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"hFvELRcWuB"}],"key":"gGBJsb716L"},{"type":"paragraph","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"strong","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"Medium (16GB RAM, 4 CPU)","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"A62s60gtKC"}],"key":"xCQcUqQqXy"}],"key":"s6QnisiGN0"},{"type":"paragraph","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"When attempting ","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"ojb1RSXpe4"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"FoX74JSIwi"},{"type":"text","value":" ","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"DyR2Ab4Uy2"},{"type":"inlineMath","value":"\\ge","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≥\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\ge\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"IAKqXmCseV"},{"type":"text","value":" 100 million, the cross-match exhibits long compute times, seeming never to finish.","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"IEyDz3wFFW"}],"key":"v8PcD2zod1"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"strong","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"Large (64GB RAM, 16 CPU)","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"KRH6RsFp8H"}],"key":"gzk9pQqzYA"}],"key":"KugL8GVhMS"},{"type":"paragraph","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"children":[{"type":"text","value":"When attempting ","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"pOpMuyQqTs"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"T75VOsc7Kq"},{"type":"text","value":" = 100 million with anything but 16 or ‘default’ values for ","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"FWvn8ZGILf"},{"type":"inlineCode","value":"dask_workers","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"BPF3xNesiP"},{"type":"text","value":", the cross-match exhibits long compute times, seeming never to finish. When attempting ","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"xjxbiv4YcD"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"UXTZ6t0ye3"},{"type":"text","value":" ","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"ikZQNeJjVq"},{"type":"inlineMath","value":"\\ge","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≥\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\ge\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"h7fxXo21xw"},{"type":"text","value":" 1 billion, the cross-match exhibits long compute times, seeming never to finish.","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"mQPSv6jTsu"}],"key":"ZYbhmyEYXC"},{"type":"paragraph","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"children":[{"type":"strong","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"children":[{"type":"text","value":"XLarge (512GB RAM, 128 CPU)","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"key":"gdFFvPy7SM"}],"key":"M0eBpWhtLI"}],"key":"NL0xlO0oC4"},{"type":"paragraph","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"The XLarge environment was able to complete all attempted cross-matches, except that setting ","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"qWPdToVFG6"},{"type":"inlineCode","value":"dask_workers='scale'","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"GIAyruAvjg"},{"type":"text","value":" resulted in the dead worker behavior documented below.","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"xMihFUwE7Q"}],"key":"lHtfFkbC3J"},{"type":"paragraph","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"strong","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"text","value":"Autoscaling on any environment","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"GDAUahfemY"}],"key":"cgXEQGq4Xb"}],"key":"PMsGXkJOk9"},{"type":"paragraph","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"children":[{"type":"text","value":"When using ","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"F75mBnelyt"},{"type":"inlineCode","value":"dask_workers='scale'","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"QXGuSt1Mar"},{"type":"text","value":" and scaling up the number of rows to cross-match, eventually you will see logging output from the ","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"TkLNHrik41"},{"type":"inlineCode","value":"dask","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"QRehWwCYk5"},{"type":"text","value":" cluster indicating that workers have died and are being respawn. This behavior repeats, and the cross-match never finishes (after being allowed to run for, e.g., an hour when it is expected to finish in 5 minutes).","position":{"start":{"line":288,"column":1},"end":{"line":288,"column":1}},"key":"CGpRkMTS1f"}],"key":"TUGLoOVTyQ"}],"key":"snMKGFCVUF"},{"type":"block","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"children":[{"type":"text","value":"5. Summary","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"key":"iXec8aNXS1"}],"identifier":"id-5-summary","label":"5. Summary","html_id":"id-5-summary","implicit":true,"key":"bQV0nUYdeb"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"The Fornax Science Console is capable of hosting cross-matches between large catalogs using the ","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"JlP6yFAC3w"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"uSevDZul15"},{"type":"text","value":" package. ","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"nNYZ59zwHs"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"HLO1SwkCCD"},{"type":"text","value":" leverages ","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"zjpdpaoztN"},{"type":"inlineCode","value":"dask","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"DIFqiEDcnZ"},{"type":"text","value":" to efficiently plan cross-match jobs using multiple workers, which results in large performance gains, especially as jobs scale up to millions or tens of millions of catalog rows.","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"jE6WciF4Px"}],"key":"pF0DFMRFoT"},{"type":"paragraph","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"strong","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"text","value":"Recommendations","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"anb2aB9B1Y"}],"key":"YsMr7NojYW"}],"key":"n2bdUgRPr7"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":298,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"For small cross-matches (1 million rows or less) it is acceptable and often optimal to use ","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"vcy4QPC3Xm"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"kbYs3NcYYP"},{"type":"text","value":"’s default ","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"J6xtnPCjiy"},{"type":"inlineCode","value":"dask","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"ii0Xa7vlzs"},{"type":"text","value":" settings to parallelize jobs. In other words, for these jobs you don’t need to configure or even import ","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"Qbo3mDtLCj"},{"type":"inlineCode","value":"dask","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"Ys5q4KxeRI"},{"type":"text","value":" at all to leverage its parallelization power.","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"ofsAi1xrwV"}],"key":"vL9TPpZma8"}],"key":"DB4kQREG20"},{"type":"listItem","spread":true,"position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"For large cross-matches (millions of rows or more), we recommend running in an environment with at least tens of CPUs, and setting the number of ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"M66h0mllb8"},{"type":"inlineCode","value":"dask","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"SpJzuclavr"},{"type":"text","value":" workers to at least half the number of available CPUs, and up to the number of CPUs. E.g., 128 CPUs with 64 ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"UDjJNZdxkW"},{"type":"inlineCode","value":"dask","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"DUbREpc5OL"},{"type":"text","value":" workers.","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"Eoz5FrNRWv"}],"key":"aqwrm72h23"}],"key":"PooLyt2f8c"},{"type":"listItem","spread":true,"position":{"start":{"line":300,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Cross-matches of 10 million rows or less can, at the time of writing, be completed on the Small Fornax Console using the default ","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"opHMWl7RvJ"},{"type":"inlineCode","value":"dask","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"mI1ExrLhnb"},{"type":"text","value":" configuration. However, given the performance, we recommend the following use scaling:","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"Xm8UFck8l5"}],"key":"PDTYmCq618"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":301,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Nrows","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"NWxU0l6TI5"},{"type":"text","value":" ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"eaM9vgFbr0"},{"type":"inlineMath","value":"\\le 10^6","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e6\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\le 10^6\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e6\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"pAyFilpy1Y"},{"type":"text","value":": Small","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"fhXY39d5aZ"}],"key":"AHqfQ9cmrW"}],"key":"cusEQliJxO"},{"type":"listItem","spread":true,"position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"10^6 \u003c","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e6\u003c/mn\u003e\u003c/msup\u003e\u003cmo\u003e\u0026lt;\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e10^6 \u0026lt;\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8532em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e6\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u0026lt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"OACT146det"},{"type":"text","value":" ","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"QrX1nQOZAs"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"mjCN31Blew"},{"type":"text","value":" ","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"omiXbM6GQt"},{"type":"inlineMath","value":"\u003c 10^7","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e\u0026lt;\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e7\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\u0026lt; 10^7\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e7\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"SMIwkwEKcp"},{"type":"text","value":": Medium","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"v681iuQwfY"}],"key":"eikobXD1EW"}],"key":"t8URnXkxmJ"},{"type":"listItem","spread":true,"position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"10^7 \u003c","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e7\u003c/mn\u003e\u003c/msup\u003e\u003cmo\u003e\u0026lt;\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e10^7 \u0026lt;\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8532em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e7\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u0026lt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"g8AyJCTlNm"},{"type":"text","value":" ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"MDTOmyOktg"},{"type":"inlineCode","value":"Nrows","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"WKTz2S46Up"},{"type":"text","value":" ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"rU1wd55iPG"},{"type":"inlineMath","value":"\u003c 10^8","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e\u0026lt;\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e8\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\u0026lt; 10^8\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e8\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"oUFnePYlfz"},{"type":"text","value":": Large","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"KDGBjH3UD3"}],"key":"lmrAc1Omja"}],"key":"UrICF4lWJh"},{"type":"listItem","spread":true,"position":{"start":{"line":304,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Nrows","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"FX6Xzt3SQ7"},{"type":"text","value":" ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"L7KzYxpDjU"},{"type":"inlineMath","value":"\u003e 10^8","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e\u0026gt;\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e8\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\u0026gt; 10^8\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e8\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"jmq3cQ9qgr"},{"type":"text","value":": XLarge","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"P5cqoGOO7x"}],"key":"n0U8kfNRxv"}],"key":"RpXPxOThzr"}],"key":"QX2X4La8FT"}],"key":"gu1SWTOhtq"}],"key":"V2jpAkGAtV"},{"type":"paragraph","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"children":[{"type":"text","value":"In this tutorial we have cross-matched sections of catalogs in a particular region of sky, where most of the stars likely fall in the same or neighboring sky cells. It would be useful in the future to try this using generic samples of stars from across the entire sky. How different is performance when the catalog rows come from many sky cells instead of just a few? We have also generated the cross-match using ","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"He7P2gVhAW"},{"type":"inlineCode","value":"compute","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"C5SHREAwoP"},{"type":"text","value":", which loads the full result into memory, but ","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"V1O7qa1mJg"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"sLUyDa5SAQ"},{"type":"text","value":" supports larger-than-memory cross-matches by writing them directly to disk using ","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"Z1vlIT7if9"},{"type":"inlineCode","value":"to_hats","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"UytAYzZcyf"},{"type":"text","value":". It would also be illustrative to run these benchmarks, and benchmarking a full cross-match between ZTF and Pan-STARRS, by writing the result to disk.","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"JdkHck5Bcp"}],"key":"TUqR2oQAvS"},{"type":"paragraph","position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"strong","position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"text","value":"Other Science Cases","position":{"start":{"line":308,"column":1},"end":{"line":308,"column":1}},"key":"il07FngaCH"}],"key":"WEZRNuh3A7"}],"key":"fhNB9zZkNy"},{"type":"paragraph","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"children":[{"type":"text","value":"The example science case used here is an investigation to collect time-series photometry from sources in and around the Kepler field. The time series associated with the ZTF and Pan-STARRS sources might be used to supplement the Kepler light curves, extend their time baseline, examine how stellar light curves change in different photometric filters, and more. But ","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"nPbhYzSd5K"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"yQd4sUg3Qm"},{"type":"text","value":" enables other science cases with other catalogs as well. Some examples might be to","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"h6wj2KWQ2q"}],"key":"xskFrapWce"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":312,"column":1},"end":{"line":315,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"combine photometric spectral energy distributions (SEDs) of distant galaxies with their spectra to build a training set for machine learning to predict photometric redshifts,","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"I1WqzjuZ3s"}],"key":"dWjp9Nf7Y1"}],"key":"FL3zNRM1KX"},{"type":"listItem","spread":true,"position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"combine Gaia’s exquisite astrometry with your favorite star survey to obtain 6D kinematic solutions for your sample stars,","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"ZafcQygL0B"}],"key":"Z6D0A4NSIC"}],"key":"Eeb1v7Mr2e"},{"type":"listItem","spread":true,"position":{"start":{"line":314,"column":1},"end":{"line":315,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"combine stellar spectroscopic catalogs with light curve rotation period measurements to estimate stellar ages using gyrochronology.","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"yImzZoR7hr"}],"key":"PEKHi507Hz"}],"key":"VR7cPdX9my"}],"key":"eClFKifNsl"}],"key":"JNLVc6o9sq"},{"type":"block","position":{"start":{"line":316,"column":1},"end":{"line":316,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},"children":[{"type":"text","value":"About this Notebook","position":{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},"key":"HSajG5ALBZ"}],"identifier":"about-this-notebook","label":"About this Notebook","html_id":"about-this-notebook","implicit":true,"key":"QKB3wmagaV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":320,"column":1},"end":{"line":322,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":320,"column":1},"end":{"line":320,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":320,"column":1},"end":{"line":320,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":320,"column":1},"end":{"line":320,"column":1}},"key":"CDeDK1BlKj"}],"key":"fXIZ396kIz"},{"type":"text","value":" Zach Claytor (Astronomical Data Scientist at Space Telescope Science Institute) and the Fornax team","position":{"start":{"line":320,"column":1},"end":{"line":320,"column":1}},"key":"WWEojYvPXK"}],"key":"R76KdsiAGY"}],"key":"TpZqAETIER"},{"type":"listItem","spread":true,"position":{"start":{"line":321,"column":1},"end":{"line":322,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"llo7P0kFjn"}],"key":"s0klzPqFlZ"},{"type":"text","value":" For help with this notebook, please open a topic in the ","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"G2o1uSdKRF"},{"type":"link","url":"https://discourse.fornax.sciencecloud.nasa.gov/","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"children":[{"type":"text","value":"Fornax Community Forum","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"Ft3hfagJuD"}],"urlSource":"https://discourse.fornax.sciencecloud.nasa.gov/","key":"uoK7RXautD"},{"type":"text","value":" “Support” category.","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"vDGDlo47RK"}],"key":"jHUIBVYDMD"}],"key":"w9QyhxTDbr"}],"key":"YZn0cQlf9T"}],"key":"cV5cdyX6OY"},{"type":"block","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"key":"rj5yi6iSzh"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"Mj9vpgL7bs"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":327,"column":1},"end":{"line":328,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This work uses ","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"yn9HQm1Bde"},{"type":"link","url":"https://www.astropy.org/acknowledging.html","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"inlineCode","value":"astropy","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"Fz4xLzkqj7"}],"urlSource":"https://www.astropy.org/acknowledging.html","key":"TfdNaEsGU4"},{"type":"text","value":".","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"LvZxQVxKKD"}],"key":"mpLvOkXrji"}],"key":"yZ8CsFzx8M"},{"type":"listItem","spread":true,"position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This work uses ","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"HjncePfxLE"},{"type":"link","url":"https://docs.lsdb.io/","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"children":[{"type":"inlineCode","value":"lsdb","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"VTFXmOOD14"}],"urlSource":"https://docs.lsdb.io/","key":"zK4Q9IK4IR"},{"type":"text","value":".","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"GzSpYOpLDr"}],"key":"mvBIi5VnV7"}],"key":"n45zWxeLz6"}],"key":"vUXeuuNHnC"}],"key":"Sr4umhl4xM"}],"key":"WHUwRICTHT"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Cross Matching","url":"/crossmatch","group":"The Fornax Initiative"}}},"domain":"http://localhost:3000"},"project":{"subject":"Fornax Demo Notebooks","settings":{"output_matplotlib_strings":"remove"},"description":"Tutorial notebooks for example Fornax use cases","authors":[{"id":"Fornax developers and scientists","name":"Fornax developers and scientists"}],"github":"https://github.com/nasa-fornax/fornax-demo-notebooks","keywords":["astronomy"],"references":{"fornax-docs":{"url":"https://docs.fornax.sciencecloud.nasa.gov"}},"toc":[{"file":"index.md"},{"children":[{"file":"light_curves/light_curve_collector.md"},{"file":"light_curves/scale_up.md"},{"file":"light_curves/light_curve_classifier.md"},{"file":"light_curves/ML_AGNzoo.md"}],"file":"light_curves/time-domain.md","title":"Light Curves"},{"children":[{"file":"spectroscopy/spectra_collector.md"}],"file":"spectroscopy/spectroscopy.md","title":"Spectroscopy"},{"children":[{"file":"forced_photometry/multiband_photometry.md"}],"file":"forced_photometry/forced-photometry.md","title":"Forced Photometry"},{"children":[{"file":"crossmatch/ztf_ps1_crossmatch.md"}],"file":"crossmatch/crossmatch.md","title":"Crossmatch"}],"exports":[],"bibliography":[],"title":"The Fornax Initiative","index":"index","pages":[{"slug":"time-domain","title":"Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"light-curve-collector","title":"Make Multi-Wavelength Light Curves Using Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"scale-up","title":"Make Multi-Wavelength Light Curves for Large Samples","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"light-curve-classifier","title":"Light Curve Classifier","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ml-agnzoo","title":"AGN Zoo: Comparison of AGN selected with different metrics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spectroscopy","title":"Spectroscopy","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectra-collector","title":"Extract Multi-Wavelength Spectroscopy from Archival Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"forced-photometry","title":"Multi-band forced photometry","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"multiband-photometry","title":"Automated Multiband Forced Photometry on Large Datasets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"crossmatch","title":"Cross Matching","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"ztf-ps1-crossmatch","title":"Cross-Match ZTF and Pan-STARRS using LSDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/fornax-demo-notebooks/build/manifest-86A905A4.js";
import * as route0 from "/fornax-demo-notebooks/build/root-CXYA7X5D.js";
import * as route1 from "/fornax-demo-notebooks/build/routes/$-JRBPULBO.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/fornax-demo-notebooks/build/entry.client-PCJPW7TK.js");</script></body></html>